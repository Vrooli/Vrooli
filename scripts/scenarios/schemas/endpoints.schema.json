{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://vrooli.com/schemas/endpoints.schema.json",
  "title": "Vrooli API Endpoints Registry",
  "description": "Comprehensive registry of API endpoints, WebSocket events, and CLI commands for a scenario. Used for testing, documentation generation, service discovery, and inter-scenario communication.",
  "type": "object",
  "required": ["version", "endpoints"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version (semver format)"
    },
    "endpoints": {
      "type": "array",
      "description": "HTTP/REST API endpoints",
      "items": {
        "type": "object",
        "required": ["id", "path", "method"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$",
            "description": "Unique identifier for this endpoint (kebab-case)",
            "examples": ["health-check", "create-project", "execute-workflow"]
          },
          "path": {
            "type": "string",
            "pattern": "^/",
            "description": "URL path (with route parameters in {braces})",
            "examples": ["/health", "/api/v1/projects", "/api/v1/workflows/{id}/execute"]
          },
          "method": {
            "type": "string",
            "enum": ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"],
            "description": "HTTP method"
          },
          "summary": {
            "type": "string",
            "description": "Brief one-line description of what this endpoint does",
            "examples": ["Create a new project", "Execute a workflow by ID"]
          },
          "description": {
            "type": "string",
            "description": "Detailed description of endpoint behavior, use cases, and side effects"
          },
          "category": {
            "type": "string",
            "description": "Logical grouping category (matches categories section keys)",
            "examples": ["system", "projects", "workflows", "executions", "ai"]
          },
          "params": {
            "type": "object",
            "description": "Path parameters (e.g., {id} in /workflows/{id})",
            "additionalProperties": {
              "type": "object",
              "required": ["type"],
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["string", "integer", "uuid"],
                  "description": "Parameter data type"
                },
                "description": {
                  "type": "string"
                },
                "required": {
                  "type": "boolean",
                  "default": true
                },
                "pattern": {
                  "type": "string",
                  "description": "Regex pattern for validation"
                }
              }
            }
          },
          "query": {
            "type": "object",
            "description": "Query string parameters",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["string", "integer", "boolean", "array"]
                },
                "description": {
                  "type": "string"
                },
                "required": {
                  "type": "boolean",
                  "default": false
                },
                "default": {
                  "description": "Default value if not provided"
                }
              }
            }
          },
          "request": {
            "type": "object",
            "description": "Request body schema (for POST/PUT/PATCH)",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["object", "array", "string", "binary"],
                "default": "object"
              },
              "content_type": {
                "type": "string",
                "default": "application/json",
                "examples": ["application/json", "multipart/form-data", "text/plain"]
              },
              "required": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Required field names"
              },
              "properties": {
                "type": "object",
                "description": "Field name to type mapping (simplified schema)",
                "additionalProperties": {
                  "type": "string",
                  "description": "Type or description of field"
                }
              },
              "schema_ref": {
                "type": "string",
                "description": "Reference to external JSON schema or OpenAPI component"
              }
            }
          },
          "response": {
            "type": "object",
            "description": "Success response schema (2xx)",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["object", "array", "string", "binary", "stream"]
              },
              "description": {
                "type": "string"
              },
              "properties": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                }
              },
              "schema_ref": {
                "type": "string"
              }
            }
          },
          "security": {
            "type": "object",
            "description": "Security and access control requirements",
            "properties": {
              "authentication": {
                "type": "string",
                "enum": ["none", "optional", "required"],
                "default": "none",
                "description": "Authentication requirement level"
              },
              "roles": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Required user roles or permissions"
              },
              "rate_limit": {
                "type": "string",
                "pattern": "^\\d+/(second|minute|hour|day)$",
                "description": "Rate limiting rule",
                "examples": ["100/hour", "10/second"]
              },
              "api_key": {
                "type": "boolean",
                "default": false,
                "description": "Whether API key is required"
              }
            }
          },
          "requirements": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Requirement IDs that this endpoint satisfies or validates"
          },
          "performance": {
            "type": "object",
            "description": "Performance expectations and SLA targets",
            "properties": {
              "expected_latency_ms": {
                "type": "integer",
                "description": "Expected p50 response time in milliseconds"
              },
              "max_latency_ms": {
                "type": "integer",
                "description": "Maximum acceptable response time (p95/p99)"
              },
              "timeout_ms": {
                "type": "integer",
                "description": "Request timeout in milliseconds"
              }
            }
          },
          "examples": {
            "type": "array",
            "description": "Example requests and responses",
            "items": {
              "type": "object",
              "required": ["name"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Example scenario name"
                },
                "request": {
                  "description": "Example request body (JSON or other format)"
                },
                "response": {
                  "description": "Example response body"
                },
                "curl": {
                  "type": "string",
                  "description": "Example curl command"
                }
              }
            }
          },
          "cli_mapping": {
            "type": "object",
            "description": "How this endpoint maps to CLI command(s)",
            "properties": {
              "command": {
                "type": "string",
                "description": "CLI command path (space-separated subcommands)",
                "examples": ["status", "project create", "workflow execute"]
              },
              "args": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "CLI argument/flag names",
                "examples": [["--name", "--folder"], ["--id", "--wait"]]
              }
            }
          },
          "websocket": {
            "type": "object",
            "description": "Associated WebSocket events for real-time updates",
            "properties": {
              "path": {
                "type": "string",
                "description": "WebSocket endpoint path"
              },
              "events": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Event names that may be emitted"
              }
            }
          },
          "deprecated": {
            "type": "boolean",
            "default": false,
            "description": "Whether this endpoint is deprecated"
          },
          "experimental": {
            "type": "boolean",
            "default": false,
            "description": "Whether this endpoint is experimental/beta"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Additional tags for filtering/grouping"
          }
        }
      }
    },
    "categories": {
      "type": "object",
      "description": "Endpoint category definitions for organization and documentation",
      "additionalProperties": {
        "type": "object",
        "required": ["title"],
        "properties": {
          "title": {
            "type": "string",
            "description": "Display title for this category"
          },
          "description": {
            "type": "string",
            "description": "Category description"
          },
          "order": {
            "type": "integer",
            "description": "Display order (lower numbers first)"
          }
        }
      }
    },
    "websockets": {
      "type": "array",
      "description": "WebSocket endpoint definitions",
      "items": {
        "type": "object",
        "required": ["path"],
        "properties": {
          "path": {
            "type": "string",
            "description": "WebSocket connection path",
            "examples": ["/ws", "/api/v1/stream"]
          },
          "description": {
            "type": "string",
            "description": "Purpose and behavior of this WebSocket"
          },
          "protocol": {
            "type": "string",
            "description": "WebSocket sub-protocol if applicable"
          },
          "events": {
            "type": "object",
            "description": "Event name to description mapping",
            "additionalProperties": {
              "type": "string",
              "description": "Event description"
            }
          },
          "authentication": {
            "type": "string",
            "enum": ["none", "query-param", "initial-message", "header"],
            "description": "How WebSocket authenticates"
          },
          "requirements": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Requirement IDs validated by this WebSocket"
          }
        }
      }
    },
    "cli_commands": {
      "type": "array",
      "description": "CLI command definitions (complement to endpoint cli_mapping)",
      "items": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Command name (space-separated for subcommands)",
            "examples": ["status", "workflow create", "execution watch"]
          },
          "aliases": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Command aliases or shortcuts"
          },
          "subcommands": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Available subcommands under this command"
          },
          "description": {
            "type": "string",
            "description": "What this command does"
          },
          "endpoint_id": {
            "type": "string",
            "description": "ID of endpoint this command calls (if applicable)"
          },
          "requirements": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Requirement IDs this command satisfies"
          },
          "examples": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "command": {
                  "type": "string",
                  "description": "Full command example"
                },
                "description": {
                  "type": "string",
                  "description": "What this example demonstrates"
                }
              }
            }
          }
        }
      }
    }
  }
}
