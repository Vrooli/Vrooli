{
  "value": {
    "grid": [
      {
        "id": "header",
        "data": {
          "type": "containercomponent",
          "configuration": {
            "title": "{{ scenario.name }}",
            "subtitle": "{{ scenario.description }}",
            "style": {
              "backgroundColor": "#f8fafc",
              "padding": "1rem",
              "borderRadius": "0.5rem",
              "marginBottom": "1rem"
            }
          },
          "componentInput": {},
          "customCss": {},
          "tabs": [],
          "subgrids": []
        }
      },
      
      {
        "id": "main-interface",
        "data": {
          "type": "containercomponent",
          "configuration": {
            "title": "Main Interface",
            "style": {
              "padding": "1rem",
              "backgroundColor": "#ffffff",
              "borderRadius": "0.5rem",
              "border": "1px solid #e2e8f0"
            }
          },
          "componentInput": {},
          "customCss": {},
          "tabs": [],
          "subgrids": [
            {
              "id": "input-section",
              "data": [
                {% if "ai-assistance" in categories %}
                {
                  "id": "text-input",
                  "data": {
                    "type": "textinputcomponent",
                    "configuration": {
                      "label": "Enter your request",
                      "placeholder": "Type your AI assistance request here...",
                      "multiline": true,
                      "rows": 4
                    },
                    "componentInput": {
                      "defaultValue": ""
                    }
                  }
                },
                {% endif %}
                
                {% if "whisper" in resources.required %}
                {
                  "id": "audio-upload",
                  "data": {
                    "type": "fileinputcomponent",
                    "configuration": {
                      "label": "Upload Audio File",
                      "acceptedFileTypes": ["audio/*"],
                      "multiple": false
                    },
                    "componentInput": {}
                  }
                },
                {% endif %}
                
                {% if "comfyui" in resources.required %}
                {
                  "id": "image-generation-prompt",
                  "data": {
                    "type": "textinputcomponent",
                    "configuration": {
                      "label": "Image Generation Prompt",
                      "placeholder": "Describe the image you want to generate..."
                    },
                    "componentInput": {
                      "defaultValue": ""
                    }
                  }
                },
                {% endif %}
                
                {
                  "id": "submit-button",
                  "data": {
                    "type": "buttoncomponent",
                    "configuration": {
                      "label": "Process Request",
                      "color": "blue",
                      "size": "md",
                      "beforeIcon": "Play",
                      "loading": false
                    },
                    "componentInput": {
                      "onSuccess": {
                        "type": "runscript",
                        "script": "{{ scenario.id }}/process-request"
                      }
                    }
                  }
                }
              ]
            }
          ]
        }
      },
      
      {
        "id": "results-section",
        "data": {
          "type": "containercomponent",
          "configuration": {
            "title": "Results",
            "style": {
              "padding": "1rem",
              "backgroundColor": "#f0f9ff",
              "borderRadius": "0.5rem",
              "border": "1px solid #0ea5e9",
              "marginTop": "1rem"
            }
          },
          "componentInput": {},
          "customCss": {},
          "tabs": [],
          "subgrids": [
            {
              "id": "output-display",
              "data": [
                {
                  "id": "status-display",
                  "data": {
                    "type": "displaycomponent",
                    "configuration": {
                      "label": "Status"
                    },
                    "componentInput": {
                      "value": "Ready to process requests"
                    }
                  }
                },
                
                {% if "ai-assistance" in categories %}
                {
                  "id": "ai-response",
                  "data": {
                    "type": "textareainputcomponent",
                    "configuration": {
                      "label": "AI Response",
                      "readonly": true,
                      "rows": 6
                    },
                    "componentInput": {
                      "defaultValue": ""
                    }
                  }
                },
                {% endif %}
                
                {% if "comfyui" in resources.required %}
                {
                  "id": "generated-image",
                  "data": {
                    "type": "imagecomponent",
                    "configuration": {
                      "label": "Generated Image",
                      "altText": "Generated content"
                    },
                    "componentInput": {
                      "source": ""
                    }
                  }
                },
                {% endif %}
                
                {
                  "id": "performance-metrics",
                  "data": {
                    "type": "displaycomponent",
                    "configuration": {
                      "label": "Performance Metrics"
                    },
                    "componentInput": {
                      "value": "Processing time will appear here"
                    }
                  }
                }
              ]
            }
          ]
        }
      },
      
      {% if "analytics" in features or "questdb" in resources.required %}
      {
        "id": "analytics-dashboard",
        "data": {
          "type": "containercomponent",
          "configuration": {
            "title": "Analytics & Insights",
            "style": {
              "padding": "1rem",
              "backgroundColor": "#fefce8",
              "borderRadius": "0.5rem",
              "border": "1px solid #eab308",
              "marginTop": "1rem"
            }
          },
          "componentInput": {},
          "customCss": {},
          "tabs": [],
          "subgrids": [
            {
              "id": "metrics-grid",
              "data": [
                {
                  "id": "usage-stats",
                  "data": {
                    "type": "statcomponent",
                    "configuration": {
                      "label": "Total Requests",
                      "value": "0",
                      "progress": false
                    },
                    "componentInput": {}
                  }
                },
                
                {
                  "id": "avg-response-time",
                  "data": {
                    "type": "statcomponent",
                    "configuration": {
                      "label": "Avg Response Time",
                      "value": "0ms",
                      "progress": false
                    },
                    "componentInput": {}
                  }
                },
                
                {
                  "id": "success-rate",
                  "data": {
                    "type": "statcomponent",
                    "configuration": {
                      "label": "Success Rate",
                      "value": "100%",
                      "progress": true,
                      "progressColor": "green"
                    },
                    "componentInput": {}
                  }
                }
              ]
            }
          ]
        }
      },
      {% endif %}
      
      {
        "id": "configuration-panel",
        "data": {
          "type": "containercomponent",
          "configuration": {
            "title": "Configuration",
            "collapsible": true,
            "collapsed": true,
            "style": {
              "padding": "1rem",
              "backgroundColor": "#f1f5f9",
              "borderRadius": "0.5rem",
              "border": "1px solid #64748b",
              "marginTop": "1rem"
            }
          },
          "componentInput": {},
          "customCss": {},
          "tabs": [],
          "subgrids": [
            {
              "id": "config-options",
              "data": [
                {% if "ollama" in resources.required %}
                {
                  "id": "ai-model-select",
                  "data": {
                    "type": "selectcomponent",
                    "configuration": {
                      "label": "AI Model",
                      "placeholder": "Select AI model"
                    },
                    "componentInput": {
                      "items": [
                        {"value": "llama3.1:8b", "label": "Llama 3.1 8B (Balanced)"},
                        {"value": "qwen2.5-coder:7b", "label": "Qwen 2.5 Coder 7B (Code)"},
                        {"value": "llava:7b", "label": "LLaVA 7B (Vision)"}
                      ],
                      "defaultValue": "llama3.1:8b"
                    }
                  }
                },
                
                {
                  "id": "temperature-slider",
                  "data": {
                    "type": "sliderinputcomponent",
                    "configuration": {
                      "label": "AI Temperature",
                      "min": 0.1,
                      "max": 1.0,
                      "step": 0.1
                    },
                    "componentInput": {
                      "defaultValue": 0.7
                    }
                  }
                },
                {% endif %}
                
                {
                  "id": "feature-toggles",
                  "data": {
                    "type": "checkboxcomponent",
                    "configuration": {
                      "label": "Enable Features"
                    },
                    "componentInput": {
                      "options": [
                        {% if "whisper" in resources.required %}
                        {"value": "speech_to_text", "label": "Speech-to-Text Processing"},
                        {% endif %}
                        {% if "comfyui" in resources.required %}
                        {"value": "image_generation", "label": "Image Generation"},
                        {% endif %}
                        {% if "postgres" in resources.required %}
                        {"value": "activity_logging", "label": "Activity Logging"},
                        {% endif %}
                        {"value": "performance_monitoring", "label": "Performance Monitoring"},
                        {"value": "detailed_responses", "label": "Detailed Responses"}
                      ],
                      "defaultValue": [
                        {% if "whisper" in resources.required %}"speech_to_text",{% endif %}
                        {% if "comfyui" in resources.required %}"image_generation",{% endif %}
                        {% if "postgres" in resources.required %}"activity_logging",{% endif %}
                        "performance_monitoring"
                      ]
                    }
                  }
                }
              ]
            }
          ]
        }
      },
      
      {
        "id": "footer",
        "data": {
          "type": "containercomponent",
          "configuration": {
            "style": {
              "padding": "1rem",
              "backgroundColor": "#f8fafc",
              "borderRadius": "0.5rem",
              "marginTop": "2rem",
              "textAlign": "center",
              "fontSize": "0.875rem",
              "color": "#64748b"
            }
          },
          "componentInput": {},
          "customCss": {},
          "tabs": [],
          "subgrids": [
            {
              "id": "footer-content",
              "data": [
                {
                  "id": "footer-text",
                  "data": {
                    "type": "displaycomponent",
                    "configuration": {
                      "label": ""
                    },
                    "componentInput": {
                      "value": "{{ scenario.name }} v{{ scenario.version }} | Powered by Vrooli AI Platform | Target: {{ business.target_markets[0] if business.target_markets else 'General Use' }}"
                    }
                  }
                }
              ]
            }
          ]
        }
      }
    ]
  },
  
  "summary": "{{ scenario.name }} - Professional UI Application",
  
  "path": "{{ scenario.id }}",
  
  "policy": {
    "on_behalf_of": "u/admin",
    "on_behalf_of_email": "admin@vrooli.com"
  },
  
  "versions": [],
  
  "schema": {
    "type": "object",
    "properties": {
      "text_input": {
        "type": "string",
        "description": "User text input for processing"
      },
      {% if "whisper" in resources.required %}
      "audio_file": {
        "type": "string",
        "format": "binary",
        "description": "Audio file for speech-to-text processing"
      },
      {% endif %}
      {% if "comfyui" in resources.required %}
      "image_prompt": {
        "type": "string",
        "description": "Prompt for image generation"
      },
      {% endif %}
      "configuration": {
        "type": "object",
        "properties": {
          {% if "ollama" in resources.required %}
          "ai_model": {
            "type": "string",
            "enum": ["llama3.1:8b", "qwen2.5-coder:7b", "llava:7b"],
            "default": "llama3.1:8b"
          },
          "temperature": {
            "type": "number",
            "minimum": 0.1,
            "maximum": 1.0,
            "default": 0.7
          },
          {% endif %}
          "enabled_features": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "default": [
              {% if "whisper" in resources.required %}"speech_to_text",{% endif %}
              {% if "comfyui" in resources.required %}"image_generation",{% endif %}
              "performance_monitoring"
            ]
          }
        }
      }
    },
    "required": []
  },
  
  "extra_perms": {},
  
  "execution_mode": "viewer",
  
  "draft_only": false,
  
  "tag": "{{ scenario.id }}-app",
  
  "ws_error_handler_muted": false,
  
  "bg_runs_enabled": true,
  
  "visible_to_runner_only": false,
  
  "no_logs": false,
  
  "preprocessor": {
    "type": "deno",
    "content": "// Preprocessor for {{ scenario.name }}\n// This runs before the main application logic\n\nconst scenarioConfig = {\n  id: '{{ scenario.id }}',\n  name: '{{ scenario.name }}',\n  version: '{{ scenario.version }}',\n  categories: {{ categories | tojson }},\n  complexity: '{{ complexity }}',\n  required_resources: {{ resources.required | tojson }}\n};\n\n// Initialize application state\nconst appState = {\n  initialized_at: new Date().toISOString(),\n  session_id: crypto.randomUUID(),\n  config: scenarioConfig,\n  features_enabled: {{ resources.required | tojson }},\n  performance_metrics: {\n    requests_processed: 0,\n    total_processing_time_ms: 0,\n    average_response_time_ms: 0\n  }\n};\n\n// Validate required resources\nconst validateResources = async () => {\n  const resourceChecks = [];\n  \n  {% if \"ollama\" in resources.required %}\n  resourceChecks.push(checkResource('ollama', 'http://localhost:11434/api/tags'));\n  {% endif %}\n  \n  {% if \"n8n\" in resources.required %}\n  resourceChecks.push(checkResource('n8n', 'http://localhost:5678/healthz'));\n  {% endif %}\n  \n  {% if \"postgres\" in resources.required %}\n  resourceChecks.push(checkResource('postgres', 'postgresql://postgres:postgres@localhost:5433/{{ scenario.id | replace(\"-\", \"_\") }}'));\n  {% endif %}\n  \n  const results = await Promise.allSettled(resourceChecks);\n  return results.every(result => result.status === 'fulfilled');\n};\n\nconst checkResource = async (name, url) => {\n  try {\n    if (url.startsWith('http')) {\n      const response = await fetch(url, { method: 'GET', timeout: 5000 });\n      return response.ok;\n    } else {\n      // For database connections, we'll assume they're available\n      // In a real implementation, you'd check the actual connection\n      return true;\n    }\n  } catch (error) {\n    console.warn(`Resource ${name} check failed:`, error.message);\n    return false;\n  }\n};\n\n// Export for use in the main application\nexport { appState, validateResources, scenarioConfig };"
  }
}