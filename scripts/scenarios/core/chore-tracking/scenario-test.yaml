name: chore-tracking
description: Test suite for ChoreQuest gamified chore tracking
type: lifestyle-application
version: 1.0.0

tests:
  - name: "API Health Check"
    type: api
    endpoint: "/health"
    method: GET
    expected:
      status: 200
      body:
        status: "healthy"
        service: "chore-tracking"

  - name: "List Chores"
    type: api
    endpoint: "/api/chores"
    method: GET
    expected:
      status: 200
      body_contains:
        - "id"
        - "name"
        - "points"
        - "difficulty"

  - name: "Get User Points"
    type: api
    endpoint: "/api/users/demo_user/stats"
    method: GET
    expected:
      status: 200
      body_contains:
        - "total_points"
        - "level"
        - "streak"

  - name: "List Rewards"
    type: api
    endpoint: "/api/rewards"
    method: GET
    expected:
      status: 200
      body_contains:
        - "name"
        - "cost_points"
        - "category"

  - name: "CLI List Command"
    type: cli
    command: "chore-tracker list"
    expected:
      exit_code: 0
      output_contains:
        - "Available Chores"

  - name: "CLI Points Command"
    type: cli  
    command: "chore-tracker points --user demo_user"
    expected:
      exit_code: 0
      output_contains:
        - "Points"
        - "Level"

  - name: "N8n Workflow - Chore Scheduler"
    type: workflow
    workflow_id: "chore-scheduler"
    test_data:
      action: "generate_weekly_schedule"
      user_id: "demo_user"
      preferences:
        max_daily_chores: 3
        preferred_time: "morning"
    expected:
      status: "success"
      response_contains:
        - "schedule"
        - "week_start"

  - name: "N8n Workflow - Points Calculator"
    type: workflow
    workflow_id: "points-calculator"
    test_data:
      chore_id: "chore-001"
      user_id: "demo_user"
      completion_time: 20
      quality_rating: 4
      difficulty: "medium"
      base_points: 10
    expected:
      status: "success"
      response_contains:
        - "calculated_points"
        - "multipliers_applied"

  - name: "UI Accessibility"
    type: ui
    url: "/"
    checks:
      - title_contains: "ChoreQuest"
      - element_exists: "#quests-grid"
      - element_exists: ".nav-btn"
      - element_exists: "#user-points"

  - name: "Database Connection"
    type: database
    query: "SELECT COUNT(*) FROM chores"
    expected:
      row_count: 15

  - name: "Redis Cache"
    type: cache
    operation: "ping"
    expected:
      response: "PONG"

pre_test:
  - description: "Ensure database is initialized"
    command: "psql -h localhost -U postgres -d chore_tracking -c 'SELECT 1'"
  - description: "Check n8n workflows are active"
    command: "curl -sf http://localhost:5678/api/v1/workflows"

post_test:
  - description: "Clean test data"
    command: "psql -h localhost -U postgres -d chore_tracking -c 'DELETE FROM chore_assignments WHERE user_id LIKE '\''test-%'\'''"

timeout: 60
retries: 3
parallel: false