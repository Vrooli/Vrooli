{
  "name": "Retro Game Generator",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "generate-game",
        "responseMode": "onReceived"
      },
      "name": "Game Generation Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "http://ollama:11434/api/generate",
        "method": "POST",
        "body": {
          "model": "codellama",
          "prompt": "Create a retro JavaScript game based on this prompt: {{$json.prompt}}\n\nGenerate complete, playable game code using HTML5 Canvas. Include:\n1. Game loop\n2. Player controls\n3. Score system\n4. Game over condition\n5. Retro pixel art style\n\nReturn only valid JavaScript code.",
          "stream": false,
          "options": {
            "temperature": 0.8,
            "max_tokens": 4000
          }
        }
      },
      "name": "Generate Game Code",
      "type": "n8n-nodes-base.httpRequest",
      "position": [450, 300]
    },
    {
      "parameters": {
        "url": "http://judge0:2358/submissions",
        "method": "POST",
        "body": {
          "source_code": "{{$json.response}}",
          "language_id": 63,
          "stdin": "",
          "expected_output": ""
        }
      },
      "name": "Validate Code",
      "type": "n8n-nodes-base.httpRequest",
      "position": [650, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "{{$json.status.id}}",
              "value2": 3
            }
          ]
        }
      },
      "name": "Check Validation",
      "type": "n8n-nodes-base.if",
      "position": [850, 300]
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "games",
        "columns": "title,prompt,code,author_id,engine",
        "returnFields": "id,title"
      },
      "name": "Save Game",
      "type": "n8n-nodes-base.postgres",
      "position": [1050, 250]
    },
    {
      "parameters": {
        "url": "http://ollama:11434/api/generate",
        "method": "POST",
        "body": {
          "model": "llama3.2",
          "prompt": "Generate retro pixel art assets for game: {{$json.title}}\nReturn as base64 encoded 32x32 sprite data.",
          "stream": false
        }
      },
      "name": "Generate Assets",
      "type": "n8n-nodes-base.httpRequest",
      "position": [1250, 250]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "error",
              "value": "Code validation failed"
            }
          ]
        }
      },
      "name": "Error Response",
      "type": "n8n-nodes-base.set",
      "position": [1050, 350]
    }
  ],
  "connections": {
    "Game Generation Webhook": {"main": [[{"node": "Generate Game Code"}]]},
    "Generate Game Code": {"main": [[{"node": "Validate Code"}]]},
    "Validate Code": {"main": [[{"node": "Check Validation"}]]},
    "Check Validation": {
      "main": [
        [{"node": "Save Game"}],
        [{"node": "Error Response"}]
      ]
    },
    "Save Game": {"main": [[{"node": "Generate Assets"}]]}
  }
}