{
  "$schema": "./schemas/service.schema.json",
  "version": "1.0.0",
  "service": {
    "name": "personal-digital-twin",
    "displayName": "Personal Digital Twin",
    "description": "Create AI personas from personal data with semantic search and model fine-tuning for personal productivity",
    "version": "1.0.0",
    "type": "application",
    "tags": [
      "ai",
      "personas",
      "productivity",
      "fine-tuning",
      "semantic-search"
    ],
    "license": "MIT"
  },
  "resources": {
    "ai": {
      "ollama": {
        "enabled": true,
        "models": [
          "llama3.2",
          "nomic-embed-text",
          "gemma2",
          "mistral"
        ],
        "features": [
          "fine-tuning",
          "embeddings",
          "chat"
        ],
        "purpose": "Core AI for personas and embeddings"
      },
      "unstructured-io": {
        "enabled": true,
        "purpose": "Process documents, emails, and data sources"
      }
    },
    "storage": {
      "postgres": {
        "enabled": true,
        "databases": [
          "digital_twin"
        ],
        "purpose": "Store persona configurations and metadata"
      },
      "qdrant": {
        "enabled": true,
        "collections": [
          "memories",
          "documents",
          "conversations"
        ],
        "purpose": "Vector storage for semantic search"
      },
      "minio": {
        "enabled": true,
        "buckets": [
          "data-sources",
          "processed-docs",
          "model-checkpoints"
        ],
        "purpose": "Store raw data and fine-tuned models"
      }
    },
    "automation": {
      "n8n": {
        "enabled": true,
        "workflows": [
          "data-ingestion",
          "model-training",
          "memory-indexing"
        ],
        "purpose": "Orchestrate data processing and training"
      },
      "windmill": {
        "enabled": true,
        "apps": [
          "persona-manager",
          "data-source-config"
        ],
        "purpose": "Web UI for persona management and configuration"
      }
    }
  },
  "serve": {
    "ports": {
      "ui": 3200,
      "api": 8200,
      "chat": 8201
    },
    "environment": {
      "NODE_ENV": "production",
      "EMBEDDING_MODEL": "nomic-embed-text",
      "VECTOR_DIM": "768",
      "MAX_TOKENS": "8192",
      "POSTGRES_DB": "digital_twin"
    },
    "health": {
      "endpoint": "/health",
      "port": 8200
    }
  },
  "execution": {
    "startup": {
      "dependencies": [
        "postgres",
        "qdrant",
        "ollama",
        "minio",
        "n8n",
        "windmill"
      ],
      "initScripts": [
        "initialize-database.sh",
        "setup-qdrant-collections.sh",
        "import-n8n-workflows.sh",
        "deploy-windmill-apps.sh"
      ]
    },
    "integrations": {
      "data_sources": {
        "google_drive": {
          "enabled": true,
          "oauth": true
        },
        "github": {
          "enabled": true,
          "types": [
            "commits",
            "issues",
            "code"
          ]
        },
        "email": {
          "enabled": true,
          "protocols": [
            "imap",
            "gmail-api"
          ]
        },
        "local_files": {
          "enabled": true,
          "formats": [
            "pdf",
            "txt",
            "md",
            "docx",
            "json"
          ]
        }
      },
      "external": {
        "app-personalizer": {
          "description": "Provide digital twins for app customization",
          "protocol": "api",
          "endpoints": [
            "/api/twin/export",
            "/api/twin/chat"
          ]
        }
      }
    }
  },
  "features": {
    "semantic_search": {
      "enabled": true,
      "rerank": true,
      "hybrid_search": true
    },
    "fine_tuning": {
      "enabled": true,
      "techniques": [
        "lora",
        "qlora"
      ],
      "auto_train": true
    },
    "multi_persona": {
      "enabled": true,
      "max_personas": 10
    }
  },
  "lifecycle": {
    "version": "1.0.0",
    "setup": {
      "description": "Initialize Personal Digital Twin",
      "steps": [
        {
          "name": "base-setup",
          "run": "bash scripts/lib/setup.sh",
          "description": "Execute generic setup (e.g. network, system, git)"
        },
        {
          "name": "add-data",
          "run": "scripts/lib/resources/runtime-engine.sh .",
          "description": "Add app data to resources"
        },
        {
          "name": "show-urls",
          "run": "echo 'ðŸš€ Personal Digital Twin initialized\\n  Windmill Dashboard: http://localhost:${RESOURCE_PORTS[windmill]}\\n  n8n workflows: http://localhost:${RESOURCE_PORTS[n8n]}\\n  Qdrant Vector Search: http://localhost:${RESOURCE_PORTS[qdrant]}\\n  Ollama Model Training: http://localhost:${RESOURCE_PORTS[ollama]}\\n  Chat Interface: http://localhost:8201'",
          "description": "Display service access URLs"
        }
      ]
    },
    "develop": {
      "description": "Start Personal Digital Twin services",
      "steps": [
        {
          "name": "start-services",
          "run": "cd deployment && ./deploy-windmill-apps.sh && ./import-n8n-workflows.sh",
          "description": "Deploy apps and import workflows"
        },
        {
          "name": "start-servers",
          "run": "cd deployment && node api-server.js &; node chat-server.js &",
          "description": "Start API and chat servers",
          "background": true
        }
      ]
    },
    "test": {
      "description": "Test Personal Digital Twin functionality",
      "steps": [
        {
          "name": "run-tests",
          "run": "bash scenario-test.yaml",
          "description": "Execute scenario tests"
        }
      ]
    },
    "stop": {
      "description": "Stop Personal Digital Twin services",
      "steps": [
        {
          "name": "stop-services",
          "run": "pkill -f 'api-server.js' || true; pkill -f 'chat-server.js' || true",
          "description": "Stop all digital twin processes"
        }
      ]
    },
    "build": {
      "description": "Build Personal Digital Twin artifacts",
      "steps": [
        {
          "name": "build-artifacts",
          "run": "./scripts/manage.sh build"
        }
      ]
    },
    "test": {
      "description": "Run Personal Digital Twin tests",
      "steps": [
        {
          "name": "run-scenario-tests",
          "run": "../../tools/scenario-test-runner.sh scenario-test.yaml"
        }
      ]
    },
    "clean": {
      "description": "Clean build artifacts and temporary files",
      "steps": [
        {
          "name": "clean-artifacts",
          "run": "rm -rf dist/ build/ .next/ node_modules/ .cache/ || true"
        }
      ]
    }
  }
}
