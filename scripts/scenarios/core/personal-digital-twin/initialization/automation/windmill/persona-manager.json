{
  "summary": "Personal Digital Twin - Persona Manager",
  "description": "Web interface for creating and managing AI personas",
  "policy": {
    "on_behalf_of": "u/admin",
    "on_behalf_of_email": "admin@windmill.dev"
  },
  "grid": [
    {
      "id": "a",
      "data": {
        "type": "displaycomponent",
        "componentInput": {
          "type": "static",
          "value": {
            "title": "Personal Digital Twin - Persona Manager",
            "description": "Create and manage AI personas trained on your personal data"
          }
        },
        "configuration": {
          "style": {
            "backgroundColor": "#f8fafc",
            "padding": "1rem",
            "borderRadius": "0.5rem"
          }
        }
      },
      "3": { "x": 0, "y": 0, "w": 12, "h": 2 }
    },
    {
      "id": "b", 
      "data": {
        "type": "buttoncomponent",
        "componentInput": {
          "type": "static",
          "value": {
            "label": "Create New Persona",
            "color": "blue",
            "size": "md"
          }
        },
        "runnable": {
          "type": "runnableByName",
          "name": "f/personas/create_persona"
        }
      },
      "3": { "x": 0, "y": 2, "w": 3, "h": 1 }
    },
    {
      "id": "c",
      "data": {
        "type": "tablecomponent", 
        "componentInput": {
          "type": "runnable",
          "runnable": {
            "type": "runnableByName",
            "name": "f/personas/list_personas"
          }
        },
        "configuration": {
          "columns": {
            "name": {
              "displayName": "Name"
            },
            "description": {
              "displayName": "Description"
            },
            "document_count": {
              "displayName": "Documents"
            },
            "training_status": {
              "displayName": "Status"
            },
            "created_at": {
              "displayName": "Created",
              "type": "datetime"
            }
          },
          "actions": [
            {
              "id": "train",
              "displayName": "Train Model",
              "runnable": {
                "type": "runnableByName", 
                "name": "f/personas/train_persona"
              }
            },
            {
              "id": "chat",
              "displayName": "Chat",
              "runnable": {
                "type": "runnableByName",
                "name": "f/personas/open_chat"
              }
            },
            {
              "id": "delete",
              "displayName": "Delete",
              "runnable": {
                "type": "runnableByName",
                "name": "f/personas/delete_persona"
              },
              "confirmationModal": {
                "title": "Delete Persona?",
                "description": "This will permanently delete the persona and all associated data."
              }
            }
          ]
        }
      },
      "3": { "x": 0, "y": 3, "w": 12, "h": 8 }
    },
    {
      "id": "d",
      "data": {
        "type": "formcomponent",
        "componentInput": {
          "type": "static",
          "value": {
            "schema": {
              "properties": {
                "name": {
                  "type": "string",
                  "title": "Persona Name",
                  "description": "Unique name for your AI persona"
                },
                "description": {
                  "type": "string", 
                  "title": "Description",
                  "description": "Brief description of the persona's purpose"
                },
                "base_model": {
                  "type": "string",
                  "title": "Base Model",
                  "enum": ["llama3.2", "gemma2", "mistral"],
                  "default": "llama3.2"
                },
                "personality_traits": {
                  "type": "object",
                  "title": "Personality Traits",
                  "properties": {
                    "creativity": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1,
                      "default": 0.7
                    },
                    "analytical": {
                      "type": "number", 
                      "minimum": 0,
                      "maximum": 1,
                      "default": 0.8
                    },
                    "empathy": {
                      "type": "number",
                      "minimum": 0, 
                      "maximum": 1,
                      "default": 0.6
                    }
                  }
                }
              },
              "required": ["name", "description"]
            }
          }
        },
        "runnable": {
          "type": "runnableByName",
          "name": "f/personas/create_persona"
        },
        "configuration": {
          "displayType": "modal",
          "modalTitle": "Create New Persona"
        }
      },
      "3": { "x": 3, "y": 2, "w": 6, "h": 1 }
    }
  ],
  "unusedInlineScripts": [
    {
      "name": "f/personas/list_personas",
      "language": "postgresql",
      "content": "SELECT id, name, description, document_count, training_status, created_at FROM personas ORDER BY created_at DESC;",
      "schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "properties": {}
      }
    },
    {
      "name": "f/personas/create_persona", 
      "language": "postgresql",
      "content": "INSERT INTO personas (name, description, base_model, personality_traits) VALUES ($1, $2, $3, $4::jsonb) RETURNING id;",
      "schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object", 
        "properties": {
          "name": {"type": "string"},
          "description": {"type": "string"},
          "base_model": {"type": "string"},
          "personality_traits": {"type": "object"}
        },
        "required": ["name", "description"]
      }
    },
    {
      "name": "f/personas/train_persona",
      "language": "bash",
      "content": "#!/bin/bash\n# Trigger persona training via n8n webhook\ncurl -X POST http://n8n:5678/webhook/train \\\n  -H \"Content-Type: application/json\" \\\n  -d \"{\\\"persona_id\\\": \\\"$1\\\", \\\"model\\\": \\\"llama3.2\\\", \\\"technique\\\": \\\"lora\\\"}\"",
      "schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "properties": {
          "persona_id": {"type": "string"}
        },
        "required": ["persona_id"]
      }
    },
    {
      "name": "f/personas/delete_persona",
      "language": "postgresql", 
      "content": "DELETE FROM personas WHERE id = $1;",
      "schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "properties": {
          "persona_id": {"type": "string"}
        },
        "required": ["persona_id"]
      }
    },
    {
      "name": "f/personas/open_chat",
      "language": "bash",
      "content": "#!/bin/bash\n# Open chat interface for persona\necho \"http://localhost:8201/chat?persona_id=$1\"",
      "schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "type": "object",
        "properties": {
          "persona_id": {"type": "string"}
        },
        "required": ["persona_id"]
      }
    }
  ]
}