version: 1.0
scenario: multi-modal-ai-assistant

# Structure validation
structure:
  required_files:
    - .vrooli/service.json
    - initialization/storage/schema.sql
    - initialization/storage/seed.sql
    - initialization/automation/n8n/main-workflow.json
    - initialization/automation/windmill/windmill-app.json
    - initialization/automation/triggers.yaml
    - initialization/configuration/app-config.json
    - initialization/configuration/feature-flags.json
    - initialization/configuration/resource-urls.json
    - ui/multimodal-assistant-app.json
    - ui/deploy-ui.sh
    - deployment/startup.sh
    - test.sh
    - custom-tests.sh
  
  required_dirs:
    - initialization/storage
    - initialization/automation
    - initialization/configuration
    - deployment
    - ui

# Resource requirements
resources:
  required: [postgres, whisper, ollama, comfyui, agent-s2, windmill]
  optional: [minio, qdrant]
  health_timeout: 60

# Declarative tests
tests:
  - name: "PostgreSQL Database Ready"
    type: database
    service: postgres
    database: multi_modal_ai_assistant
    query: "SELECT table_name FROM information_schema.tables WHERE table_schema = 'multi_modal_ai_assistant'"
    expect:
      contains: ["conversations", "voice_interactions", "generated_images", "automation_requests"]
      
  - name: "Whisper Speech-to-Text Ready"
    type: http
    service: whisper
    endpoint: /
    method: GET
    expect:
      status: 200
      
  - name: "Ollama AI Models Ready"
    type: http
    service: ollama
    endpoint: /api/tags
    method: GET
    expect:
      status: 200
      body:
        type: json
        contains: ["llama3.1:8b", "llava:13b", "nomic-embed-text"]
        
  - name: "ComfyUI Visual Generation Ready"
    type: http
    service: comfyui
    endpoint: /system_stats
    method: GET
    expect:
      status: 200
      
  - name: "Agent-S2 Screen Automation Ready"
    type: http
    service: agent-s2
    endpoint: /health
    method: GET
    expect:
      status: 200
      
  - name: "Windmill UI Platform Ready"
    type: http
    service: windmill
    endpoint: /api/version
    method: GET
    expect:
      status: 200
      body:
        type: json

  - name: "Multi-Modal Workflow Integration Test"
    type: integration
    description: "Test voice-to-action workflow pipeline"
    workflow:
      - step: "Process Voice Command"
        type: http
        service: whisper
        endpoint: /transcribe
        method: POST
        body:
          audio_data: "mock_audio_command"
          language: "en"
        expect:
          status: 200
          response_time: 30000
          
      - step: "Generate Visual Content"
        type: http
        service: comfyui
        endpoint: /api/prompt
        method: POST
        body:
          prompt: "Create a productivity dashboard mockup"
          workflow: "multimodal-ui-generation"
        expect:
          status: 200
          response_time: 60000
          
      - step: "Execute Screen Automation"
        type: http
        service: agent-s2
        endpoint: /mouse
        method: POST
        body:
          action: "click"
          x: 100
          y: 100
        expect:
          status: 200
          response_time: 5000

  - name: "Business Logic Integration"
    type: custom
    script: custom-tests.sh
    function: test_multimodal_business_workflow
    
  - name: "Accessibility Dashboard UI Test"
    type: http
    service: windmill
    endpoint: /f/multi-modal-ai-assistant/dashboard
    method: GET
    expect:
      status: 200
      response_time: 5000

# Validation criteria
validation:
  success_rate: 80        # Allow some flexibility for complex multi-modal operations
  response_time: 60000    # 60 seconds max for complex AI operations
  revenue_potential: 85000  # Based on service.json business model
  business_criteria:
    - "All core multi-modal services operational"
    - "Voice command processing and transcription working"
    - "Language understanding and visual generation ready"
    - "Screen automation capabilities functional"
    - "Professional accessibility-focused UI platform ready"
    - "Multi-modal workflow chain functional end-to-end"
    - "Database properly stores interaction history"
    - "Integration pipeline handles voice-to-visual-to-action workflows"