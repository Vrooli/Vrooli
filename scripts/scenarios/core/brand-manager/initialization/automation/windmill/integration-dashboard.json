{
  "summary": "App Integration Monitoring Dashboard", 
  "description": "Monitor Claude Code agent progress and integration status",
  "app": {
    "grid": [
      {
        "id": "active-integrations",
        "type": "table",
        "position": {"x": 0, "y": 0, "w": 16, "h": 12},
        "configuration": {
          "title": "Active Integrations",
          "refresh": 3000,
          "resource": "postgres",
          "query": "SELECT ir.id, b.name as brand_name, ir.target_app_path, ir.integration_type, ir.status, ir.created_at, ir.claude_session_id FROM integration_requests ir JOIN brands b ON ir.brand_id = b.id WHERE ir.status IN ('pending', 'processing') ORDER BY ir.created_at DESC",
          "columns": [
            {"field": "brand_name", "header": "Brand", "width": 150},
            {"field": "target_app_path", "header": "Target App", "width": 300},
            {"field": "integration_type", "header": "Type", "width": 120},
            {
              "field": "status", 
              "header": "Status", 
              "width": 100,
              "render": "badge",
              "badgeColors": {
                "pending": "blue",
                "processing": "yellow",
                "completed": "green",
                "failed": "red"
              }
            },
            {"field": "created_at", "header": "Started", "type": "datetime", "width": 140}
          ],
          "actions": [
            {
              "label": "View Logs",
              "icon": "file-text",
              "action": "open_modal",
              "modal": "integration-logs"
            },
            {
              "label": "Cancel",
              "icon": "x-circle",
              "action": "api_call",
              "endpoint": "http://localhost:8100/api/integration/cancel/{id}",
              "confirm": "Cancel this integration?",
              "condition": "status === 'processing'"
            }
          ]
        }
      },
      {
        "id": "integration-metrics",
        "type": "cards",
        "position": {"x": 0, "y": 12, "w": 16, "h": 6},
        "configuration": {
          "title": "Integration Metrics",
          "refresh": 30000,
          "cards": [
            {
              "title": "Total Integrations",
              "value": {
                "resource": "postgres",
                "query": "SELECT COUNT(*) as count FROM integration_requests",
                "field": "count"
              },
              "color": "blue",
              "icon": "layers"
            },
            {
              "title": "Success Rate",
              "value": {
                "resource": "postgres", 
                "query": "SELECT ROUND(100.0 * SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) / COUNT(*), 1) as rate FROM integration_requests",
                "field": "rate",
                "suffix": "%"
              },
              "color": "green",
              "icon": "check-circle"
            },
            {
              "title": "Active Now",
              "value": {
                "resource": "postgres",
                "query": "SELECT COUNT(*) as count FROM integration_requests WHERE status IN ('pending', 'processing')",
                "field": "count"
              },
              "color": "yellow",
              "icon": "clock"
            },
            {
              "title": "Avg Duration",
              "value": {
                "resource": "postgres",
                "query": "SELECT ROUND(AVG(EXTRACT(EPOCH FROM (completed_at - created_at))/60), 1) as avg_minutes FROM integration_requests WHERE status = 'completed'",
                "field": "avg_minutes",
                "suffix": "min"
              },
              "color": "purple",
              "icon": "timer"
            }
          ]
        }
      },
      {
        "id": "integration-history",
        "type": "table",
        "position": {"x": 0, "y": 18, "w": 16, "h": 12},
        "configuration": {
          "title": "Integration History",
          "resource": "postgres",
          "query": "SELECT ir.id, b.name as brand_name, ir.target_app_path, ir.integration_type, ir.status, ir.created_at, ir.completed_at, EXTRACT(EPOCH FROM (COALESCE(ir.completed_at, NOW()) - ir.created_at))/60 as duration_minutes FROM integration_requests ir JOIN brands b ON ir.brand_id = b.id ORDER BY ir.created_at DESC LIMIT 50",
          "columns": [
            {"field": "brand_name", "header": "Brand", "width": 150},
            {"field": "target_app_path", "header": "Target App", "width": 250},
            {"field": "integration_type", "header": "Type", "width": 100},
            {
              "field": "status",
              "header": "Status",
              "width": 100,
              "render": "badge",
              "badgeColors": {
                "pending": "blue",
                "processing": "yellow", 
                "completed": "green",
                "failed": "red",
                "cancelled": "gray"
              }
            },
            {"field": "created_at", "header": "Started", "type": "datetime", "width": 140},
            {"field": "duration_minutes", "header": "Duration", "width": 100, "suffix": "min", "type": "number"}
          ],
          "actions": [
            {
              "label": "View Details",
              "icon": "info",
              "action": "open_modal",
              "modal": "integration-details"
            },
            {
              "label": "Retry",
              "icon": "refresh-cw",
              "action": "api_call", 
              "endpoint": "http://localhost:8100/api/integration/retry/{id}",
              "confirm": "Retry this integration?",
              "condition": "status === 'failed'"
            }
          ]
        }
      }
    ],
    "modals": [
      {
        "id": "integration-logs",
        "title": "Integration Logs",
        "size": "large",
        "content": [
          {
            "type": "code_block",
            "resource": "postgres",
            "query": "SELECT response_payload->>'logs' as logs FROM integration_requests WHERE id = $1",
            "field": "logs",
            "language": "json",
            "height": 400
          },
          {
            "type": "live_log",
            "endpoint": "ws://localhost:8100/api/integration/logs/{id}",
            "height": 200
          }
        ]
      },
      {
        "id": "integration-details",
        "title": "Integration Details",
        "size": "large",
        "content": [
          {
            "type": "details",
            "resource": "postgres",
            "query": "SELECT ir.*, b.name as brand_name FROM integration_requests ir JOIN brands b ON ir.brand_id = b.id WHERE ir.id = $1",
            "fields": [
              "brand_name",
              "target_app_path", 
              "integration_type",
              "status",
              "claude_session_id",
              "created_at",
              "completed_at"
            ]
          },
          {
            "type": "tabs",
            "tabs": [
              {
                "label": "Request Data",
                "content": {
                  "type": "json_viewer",
                  "resource": "postgres",
                  "query": "SELECT request_payload FROM integration_requests WHERE id = $1",
                  "field": "request_payload"
                }
              },
              {
                "label": "Response Data",
                "content": {
                  "type": "json_viewer",
                  "resource": "postgres", 
                  "query": "SELECT response_payload FROM integration_requests WHERE id = $1",
                  "field": "response_payload"
                }
              },
              {
                "label": "App Backup",
                "content": {
                  "type": "file_browser",
                  "resource": "minio",
                  "bucket": "app-backups",
                  "path": "integration_{id}/"
                }
              }
            ]
          }
        ]
      }
    ],
    "theme": {
      "primaryColor": "#06d6a0",
      "font": "Inter"
    },
    "permissions": {
      "public": false,
      "roles": ["admin", "brand-manager", "developer"]
    },
    "notifications": {
      "enabled": true,
      "events": [
        {
          "trigger": "integration_completed",
          "message": "Integration completed for {brand_name}",
          "type": "success"
        },
        {
          "trigger": "integration_failed", 
          "message": "Integration failed for {brand_name}",
          "type": "error"
        }
      ]
    }
  }
}