name: mind-maps
description: AI-enabled mind mapping tool for visual organization and semantic search
version: 1.0.0

health_checks:
  - name: API Health Check
    type: http
    url: http://localhost:8700/health
    expected_status: 200
    timeout: 10
    retries: 3

  - name: UI Health Check
    type: http
    url: http://localhost:3700
    expected_status: 200
    timeout: 10
    retries: 3

  - name: Database Connection
    type: postgres
    host: localhost
    port: 5432
    database: mind_maps
    query: "SELECT 1"
    expected_rows: 1

  - name: Qdrant Connection
    type: http
    url: http://localhost:6333/collections/mind_maps
    expected_status: 200

api_tests:
  - name: Create Mind Map
    endpoint: /api/mindmaps/create
    method: POST
    body:
      title: "Test Mind Map"
      description: "A test mind map for validation"
      userId: "test-user"
      tags: ["test", "demo"]
      initialNode:
        text: "Central Idea"
        type: "root"
    expected_status: 200
    expected_response:
      success: true
      mapId: string

  - name: Update Mind Map
    endpoint: /api/mindmaps/update
    method: PUT
    body:
      mapId: "test-map-001"
      nodes:
        - id: "node-1"
          text: "Main Concept"
          type: "root"
          x: 0
          y: 0
        - id: "node-2"
          text: "Sub-concept A"
          type: "child"
          x: 200
          y: 100
      edges:
        - from: "node-1"
          to: "node-2"
    expected_status: 200
    expected_response:
      success: true

  - name: Semantic Search
    endpoint: /api/mindmaps/search
    method: POST
    body:
      query: "productivity techniques"
      mode: "semantic"
      limit: 10
    expected_status: 200
    expected_response:
      success: true
      results: array

  - name: Get Mind Map
    endpoint: /api/mindmaps/test-map-001
    method: GET
    expected_status: 200
    expected_response:
      success: true
      mindmap: object

  - name: List User Maps
    endpoint: /api/mindmaps/list
    method: GET
    query:
      userId: "test-user"
      limit: 20
    expected_status: 200
    expected_response:
      success: true
      maps: array

  - name: Export Mind Map
    endpoint: /api/mindmaps/export
    method: POST
    body:
      mapId: "test-map-001"
      format: "json"
    expected_status: 200
    expected_response:
      success: true
      data: object

  - name: Auto-Organize Nodes
    endpoint: /api/mindmaps/auto-organize
    method: POST
    body:
      mapId: "test-map-001"
      strategy: "hierarchical"
    expected_status: 200
    expected_response:
      success: true
      organized: true

workflow_tests:
  - name: Create Mind Map Workflow
    workflow: mind-maps-create
    trigger: webhook
    payload:
      title: "Workflow Test Map"
      description: "Testing workflow creation"
      userId: "test-user"
      tags: ["workflow", "test"]
    expected_output:
      success: true
      mapId: string

  - name: Semantic Search Workflow
    workflow: mind-maps-semantic-search
    trigger: webhook
    payload:
      query: "artificial intelligence concepts"
      limit: 5
      userId: "test-user"
    expected_output:
      success: true
      results: array

  - name: Auto-Organize Workflow
    workflow: mind-maps-auto-organize
    trigger: webhook
    payload:
      mapId: "test-map-001"
      strategy: "radial"
      userId: "test-user"
    expected_output:
      success: true
      nodes: array

  - name: Intelligent Builder Workflow
    workflow: mind-maps-intelligent-builder
    trigger: webhook
    payload:
      topic: "Software Architecture"
      depth: 3
      userId: "test-user"
    expected_output:
      success: true
      mindmap: object

  - name: Export Workflow
    workflow: mind-maps-export
    trigger: webhook
    payload:
      mapId: "test-map-001"
      format: "markdown"
      includeMetadata: true
    expected_output:
      success: true
      content: string

ui_tests:
  - name: Load Homepage
    type: browser
    url: http://localhost:3700
    actions:
      - wait_for_element: ".logo"
      - assert_text: "Mind Maps"
      - assert_element_exists: "#canvas"

  - name: Create New Map
    type: browser
    url: http://localhost:3700
    actions:
      - click: "#newMapBtn"
      - wait_for_element: ".modal"
      - input: 
          selector: "#mapTitle"
          value: "UI Test Map"
      - click: ".create-btn"
      - assert_element_visible: "#canvas"

  - name: Add Node
    type: browser
    url: http://localhost:3700
    actions:
      - double_click: "#canvas"
      - wait_for_element: ".node-editor"
      - input:
          selector: ".node-text"
          value: "New Concept"
      - press_key: "Enter"
      - assert_element_exists: ".node"

  - name: Search Maps
    type: browser
    url: http://localhost:3700
    actions:
      - input:
          selector: "#searchInput"
          value: "productivity"
      - press_key: "Enter"
      - wait_for_element: ".search-results"
      - assert_element_count:
          selector: ".search-result"
          min: 1

  - name: Switch View Modes
    type: browser
    url: http://localhost:3700
    actions:
      - click: "[data-view='neural']"
      - assert_class_exists: "#canvas.neural-view"
      - click: "[data-view='radial']"
      - assert_class_exists: "#canvas.radial-view"
      - click: "[data-view='tree']"
      - assert_class_exists: "#canvas.tree-view"

integration_tests:
  - name: Complete Mind Map Creation Flow
    steps:
      - api_call:
          endpoint: /api/mindmaps/create
          method: POST
          body:
            title: "Integration Test Map"
            userId: "test-user"
      - workflow_call:
          name: mind-maps-intelligent-builder
          payload:
            mapId: "{{mapId}}"
            topic: "Test Topic"
            depth: 2
      - api_call:
          endpoint: /api/mindmaps/{{mapId}}
          method: GET
      - verify_database:
          table: mind_maps
          condition: "id = '{{mapId}}'"
          expected_count: 1
      - verify_qdrant:
          collection: mind_maps
          id: "{{mapId}}"
          expected: exists

  - name: Collaboration Flow
    steps:
      - api_call:
          endpoint: /api/mindmaps/create
          method: POST
          body:
            title: "Shared Map"
            userId: "user-1"
            isPublic: true
      - api_call:
          endpoint: /api/mindmaps/share
          method: POST
          body:
            mapId: "{{mapId}}"
            userId: "user-2"
            permission: "edit"
      - api_call:
          endpoint: /api/mindmaps/{{mapId}}/collaborate
          method: POST
          body:
            userId: "user-2"
            action: "add_node"
            node:
              text: "Collaborative idea"
      - verify_redis:
          key: "collab:{{mapId}}"
          expected: exists

performance:
  - name: API Response Time
    endpoint: /api/mindmaps/create
    max_response_time_ms: 2000
    concurrent_requests: 10

  - name: Semantic Search Performance
    endpoint: /api/mindmaps/search
    max_response_time_ms: 1500
    concurrent_requests: 20

  - name: Database Query Performance
    query: "SELECT * FROM mind_maps WHERE user_id = $1 ORDER BY created_at DESC LIMIT 50"
    max_execution_time_ms: 100

  - name: Qdrant Search Performance
    collection: mind_maps
    vector_search: true
    max_response_time_ms: 500

cleanup:
  - type: database
    action: truncate
    tables:
      - mind_map_collaborators
      - mind_map_nodes
      - mind_map_edges
      - mind_maps
      - campaigns
      - users
  
  - type: qdrant
    action: delete_collection
    collection: mind_maps
  
  - type: redis
    action: flush
    database: mind_maps