name: idea-generator
description: Test suite for AI-powered idea generation application
version: 1.0.0

prerequisites:
  resources:
    - postgres
    - redis
    - ollama
    - n8n
    - qdrant
  environment:
    POSTGRES_PASSWORD: test_password
    REDIS_PASSWORD: test_redis
    N8N_WEBHOOK_URL: http://localhost:5678

tests:
  - name: resource_availability
    description: Verify all required resources are running
    steps:
      - check: postgres_connection
        command: pg_isready -h localhost -p 5432
        expected: accepting connections
      - check: redis_connection
        command: redis-cli ping
        expected: PONG
      - check: ollama_api
        command: curl -f http://localhost:11434/api/version
        expected_status: 200
      - check: n8n_health
        command: curl -f http://localhost:5678/healthz
        expected_status: 200
      - check: qdrant_health
        command: curl -f http://localhost:6333/health
        expected_status: 200

  - name: database_initialization
    description: Verify database schema is properly initialized
    steps:
      - check: tables_exist
        query: |
          SELECT COUNT(*) FROM information_schema.tables 
          WHERE table_schema = 'public' 
          AND table_name IN ('campaigns', 'ideas', 'agent_interactions', 'data_connections')
        expected: 4
      - check: indexes_created
        query: |
          SELECT COUNT(*) FROM pg_indexes 
          WHERE schemaname = 'public' 
          AND tablename IN ('campaigns', 'ideas')
        min_expected: 8

  - name: workflow_deployment
    description: Verify n8n workflows are deployed and active
    steps:
      - check: idea_generation_workflow
        command: curl -X GET http://localhost:5678/rest/workflows
        contains: idea-generation-workflow
      - check: refinement_workflow
        command: curl -X GET http://localhost:5678/rest/workflows
        contains: agent-refinement-workflow

  - name: api_endpoints
    description: Test core API endpoints
    steps:
      - check: create_campaign
        method: POST
        url: http://localhost:8080/api/campaigns
        body:
          name: Test Campaign
          description: Test campaign for validation
        expected_status: 201
      - check: generate_ideas
        method: POST
        url: http://localhost:8080/api/ideas/generate
        body:
          campaign_id: ${campaign_id}
          prompt: Generate innovative product ideas
          count: 3
        expected_status: 200
      - check: refine_idea
        method: POST
        url: http://localhost:8080/api/ideas/refine
        body:
          idea_id: ${idea_id}
          action_type: revise
        expected_status: 200

  - name: ui_availability
    description: Verify UI is accessible
    steps:
      - check: ui_homepage
        command: curl -f http://localhost:3000
        expected_status: 200
      - check: ui_assets
        command: curl -f http://localhost:3000/static/js/bundle.js
        expected_status: 200

  - name: vector_search
    description: Test vector search functionality
    steps:
      - check: create_collection
        method: PUT
        url: http://localhost:6333/collections/ideas
        body:
          vectors:
            size: 1536
            distance: Cosine
        expected_status: 200
      - check: search_similar
        method: POST
        url: http://localhost:6333/collections/ideas/points/search
        body:
          vector: [0.1, 0.2, 0.3]
          limit: 5
        expected_status: 200

validation:
  timeout: 300
  retry_count: 3
  success_threshold: 0.95