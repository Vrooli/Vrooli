{
  "name": "Agent Idea Refinement Workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "refine-idea",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook_trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT i.*, c.context as campaign_context FROM ideas i JOIN campaigns c ON i.campaign_id = c.id WHERE i.id = '{{ $json.idea_id }}'",
        "additionalFields": {}
      },
      "id": "get_idea",
      "name": "Get Idea with Context",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.action_type }}",
              "value2": "revise"
            }
          ]
        }
      },
      "id": "action_router",
      "name": "Route by Action Type",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "resource": "completion",
        "model": "llama3.2",
        "prompt": "Revise and improve the following idea:\n\nOriginal: {{ $node['Get Idea with Context'].json.content }}\n\nMake it more specific, actionable, and innovative while maintaining the core concept.",
        "temperature": 0.7,
        "maxTokens": 1500
      },
      "id": "revise_agent",
      "name": "Revise Agent",
      "type": "n8n-nodes-base.ollama",
      "typeVersion": 1,
      "position": [850, 200]
    },
    {
      "parameters": {
        "resource": "completion",
        "model": "llama3.2",
        "prompt": "Investigate the feasibility and market potential of:\n\n{{ $node['Get Idea with Context'].json.content }}\n\nProvide research insights, potential challenges, and success factors.",
        "temperature": 0.6,
        "maxTokens": 1500
      },
      "id": "investigate_agent",
      "name": "Investigate Agent",
      "type": "n8n-nodes-base.ollama",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "resource": "completion",
        "model": "llama3.2",
        "prompt": "Provide constructive critique for:\n\n{{ $node['Get Idea with Context'].json.content }}\n\nIdentify weaknesses, assumptions, and areas for improvement.",
        "temperature": 0.5,
        "maxTokens": 1500
      },
      "id": "critique_agent",
      "name": "Critique Agent",
      "type": "n8n-nodes-base.ollama",
      "typeVersion": 1,
      "position": [850, 400]
    },
    {
      "parameters": {
        "resource": "completion",
        "model": "llama3.2",
        "prompt": "Expand on this idea with additional features and possibilities:\n\n{{ $node['Get Idea with Context'].json.content }}\n\nSuggest complementary ideas and extensions.",
        "temperature": 0.8,
        "maxTokens": 1500
      },
      "id": "expand_agent",
      "name": "Expand Agent",
      "type": "n8n-nodes-base.ollama",
      "typeVersion": 1,
      "position": [850, 500]
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "agent_interactions",
        "columns": "idea_id,interaction_type,agent_prompt,agent_response,model_used",
        "returnFields": "*"
      },
      "id": "save_interaction",
      "name": "Save Agent Interaction",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "status",
              "value": "success"
            }
          ]
        },
        "options": {}
      },
      "id": "response",
      "name": "Send Response",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [1250, 300]
    }
  ],
  "connections": {
    "webhook_trigger": {
      "main": [[{"node": "get_idea", "type": "main", "index": 0}]]
    },
    "get_idea": {
      "main": [[{"node": "action_router", "type": "main", "index": 0}]]
    },
    "action_router": {
      "main": [
        [{"node": "revise_agent", "type": "main", "index": 0}],
        [{"node": "investigate_agent", "type": "main", "index": 0}],
        [{"node": "critique_agent", "type": "main", "index": 0}],
        [{"node": "expand_agent", "type": "main", "index": 0}]
      ]
    },
    "revise_agent": {
      "main": [[{"node": "save_interaction", "type": "main", "index": 0}]]
    },
    "investigate_agent": {
      "main": [[{"node": "save_interaction", "type": "main", "index": 0}]]
    },
    "critique_agent": {
      "main": [[{"node": "save_interaction", "type": "main", "index": 0}]]
    },
    "expand_agent": {
      "main": [[{"node": "save_interaction", "type": "main", "index": 0}]]
    },
    "save_interaction": {
      "main": [[{"node": "response", "type": "main", "index": 0}]]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "id": "agent-refinement-workflow"
}