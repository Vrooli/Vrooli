name: video-downloader
description: Test suite for Video Downloader scenario
version: 1.0.0

tests:
  - name: API Health Check
    type: api
    endpoint: /health
    method: GET
    expected_status: 200
    expected_response:
      status: "healthy"
      service: "video-downloader"

  - name: Analyze Video URL
    type: api
    endpoint: /api/analyze
    method: POST
    body:
      url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
    expected_status: 200
    expected_response_contains:
      - "title"
      - "duration"
      - "formats"

  - name: CLI Version Check
    type: cli
    command: video-downloader --version
    expected_output_contains: "1.0.0"

  - name: CLI Help
    type: cli
    command: video-downloader --help
    expected_output_contains: 
      - "download"
      - "analyze"
      - "list"

  - name: UI Availability
    type: ui
    url: "http://localhost:${UI_PORT}"
    expected_status: 200
    expected_content_contains:
      - "Video Downloader"
      - "Enter URL"

  - name: N8n Workflow Health
    type: n8n
    workflow: url-analyzer
    test_type: trigger
    expected_status: success

validation:
  required_files:
    - api/main.go
    - api/go.mod
    - ui/server.js
    - ui/package.json
    - ui/index.html
    - cli/video-downloader
    - initialization/n8n/video-processor.json
    - initialization/n8n/url-analyzer.json
    - initialization/n8n/download-orchestrator.json
    - initialization/postgres/schema.sql
    - .vrooli/service.json
    - README.md

  required_ports:
    - name: api
      port: "${SERVICE_PORT}"
      protocol: tcp
    - name: ui
      port: "${UI_PORT}"
      protocol: tcp

  resource_dependencies:
    - postgres
    - redis
    - n8n
    - browserless

timeout: 300
retry_count: 3
cleanup_on_failure: true