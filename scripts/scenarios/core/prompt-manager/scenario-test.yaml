name: prompt-manager
description: Personal prompt storage and management tool with API, CLI, and web interface
version: 1.0.0

tests:
  # Infrastructure tests
  - name: PostgreSQL Database Schema
    type: database
    service: postgres
    database: prompt_manager
    query: "SELECT COUNT(*) FROM campaigns; SELECT COUNT(*) FROM prompts; SELECT COUNT(*) FROM tags;"
    expected: 
      min_campaigns: 3
      min_prompts: 5
      min_tags: 5

  - name: Qdrant Vector Store
    type: connectivity
    service: qdrant
    endpoint: http://localhost:6333/collections
    expected: 200
    post_check:
      - endpoint: http://localhost:6333/collections/prompts
        expected: 200

  - name: Ollama LLM (Optional)
    type: connectivity
    service: ollama
    endpoint: http://localhost:11434/api/tags
    expected: 200
    optional: true

  # API Tests
  - name: API Health Check
    type: http
    endpoint: http://localhost:8085/health
    expected:
      status: 200
      body:
        status: healthy

  - name: Campaign API Endpoints
    type: functional
    description: Test campaign management via API
    steps:
      - action: list_campaigns
        endpoint: /api/campaigns
        method: GET
        expected: 
          status: 200
          body_type: array
          min_items: 3
      - action: create_campaign
        endpoint: /api/campaigns
        method: POST
        body:
          name: "API Test Campaign"
          description: "Created via API test"
          color: "#ff6b6b"
        expected: 
          status: 201
          body:
            name: "API Test Campaign"
            color: "#ff6b6b"
      - action: get_campaign
        endpoint: /api/campaigns/{campaign_id}
        method: GET
        expected:
          status: 200
          body:
            name: "API Test Campaign"

  - name: Prompt API Endpoints
    type: functional
    description: Test prompt management via API
    steps:
      - action: list_prompts
        endpoint: /api/prompts
        method: GET
        expected:
          status: 200
          body_type: array
      - action: create_prompt
        endpoint: /api/prompts
        method: POST
        body:
          title: "API Test Prompt"
          content: "This is a test prompt created via API for {{purpose}}"
          description: "Test prompt description"
          campaign_id: "{campaign_id}"
        expected:
          status: 201
          body:
            title: "API Test Prompt"
            usage_count: 0
      - action: get_prompt
        endpoint: /api/prompts/{prompt_id}
        method: GET
        expected:
          status: 200
          body:
            title: "API Test Prompt"
      - action: record_usage
        endpoint: /api/prompts/{prompt_id}/use
        method: POST
        body: {}
        expected:
          status: 200

  - name: Search Functionality
    type: functional
    description: Test prompt search capabilities
    steps:
      - action: text_search
        endpoint: /api/search/prompts
        method: GET
        query:
          q: "debug"
        expected:
          status: 200
          body_type: array
      - action: empty_search
        endpoint: /api/search/prompts
        method: GET
        query:
          q: "nonexistent_term_xyz"
        expected:
          status: 200
          body_type: array
          max_items: 0

  - name: Tags Management
    type: functional
    description: Test tag functionality
    steps:
      - action: list_tags
        endpoint: /api/tags
        method: GET
        expected:
          status: 200
          body_type: array
          min_items: 5

  # UI Tests
  - name: React UI Accessibility
    type: http
    endpoint: http://localhost:3005
    expected: 200
    description: Test React UI is accessible

  - name: UI Static Assets
    type: functional
    description: Test UI static assets load correctly
    steps:
      - action: css_load
        endpoint: http://localhost:3005/static/css/main.*.css
        method: GET
        expected:
          status: 200
        pattern_match: true
      - action: js_load  
        endpoint: http://localhost:3005/static/js/main.*.js
        method: GET
        expected:
          status: 200
        pattern_match: true

  # CLI Tests
  - name: CLI Tool Installation
    type: command
    command: "command -v prompt-manager || test -f ./cli/prompt-manager"
    expected:
      exit_code: 0
    description: Test CLI tool is available

  - name: CLI Basic Commands
    type: functional
    description: Test CLI basic functionality
    steps:
      - action: cli_help
        command: "prompt-manager help"
        expected:
          exit_code: 0
          output_contains: "Usage:"
      - action: cli_status
        command: "timeout 10s prompt-manager status"
        expected:
          exit_code: 0
          output_contains: "API is running"
      - action: cli_campaigns
        command: "timeout 10s prompt-manager campaigns list"
        expected:
          exit_code: 0

  # Integration Tests  
  - name: End-to-End Workflow
    type: functional
    description: Test complete prompt management workflow
    steps:
      - action: create_campaign_via_api
        endpoint: /api/campaigns
        method: POST
        body:
          name: "E2E Test Campaign"
          description: "End-to-end test campaign"
        expected:
          status: 201
      - action: create_prompt_via_api
        endpoint: /api/prompts
        method: POST
        body:
          title: "E2E Test Prompt"
          content: "End-to-end test prompt for {{scenario}}"
          campaign_id: "{campaign_id}"
        expected:
          status: 201
      - action: search_created_prompt
        endpoint: /api/search/prompts
        method: GET
        query:
          q: "E2E Test"
        expected:
          status: 200
          body_type: array
          min_items: 1
      - action: use_prompt
        endpoint: /api/prompts/{prompt_id}/use
        method: POST
        expected:
          status: 200
      - action: verify_usage_count
        endpoint: /api/prompts/{prompt_id}
        method: GET
        expected:
          body:
            usage_count: 1

  # Performance Tests
  - name: API Response Times
    type: performance
    description: Test API response times are reasonable
    tests:
      - endpoint: /api/campaigns
        max_response_time: 500ms
      - endpoint: /api/prompts
        max_response_time: 1000ms
      - endpoint: /api/health
        max_response_time: 100ms

validation:
  required_services:
    - postgres
    - qdrant
  optional_services:
    - ollama
  required_ports:
    - 3005  # React UI
    - 8085  # Go API
    - 6333  # Qdrant
    - 5433  # PostgreSQL
  required_files:
    - api/main.go
    - cli/prompt-manager
    - ui/src/App.js
    - initialization/storage/postgres/schema.sql
    - initialization/storage/postgres/seed.sql
  authentication: none
  data_persistence: required
  backup_support: database_only