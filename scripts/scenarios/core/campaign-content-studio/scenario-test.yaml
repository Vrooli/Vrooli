version: 1.0
scenario: campaign-content-studio

# Structure validation
structure:
  required_files:
    - .vrooli/service.json
    - api/main.go
    - api/go.mod
    - cli/campaign-content-studio-cli.sh
    - cli/install-cli.sh
    - cli/campaign-content-studio.bats
    - initialization/storage/schema.sql
    - initialization/storage/seed.sql
    - initialization/automation/n8n/campaign-management.json
    - initialization/automation/n8n/document-processing.json
    - initialization/automation/n8n/content-generation.json
    - initialization/automation/n8n/search-retrieval.json
    - initialization/automation/windmill/campaign-dashboard.json
    - initialization/configuration/app-config.json
    - initialization/configuration/content-templates.json
    - initialization/configuration/feature-flags.json
    - initialization/configuration/resource-urls.json
  
  required_dirs:
    - api
    - cli
    - initialization/storage
    - initialization/automation
    - initialization/configuration

# Resource requirements
resources:
  required: [postgres, minio, qdrant, ollama, comfyui, unstructured-io, n8n, windmill]
  optional: []
  health_timeout: 60

# Declarative tests
tests:
  - name: "PostgreSQL Database Ready"
    type: database
    service: postgres
    database: campaign_content_studio
    query: "SELECT table_name FROM information_schema.tables WHERE table_schema = 'campaign_content_studio'"
    expect:
      contains: ["campaigns", "campaign_documents", "generated_content", "user_sessions"]
      
  - name: "Qdrant Vector Database Ready"
    type: http
    service: qdrant
    endpoint: /collections
    method: GET
    expect:
      status: 200
      body:
        type: json
        
  - name: "MinIO Object Storage Ready"
    type: http
    service: minio
    endpoint: /minio/health/ready
    method: GET
    expect:
      status: 200
      
  - name: "Ollama AI Models Ready"
    type: http
    service: ollama
    endpoint: /api/tags
    method: GET
    expect:
      status: 200
      body:
        type: json
        contains: ["llama3.2", "nomic-embed-text"]
        
  - name: "ComfyUI Image Generation Ready"
    type: http
    service: comfyui
    endpoint: /system_stats
    method: GET
    expect:
      status: 200
      
  - name: "Unstructured-IO Document Processing Ready"
    type: http
    service: unstructured-io
    endpoint: /healthcheck
    method: GET
    expect:
      status: 200
      
  - name: "n8n Workflow Engine Ready"
    type: http
    service: n8n
    endpoint: /healthz
    method: GET
    expect:
      status: 200
      
  - name: "Windmill UI Platform Ready"
    type: http
    service: windmill
    endpoint: /api/version
    method: GET
    expect:
      status: 200
      body:
        type: json
        
  - name: "API Health Check"
    type: http
    service: api
    endpoint: /health
    method: GET
    expect:
      status: 200
      body:
        type: json
        contains: ["status", "service", "version"]
        
  - name: "API Campaigns List"
    type: http
    service: api
    endpoint: /campaigns
    method: GET
    expect:
      status: 200
      body:
        type: json
        
  - name: "Campaign Management Integration Test"
    type: integration
    description: "Test campaign creation and management workflow via n8n"
    workflow:
      - step: "Create Campaign"
        type: http
        service: n8n
        endpoint: /webhook/campaign-management
        method: POST
        body:
          operation: "create"
          campaign:
            name: "Test Campaign"
            description: "Integration test campaign"
            target_audience: "developers"
        expect:
          status: 200
          response_time: 10000
          
      - step: "Verify Campaign Creation"
        type: database
        service: postgres
        query: "SELECT COUNT(*) as count FROM campaign_content_studio.campaigns WHERE name = 'Test Campaign'"
        expect:
          count: ">= 1"
          
  - name: "API Campaign Creation Test"
    type: integration
    description: "Test campaign creation via API"
    workflow:
      - step: "Create Campaign via API"
        type: http
        service: api
        endpoint: /campaigns
        method: POST
        body:
          name: "API Test Campaign"
          description: "Campaign created via API test"
        expect:
          status: 201
          response_time: 5000
          
      - step: "Verify API Campaign Creation"
        type: database
        service: postgres
        query: "SELECT COUNT(*) as count FROM campaign_content_studio.campaigns WHERE name = 'API Test Campaign'"
        expect:
          count: ">= 1"
          
  - name: "Document Processing Pipeline Test"
    type: integration
    description: "Test document upload and processing pipeline"
    workflow:
      - step: "Process Sample Document"
        type: http
        service: n8n
        endpoint: /webhook/document-processing
        method: POST
        body:
          operation: "upload"
          campaign_id: "550e8400-e29b-41d4-a716-446655440001"
          document:
            filename: "test.txt"
            content_type: "text/plain"
            content: "This is a test document for campaign content generation."
        expect:
          status: 200
          response_time: 30000
          
  - name: "Content Generation Test"
    type: integration
    description: "Test AI content generation with campaign context"
    workflow:
      - step: "Generate Blog Post via API"
        type: http
        service: api
        endpoint: /generate
        method: POST
        body:
          campaign_id: "550e8400-e29b-41d4-a716-446655440001"
          content_type: "blog_post"
          prompt: "Write a blog post about productivity tools"
          include_images: false
        expect:
          status: 200
          response_time: 60000
          
  - name: "Campaign Dashboard UI Test"
    type: http
    service: windmill
    endpoint: /f/campaign-content-studio/dashboard
    method: GET
    expect:
      status: 200
      response_time: 5000

# Validation criteria
validation:
  success_rate: 85        # High success rate for production-ready content assistant
  response_time: 60000    # 60 seconds max for complex AI operations
  revenue_potential: 145000  # Updated based on service.json business model
  business_criteria:
    - "All core AI and storage services operational"
    - "Modern API and CLI interfaces functional"
    - "Campaign management workflows functional"
    - "Document processing pipeline working end-to-end"
    - "AI content generation producing relevant results"
    - "Vector search enabling context-aware generation"
    - "Multi-format content generation capabilities"
    - "Professional dashboard UI accessible and functional"
    - "Database properly stores campaigns, documents, and generated content"
    - "Go API server responding to health checks and CRUD operations"
    - "CLI commands execute successfully"