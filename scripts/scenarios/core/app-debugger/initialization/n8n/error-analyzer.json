{
  "name": "App Debugger - Error Analyzer",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "error-analyzer",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook_trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [200, 300]
    },
    {
      "parameters": {},
      "id": "manual_trigger",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [200, 500]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "return {\n  app_name: 'test-app',\n  error_message: 'TypeError: Cannot read property \\'map\\' of undefined',\n  stack_trace: 'at processData (main.js:45)\\nat handleRequest (server.js:120)',\n  context: {\n    endpoint: '/api/data',\n    method: 'GET',\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "set_test_defaults",
      "name": "Set Test Defaults",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [400, 500]
    },
    {
      "parameters": {},
      "id": "merge_triggers",
      "name": "Merge Triggers",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [600, 400]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const input = $input.item.json;\n\n// Extract error details\nconst appName = input.app_name || 'unknown';\nconst errorMessage = input.error_message || '';\nconst stackTrace = input.stack_trace || '';\nconst context = input.context || {};\n\n// Build analysis prompt\nconst prompt = `Analyze this error from the ${appName} application:\n\nError Message: ${errorMessage}\n\nStack Trace:\n${stackTrace}\n\nContext:\n${JSON.stringify(context, null, 2)}\n\nProvide:\n1. Root cause analysis\n2. Likely fix suggestions\n3. Prevention strategies\n4. Severity assessment (low/medium/high/critical)\n\nFormat response as JSON.`;\n\nreturn {\n  prompt: prompt,\n  model: 'phi3.5:3.8b',\n  type: 'reasoning',\n  quiet: true,\n  app_name: appName,\n  error_type: errorMessage.split(':')[0] || 'UnknownError',\n  timestamp: context.timestamp || new Date().toISOString()\n};"
      },
      "id": "prepare_analysis",
      "name": "Prepare Analysis",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [800, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:5678/webhook/ollama",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "prompt",
              "value": "={{ $json.prompt }}"
            },
            {
              "name": "model",
              "value": "={{ $json.model }}"
            },
            {
              "name": "type",
              "value": "={{ $json.type }}"
            },
            {
              "name": "quiet",
              "value": "={{ $json.quiet }}"
            }
          ]
        },
        "options": {}
      },
      "id": "call_ollama",
      "name": "Call Ollama Workflow",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1000, 400]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const analysis = $input.item.json;\nconst metadata = $('Prepare Analysis').item.json;\n\n// Parse AI response\nlet aiAnalysis = {};\ntry {\n  if (analysis.response) {\n    // Try to extract JSON from response\n    const jsonMatch = analysis.response.match(/\\{[\\s\\S]*\\}/);;\n    if (jsonMatch) {\n      aiAnalysis = JSON.parse(jsonMatch[0]);\n    } else {\n      // Fallback to text analysis\n      aiAnalysis = {\n        analysis: analysis.response,\n        severity: 'medium'\n      };\n    }\n  }\n} catch (e) {\n  aiAnalysis = {\n    analysis: analysis.response || 'Analysis failed',\n    severity: 'unknown'\n  };\n}\n\n// Store in database\nconst result = {\n  app_name: metadata.app_name,\n  error_type: metadata.error_type,\n  timestamp: metadata.timestamp,\n  analysis: aiAnalysis,\n  resolved: false,\n  resolution_attempts: 0\n};\n\nreturn result;"
      },
      "id": "format_results",
      "name": "Format Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1200, 400]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO error_logs (app_name, error_type, analysis, severity, timestamp) VALUES ($1, $2, $3, $4, $5) RETURNING id",
        "additionalFields": {
          "queryParams": "={{ $json.app_name }},{{ $json.error_type }},{{ JSON.stringify($json.analysis) }},{{ $json.analysis.severity || 'unknown' }},{{ $json.timestamp }}"
        }
      },
      "id": "store_error",
      "name": "Store Error",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [1400, 400],
      "credentials": {
        "postgres": {
          "id": "shared",
          "name": "Shared PostgreSQL"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json, null, 2) }}",
        "options": {}
      },
      "id": "respond",
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1600, 300]
    }
  ],
  "connections": {
    "webhook_trigger": {
      "main": [[{"node": "merge_triggers", "type": "main", "index": 0}]]
    },
    "manual_trigger": {
      "main": [[{"node": "set_test_defaults", "type": "main", "index": 0}]]
    },
    "set_test_defaults": {
      "main": [[{"node": "merge_triggers", "type": "main", "index": 1}]]
    },
    "merge_triggers": {
      "main": [[{"node": "prepare_analysis", "type": "main", "index": 0}]]
    },
    "prepare_analysis": {
      "main": [[{"node": "call_ollama", "type": "main", "index": 0}]]
    },
    "call_ollama": {
      "main": [[{"node": "format_results", "type": "main", "index": 0}]]
    },
    "format_results": {
      "main": [[{"node": "store_error", "type": "main", "index": 0}]]
    },
    "store_error": {
      "main": [[{"node": "respond", "type": "main", "index": 0}]]
    }
  },
  "active": false,
  "settings": {},
  "id": "app-debugger-error-analyzer"
}