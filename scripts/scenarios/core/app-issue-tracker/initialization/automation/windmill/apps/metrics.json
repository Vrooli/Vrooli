{
  "name": "Issue Metrics & Analytics",
  "path": "issue_tracker_metrics",
  "summary": "Analytics dashboard for issue patterns and performance metrics",
  "description": "Visualize issue trends, agent performance, and cross-app patterns",
  "value": {
    "type": "app",
    "grid": [
      {
        "id": "header",
        "type": "text",
        "configuration": {
          "text": "# ðŸ“Š Issue Analytics & Patterns",
          "style": {
            "fontSize": "24px",
            "fontWeight": "bold",
            "marginBottom": "20px"
          }
        },
        "position": { "x": 0, "y": 0, "w": 12, "h": 1 }
      },
      {
        "id": "time_range_selector",
        "type": "container",
        "configuration": {
          "layout": "horizontal",
          "components": [
            {
              "id": "date_range",
              "type": "dateRangePicker",
              "label": "Time Range",
              "defaultValue": "last_30_days"
            },
            {
              "id": "granularity",
              "type": "select",
              "label": "Granularity",
              "options": ["hourly", "daily", "weekly", "monthly"],
              "defaultValue": "daily"
            },
            {
              "id": "refresh_metrics",
              "type": "button",
              "text": "Refresh",
              "onClick": "{{refreshMetrics}}"
            }
          ]
        },
        "position": { "x": 0, "y": 1, "w": 12, "h": 1 }
      },
      {
        "id": "key_metrics",
        "type": "container",
        "configuration": {
          "layout": "horizontal",
          "components": [
            {
              "type": "metricCard",
              "title": "Avg Resolution Time",
              "value": "{{avgResolutionTime}}",
              "unit": "hours",
              "trend": "{{resolutionTrend}}",
              "color": "blue"
            },
            {
              "type": "metricCard",
              "title": "Fix Success Rate",
              "value": "{{fixSuccessRate}}",
              "unit": "%",
              "trend": "{{fixRateTrend}}",
              "color": "green"
            },
            {
              "type": "metricCard",
              "title": "Pattern Groups",
              "value": "{{activePatternGroups}}",
              "unit": "active",
              "color": "purple"
            },
            {
              "type": "metricCard",
              "title": "Cross-App Issues",
              "value": "{{crossAppIssueCount}}",
              "unit": "detected",
              "color": "orange"
            }
          ]
        },
        "position": { "x": 0, "y": 2, "w": 12, "h": 2 }
      },
      {
        "id": "issue_volume_chart",
        "type": "chart",
        "configuration": {
          "chartType": "line",
          "title": "Issue Volume Over Time",
          "data": "{{getIssueVolumeData}}",
          "xAxis": "date",
          "yAxis": [
            { "field": "new_issues", "label": "New Issues", "color": "red" },
            { "field": "resolved_issues", "label": "Resolved", "color": "green" },
            { "field": "in_progress", "label": "In Progress", "color": "yellow" }
          ],
          "height": 300
        },
        "position": { "x": 0, "y": 4, "w": 6, "h": 4 }
      },
      {
        "id": "app_distribution_chart",
        "type": "chart",
        "configuration": {
          "chartType": "pie",
          "title": "Issues by Application",
          "data": "{{getAppDistribution}}",
          "valueField": "issue_count",
          "labelField": "app_name",
          "height": 300
        },
        "position": { "x": 6, "y": 4, "w": 6, "h": 4 }
      },
      {
        "id": "agent_performance_table",
        "type": "aggridcomponent",
        "configuration": {
          "title": "Agent Performance",
          "query": "SELECT agent_name, display_name, total_runs, success_rate_percent, avg_completion_time_seconds, total_cost_usd FROM agent_performance ORDER BY success_rate_percent DESC",
          "columnDefs": [
            { "field": "agent_name", "headerName": "Agent", "width": 150 },
            { "field": "display_name", "headerName": "Display Name", "flex": 1 },
            { "field": "total_runs", "headerName": "Total Runs", "width": 100 },
            { "field": "success_rate_percent", "headerName": "Success %", "width": 100, "cellRenderer": "percentageBar" },
            { "field": "avg_completion_time_seconds", "headerName": "Avg Time (s)", "width": 120 },
            { "field": "total_cost_usd", "headerName": "Total Cost ($)", "width": 120, "valueFormatter": "currencyFormatter" }
          ],
          "pagination": false
        },
        "position": { "x": 0, "y": 8, "w": 6, "h": 4 }
      },
      {
        "id": "pattern_groups_list",
        "type": "container",
        "configuration": {
          "title": "Active Pattern Groups",
          "components": [
            {
              "type": "list",
              "data": "{{getActivePatterns}}",
              "template": {
                "type": "card",
                "content": [
                  { "type": "text", "text": "### {{name}}" },
                  { "type": "text", "text": "{{description}}" },
                  { "type": "badge", "text": "{{total_issues}} issues", "color": "red" },
                  { "type": "badge", "text": "{{affected_apps_count}} apps", "color": "blue" },
                  { "type": "progress", "value": "{{resolution_progress}}", "label": "Resolution Progress" }
                ]
              }
            }
          ]
        },
        "position": { "x": 6, "y": 8, "w": 6, "h": 4 }
      },
      {
        "id": "priority_heatmap",
        "type": "chart",
        "configuration": {
          "chartType": "heatmap",
          "title": "Issue Priority Distribution by App",
          "data": "{{getPriorityHeatmap}}",
          "xAxis": "app_name",
          "yAxis": "priority",
          "valueField": "count",
          "colorScale": "reds",
          "height": 250
        },
        "position": { "x": 0, "y": 12, "w": 6, "h": 3 }
      },
      {
        "id": "resolution_time_histogram",
        "type": "chart",
        "configuration": {
          "chartType": "histogram",
          "title": "Resolution Time Distribution",
          "data": "{{getResolutionTimeDistribution}}",
          "binField": "resolution_hours",
          "binSize": 24,
          "xLabel": "Hours to Resolution",
          "yLabel": "Number of Issues",
          "height": 250
        },
        "position": { "x": 6, "y": 12, "w": 6, "h": 3 }
      },
      {
        "id": "cost_analysis",
        "type": "container",
        "configuration": {
          "title": "AI Investigation Costs",
          "components": [
            {
              "type": "chart",
              "chartType": "bar",
              "data": "{{getMonthlyCosts}}",
              "xAxis": "month",
              "yAxis": "cost_usd",
              "height": 200
            },
            {
              "type": "keyValue",
              "data": {
                "Total Cost (30d)": "${{totalCost30d}}",
                "Avg Cost per Issue": "${{avgCostPerIssue}}",
                "Most Expensive Agent": "{{mostExpensiveAgent}}",
                "ROI Estimate": "{{roiEstimate}}x"
              }
            }
          ]
        },
        "position": { "x": 0, "y": 15, "w": 12, "h": 3 }
      },
      {
        "id": "anomaly_alerts",
        "type": "container",
        "configuration": {
          "title": "âš ï¸ Anomaly Detection",
          "components": [
            {
              "type": "list",
              "data": "{{getAnomalies}}",
              "template": {
                "type": "alert",
                "severity": "{{severity}}",
                "title": "{{title}}",
                "description": "{{description}}",
                "timestamp": "{{detected_at}}"
              },
              "maxItems": 5
            }
          ]
        },
        "position": { "x": 0, "y": 18, "w": 12, "h": 2 }
      }
    ],
    "scripts": {
      "avgResolutionTime": "SELECT AVG(EXTRACT(EPOCH FROM (resolved_at - created_at))/3600)::DECIMAL(10,2) as value FROM issues WHERE resolved_at IS NOT NULL AND created_at >= NOW() - INTERVAL '30 days'",
      "fixSuccessRate": "SELECT (COUNT(CASE WHEN fix_successful THEN 1 END)::DECIMAL / NULLIF(COUNT(CASE WHEN fix_attempted THEN 1 END), 0) * 100)::DECIMAL(5,2) as value FROM issues WHERE created_at >= NOW() - INTERVAL '30 days'",
      "activePatternGroups": "SELECT COUNT(*) as value FROM pattern_groups WHERE active_issues > 0",
      "crossAppIssueCount": "SELECT COUNT(DISTINCT r.issue_id) as value FROM related_issues r WHERE r.cross_app = true",
      "getIssueVolumeData": "scripts/analytics/calculate-volume-trends",
      "getAppDistribution": "scripts/analytics/calculate-app-distribution",
      "getActivePatterns": "scripts/analytics/get-active-patterns",
      "getPriorityHeatmap": "scripts/analytics/generate-priority-heatmap",
      "getResolutionTimeDistribution": "scripts/analytics/calculate-resolution-distribution",
      "getMonthlyCosts": "scripts/analytics/calculate-monthly-costs",
      "getAnomalies": "scripts/analytics/detect-anomalies",
      "refreshMetrics": "location.reload()"
    }
  }
}