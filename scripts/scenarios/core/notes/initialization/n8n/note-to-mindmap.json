{
  "name": "note-to-mindmap",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "notes/generate-mindmap",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {},
      "id": "manual-trigger",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [250, 500]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"note_id\": \"test-note-123\",\n  \"title\": \"Machine Learning Concepts\",\n  \"content\": \"Machine learning is a subset of artificial intelligence that enables systems to learn from data. Deep learning uses neural networks with multiple layers. Transformers have revolutionized natural language processing.\",\n  \"user_id\": \"test-user\"\n}",
        "options": {}
      },
      "id": "provide-defaults",
      "name": "Provide Defaults",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [450, 500]
    },
    {
      "parameters": {
        "jsCode": "const input = $input.all()[0].json;\n\nif (!input.content || !input.note_id) {\n  throw new Error('Note content and ID are required');\n}\n\nreturn {\n  note_id: input.note_id,\n  title: input.title || 'Untitled Note',\n  content: input.content,\n  user_id: input.user_id || 'anonymous',\n  map_id: `note_map_${input.note_id}`,\n  timestamp: new Date().toISOString()\n};"
      },
      "id": "merge-inputs",
      "name": "Merge Inputs",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 400]
    },
    {
      "parameters": {
        "command": "=#!/bin/bash\n# Create mind map from note content using mind-maps CLI\nset -e\n\n# Prepare input data\nNOTE_CONTENT='{{ $json.title }}\\n\\n{{ $json.content }}'\nMAP_ID='{{ $json.map_id }}'\nUSER_ID='{{ $json.user_id }}'\n\n# Check if mind-maps CLI is available\nif command -v mind-maps &> /dev/null; then\n    # Use mind-maps CLI to create a map from the document\n    echo \"$NOTE_CONTENT\" | mind-maps create-from-document --id \"$MAP_ID\" --user \"$USER_ID\" --format json\nelse\n    # Fallback: Call mind-maps API directly if available\n    MIND_MAPS_PORT=${MIND_MAPS_PORT:-8925}\n    \n    # Check if mind-maps service is running\n    if curl -sf \"http://localhost:$MIND_MAPS_PORT/health\" > /dev/null 2>&1; then\n        curl -X POST \"http://localhost:$MIND_MAPS_PORT/api/maps/from-document\" \\\n            -H \"Content-Type: application/json\" \\\n            -d \"{\n                \\\"document\\\": \\\"$NOTE_CONTENT\\\",\n                \\\"mapId\\\": \\\"$MAP_ID\\\",\n                \\\"userId\\\": \\\"$USER_ID\\\"\n            }\"\n    else\n        # Return error if mind-maps is not available\n        echo '{\"error\": \"Mind-maps service not available\", \"map_id\": \"'\"$MAP_ID\"'\"}'\n    fi\nfi",
        "cwd": "/tmp"
      },
      "id": "create-mindmap",
      "name": "Create Mind Map via CLI",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [850, 400]
    },
    {
      "parameters": {
        "jsCode": "const result = $json;\nconst input = $('merge-inputs').item.json;\n\n// Parse the result from the command\nlet mindMapData;\ntry {\n  mindMapData = typeof result.stdout === 'string' ? JSON.parse(result.stdout) : result.stdout;\n} catch (e) {\n  // If parsing fails, create a basic response\n  mindMapData = {\n    map_id: input.map_id,\n    status: 'created',\n    message: 'Mind map generation initiated'\n  };\n}\n\n// Store reference in note metadata\nconst noteUpdate = {\n  note_id: input.note_id,\n  metadata: {\n    mind_map_id: mindMapData.map_id || input.map_id,\n    mind_map_created: input.timestamp,\n    mind_map_status: mindMapData.status || 'pending'\n  }\n};\n\nreturn {\n  success: true,\n  note_id: input.note_id,\n  mind_map: mindMapData,\n  visualization_url: `http://localhost:${process.env.MIND_MAPS_UI_PORT || 3925}/map/${mindMapData.map_id || input.map_id}`,\n  metadata: noteUpdate.metadata\n};"
      },
      "id": "process-result",
      "name": "Process Result",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1050, 400]
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "id": "respond",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1250, 300]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Merge Inputs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Provide Defaults",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Provide Defaults": {
      "main": [
        [
          {
            "node": "Merge Inputs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Inputs": {
      "main": [
        [
          {
            "node": "Create Mind Map via CLI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Mind Map via CLI": {
      "main": [
        [
          {
            "node": "Process Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Result": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [],
  "versionId": "1.0.0",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "notes-mindmap-generation"
  }
}