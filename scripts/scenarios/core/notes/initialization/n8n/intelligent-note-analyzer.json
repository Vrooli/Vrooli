{
  "name": "intelligent-note-analyzer",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "notes/analyze-intelligent",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [260, 300],
      "id": "webhook-1"
    },
    {
      "parameters": {},
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [260, 500],
      "id": "manual-1"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "note_id",
              "value": "={{ $json.note_id || 'test-note-123' }}"
            },
            {
              "name": "title",
              "value": "={{ $json.title || 'Meeting Notes - Q1 Planning' }}"
            },
            {
              "name": "content",
              "value": "={{ $json.content || 'Discussion about Q1 objectives:\\n- Launch new feature by March\\n- Increase user engagement by 20%\\n- Hire 3 new engineers\\n- Review budget allocation\\n\\nAction items:\\n- John: Create hiring plan\\n- Sarah: Feature specs by Friday\\n- Mike: Budget proposal next week' }}"
            },
            {
              "name": "user_id",
              "value": "={{ $json.user_id || 'default-user' }}"
            },
            {
              "name": "analysis_depth",
              "value": "={{ $json.analysis_depth || 'comprehensive' }}"
            }
          ]
        }
      },
      "name": "Set Defaults",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [460, 500],
      "id": "set-defaults"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $node['Webhook'].json.body ? true : false }}",
              "value2": "true"
            }
          ]
        }
      },
      "name": "IF Webhook",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [660, 400],
      "id": "if-webhook"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "content",
              "value": "={{ $json.content }}"
            },
            {
              "name": "title",
              "value": "={{ $json.title }}"
            }
          ]
        }
      },
      "name": "Prepare for Chain of Thought",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [860, 400],
      "id": "prepare-cot"
    },
    {
      "parameters": {
        "url": "http://localhost:5678/webhook/chain-of-thought",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "problem",
              "value": "Analyze this note and extract key insights, action items, topics, sentiment, and connections to other knowledge areas. Title: {{ $json.title }}\\n\\nContent: {{ $json.content }}"
            },
            {
              "name": "reasoning_steps",
              "value": "=[\"1. Identify main topics and themes\", \"2. Extract specific action items with assignees\", \"3. Analyze sentiment and tone\", \"4. Identify dates, deadlines, and time-sensitive information\", \"5. Extract key decisions made\", \"6. Identify questions or open issues\", \"7. Suggest related topics for linking\", \"8. Generate smart tags\", \"9. Create a brief summary\", \"10. Identify follow-up actions\"]"
            },
            {
              "name": "validation_criteria",
              "value": "=[\"All action items have clear owners\", \"Dates are properly formatted\", \"Tags are relevant and specific\", \"Summary captures key points\", \"Related topics are genuinely connected\"]"
            },
            {
              "name": "output_format",
              "value": "={\"summary\": \"string\", \"topics\": [\"string\"], \"action_items\": [{\"task\": \"string\", \"assignee\": \"string\", \"deadline\": \"string\"}], \"sentiment\": \"string\", \"key_decisions\": [\"string\"], \"open_questions\": [\"string\"], \"smart_tags\": [\"string\"], \"related_topics\": [\"string\"], \"priority_level\": \"string\", \"follow_up_needed\": \"boolean\"}"
            },
            {
              "name": "max_iterations",
              "value": "3"
            }
          ]
        },
        "options": {}
      },
      "name": "Chain of Thought Analysis",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1060, 400],
      "id": "cot-analysis"
    },
    {
      "parameters": {
        "url": "http://localhost:5678/webhook/extract",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "={{ $node['prepare-cot'].json.content }}"
            },
            {
              "name": "mode",
              "value": "auto"
            }
          ]
        },
        "options": {}
      },
      "name": "Extract Structured Data",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1060, 600],
      "id": "extract-data"
    },
    {
      "parameters": {
        "url": "http://localhost:5678/webhook/smart-search",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "={{ $node['prepare-cot'].json.content }}"
            },
            {
              "name": "collection",
              "value": "notes"
            },
            {
              "name": "mode",
              "value": "quick"
            },
            {
              "name": "max_queries",
              "value": "5"
            },
            {
              "name": "max_results_per_query",
              "value": "3"
            },
            {
              "name": "include_synthesis",
              "value": "={{ true }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Find Related Notes",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1060, 800],
      "id": "find-related"
    },
    {
      "parameters": {
        "url": "http://localhost:5678/webhook/react-loop",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "goal",
              "value": "Analyze the note for hidden patterns, potential risks, opportunities, and generate creative suggestions for improvement"
            },
            {
              "name": "context",
              "value": "={{ JSON.stringify({title: $node['prepare-cot'].json.title, content: $node['prepare-cot'].json.content, initial_analysis: $node['Chain of Thought Analysis'].json}) }}"
            },
            {
              "name": "tools",
              "value": "=[{\"name\": \"pattern_detector\", \"description\": \"Detect patterns in text\", \"parameters\": {}}, {\"name\": \"risk_analyzer\", \"description\": \"Analyze potential risks\", \"parameters\": {}}, {\"name\": \"opportunity_finder\", \"description\": \"Find hidden opportunities\", \"parameters\": {}}, {\"name\": \"creative_suggester\", \"description\": \"Generate creative suggestions\", \"parameters\": {}}]"
            },
            {
              "name": "max_iterations",
              "value": "3"
            },
            {
              "name": "mode",
              "value": "quick"
            }
          ]
        },
        "options": {}
      },
      "name": "ReAct Deep Analysis",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1260, 600],
      "id": "react-analysis"
    },
    {
      "parameters": {
        "functionCode": "const cotAnalysis = $node['Chain of Thought Analysis'].json;\nconst structuredData = $node['Extract Structured Data'].json;\nconst relatedNotes = $node['Find Related Notes'].json;\nconst reactAnalysis = $node['ReAct Deep Analysis'].json;\n\n// Combine all analyses\nconst combinedAnalysis = {\n  note_id: $node['prepare-cot'].json.note_id || 'unknown',\n  title: $node['prepare-cot'].json.title,\n  \n  // From Chain of Thought\n  summary: cotAnalysis.solution?.summary || cotAnalysis.final_answer || '',\n  topics: cotAnalysis.solution?.topics || [],\n  action_items: cotAnalysis.solution?.action_items || [],\n  sentiment: cotAnalysis.solution?.sentiment || 'neutral',\n  key_decisions: cotAnalysis.solution?.key_decisions || [],\n  open_questions: cotAnalysis.solution?.open_questions || [],\n  smart_tags: cotAnalysis.solution?.smart_tags || [],\n  priority_level: cotAnalysis.solution?.priority_level || 'medium',\n  follow_up_needed: cotAnalysis.solution?.follow_up_needed || false,\n  \n  // From Structured Data Extraction\n  extracted_entities: {\n    emails: structuredData.data?.emails || [],\n    phones: structuredData.data?.phones || [],\n    dates: structuredData.data?.dates || [],\n    urls: structuredData.data?.urls || [],\n    money: structuredData.data?.money || [],\n    locations: structuredData.data?.locations || [],\n    people: structuredData.data?.people || []\n  },\n  \n  // From Smart Search\n  related_notes: relatedNotes.aggregated_results?.slice(0, 5).map(r => ({\n    id: r.id,\n    title: r.metadata?.title || 'Untitled',\n    score: r.score,\n    snippet: r.content?.substring(0, 100) + '...'\n  })) || [],\n  related_synthesis: relatedNotes.synthesis || '',\n  \n  // From ReAct Analysis\n  deep_insights: {\n    patterns: reactAnalysis.result?.patterns || [],\n    risks: reactAnalysis.result?.risks || [],\n    opportunities: reactAnalysis.result?.opportunities || [],\n    creative_suggestions: reactAnalysis.result?.suggestions || [],\n    reasoning_trace: reactAnalysis.reasoning_trace || []\n  },\n  \n  // Metadata\n  analysis_timestamp: new Date().toISOString(),\n  analysis_depth: $node['prepare-cot'].json.analysis_depth,\n  confidence_scores: {\n    cot: cotAnalysis.confidence_score || 0,\n    extraction: structuredData.confidence_score || 0,\n    search: relatedNotes.confidence_score || 0,\n    react: reactAnalysis.success ? 0.85 : 0\n  },\n  \n  // Quality metrics\n  quality_metrics: {\n    completeness: (cotAnalysis.success && structuredData.success && relatedNotes.success && reactAnalysis.success) ? 1.0 : 0.7,\n    depth_score: cotAnalysis.iterations ? (cotAnalysis.iterations / 3) : 0.5,\n    relevance_score: relatedNotes.stats?.avg_score || 0.5\n  }\n};\n\n// Calculate overall confidence\ncombinedAnalysis.overall_confidence = \n  (combinedAnalysis.confidence_scores.cot + \n   combinedAnalysis.confidence_scores.extraction + \n   combinedAnalysis.confidence_scores.search + \n   combinedAnalysis.confidence_scores.react) / 4;\n\n// Generate AI recommendations\ncombinedAnalysis.ai_recommendations = [];\n\nif (combinedAnalysis.follow_up_needed) {\n  combinedAnalysis.ai_recommendations.push({\n    type: 'follow_up',\n    priority: 'high',\n    message: 'This note requires follow-up actions. Review action items.'\n  });\n}\n\nif (combinedAnalysis.open_questions.length > 0) {\n  combinedAnalysis.ai_recommendations.push({\n    type: 'clarification',\n    priority: 'medium',\n    message: `${combinedAnalysis.open_questions.length} open questions need resolution.`\n  });\n}\n\nif (combinedAnalysis.deep_insights.risks.length > 0) {\n  combinedAnalysis.ai_recommendations.push({\n    type: 'risk',\n    priority: 'high',\n    message: 'Potential risks identified. Review risk analysis.'\n  });\n}\n\nif (combinedAnalysis.related_notes.length > 3) {\n  combinedAnalysis.ai_recommendations.push({\n    type: 'connection',\n    priority: 'low',\n    message: 'This note is highly connected. Consider creating a topic cluster.'\n  });\n}\n\nreturn combinedAnalysis;"
      },
      "name": "Combine All Analyses",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1460, 400],
      "id": "combine-analyses"
    },
    {
      "parameters": {
        "url": "http://localhost:5678/webhook/embed",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "={{ $json.title + ' ' + $json.summary + ' ' + $json.smart_tags.join(' ') }}"
            },
            {
              "name": "model",
              "value": "nomic-embed-text"
            }
          ]
        },
        "options": {}
      },
      "name": "Generate Embedding",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1660, 400],
      "id": "generate-embedding"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "status",
              "value": "success"
            }
          ],
          "object": [
            {
              "name": "analysis",
              "value": "={{ $json }}"
            },
            {
              "name": "embedding",
              "value": "={{ $node['Generate Embedding'].json }}"
            }
          ]
        }
      },
      "name": "Format Response",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [1860, 400],
      "id": "format-response"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "status",
              "value": "error"
            },
            {
              "name": "message",
              "value": "Failed to analyze note"
            }
          ]
        }
      },
      "name": "Error Response",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [1860, 600],
      "id": "error-response"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "IF Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Set Defaults",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Defaults": {
      "main": [
        [
          {
            "node": "IF Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Webhook": {
      "main": [
        [
          {
            "node": "Prepare for Chain of Thought",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare for Chain of Thought",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Chain of Thought": {
      "main": [
        [
          {
            "node": "Chain of Thought Analysis",
            "type": "main",
            "index": 0
          },
          {
            "node": "Extract Structured Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "Find Related Notes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chain of Thought Analysis": {
      "main": [
        [
          {
            "node": "ReAct Deep Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Structured Data": {
      "main": [
        [
          {
            "node": "ReAct Deep Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Find Related Notes": {
      "main": [
        [
          {
            "node": "ReAct Deep Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ReAct Deep Analysis": {
      "main": [
        [
          {
            "node": "Combine All Analyses",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combine All Analyses": {
      "main": [
        [
          {
            "node": "Generate Embedding",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Embedding": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateId": "intelligent-note-analyzer"
  },
  "pinData": {},
  "versionId": "1.0.0",
  "triggerCount": 2,
  "tags": []
}