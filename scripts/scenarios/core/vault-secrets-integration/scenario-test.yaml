version: 1.0
scenario: vault-secrets-integration

# Structure validation
structure:
  required_files:
    - .vrooli/service.json
    - initialization/storage/schema.sql
    - initialization/storage/seed.sql
    - initialization/automation/n8n/main-workflow.json
    - initialization/automation/triggers.yaml
    - initialization/automation/windmill/windmill-app.json
    - initialization/configuration/app-config.json
    - initialization/configuration/feature-flags.json
    - initialization/configuration/resource-urls.json
    - deployment/startup.sh
    - deployment/monitor.sh
    - test.sh
    - custom-tests.sh
    - resources/n8n/vault-integration-workflow.json
    - resources/postgres/schema.sql
    - resources/postgres/seed.sql
  
  required_dirs:
    - .vrooli
    - initialization/storage
    - initialization/automation
    - initialization/configuration
    - deployment
    - resources
    - resources/config
    - resources/n8n
    - resources/postgres

# Resource requirements
resources:
  required: [vault, n8n]
  optional: [postgres]
  health_timeout: 25

# Declarative tests
tests:
  - name: "Application Health Check"
    type: http
    service: app
    endpoint: /api/vault-secrets-integration/health
    method: GET
    expect:
      status: 200
      body:
        type: json

  - name: "Secrets Manager Ready"
    type: http
    service: vault
    endpoint: /v1/sys/health
    method: GET
    expect:
      status: 200

  - name: "N8N Workflow Engine Ready"
    type: http
    service: n8n
    endpoint: /api/v1/info
    method: GET
    expect:
      status: 200
      body:
        type: json
      
  - name: "Vault Secrets Integration Workflow"
    type: custom
    script: custom-tests.sh
    function: test_vault_secrets_integration_workflow

# Validation criteria
validation:
  success_rate: 90        # High success rate for DevSecOps solution
  response_time: 5000     # 5 seconds max for secrets operations
  revenue_potential: 40000  # Total estimate from service.json
  business_criteria:
    - "HashiCorp Vault secrets management operational"
    - "Zero-trust workflow automation functional"
    - "Automated secrets rotation capabilities validated"
    - "Centralized audit trails and compliance verified"
    - "DevSecOps integration pipeline confirmed"
