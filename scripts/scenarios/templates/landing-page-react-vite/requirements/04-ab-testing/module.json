{
  "module_id": "ab-testing",
  "title": "A/B Testing Core",
  "priority": "P0",
  "description": "Whole-page A/B variant selection, management, and archival",
  "requirements": [
    {
      "id": "AB-FALLBACK",
      "title": "Baked fallback variant",
      "prd_ref": "OT-P0-031",
      "description": "Ship a static fallback variant (hero/features/pricing/cta/download copy) that the UI renders whenever variant selection or section fetches fail, ensuring visitors always see a safe configuration even if the API is unavailable.",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "ref": "ui/src/app/providers/LandingVariantProvider.test.tsx",
          "notes": "Provider unit tests cover fallback activation when the landing config fetch errors or the slug is invalid."
        },
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "ref": "api/landing_config_service_test.go",
          "notes": "LandingConfigService test verifies that missing variants trigger the baked fallback response."
        }
      ],
      "status": "complete",
      "notes": "Spec: Template PRD `OT-P0-031` (landing config + fallback). Frontend fallback coverage via LandingVariantProvider tests and backend guard via landing_config_service."
    },
    {
      "id": "AB-URL",
      "title": "URL variant selection",
      "prd_ref": "OT-P0-014",
      "description": "If variant_slug in URL, force that variant regardless of localStorage",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "notes": "Frontend variant context fetches variant by slug from URL parameter. Tests verify URL takes priority over localStorage.",
          "ref": "ui/src/contexts/VariantContext.tsx"
        }
      ],
      "status": "complete",
      "notes": "Complete implementation: API endpoint GET /api/v1/variants/{slug} + frontend VariantContext with URL parsing. 7 unit tests passing."
    },
    {
      "id": "AB-STORAGE",
      "title": "localStorage persistence",
      "prd_ref": "OT-P0-015",
      "description": "If no URL slug and localStorage has variant ID, reuse that variant",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "notes": "Frontend VariantContext retrieves and stores variant in localStorage. Tests verify persistence across page reloads.",
          "ref": "ui/src/contexts/VariantContext.tsx"
        }
      ],
      "status": "complete",
      "dependencies": [
        "AB-URL"
      ],
      "notes": "Complete implementation: VariantContext manages localStorage persistence with VARIANT_STORAGE_KEY. Unit tests validate storage/retrieval logic."
    },
    {
      "id": "AB-API",
      "title": "API weight-based selection",
      "prd_ref": "OT-P0-016",
      "description": "If neither URL nor localStorage, API selects variant by weight and frontend stores it in localStorage",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "notes": "Frontend VariantContext calls /api/v1/variants/select and stores result in localStorage. Tests verify selection and storage.",
          "ref": "ui/src/contexts/VariantContext.tsx"
        }
      ],
      "status": "complete",
      "dependencies": [
        "AB-URL",
        "AB-STORAGE"
      ],
      "notes": "Complete end-to-end implementation: Backend weighted selection API + frontend integration with localStorage persistence. 10 total unit tests passing (7 frontend + 3 backend)."
    },
    {
      "id": "AB-CRUD",
      "title": "Variant CRUD operations",
      "prd_ref": "OT-P0-017",
      "description": "Admin can create, update weights, disable/archive, and hard delete variants (with confirmation)",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "notes": "All CRUD API endpoints implemented: GET /variants, POST /variants, PATCH /variants/{slug}, DELETE /variants/{slug}",
          "ref": "api/variant_service.go"
        }
      ],
      "status": "complete",
      "notes": "Backend CRUD complete. Admin UI for variant management needs implementation."
    },
    {
      "id": "AB-ARCHIVE",
      "title": "Archived variant handling",
      "prd_ref": "OT-P0-018",
      "description": "Archived variants remain queryable for analytics but ineligible for random selection",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "notes": "Archive endpoint POST /variants/{slug}/archive implemented. SelectVariant excludes archived status.",
          "ref": "api/variant_service.go"
        }
      ],
      "status": "complete",
      "dependencies": [
        "AB-CRUD"
      ],
      "notes": "Database schema has status column (active, archived, deleted). API filters archived variants from random selection. SelectVariant only returns active variants."
    }
  ],
  "_metadata": {}
}
