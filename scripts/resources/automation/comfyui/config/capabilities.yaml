apiVersion: vrooli.com/v1
kind: ResourceCapability
metadata:
  name: comfyui
  category: automation
  subcategory: image-generation
  description: "Node-based GUI for stable diffusion with powerful workflow automation"
  maturity: stable
  complexity: advanced
  
spec:
  # Core capabilities this resource provides
  capabilities:
    primary:
      - image-generation
      - workflow-automation
      - stable-diffusion-interface
      - node-based-workflows
    secondary:
      - image-editing
      - batch-processing
      - model-management
      - prompt-engineering
    specialized:
      - gpu-acceleration
      - custom-node-ecosystem
      - api-automation
      - advanced-compositing
  
  # API interfaces available
  interfaces:
    - name: workflow-execution
      endpoint: "/prompt"
      method: [POST]
      inputTypes: [application/json]
      outputTypes: [application/json, image/png, image/jpeg]
      description: "Execute ComfyUI workflows via API"
    - name: queue-management
      endpoint: "/queue"
      method: [GET, DELETE]
      inputTypes: []
      outputTypes: [application/json]
      description: "Manage generation queue and monitor progress"
    - name: model-management
      endpoint: "/object_info"
      method: [GET]
      inputTypes: []
      outputTypes: [application/json]
      description: "List available models, nodes, and capabilities"
    - name: websocket
      endpoint: "/ws"
      method: [WebSocket]
      inputTypes: [websocket]
      outputTypes: [websocket]
      description: "Real-time progress updates and notifications"
  
  # Resource dependencies and requirements
  dependencies:
    required:
      - python
      - pytorch
      - cuda-toolkit
    optional:
      - nvidia-gpu
      - stable-diffusion-models
    incompatible: []
  
  # Scenario compatibility
  scenarios:
    primary:
      - image-generation-pipeline
      - brand-manager
      - campaign-content-studio
    secondary:
      - document-manager
      - research-assistant
    optimal_combinations:
      - [comfyui, minio, n8n]               # Automated image generation pipeline
      - [comfyui, postgres, vault]          # Secure image workflow management
      - [comfyui, ollama, agent-s2]         # AI-powered image automation
      - [comfyui, whisper, unstructured-io] # Multi-modal content creation
  
  # Business intelligence
  business:
    revenue_range:
      min: 12000
      max: 60000
      currency: USD
    complexity_score: 8  # 1-10 scale
    implementation_time: "4-8 days"
    upwork_demand: very-high
    target_industries:
      - creative-agencies
      - marketing-automation
      - content-creation
      - e-commerce
      - gaming
      - entertainment
      - social-media-management
    common_project_types:
      - "Automated marketing image generation"
      - "Brand-consistent content creation platform"
      - "E-commerce product image automation"
      - "Social media content pipeline"
      - "Creative workflow automation"
  
  # Technical specifications
  technical:
    ports: [8188]
    protocols: [http, websocket, rest]
    data_formats: [json, png, jpeg, webp, tiff, safetensors, ckpt, pth]
    resource_requirements:
      memory:
        minimum: "8GB"
        recommended: "16GB"
        optimal: "32GB+"
      cpu:
        minimum: "4 cores"
        recommended: "8 cores"
        optimal: "16+ cores"
      storage:
        minimum: "10GB"
        recommended: "50GB"
        optimal: "500GB+"
      gpu:
        required: true
        recommended: true
        supported: ["NVIDIA RTX 20xx+", "NVIDIA Tesla", "AMD ROCm"]
      vram:
        minimum: "6GB"
        recommended: "12GB"
        optimal: "24GB+"
    scaling:
      horizontal: true
      vertical: true
      max_concurrent_workflows: 5
      execution_modes: [gpu, cpu-fallback, batch]
  
  # AI generation hints for automated scenario creation
  ai_generation:
    common_patterns:
      - automated-image-generation
      - brand-consistent-content-creation
      - batch-image-processing
      - workflow-based-automation
    integration_targets:
      preferred: [minio, n8n, postgres, vault]
      compatible: [ollama, agent-s2, whisper, redis]
      avoid: [text-only-processing, audio-processing]
    workflow_templates:
      generation: "Receive prompt → Generate image → Apply brand styling → Store result → Notify completion"
      batch: "Load prompts from DB → Generate images → Apply post-processing → Store in MinIO → Update status"
      automation: "Trigger on event → Generate variations → Quality check → Deliver to client → Log metrics"
    complexity_indicators:
      simple: ["single image generation", "basic prompts", "standard models"]
      intermediate: ["batch processing", "custom workflows", "brand consistency", "API integration"]
      advanced: ["enterprise automation", "custom models", "complex compositing", "real-time generation"]
  
  # Specialized features
  features:
    node_based_interface:
      enabled: true
      description: "Visual workflow builder with node-based interface"
      capabilities: ["drag-drop", "visual-programming", "workflow-templates"]
    gpu_optimization:
      enabled: true
      description: "Optimized GPU utilization for fast image generation"
      requires: nvidia_gpu
    model_ecosystem:
      enabled: true
      description: "Support for thousands of community models and nodes"
      types: ["checkpoints", "loras", "embeddings", "custom-nodes"]
    api_automation:
      enabled: true
      description: "Full API access for workflow automation"
      formats: ["json", "websocket", "rest"]
  
  # Integration capabilities
  integrations:
    model_formats:
      - safetensors
      - ckpt
      - pth
      - diffusers
    image_formats:
      - png
      - jpeg
      - webp
      - tiff
      - exr
    workflow_features:
      - custom_nodes
      - community_models
      - batch_processing
      - api_integration
      - real_time_preview
  
  # Testing and validation
  testing:
    test_file: "scripts/resources/automation/comfyui/test/integration-test.sh"
    test_coverage:
      - service_health
      - workflow_execution
      - model_loading
      - api_functionality
      - gpu_utilization
    fixtures:
      - sample_workflows
      - test_models
      - validation_prompts
    integration_tests:
      - comfyui_minio_storage
      - comfyui_n8n_automation
      - batch_generation_workflow
  
  # Documentation and examples
  documentation:
    readme: "scripts/resources/automation/comfyui/README.md"
    api_reference: "scripts/resources/automation/comfyui/docs/API.md"
    examples_dir: "scripts/resources/automation/comfyui/examples/"
    configuration: "scripts/resources/automation/comfyui/docs/CONFIGURATION.md"
    troubleshooting: "scripts/resources/automation/comfyui/docs/TROUBLESHOOTING.md"
  
  # Version and compatibility
  version_info:
    min_version: "0.1.0"
    tested_version: "latest"
    api_version: "v1"
    compatibility_matrix:
      python: ">=3.8"
      pytorch: ">=2.0"
      cuda: ">=11.8"
      docker: ">=20.10.0"
      architecture: [amd64]

# Metadata for resource discovery and automation
labels:
  resource.vrooli.com/category: "automation"
  resource.vrooli.com/type: "image-generation"
  resource.vrooli.com/maturity: "stable"
  resource.vrooli.com/business-value: "very-high"
  resource.vrooli.com/ai-friendly: "true"
  resource.vrooli.com/gpu-required: "true"