workflow:
  name: "form-submission"
  description: "Submit various types of forms with validation and file uploads"
  version: "1.0.0"
  debug_level: "steps"
  
  parameters:
    form_url:
      type: string
      required: true
      description: "URL of the form to submit"
    form_data:
      type: object
      required: true
      description: "Form field values as key-value pairs"
    file_uploads:
      type: array
      required: false
      description: "Array of file paths to upload"
      default: []
    submit_button_text:
      type: string
      required: false
      description: "Text on submit button"
      default: "Submit"
    wait_for_response:
      type: boolean
      required: false
      description: "Wait for form submission response"
      default: true
  
  steps:
    - name: "navigate-to-form"
      action: "navigate"
      url: "${params.form_url}"
      wait_for: "networkidle2"
      timeout: 30000
      debug:
        screenshot: true
        console: true
    
    - name: "wait-for-form"
      action: "wait_for_element"
      selector: "form, .form-container, #contact-form"
      timeout: 10000
      visible: true
      debug:
        screenshot: false
    
    - name: "accept-cookies"
      action: "click"
      selector: "button:contains('Accept'), .cookie-accept, #accept-cookies"
      on_error: "continue"
      timeout: 2000
      debug:
        screenshot: false
    
    - name: "fill-text-fields"
      action: "fill_form"
      selectors:
        name: "input[name='name'], #name, input[placeholder*='name']"
        email: "input[name='email'], #email, input[type='email']"
        phone: "input[name='phone'], #phone, input[type='tel']"
        subject: "input[name='subject'], #subject, input[placeholder*='subject']"
        company: "input[name='company'], #company, input[placeholder*='company']"
        website: "input[name='website'], #website, input[type='url']"
      values: "${params.form_data}"
      on_error: "continue"
      debug:
        screenshot: true
    
    - name: "fill-message-field"
      action: "fill_form"
      selectors:
        message: "textarea[name='message'], #message, textarea[placeholder*='message']"
        comments: "textarea[name='comments'], #comments, textarea"
      values:
        message: "${params.form_data.message}"
        comments: "${params.form_data.comments}"
      on_error: "continue"
      debug:
        screenshot: true
    
    - name: "select-dropdown-options"
      action: "select"
      selector: "select[name='category'], #category, select[name='department']"
      value: "${params.form_data.category}"
      on_error: "continue"
      debug:
        screenshot: true
    
    - name: "check-checkboxes"
      action: "click"
      selector: "input[type='checkbox'][name='newsletter'], #newsletter"
      on_error: "continue"
      debug:
        screenshot: false
    
    - name: "select-radio-option"
      action: "click"
      selector: "input[type='radio'][value='${params.form_data.contact_method}']"
      on_error: "continue"
      debug:
        screenshot: false
    
    - name: "upload-file-1"
      action: "upload_file"
      selector: "input[type='file'], #file-upload, .file-input"
      file_path: "${params.file_uploads[0]}"
      on_error: "continue"
      condition: "${params.file_uploads.length > 0}"
      debug:
        screenshot: true
    
    - name: "wait-for-upload"
      action: "wait"
      duration: 2000
      condition: "${params.file_uploads.length > 0}"
      debug:
        screenshot: false
    
    - name: "scroll-to-submit"
      action: "scroll"
      selector: "button[type='submit'], input[type='submit']"
      debug:
        screenshot: false
    
    - name: "capture-filled-form"
      action: "screenshot"
      output: "${context.outputDir}/filled-form.png"
      full_page: true
      debug:
        screenshot: true
    
    - name: "submit-form"
      action: "click"
      selector: "button[type='submit'], input[type='submit'], button:contains('${params.submit_button_text}')"
      wait_for_navigation: "${params.wait_for_response}"
      debug:
        screenshot: true
        network: true
        console: true
    
    - name: "wait-for-submission"
      action: "wait_for_network_idle"
      idle_time: 2000
      timeout: 10000
      condition: "${params.wait_for_response}"
      debug:
        screenshot: false
    
    - name: "check-success-message"
      action: "wait_for_element"
      selector: ".success-message, .alert-success, .form-success, h1:contains('Thank'), .confirmation"
      timeout: 10000
      on_error: "continue"
      debug:
        screenshot: true
    
    - name: "extract-confirmation"
      action: "extract_data"
      selectors:
        confirmation_message: ".success-message, .alert-success, .confirmation-text"
        reference_number: ".reference-number, .ticket-id, .submission-id"
        timestamp: ".submission-time, .timestamp, time"
      on_error: "continue"
      output: "${context.outputDir}/submission-confirmation.json"
      debug:
        screenshot: false
    
    - name: "capture-confirmation"
      action: "screenshot"
      output: "${context.outputDir}/form-confirmation.png"
      full_page: true
      debug:
        screenshot: true
    
    - name: "check-for-errors"
      action: "assert_no_element"
      selector: ".error-message, .alert-danger, .form-error, .validation-error"
      on_error: "continue"
      debug:
        screenshot: true