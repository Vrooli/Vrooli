{
  "name": "real-estate-platform",
  "description": "Complete real estate platform with property listings, lead management, and market analytics",
  "version": "1.0.0",
  "author": "Vrooli Team",
  "tags": ["real-estate", "property", "crm", "listings"],
  "dependencies": [],
  
  "resources": {
    "postgres": {
      "description": "Main database for properties, agents, and leads",
      "inject": {
        "tables": [
          {
            "name": "realestate",
            "schema": "assets/schema.sql",
            "seed": "assets/seed-data.sql"
          }
        ]
      }
    },
    
    "minio": {
      "description": "Storage for property images, documents, and virtual tours",
      "inject": {
        "buckets": [
          {
            "name": "property-images",
            "policy": "public-read",
            "versioning": false
          },
          {
            "name": "property-documents",
            "policy": "private",
            "versioning": true
          },
          {
            "name": "virtual-tours",
            "policy": "public-read",
            "versioning": false
          },
          {
            "name": "agent-profiles",
            "policy": "public-read",
            "versioning": false
          }
        ]
      }
    },
    
    "node-red": {
      "description": "Lead capture and notification workflows",
      "inject": {
        "flows": [
          {
            "name": "Lead Capture",
            "file": "assets/workflows/node-red/lead-capture.json",
            "deploy": true
          },
          {
            "name": "Property Alerts",
            "file": "assets/workflows/node-red/property-alerts.json",
            "deploy": true
          },
          {
            "name": "Showing Scheduler",
            "file": "assets/workflows/node-red/showing-scheduler.json",
            "deploy": true
          }
        ]
      }
    },
    
    "n8n": {
      "description": "CRM automation and marketing workflows",
      "inject": {
        "workflows": [
          {
            "name": "Lead Nurturing",
            "file": "assets/workflows/n8n/lead-nurturing.json",
            "active": true
          },
          {
            "name": "Market Report Generator",
            "file": "assets/workflows/n8n/market-report.json",
            "active": true
          },
          {
            "name": "Commission Calculator",
            "file": "assets/workflows/n8n/commission-calc.json",
            "active": false
          },
          {
            "name": "Document Management",
            "file": "assets/workflows/n8n/document-flow.json",
            "active": true
          }
        ]
      }
    },
    
    "qdrant": {
      "description": "Vector search for property recommendations and similar listings",
      "inject": {
        "collections": [
          {
            "name": "properties",
            "size": 768,
            "distance": "Cosine",
            "on_disk": false
          },
          {
            "name": "neighborhoods",
            "size": 384,
            "distance": "Cosine",
            "on_disk": false
          },
          {
            "name": "buyer_preferences",
            "size": 256,
            "distance": "Cosine",
            "on_disk": false
          }
        ],
        "indices": [
          {
            "collection": "properties",
            "field": "property_type",
            "type": "keyword"
          },
          {
            "collection": "properties",
            "field": "city",
            "type": "keyword"
          },
          {
            "collection": "properties",
            "field": "price_range",
            "type": "keyword"
          }
        ]
      }
    },
    
    "questdb": {
      "description": "Time-series data for market analytics and price tracking",
      "inject": {
        "tables": [
          {
            "name": "property_views",
            "schema": "timestamp TIMESTAMP, property_id SYMBOL, viewer_id SYMBOL, source SYMBOL, duration INT, actions SYMBOL",
            "partitionBy": "DAY",
            "timestamp": "timestamp"
          },
          {
            "name": "price_history",
            "schema": "timestamp TIMESTAMP, property_id SYMBOL, list_price DOUBLE, sale_price DOUBLE, days_on_market INT, status SYMBOL",
            "partitionBy": "MONTH",
            "timestamp": "timestamp"
          },
          {
            "name": "market_metrics",
            "schema": "timestamp TIMESTAMP, zipcode SYMBOL, median_price DOUBLE, inventory INT, avg_dom INT, price_per_sqft DOUBLE",
            "partitionBy": "MONTH",
            "timestamp": "timestamp"
          },
          {
            "name": "lead_activity",
            "schema": "timestamp TIMESTAMP, lead_id SYMBOL, agent_id SYMBOL, activity_type SYMBOL, property_id SYMBOL, notes STRING",
            "partitionBy": "DAY",
            "timestamp": "timestamp"
          }
        ]
      }
    },
    
    "vault": {
      "description": "Secure storage for API keys and sensitive documents",
      "inject": {
        "secrets": [
          {
            "path": "secret/data/mls/api",
            "data": {
              "api_key": "${MLS_API_KEY}",
              "api_secret": "${MLS_API_SECRET}",
              "endpoint": "${MLS_ENDPOINT}"
            }
          },
          {
            "path": "secret/data/maps/google",
            "data": {
              "api_key": "${GOOGLE_MAPS_KEY}",
              "geocoding_key": "${GOOGLE_GEOCODING_KEY}"
            }
          },
          {
            "path": "secret/data/communications/twilio",
            "data": {
              "account_sid": "${TWILIO_SID}",
              "auth_token": "${TWILIO_TOKEN}",
              "phone_number": "${TWILIO_PHONE}"
            }
          },
          {
            "path": "secret/data/mortgage/calculator",
            "data": {
              "api_key": "${MORTGAGE_CALC_KEY}",
              "rate_api": "${MORTGAGE_RATE_API}"
            }
          }
        ],
        "policies": [
          {
            "name": "agent-access",
            "rules": "path \"secret/data/mls/*\" { capabilities = [\"read\"] } path \"secret/data/maps/*\" { capabilities = [\"read\"] }"
          },
          {
            "name": "admin-access",
            "rules": "path \"secret/data/*\" { capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"] }"
          }
        ]
      }
    },
    
    "windmill": {
      "description": "Scheduled reports and batch processing",
      "inject": {
        "scripts": [
          {
            "name": "daily_listing_sync",
            "file": "assets/scripts/windmill/mls-sync.py",
            "schedule": "0 2 * * *",
            "description": "Sync listings from MLS"
          },
          {
            "name": "weekly_market_analysis",
            "file": "assets/scripts/windmill/market-analysis.py",
            "schedule": "0 8 * * 1",
            "description": "Generate weekly market reports"
          },
          {
            "name": "lead_scoring",
            "file": "assets/scripts/windmill/lead-scoring.py",
            "schedule": "0 */6 * * *",
            "description": "Update lead scores based on activity"
          },
          {
            "name": "commission_reports",
            "file": "assets/scripts/windmill/commission-report.py",
            "schedule": "0 0 1 * *",
            "description": "Monthly commission reports"
          }
        ],
        "apps": [
          {
            "name": "agent_dashboard",
            "file": "assets/apps/windmill/agent-dashboard.json",
            "public": false
          },
          {
            "name": "property_analyzer",
            "file": "assets/apps/windmill/property-analyzer.json",
            "public": false
          }
        ]
      }
    },
    
    "ollama": {
      "description": "AI models for property descriptions and chat support",
      "inject": {
        "models": [
          {
            "name": "llama2",
            "tag": "13b",
            "pull": true
          },
          {
            "name": "mistral",
            "tag": "7b",
            "pull": true
          }
        ]
      }
    },
    
    "comfyui": {
      "description": "Virtual staging and property image enhancement",
      "inject": {
        "workflows": [
          {
            "name": "virtual_staging",
            "file": "assets/workflows/comfyui/virtual-staging.json",
            "description": "Add furniture to empty rooms"
          },
          {
            "name": "exterior_enhancement",
            "file": "assets/workflows/comfyui/exterior-enhance.json",
            "description": "Enhance property exterior photos"
          }
        ]
      }
    }
  },
  
  "environment": {
    "required": [
      "DB_USER",
      "DB_PASSWORD",
      "MLS_API_KEY",
      "GOOGLE_MAPS_KEY",
      "SMTP_HOST",
      "SMTP_PORT",
      "SMTP_USER",
      "SMTP_PASSWORD"
    ],
    "optional": [
      "MLS_API_SECRET",
      "MLS_ENDPOINT",
      "GOOGLE_GEOCODING_KEY",
      "TWILIO_SID",
      "TWILIO_TOKEN",
      "TWILIO_PHONE",
      "MORTGAGE_CALC_KEY"
    ]
  },
  
  "post_injection": {
    "commands": [
      "echo 'Real Estate Platform deployed successfully!'",
      "echo 'Access points:'",
      "echo '  - Agent Dashboard: http://localhost:8000'",
      "echo '  - Property Search: http://localhost:3000'",
      "echo '  - n8n Workflows: http://localhost:5678'",
      "echo '  - Node-RED: http://localhost:1880'"
    ]
  }
}