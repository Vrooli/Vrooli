# Vrooli Resource Interface Contract - Core Requirements v1.0
# This contract defines the minimum interface requirements that ALL resources must implement
# regardless of category (ai, automation, agents, storage, search, execution)

version: "1.0"
contract_type: "core"
description: "Base interface requirements for all Vrooli resources"

# Required actions that MUST be implemented by all resources
required_actions:
  install:
    description: "Install the resource and its dependencies"
    parameters:
      - name: force
        type: flag
        required: false
        description: "Skip confirmation prompts and force installation"
    exit_codes:
      0: "Successfully installed"
      1: "Installation failed"
      2: "Already installed (skipped)"
    timeout_seconds: 300
    
  start:
    description: "Start the resource service"
    parameters:
      - name: wait
        type: flag
        required: false
        description: "Wait for service to be ready before returning"
    exit_codes:
      0: "Service started successfully"
      1: "Start failed"
      2: "Already running"
    timeout_seconds: 60
    
  stop:
    description: "Stop the resource service"
    parameters:
      - name: force
        type: flag
        required: false
        description: "Force stop without graceful shutdown"
    exit_codes:
      0: "Service stopped successfully"
      1: "Stop failed"
      2: "Not running"
    timeout_seconds: 30
    
  status:
    description: "Check resource service status and health"
    parameters: []
    exit_codes:
      0: "Service running and healthy"
      1: "Service error or unhealthy"
      2: "Service not running"
    output_formats:
      - text
      - json  # Optional but recommended
    timeout_seconds: 10
    
  logs:
    description: "Display resource service logs"
    parameters:
      - name: tail
        type: integer
        required: false
        default: 50
        description: "Number of log lines to show"
    exit_codes:
      0: "Logs displayed successfully"
      1: "Error retrieving logs"
    timeout_seconds: 15

# Standard help patterns that must be supported
help_patterns:
  - "--help"
  - "-h"
  - "--version"

# Required error handling patterns
error_handling:
  strict_mode: "set -euo pipefail"
  cleanup_trap: "trap cleanup EXIT"
  error_messages: "Meaningful error messages with context"
  exit_codes: "Consistent exit code usage (0=success, 1=error, 2=skip/already)"

# Required file structure
file_structure:
  required_files:
    - "manage.sh"           # Main management script
    - "config/defaults.sh"  # Default configuration
    - "config/messages.sh"  # User-facing messages
    - "lib/common.sh"       # Common utility functions
  optional_files:
    - "lib/install.sh"      # Installation utilities
    - "lib/status.sh"       # Status check utilities
    - "README.md"           # Documentation
    - "inject.sh"           # Dependency injection
  required_directories:
    - "config/"             # Configuration files
    - "lib/"                # Library functions

# Argument parsing patterns
argument_patterns:
  main_flag: "--action"
  action_syntax: "--action ACTION_NAME"
  common_flags:
    - "--yes"               # Skip confirmations
    - "--verbose"           # Verbose output
    - "--quiet"             # Minimal output
    - "--dry-run"           # Show what would be done
  parameter_syntax: "--parameter-name value"

# Configuration loading requirements
configuration:
  load_order:
    1: "config/defaults.sh"
    2: "config/messages.sh"
    3: "lib/common.sh"
  environment_variables:
    namespace: "VROOLI_RESOURCE_"
    service_specific: true

# Performance requirements
performance:
  startup_time_max_seconds: 60
  status_check_max_seconds: 10
  help_display_max_seconds: 2

# Security requirements
security:
  file_permissions:
    manage_script: "executable"
    config_files: "readable"
    directories: "accessible"
  input_validation: "required"
  sensitive_data: "must_not_log"

# Compatibility requirements
compatibility:
  bash_version_min: "4.0"
  required_commands:
    - "bash"
    - "echo"
    - "grep"
    - "sed"
  optional_commands:
    - "docker"
    - "curl"
    - "jq"

# Validation rules for this contract
validation:
  syntax_checks:
    - "required_actions_present"
    - "help_patterns_implemented"
    - "error_handling_patterns"
    - "file_structure_complete"
  behavioral_checks:
    - "actions_execute_successfully"
    - "exit_codes_correct"
    - "help_output_formatted"
  integration_checks:
    - "service_lifecycle_works"
    - "configuration_loading"
    - "port_registry_integration"