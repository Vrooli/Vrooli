# Vrooli Resource Interface Contract - Search Resources v1.0
# This contract extends core.yaml with search-specific requirements
# Applies to: searxng

version: "1.0"
contract_type: "category"
extends: "core.yaml"
category: "search"
description: "Interface requirements for search and information retrieval resources"

# Additional actions specific to search resources
additional_actions:
  search:
    description: "Perform search query"
    parameters:
      - name: query
        type: string
        required: true
        description: "Search query string"
      - name: engine
        type: string
        required: false
        description: "Specific search engine to use"
      - name: category
        type: string
        required: false
        values: ["general", "images", "videos", "news", "maps", "music", "files"]
        default: "general"
        description: "Search category"
      - name: format
        type: string
        required: false
        values: ["json", "xml", "html", "rss"]
        default: "json"
        description: "Response format"
      - name: limit
        type: integer
        required: false
        default: 10
        description: "Maximum number of results"
    exit_codes:
      0: "Search successful"
      1: "Search failed"
      2: "No results found"
    timeout_seconds: 30
    
  engines:
    description: "Manage search engines"
    parameters:
      - name: action
        type: string
        required: true
        values: ["list", "enable", "disable", "status"]
        description: "Engine management action"
      - name: engine
        type: string
        required: false
        description: "Specific engine name"
      - name: format
        type: string
        required: false
        values: ["text", "json"]
        default: "text"
        description: "Output format"
    exit_codes:
      0: "Engine operation successful"
      1: "Engine operation failed"
      2: "Engine not found"
    timeout_seconds: 15
    
  configure:
    description: "Configure search settings"
    parameters:
      - name: setting
        type: string
        required: true
        description: "Setting name to configure"
      - name: value
        type: string
        required: true
        description: "Setting value"
      - name: engine
        type: string
        required: false
        description: "Engine-specific setting"
    exit_codes:
      0: "Configuration successful"
      1: "Configuration failed"
      2: "Invalid setting or value"
    timeout_seconds: 10
    
  stats:
    description: "Display search statistics"
    parameters:
      - name: period
        type: string
        required: false
        values: ["hour", "day", "week", "month"]
        default: "day"
        description: "Statistics period"
      - name: format
        type: string
        required: false
        values: ["text", "json"]
        default: "text"
        description: "Output format"
    exit_codes:
      0: "Statistics displayed"
      1: "Statistics retrieval failed"
      2: "No statistics available"
    timeout_seconds: 10

# Search-specific configuration requirements
search_configuration:
  engines_config:
    description: "Search engines configuration"
    required: true
    environment_variable: "VROOLI_SEARCH_ENGINES_CONFIG"
  
  privacy_settings:
    description: "Privacy and anonymization settings"
    required: true
    parameters:
      - "disable_logging"
      - "anonymize_queries"
      - "remove_tracking"
      - "proxy_requests"
  
  rate_limiting:
    description: "Rate limiting configuration"
    parameters:
      - "requests_per_minute"
      - "burst_limit"
      - "per_engine_limits"
  
  caching_settings:
    description: "Search result caching"
    optional: true
    parameters:
      - "cache_duration"
      - "cache_size"
      - "cache_engines"

# Search-specific file structure
search_file_structure:
  required_files:
    - "config/engines.yaml"     # Search engines configuration
  
  optional_files:
    - "lib/search.sh"           # Search utilities
    - "lib/engines.sh"          # Engine management
    - "config/settings.yaml"    # Search settings
    - "filters/"                # Search filters
    - "plugins/"                # Search plugins
  
  optional_directories:
    - "cache/"                  # Search result cache
    - "logs/"                   # Search-specific logs
    - "plugins/"                # Search engine plugins
    - "filters/"                # Content filters
    - "themes/"                 # UI themes

# Search-specific environment variables
search_environment:
  required_variables:
    - "VROOLI_SEARCH_SERVICE_PORT"
    - "VROOLI_SEARCH_BASE_URL"
  
  optional_variables:
    - "VROOLI_SEARCH_ENGINES_CONFIG"
    - "VROOLI_SEARCH_CACHE_SIZE"
    - "VROOLI_SEARCH_RATE_LIMIT"
    - "VROOLI_SEARCH_PROXY_URL"
    - "VROOLI_SEARCH_SECRET_KEY"

# Performance requirements for search resources
search_performance:
  search_response_max_seconds: 10
  engine_status_max_seconds: 5
  configuration_update_max_seconds: 5
  concurrent_search_support: true
  cache_hit_ratio_min: 0.8

# Search-specific security requirements
search_security:
  query_sanitization: "required"
  result_filtering: "required"
  privacy_protection: "required"
  rate_limiting: "required"
  ssl_encryption: "required"

# Search service health indicators
search_health_checks:
  api_endpoint:
    description: "API endpoint responds"
    method: "GET"
    path: "/health"
    expected_status: 200
    timeout_seconds: 10
  
  search_functionality:
    description: "Basic search functionality works"
    test_query: "test"
    expected_results: ">= 1"
    timeout_seconds: 15
  
  engine_availability:
    description: "At least one search engine is available"
    check_type: "engine_status"
    minimum_engines: 1
    timeout_seconds: 10

# Common search resource patterns
search_patterns:
  query_format:
    description: "Standard query format handling"
    supported_operators: ["AND", "OR", "NOT", "\"exact phrase\""]
    special_syntax: ["site:", "filetype:", "intitle:"]
  
  api_endpoints:
    description: "Standard API endpoint patterns"
    required_endpoints:
      - "/health"
      - "/search"
      - "/engines"
    optional_endpoints:
      - "/stats"
      - "/config"
      - "/autocomplete"
  
  result_format:
    description: "Standard search result format"
    required_fields:
      - "title"
      - "url"
      - "content"
      - "engine"
    optional_fields:
      - "thumbnail"
      - "published_date"
      - "score"
      - "category"

# Integration requirements
search_integration:
  upstream_engines:
    description: "Integration with upstream search engines"
    required: true
    supported_engines: ["google", "bing", "duckduckgo", "startpage", "yandex"]
  
  proxy_support:
    description: "Proxy and VPN integration"
    optional: true
    supported_protocols: ["http", "https", "socks5"]
  
  content_filtering:
    description: "Content filtering capabilities"
    optional: true
    filter_types: ["adult_content", "malware", "phishing", "spam"]
  
  monitoring:
    description: "Search-specific monitoring metrics"
    required_metrics:
      - "search_requests_count"
      - "average_response_time"
      - "engine_success_rate"
      - "cache_hit_ratio"
      - "active_engines_count"

# Search engine management
engine_management:
  engine_states:
    - "enabled"
    - "disabled"
    - "error"
    - "timeout"
  
  engine_types:
    - "general"
    - "images"
    - "videos"
    - "news"
    - "maps"
    - "academic"
  
  required_operations:
    - "list_engines"
    - "enable_engine"
    - "disable_engine"
    - "check_engine_status"

# Privacy and anonymization
privacy_features:
  query_anonymization:
    description: "Query anonymization features"
    required: true
    features:
      - "remove_personal_info"
      - "strip_tracking_params"
      - "randomize_user_agent"
  
  result_sanitization:
    description: "Result sanitization features"
    required: true
    features:
      - "remove_tracking_urls"
      - "sanitize_content"
      - "filter_malicious_links"
  
  logging_policy:
    description: "Privacy-compliant logging"
    required: true
    policies:
      - "no_query_logging"
      - "anonymized_metrics_only"
      - "configurable_retention"

# Content filtering and safety
content_safety:
  safe_search:
    description: "Safe search filtering"
    required: true
    levels: ["off", "moderate", "strict"]
  
  malware_protection:
    description: "Malware and phishing protection"
    optional: true
    features:
      - "url_scanning"
      - "blacklist_checking"
      - "reputation_scoring"
  
  adult_content_filter:
    description: "Adult content filtering"
    optional: true
    modes: ["off", "moderate", "strict"]

# Validation rules specific to search resources
search_validation:
  syntax_checks:
    - "search_actions_present"
    - "engine_management_implemented"
    - "configuration_available"
  
  behavioral_checks:
    - "basic_search_functional"
    - "engine_listing_works"
    - "privacy_features_active"
  
  integration_checks:
    - "upstream_engines_accessible"
    - "result_format_compliant"
    - "privacy_requirements_met"
    - "performance_targets_achieved"