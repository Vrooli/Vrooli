{
  "$schema": "../schemas/scenarios.schema.json",
  "version": "1.0.0",
  "scenarios": {
    "local-development": {
      "name": "local-development",
      "description": "Local development setup with hot reload",
      "category": "development",
      "resources": {
        "include": ["storage.postgres", "storage.redis", "ai.ollama", "execution.bullmq"],
        "exclude": ["ai.openrouter", "storage.qdrant"]
      },
      "execution": {
        "environment": "development",
        "sandboxing": "process",
        "languages": ["javascript", "typescript"]
      },
      "deployment": {
        "target": "local"
      },
      "initialization": {
        "phases": [
          {
            "name": "setup-database",
            "description": "Initialize database schema and seed data",
            "tasks": [
              {
                "name": "create-schema",
                "type": "command",
                "command": ["npm", "run", "db:schema"],
                "timeout": "30s"
              },
              {
                "name": "seed-data",
                "type": "command",
                "command": ["npm", "run", "db:seed"],
                "timeout": "60s"
              }
            ]
          },
          {
            "name": "setup-ai",
            "description": "Download and prepare AI models",
            "parallel": true,
            "tasks": [
              {
                "name": "pull-llm",
                "type": "command",
                "command": ["ollama", "pull", "llama3.1:8b"],
                "timeout": "600s"
              },
              {
                "name": "pull-embeddings",
                "type": "command",
                "command": ["ollama", "pull", "nomic-embed-text"],
                "timeout": "300s"
              }
            ]
          },
          {
            "name": "verify-setup",
            "description": "Verify all services are running",
            "waitFor": ["setup-database", "setup-ai"],
            "tasks": [
              {
                "name": "health-check",
                "type": "http",
                "url": "http://localhost:3000/health",
                "timeout": "10s",
                "retryPolicy": {
                  "maxAttempts": 5,
                  "delay": "2s"
                }
              }
            ]
          }
        ],
        "timeout": "15m",
        "retryPolicy": {
          "maxAttempts": 2,
          "delay": "30s"
        }
      }
    },
    "docker-testing": {
      "name": "docker-testing",
      "description": "Docker containerized environment for testing",
      "category": "testing",
      "resources": {
        "include": ["storage.postgres", "storage.redis", "storage.qdrant", "ai.ollama", "execution.bullmq"],
        "configurations": {
          "storage.postgres": {
            "host": "postgres-container"
          },
          "storage.redis": {
            "host": "redis-container"
          },
          "ai.ollama": {
            "baseUrl": "http://ollama-container:11434"
          }
        }
      },
      "execution": {
        "environment": "production",
        "sandboxing": "container"
      },
      "deployment": {
        "target": "docker",
        "strategy": "recreate"
      },
      "initialization": {
        "phases": [
          {
            "name": "wait-for-services",
            "description": "Wait for all containers to be ready",
            "parallel": true,
            "tasks": [
              {
                "name": "wait-postgres",
                "type": "check",
                "condition": {
                  "type": "resource",
                  "resource": "storage.postgres",
                  "expected": "healthy"
                },
                "timeout": "60s"
              },
              {
                "name": "wait-redis",
                "type": "check",
                "condition": {
                  "type": "resource",
                  "resource": "storage.redis",
                  "expected": "healthy"
                },
                "timeout": "30s"
              }
            ]
          },
          {
            "name": "run-tests",
            "description": "Execute test suite",
            "waitFor": ["wait-for-services"],
            "tasks": [
              {
                "name": "integration-tests",
                "type": "command",
                "command": ["npm", "run", "test:integration"],
                "timeout": "300s"
              }
            ]
          }
        ]
      },
      "validation": {
        "postDeployment": [
          {
            "name": "service-health",
            "type": "health",
            "target": "all-services",
            "severity": "error"
          },
          {
            "name": "api-availability",
            "type": "connectivity",
            "target": "api-endpoints",
            "severity": "critical"
          }
        ]
      }
    },
    "production-minimal": {
      "name": "production-minimal",
      "description": "Minimal production deployment",
      "category": "production",
      "resources": {
        "required": ["storage.postgres", "storage.redis", "ai.ollama"],
        "optional": ["storage.qdrant"]
      },
      "execution": {
        "environment": "production",
        "sandboxing": "container"
      },
      "deployment": {
        "target": "kubernetes",
        "strategy": "rolling",
        "scaling": {
          "min": 2,
          "max": 5,
          "targetCPU": 70
        }
      },
      "validation": {
        "preDeployment": [
          {
            "name": "security-scan",
            "type": "security",
            "target": "container-images",
            "severity": "critical"
          },
          {
            "name": "resource-check",
            "type": "connectivity",
            "target": "required-resources",
            "severity": "critical"
          }
        ],
        "postDeployment": [
          {
            "name": "smoke-test",
            "type": "health",
            "target": "api-endpoints",
            "severity": "critical"
          },
          {
            "name": "performance-check",
            "type": "performance",
            "target": "response-time",
            "severity": "warning"
          }
        ]
      },
      "transitions": [
        {
          "from": "docker-testing",
          "to": "production-minimal",
          "condition": {
            "type": "expression",
            "expression": "tests_passed && security_cleared"
          },
          "automatic": true
        }
      ]
    }
  },
  "profiles": {
    "development": {
      "name": "development",
      "description": "Development profile with debugging enabled",
      "resources": {
        "presets": {
          "storage.postgres": {
            "pool": {
              "min": 1,
              "max": 5
            }
          }
        }
      },
      "execution": {
        "environment": "development"
      },
      "variables": {
        "LOG_LEVEL": "debug",
        "DEBUG_MODE": "true"
      }
    },
    "production": {
      "name": "production",
      "description": "Production profile with performance optimizations",
      "extends": "development",
      "resources": {
        "overrides": {
          "storage.postgres": {
            "pool": {
              "min": 5,
              "max": 20
            }
          }
        }
      },
      "execution": {
        "environment": "production"
      },
      "variables": {
        "LOG_LEVEL": "info",
        "DEBUG_MODE": "false",
        "CACHE_TTL": "3600"
      }
    }
  },
  "workflows": {
    "deploy-to-production": {
      "name": "deploy-to-production",
      "description": "Complete production deployment workflow",
      "trigger": {
        "type": "manual"
      },
      "steps": [
        {
          "name": "security-validation",
          "type": "scenario",
          "scenario": "security-scan",
          "onFailure": [
            {
              "name": "notify-security-team",
              "type": "command",
              "command": ["notify", "security", "deployment-blocked"]
            }
          ]
        },
        {
          "name": "deploy",
          "type": "scenario",
          "scenario": "production-minimal",
          "onSuccess": [
            {
              "name": "notify-success",
              "type": "command",
              "command": ["notify", "team", "deployment-success"]
            }
          ]
        }
      ],
      "notifications": [
        {
          "type": "slack",
          "destination": "#deployments",
          "events": ["start", "success", "failure"],
          "template": "deployment-status"
        }
      ]
    }
  }
}