{
  "$schema": "../schemas/service.schema.json",
  "version": "1.0.0",
  "service": {
    "name": "custom-automation-platform",
    "displayName": "Custom Enterprise Automation Platform",
    "description": "Enterprise automation platform derived from Vrooli with custom integrations",
    "version": "1.0.0",
    "type": "platform",
    "tags": [
      "automation",
      "enterprise",
      "custom",
      "integration"
    ],
    "maintainers": [
      {
        "name": "Enterprise Team",
        "email": "platform-team@company.com",
        "url": "https://github.com/company/automation-platform"
      }
    ],
    "repository": {
      "type": "git",
      "url": "https://github.com/company/automation-platform",
      "sshUrl": "git@github.com:company/automation-platform.git",
      "directory": "/",
      "branch": "main",
      "private": true,
      "mirrors": [
        "https://gitlab.company.com/automation-platform",
        "https://backup.company.com/git/automation-platform"
      ],
      "submodules": {
        "enabled": true,
        "recursive": true,
        "shallow": false
      },
      "hooks": {
        "postClone": "pnpm install && cd packages/server && pnpm prisma generate",
        "preBuild": "pnpm test:unit && pnpm lint",
        "postUpdate": "pnpm install && pnpm prisma migrate deploy"
      }
    },
    "license": "PROPRIETARY",
    "homepage": "https://automation.company.com",
    "support": {
      "email": "support@company.com",
      "issues": "https://github.com/company/automation-platform/issues"
    }
  },
  "inheritance": {
    "extends": "../service.json",
    "overrides": {
      "resources": true,
      "execution": false,
      "scenarios": true,
      "serve": true
    },
    "merge": {
      "strategy": "merge",
      "arrays": "union"
    }
  },
  "resources": {
    "storage": {
      "postgres": {
        "$ref": "../service.json#/resources/storage/postgres",
        "database": "enterprise_platform",
        "username": "platform_user",
        "pool": {
          "min": 5,
          "max": 25
        }
      },
      "redis": {
        "$ref": "../service.json#/resources/storage/redis",
        "maxMemory": "4Gi"
      },
      "mongodb": {
        "type": "mongodb",
        "enabled": true,
        "version": "7",
        "host": "localhost",
        "port": 27017,
        "database": "analytics",
        "healthCheck": {
          "type": "tcp",
          "port": 27017,
          "intervalMs": 30000
        }
      },
      "elasticsearch": {
        "type": "elasticsearch",
        "enabled": true,
        "version": "8.11",
        "baseUrl": "http://localhost:9200",
        "indices": [
          {
            "name": "workflow-logs",
            "shards": 3,
            "replicas": 1
          },
          {
            "name": "audit-trail",
            "shards": 2,
            "replicas": 2
          }
        ]
      }
    },
    "ai": {
      "ollama": {
        "$ref": "../service.json#/resources/ai/ollama",
        "models": [
          {
            "name": "llama3.1:70b",
            "type": "llm"
          },
          {
            "name": "codellama:34b",
            "type": "llm"
          },
          {
            "name": "nomic-embed-text",
            "type": "embedding"
          }
        ]
      },
      "openai": {
        "type": "openai",
        "enabled": true,
        "provider": "openai",
        "baseUrl": "https://api.openai.com/v1",
        "apiKey": {
          "name": "OPENAI_API_KEY",
          "key": "value",
          "provider": "vault"
        },
        "models": [
          {
            "name": "gpt-4",
            "type": "llm"
          },
          {
            "name": "text-embedding-3-large",
            "type": "embedding"
          }
        ],
        "rateLimits": {
          "requests": 500,
          "window": "1m"
        }
      }
    },
    "automation": {
      "n8n": {
        "type": "n8n",
        "enabled": true,
        "baseUrl": "http://localhost:5678",
        "webhookUrl": "http://localhost:5678/webhook",
        "workspaces": [
          "enterprise",
          "finance",
          "hr"
        ],
        "executionLimit": 50
      },
      "windmill": {
        "type": "windmill",
        "enabled": true,
        "baseUrl": "http://localhost:8000",
        "workspaces": [
          "platform-admin",
          "workflow-dev"
        ],
        "executionLimit": 100
      },
      "zapier": {
        "type": "zapier",
        "enabled": true,
        "baseUrl": "https://hooks.zapier.com",
        "apiKey": {
          "name": "ZAPIER_API_KEY",
          "key": "value",
          "provider": "vault"
        },
        "rateLimits": {
          "requests": 1000,
          "window": "1h"
        }
      }
    },
    "agents": {
      "claude-code": {
        "type": "claude-code",
        "enabled": true,
        "capabilities": [
          "code-execution",
          "file-management",
          "api-interaction"
        ],
        "sandbox": true,
        "maxSessionTime": "60m"
      },
      "custom-agent": {
        "type": "custom-agent",
        "enabled": true,
        "baseUrl": "http://localhost:9000",
        "capabilities": [
          "document-processing",
          "data-analysis",
          "report-generation"
        ],
        "sandbox": true,
        "maxSessionTime": "30m",
        "rateLimits": {
          "requests": 100,
          "window": "1h"
        }
      }
    },
    "execution": {
      "bullmq": {
        "$ref": "../service.json#/resources/execution/bullmq",
        "queues": [
          {
            "name": "workflow-execution",
            "durable": true,
            "maxRetries": 5,
            "deadLetter": "workflow-dlq"
          },
          {
            "name": "data-processing",
            "durable": true,
            "maxRetries": 3,
            "deadLetter": "data-processing-dlq"
          },
          {
            "name": "notification",
            "durable": true,
            "maxRetries": 3
          },
          {
            "name": "audit",
            "durable": true,
            "maxRetries": 1
          }
        ]
      },
      "judge0": {
        "type": "judge0",
        "enabled": true,
        "baseUrl": "http://localhost:2358",
        "languages": [
          "javascript",
          "typescript",
          "python",
          "go",
          "java"
        ],
        "timeout": "60s",
        "memoryLimit": "512Mi",
        "networkAccess": false,
        "fileSystemAccess": false
      }
    }
  },
  "scenarios": {
    "enterprise-development": {
      "name": "enterprise-development",
      "description": "Enterprise development environment with full tooling",
      "category": "development",
      "resources": {
        "include": [
          "storage.postgres",
          "storage.redis",
          "storage.mongodb",
          "ai.ollama",
          "ai.openai",
          "automation.n8n",
          "automation.windmill",
          "agents.claude-code",
          "agents.custom-agent",
          "execution.bullmq",
          "execution.judge0"
        ]
      },
      "deployment": {
        "target": "local"
      },
      "initialization": {
        "phases": [
          {
            "name": "setup-enterprise-data",
            "tasks": [
              {
                "name": "migrate-enterprise-schema",
                "type": "command",
                "command": [
                  "npm",
                  "run",
                  "db:migrate:enterprise"
                ]
              },
              {
                "name": "seed-enterprise-data",
                "type": "command",
                "command": [
                  "npm",
                  "run",
                  "db:seed:enterprise"
                ]
              }
            ]
          },
          {
            "name": "setup-integrations",
            "parallel": true,
            "tasks": [
              {
                "name": "configure-n8n",
                "type": "script",
                "script": "./scripts/setup-n8n-enterprise.sh"
              },
              {
                "name": "configure-windmill",
                "type": "script",
                "script": "./scripts/setup-windmill-enterprise.sh"
              }
            ]
          }
        ]
      }
    },
    "production-enterprise": {
      "name": "production-enterprise",
      "description": "Production enterprise deployment with high availability",
      "category": "production",
      "resources": {
        "required": [
          "storage.postgres",
          "storage.redis",
          "storage.mongodb",
          "storage.elasticsearch",
          "ai.openai",
          "automation.n8n",
          "automation.windmill",
          "execution.bullmq"
        ],
        "optional": [
          "ai.ollama",
          "agents.claude-code",
          "execution.judge0"
        ]
      },
      "deployment": {
        "target": "kubernetes",
        "strategy": "blue-green",
        "scaling": {
          "min": 5,
          "max": 25,
          "targetCPU": 60,
          "targetMemory": 70
        }
      },
      "validation": {
        "preDeployment": [
          {
            "name": "security-compliance",
            "type": "compliance",
            "target": "all-components",
            "severity": "critical"
          },
          {
            "name": "enterprise-sso",
            "type": "security",
            "target": "authentication",
            "severity": "critical"
          },
          {
            "name": "data-governance",
            "type": "compliance",
            "target": "data-handling",
            "severity": "critical"
          }
        ],
        "postDeployment": [
          {
            "name": "workflow-smoke-test",
            "type": "health",
            "target": "workflow-endpoints",
            "severity": "critical"
          },
          {
            "name": "integration-connectivity",
            "type": "connectivity",
            "target": "external-systems",
            "severity": "error"
          }
        ]
      }
    }
  },
  "serve": {
    "deployment": {
      "targets": {
        "aws-prod": {
          "type": "eks",
          "enabled": true,
          "environment": "production",
          "region": "us-east-1",
          "cluster": "enterprise-automation-prod",
          "namespace": "automation-platform"
        },
        "azure-dr": {
          "type": "aks",
          "enabled": true,
          "environment": "disaster-recovery",
          "region": "eastus2",
          "cluster": "enterprise-automation-dr",
          "namespace": "automation-platform"
        }
      },
      "strategy": {
        "type": "canary",
        "canary": {
          "steps": [
            {
              "weight": 5,
              "duration": "15m"
            },
            {
              "weight": 25,
              "duration": "30m"
            },
            {
              "weight": 50,
              "duration": "60m"
            },
            {
              "weight": 100
            }
          ]
        }
      }
    },
    "monitoring": {
      "metrics": {
        "enabled": true,
        "provider": "datadog",
        "endpoint": "https://api.datadoghq.com",
        "custom": [
          {
            "name": "workflow_executions_total",
            "type": "counter",
            "labels": [
              "workspace",
              "status",
              "workflow_type"
            ]
          },
          {
            "name": "enterprise_user_sessions",
            "type": "gauge",
            "labels": [
              "department",
              "role"
            ]
          }
        ]
      },
      "alerts": {
        "rules": [
          {
            "name": "enterprise-workflow-failures",
            "expression": "rate(workflow_executions_total{status=\"failed\"}[5m]) > 0.02",
            "duration": "3m",
            "severity": "critical"
          },
          {
            "name": "sso-authentication-issues",
            "expression": "rate(auth_failures_total[5m]) > 0.01",
            "duration": "2m",
            "severity": "critical"
          }
        ]
      }
    },
    "networking": {
      "ingress": {
        "enabled": true,
        "className": "enterprise-gateway",
        "hosts": [
          {
            "host": "automation.company.com",
            "paths": [
              {
                "path": "/api",
                "pathType": "Prefix",
                "backend": "platform-api"
              },
              {
                "path": "/workflows",
                "pathType": "Prefix",
                "backend": "workflow-engine"
              }
            ]
          }
        ],
        "annotations": {
          "enterprise.company.com/sso-required": "true",
          "enterprise.company.com/audit-log": "detailed"
        }
      }
    }
  },
  "lifecycle": {
    "hooks": {
      "preInstall": {
        "exec": {
          "command": [
            "./scripts/enterprise-prereqs.sh"
          ],
          "environment": {
            "ENTERPRISE_MODE": "true",
            "COMPLIANCE_LEVEL": "strict"
          }
        }
      },
      "postInstall": {
        "exec": {
          "command": [
            "./scripts/validate-enterprise-setup.sh"
          ]
        }
      }
    },
    "dependencies": {
      "services": [
        {
          "name": "enterprise-sso",
          "required": true,
          "checkHealth": true,
          "waitFor": {
            "condition": "ready",
            "timeout": "5m"
          }
        },
        {
          "name": "audit-system",
          "required": true,
          "checkHealth": true
        },
        {
          "name": "backup-system",
          "required": false,
          "checkHealth": true
        }
      ]
    }
  }
}