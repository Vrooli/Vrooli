{
  "metadata": {
    "description": "Validates graceful handling of invalid CSS selectors with appropriate error messages",
    "version": 1,
    "reset": "none"
  },
  "settings": {
    "executionViewport": {
      "width": 1920,
      "height": 1080,
      "preset": "desktop"
    }
  },
  "nodes": [
    {
      "id": "navigate-dashboard",
      "type": "navigate",
      "data": {
        "label": "Open BAS dashboard",
        "destinationType": "scenario",
        "scenario": "browser-automation-studio",
        "scenarioPath": "/",
        "waitUntil": "networkidle0",
        "timeoutMs": 45000,
        "waitForMs": 2000
      }
    },
    {
      "id": "wait-dashboard",
      "type": "wait",
      "data": {
        "label": "Wait for dashboard",
        "durationMs": 2000,
        "waitType": "duration"
      }
    },
    {
      "id": "click-invalid-selector",
      "type": "click",
      "data": {
        "label": "Attempt click with invalid selector (should fail gracefully)",
        "selector": ".this-element-does-not-exist-at-all",
        "timeoutMs": 3000,
        "waitForMs": 500,
        "continueOnError": true
      }
    },
    {
      "id": "wait-after-error",
      "type": "wait",
      "data": {
        "label": "Wait after expected error",
        "durationMs": 1500,
        "waitType": "duration"
      }
    },
    {
      "id": "capture-error-state",
      "type": "screenshot",
      "data": {
        "label": "Capture error handling UI",
        "fullPage": true,
        "waitForMs": 500
      }
    },
    {
      "id": "verify-error-displayed",
      "type": "evaluate",
      "data": {
        "label": "Check if error message is displayed",
        "expression": "!!document.querySelector('[class*=\"error\"], [role=\"alert\"], [class*=\"toast\"]')",
        "storeAs": "errorDisplayed",
        "continueOnError": true
      }
    },
    {
      "id": "verify-workflow-continues",
      "type": "assert",
      "data": {
        "label": "Workflow should continue (not crash)",
        "selector": "body",
        "assertMode": "exists",
        "timeoutMs": 3000,
        "failureMessage": "Page should still be responsive after error"
      }
    },
    {
      "id": "test-malformed-selector",
      "type": "click",
      "data": {
        "label": "Test malformed selector syntax",
        "selector": "[[[invalid---syntax",
        "timeoutMs": 3000,
        "waitForMs": 500,
        "continueOnError": true
      }
    },
    {
      "id": "wait-after-malformed",
      "type": "wait",
      "data": {
        "label": "Wait after malformed selector",
        "durationMs": 1500,
        "waitType": "duration"
      }
    },
    {
      "id": "capture-malformed-error",
      "type": "screenshot",
      "data": {
        "label": "Capture malformed selector error",
        "fullPage": true,
        "waitForMs": 500
      }
    },
    {
      "id": "verify-graceful-recovery",
      "type": "evaluate",
      "data": {
        "label": "System should recover gracefully",
        "expression": "true",
        "storeAs": "recoveredGracefully"
      }
    },
    {
      "id": "final-verification",
      "type": "screenshot",
      "data": {
        "label": "Final graceful degradation verification",
        "fullPage": true,
        "waitForMs": 500
      }
    }
  ],
  "edges": [
    {
      "id": "e1",
      "source": "navigate-dashboard",
      "target": "wait-dashboard",
      "type": "smoothstep"
    },
    {
      "id": "e2",
      "source": "wait-dashboard",
      "target": "click-invalid-selector",
      "type": "smoothstep"
    },
    {
      "id": "e3",
      "source": "click-invalid-selector",
      "target": "wait-after-error",
      "type": "smoothstep"
    },
    {
      "id": "e4",
      "source": "wait-after-error",
      "target": "capture-error-state",
      "type": "smoothstep"
    },
    {
      "id": "e5",
      "source": "capture-error-state",
      "target": "verify-error-displayed",
      "type": "smoothstep"
    },
    {
      "id": "e6",
      "source": "verify-error-displayed",
      "target": "verify-workflow-continues",
      "type": "smoothstep"
    },
    {
      "id": "e7",
      "source": "verify-workflow-continues",
      "target": "test-malformed-selector",
      "type": "smoothstep"
    },
    {
      "id": "e8",
      "source": "test-malformed-selector",
      "target": "wait-after-malformed",
      "type": "smoothstep"
    },
    {
      "id": "e9",
      "source": "wait-after-malformed",
      "target": "capture-malformed-error",
      "type": "smoothstep"
    },
    {
      "id": "e10",
      "source": "capture-malformed-error",
      "target": "verify-graceful-recovery",
      "type": "smoothstep"
    },
    {
      "id": "e11",
      "source": "verify-graceful-recovery",
      "target": "final-verification",
      "type": "smoothstep"
    }
  ]
}
