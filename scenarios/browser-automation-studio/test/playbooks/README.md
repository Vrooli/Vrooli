# BAS Playbook Registry

Automation workflows live here for both **capabilities** (feature surfaces) and **journeys** (multi-surface flows).

## Directory Layout
- `capabilities/` – mirrors PRD operational targets
  - `foundation/` – project CRUD, workflow lists, version history
  - `builder/` – canvas, palette, toolbar, header, demo seeds
  - `execution/` – telemetry + control UIs and automation fixtures
  - `ai/` – AI modal + generation smoke flows
  - `replay/` – replay UI and export automation
  - `nonfunctional/` – performance/error-handling checks
- `journeys/` – composite flows (e.g., happy-path new user)
- `__subflows/` – reusable fixtures (`metadata.fixture_id` required)
- `__seeds/` – deterministic seed/cleanup scripts supporting flows

Numbers in the requirements folders determine **what** each target means; this layout explains **where** to place the validations.

## Authoring Checklist
1. Pick the correct capability folder + surface (e.g., `builder/toolbar`). If the folder doesn’t exist yet, create it and update this README.
2. File naming: `feature-action.json` (kebab-case, include verb).
3. Add metadata with `description`, `requirement` ID, and `version`.
4. Reference selectors via `@selector/<key>` from `ui/src/consts/selectors.ts` (never hard-code CSS). Add new selector keys there when needed.
5. Reuse fixtures by setting `"workflowId": "@fixture/<slug>(key=value)"` rather than duplicating setup steps. Parameters are optional unless the fixture declares them in metadata. Strings with spaces/punctuation must be quoted: `@fixture/open-workflow(project="Demo Browser Automations")`. Use `@store/<key>` for runtime values stored earlier in the workflow.
6. If a fixture guarantees requirement coverage (e.g., demo workflow seeding), list those requirement IDs under `metadata.requirements`. The resolver propagates them to parent workflows via `metadata.requirementsFromFixtures` so coverage reports know which requirements the run exercised.
7. Update the matching requirement module to reference the new playbook path; auto-sync will keep statuses fresh when tests run.

### Fixture Metadata Reference

- `fixture_id` – required slug referenced via `@fixture/<slug>`
- `parameters` – optional array describing accepted arguments. Each entry supports `name`, `type` (`string|number|boolean|enum`), `required`, `default`, `enumValues`, and `description`. Defaults can reference stores (e.g., `"default": "@store/seed.workflowName"`).
- `requirements` – optional array of requirement IDs the fixture covers during execution. These IDs propagate to every playbook that calls the fixture.

**Call Syntax**

```
"workflowId": "@fixture/open-workflow(project=\"Demo Browser Automations\", workflow=@store/seed.workflowName)"
```

- Separate key/value pairs with commas.
- Quote values containing spaces, commas, or parentheses.
- `@store/<key>` values are treated as literal strings and resolved at runtime by BAS. Seeds push canonical keys (`seed.projectName`, `seed.workflowName`, etc.) via the `load-seed-state` fixture so downstream fixtures can reference them consistently.
- `@seed/<key>` tokens (e.g., `@seed/projectName`) are resolved by the workflow resolver *before* execution using the JSON artifact generated by `test/playbooks/__seeds/apply.sh` (`test/artifacts/runtime/seed-state.json`). Use these when you need literal strings (selectors, labels, etc.) derived from the dynamic seed state.
- Unknown parameters or missing required parameters cause workflow resolution to fail fast.

## Running Locally
```
browser-automation-studio execution create \
  --file test/playbooks/capabilities/foundation/projects/new-project-create.json \
  --wait
```

## Notes
- Keep this README under 100 lines; link to shared docs for deep dives (`docs/testing/guides/ui-automation-with-bas.md`).
- No compatibility shims: move files directly into this layout even if it causes short-term failures.
- Upcoming automation ideas referenced in requirements should point to `test/playbooks/journeys/...` using the final desired path.
- Regenerate the registry after edits: `node scripts/scenarios/testing/playbooks/build-registry.mjs --scenario scenarios/browser-automation-studio` (run from repo root).
