{
  "edges": [
    {
      "id": "e0",
      "source": "open-demo-project",
      "target": "switch-to-tree-view",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e1",
      "source": "switch-to-tree-view",
      "target": "assert-tree-visible",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e2",
      "source": "assert-tree-visible",
      "target": "capture-initial-tree-state",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e3",
      "source": "capture-initial-tree-state",
      "target": "click-new-menu",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e4",
      "source": "click-new-menu",
      "target": "assert-resync-button-visible",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e5",
      "source": "assert-resync-button-visible",
      "target": "click-resync-button",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e6",
      "source": "click-resync-button",
      "target": "wait-for-confirm-dialog",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e7",
      "source": "wait-for-confirm-dialog",
      "target": "assert-confirm-dialog-text",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e8",
      "source": "assert-confirm-dialog-text",
      "target": "confirm-resync",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e9",
      "source": "confirm-resync",
      "target": "wait-for-tree-refresh",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e10",
      "source": "wait-for-tree-refresh",
      "target": "assert-tree-still-visible",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e11",
      "source": "assert-tree-still-visible",
      "target": "verify-post-resync-state",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e12",
      "source": "verify-post-resync-state",
      "target": "assert-no-errors",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    }
  ],
  "metadata": {
    "description": "Tests the resync-from-disk functionality: verifies that the resync operation rebuilds the file index and is accessible via the UI menu",
    "labels": {
      "reset": "full"
    },
    "version": "1"
  },
  "nodes": [
    {
      "action": {
        "metadata": {
          "label": "Open seeded demo project"
        },
        "subflow": {
          "workflow_path": "actions/open-demo-project.json"
        },
        "type": "ACTION_TYPE_SUBFLOW"
      },
      "id": "open-demo-project"
    },
    {
      "action": {
        "click": {
          "selector": "@selector/projects.fileTree.viewModeToggle"
        },
        "metadata": {
          "label": "Switch to File Tree view"
        },
        "type": "ACTION_TYPE_CLICK"
      },
      "execution_settings": {
        "wait_after_ms": 500
      },
      "id": "switch-to-tree-view"
    },
    {
      "action": {
        "assert": {
          "failure_message": "File tree should be visible after switching view mode",
          "mode": "ASSERTION_MODE_EXISTS",
          "selector": "@selector/projects.fileTree.container",
          "timeout_ms": 5000
        },
        "metadata": {
          "label": "File tree root is visible"
        },
        "type": "ACTION_TYPE_ASSERT"
      },
      "id": "assert-tree-visible"
    },
    {
      "action": {
        "evaluate": {
          "expression": "(() =\u003e { const folders = document.querySelectorAll('[data-testid=\"file-tree-folder\"]').length; const files = document.querySelectorAll('[data-testid=\"file-tree-file\"]').length; return { initialFolderCount: folders, initialFileCount: files }; })()",
          "store_result": "initialTreeState"
        },
        "metadata": {
          "label": "Capture initial tree state"
        },
        "type": "ACTION_TYPE_EVALUATE"
      },
      "id": "capture-initial-tree-state"
    },
    {
      "action": {
        "click": {
          "selector": "@selector/workflows.newButton"
        },
        "metadata": {
          "label": "Open New file menu to access resync"
        },
        "type": "ACTION_TYPE_CLICK"
      },
      "execution_settings": {
        "wait_after_ms": 300
      },
      "id": "click-new-menu"
    },
    {
      "action": {
        "assert": {
          "failure_message": "Resync from Disk button should be visible in the New menu",
          "mode": "ASSERTION_MODE_EXISTS",
          "selector": "button:has-text('Resync From Disk')",
          "timeout_ms": 3000
        },
        "metadata": {
          "label": "Resync from Disk option is visible in menu"
        },
        "type": "ACTION_TYPE_ASSERT"
      },
      "id": "assert-resync-button-visible"
    },
    {
      "action": {
        "click": {
          "selector": "button:has-text('Resync From Disk')"
        },
        "metadata": {
          "label": "Click Resync from Disk"
        },
        "type": "ACTION_TYPE_CLICK"
      },
      "execution_settings": {
        "wait_after_ms": 500
      },
      "id": "click-resync-button"
    },
    {
      "action": {
        "metadata": {
          "label": "Wait for confirmation dialog"
        },
        "type": "ACTION_TYPE_WAIT",
        "wait": {
          "selector": "@selector/dialogs.responsive.content",
          "timeout_ms": 5000
        }
      },
      "execution_settings": {
        "wait_after_ms": 300
      },
      "id": "wait-for-confirm-dialog"
    },
    {
      "action": {
        "assert": {
          "failure_message": "Resync confirmation dialog should appear with warning message",
          "mode": "ASSERTION_MODE_EXISTS",
          "selector": "@selector/dialogs.responsive.content",
          "timeout_ms": 3000
        },
        "metadata": {
          "label": "Confirmation dialog shows resync message"
        },
        "type": "ACTION_TYPE_ASSERT"
      },
      "id": "assert-confirm-dialog-text"
    },
    {
      "action": {
        "click": {
          "selector": "button:has-text('Resync')"
        },
        "metadata": {
          "label": "Confirm resync operation"
        },
        "type": "ACTION_TYPE_CLICK"
      },
      "execution_settings": {
        "wait_after_ms": 2000
      },
      "id": "confirm-resync"
    },
    {
      "action": {
        "metadata": {
          "label": "Wait for tree to refresh after resync"
        },
        "type": "ACTION_TYPE_WAIT",
        "wait": {
          "duration_ms": 2000
        }
      },
      "id": "wait-for-tree-refresh"
    },
    {
      "action": {
        "assert": {
          "failure_message": "File tree should remain visible after resync completes",
          "mode": "ASSERTION_MODE_EXISTS",
          "selector": "@selector/projects.fileTree.root",
          "timeout_ms": 5000
        },
        "metadata": {
          "label": "File tree is still visible after resync"
        },
        "type": "ACTION_TYPE_ASSERT"
      },
      "id": "assert-tree-still-visible"
    },
    {
      "action": {
        "evaluate": {
          "expression": "(() =\u003e { const folders = document.querySelectorAll('[data-testid=\"file-tree-folder\"]').length; const files = document.querySelectorAll('[data-testid=\"file-tree-file\"]').length; const treeRoot = document.querySelector('[data-testid=\"project-file-tree\"]'); return { postResyncFolderCount: folders, postResyncFileCount: files, treeRootExists: !!treeRoot }; })()",
          "store_result": "postResyncTreeState"
        },
        "metadata": {
          "label": "Verify tree state after resync"
        },
        "type": "ACTION_TYPE_EVALUATE"
      },
      "id": "verify-post-resync-state"
    },
    {
      "action": {
        "evaluate": {
          "expression": "(() =\u003e { const errorToasts = document.querySelectorAll('[data-sonner-toast][data-type=\"error\"]'); return { hasErrors: errorToasts.length \u003e 0, errorCount: errorToasts.length }; })()",
          "store_result": "errorCheck"
        },
        "metadata": {
          "label": "Check no error toasts appeared"
        },
        "type": "ACTION_TYPE_EVALUATE"
      },
      "id": "assert-no-errors"
    }
  ],
  "settings": {
    "viewport_height": 900,
    "viewport_width": 1440
  }
}
