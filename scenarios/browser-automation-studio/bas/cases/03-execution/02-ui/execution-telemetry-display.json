{
  "edges": [
    {
      "id": "call-open-project-to-start-execution",
      "source": "call-open-project",
      "target": "start-execution",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e5",
      "source": "start-execution",
      "target": "verify-execution-view",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e6",
      "source": "verify-execution-view",
      "target": "wait-telemetry-start",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e7",
      "source": "wait-telemetry-start",
      "target": "capture-initial-telemetry",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e8",
      "source": "capture-initial-telemetry",
      "target": "check-screenshot-display",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e9",
      "source": "check-screenshot-display",
      "target": "check-console-tab",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e10",
      "source": "check-console-tab",
      "target": "check-network-tab",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e11",
      "source": "check-network-tab",
      "target": "capture-telemetry-ui",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e12",
      "source": "capture-telemetry-ui",
      "target": "wait-more-telemetry",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e13",
      "source": "wait-more-telemetry",
      "target": "check-telemetry-updates",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e14",
      "source": "check-telemetry-updates",
      "target": "capture-live-telemetry",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e15",
      "source": "capture-live-telemetry",
      "target": "verify-heartbeat-timestamp",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    },
    {
      "id": "e16",
      "source": "verify-heartbeat-timestamp",
      "target": "verify-telemetry-complete",
      "type": "WORKFLOW_EDGE_TYPE_SMOOTHSTEP"
    }
  ],
  "metadata": {
    "description": "Validates real-time telemetry display including screenshots, console, and network events",
    "labels": {
      "reset": "none"
    },
    "version": "1"
  },
  "nodes": [
    {
      "action": {
        "metadata": {
          "label": "Open Demo project via fixture"
        },
        "subflow": {
          "args": {
            "projectFolder": "${@params/projectFolder}",
            "projectName": "${@params/projectName}"
          },
          "workflow_path": "actions/open-demo-project.json"
        },
        "type": "ACTION_TYPE_SUBFLOW"
      },
      "id": "call-open-project"
    },
    {
      "action": {
        "click": {
          "selector": "@selector/workflowBuilder.executeButton"
        },
        "metadata": {
          "label": "Start execution to observe telemetry"
        },
        "type": "ACTION_TYPE_CLICK"
      },
      "id": "start-execution"
    },
    {
      "action": {
        "assert": {
          "failure_message": "Execution viewer should appear",
          "mode": "ASSERTION_MODE_EXISTS",
          "selector": "@selector/executions.viewer.root",
          "timeout_ms": 5000
        },
        "metadata": {
          "label": "Execution viewer should open"
        },
        "type": "ACTION_TYPE_ASSERT"
      },
      "execution_settings": {
        "continue_on_error": true
      },
      "id": "verify-execution-view"
    },
    {
      "action": {
        "metadata": {
          "label": "Wait for telemetry stream to start"
        },
        "type": "ACTION_TYPE_WAIT",
        "wait": {
          "duration_ms": 3000
        }
      },
      "id": "wait-telemetry-start"
    },
    {
      "action": {
        "metadata": {
          "label": "Capture telemetry start"
        },
        "screenshot": {
          "full_page": true
        },
        "type": "ACTION_TYPE_SCREENSHOT"
      },
      "execution_settings": {
        "wait_after_ms": 500
      },
      "id": "capture-initial-telemetry"
    },
    {
      "action": {
        "evaluate": {
          "expression": "!!document.querySelector('img[src*=\"data:image\"], canvas, [class*=\"screenshot\"]')",
          "store_result": "hasScreenshotDisplay"
        },
        "metadata": {
          "label": "Verify screenshot display area exists"
        },
        "type": "ACTION_TYPE_EVALUATE"
      },
      "id": "check-screenshot-display"
    },
    {
      "action": {
        "evaluate": {
          "expression": "Array.from(document.querySelectorAll('[role=\"tab\"], button, [class*=\"console\"]')).some(el =\u003e el.textContent?.includes('Console'))",
          "store_result": "hasConsoleTab"
        },
        "metadata": {
          "label": "Verify console tab exists"
        },
        "type": "ACTION_TYPE_EVALUATE"
      },
      "execution_settings": {
        "continue_on_error": true
      },
      "id": "check-console-tab"
    },
    {
      "action": {
        "evaluate": {
          "expression": "Array.from(document.querySelectorAll('[role=\"tab\"], button, [class*=\"network\"]')).some(el =\u003e el.textContent?.includes('Network'))",
          "store_result": "hasNetworkTab"
        },
        "metadata": {
          "label": "Verify network tab exists"
        },
        "type": "ACTION_TYPE_EVALUATE"
      },
      "execution_settings": {
        "continue_on_error": true
      },
      "id": "check-network-tab"
    },
    {
      "action": {
        "metadata": {
          "label": "Capture telemetry UI components"
        },
        "screenshot": {
          "full_page": true
        },
        "type": "ACTION_TYPE_SCREENSHOT"
      },
      "id": "capture-telemetry-ui"
    },
    {
      "action": {
        "metadata": {
          "label": "Allow telemetry to stream"
        },
        "type": "ACTION_TYPE_WAIT",
        "wait": {
          "duration_ms": 5000
        }
      },
      "id": "wait-more-telemetry"
    },
    {
      "action": {
        "evaluate": {
          "expression": "document.querySelectorAll('[class*=\"telemetry\"], [class*=\"event\"], [class*=\"log\"]').length \u003e 0",
          "store_result": "hasTelemetryData"
        },
        "metadata": {
          "label": "Verify telemetry data is updating"
        },
        "type": "ACTION_TYPE_EVALUATE"
      },
      "id": "check-telemetry-updates"
    },
    {
      "action": {
        "metadata": {
          "label": "Capture live telemetry stream"
        },
        "screenshot": {
          "full_page": true
        },
        "type": "ACTION_TYPE_SCREENSHOT"
      },
      "execution_settings": {
        "wait_after_ms": 500
      },
      "id": "capture-live-telemetry"
    },
    {
      "action": {
        "evaluate": {
          "expression": "!!document.querySelector('[class*=\"timestamp\"], [class*=\"time\"], time')",
          "store_result": "hasTimestamps"
        },
        "metadata": {
          "label": "Verify heartbeat/timestamp display"
        },
        "type": "ACTION_TYPE_EVALUATE"
      },
      "id": "verify-heartbeat-timestamp"
    },
    {
      "action": {
        "metadata": {
          "label": "Final telemetry display verification"
        },
        "screenshot": {
          "full_page": true
        },
        "type": "ACTION_TYPE_SCREENSHOT"
      },
      "execution_settings": {
        "wait_after_ms": 500
      },
      "id": "verify-telemetry-complete"
    }
  ],
  "settings": {
    "viewport_height": 1080,
    "viewport_width": 1920
  }
}
