{
  "name": "travel-tracker",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "travel-tracker/add",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [250, 300]
    },
    {
      "parameters": {},
      "id": "manual-trigger",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [250, 500]
    },
    {
      "parameters": {
        "jsCode": "// Provide test defaults for manual execution\nreturn [{\n  json: {\n    location: \"Paris, France\",\n    date: new Date().toISOString().split('T')[0],\n    type: \"vacation\",\n    notes: \"Beautiful city with amazing architecture and culture\",\n    lat: 48.8566,\n    lng: 2.3522,\n    country: \"France\",\n    city: \"Paris\",\n    user_id: \"test-user\"\n  }\n}];"
      },
      "id": "set-defaults",
      "name": "Set Defaults",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 500]
    },
    {
      "parameters": {
        "content": "## Travel Tracker Workflow\n\nThis workflow handles adding new travel locations with:\n- Geocoding for coordinates\n- Embedding generation for semantic search\n- Achievement calculation\n- Stats updates",
        "height": 150,
        "width": 350
      },
      "id": "note_1",
      "name": "Workflow Info",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [200, 150]
    },
    {
      "parameters": {
        "operation": "insert",
        "schema": "public",
        "table": "travels",
        "columns": "user_id,location,lat,lng,date,type,notes,country,city,continent",
        "additionalFields": {}
      },
      "id": "postgres-insert",
      "name": "Save Travel",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.4,
      "position": [650, 400],
      "credentials": {
        "postgres": {
          "id": "postgres",
          "name": "Postgres"
        }
      }
    },
    {
      "parameters": {
        "workflow": "embedding-generator",
        "workflowData": "={{ JSON.stringify({\n  text: $json.location + ' ' + $json.country + ' ' + $json.city + ' ' + ($json.notes || '') + ' ' + $json.type,\n  model: 'nomic-embed-text',\n  store_in_qdrant: false,\n  collection: 'travel_locations'\n}) }}"
      },
      "id": "generate-embedding",
      "name": "Generate Embedding",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1,
      "position": [850, 400]
    },
    {
      "parameters": {
        "operation": "upsert",
        "collection": "travel_locations",
        "points": [
          {
            "id": "={{ $('postgres-insert').item.json.id }}",
            "vector": "={{ $('generate-embedding').item.json.embedding }}",
            "payload": {
              "travel_id": "={{ $('postgres-insert').item.json.id }}",
              "location": "={{ $('postgres-insert').item.json.location }}",
              "country": "={{ $('postgres-insert').item.json.country }}",
              "city": "={{ $('postgres-insert').item.json.city }}",
              "type": "={{ $('postgres-insert').item.json.type }}",
              "date": "={{ $('postgres-insert').item.json.date }}",
              "lat": "={{ $('postgres-insert').item.json.lat }}",
              "lng": "={{ $('postgres-insert').item.json.lng }}"
            }
          }
        ]
      },
      "id": "qdrant-upsert",
      "name": "Store in Vector DB",
      "type": "n8n-nodes-base.qdrant",
      "typeVersion": 1,
      "position": [1050, 400],
      "credentials": {
        "qdrantApi": {
          "id": "qdrant",
          "name": "Qdrant"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// Calculate achievements and stats\nconst travel = $('postgres-insert').item.json;\nconst achievements = [];\n\n// Query existing travels for stats\nconst stats = {\n  totalCountries: 0,\n  totalCities: 0,\n  totalContinents: 0,\n  worldCoverage: 0\n};\n\n// Achievement logic\nif (stats.totalCountries === 1) {\n  achievements.push({\n    id: 'first_country',\n    name: 'First Steps',\n    description: 'Visit your first country',\n    icon: 'üéØ',\n    earned_at: new Date().toISOString()\n  });\n}\n\nif (stats.totalCountries >= 10) {\n  achievements.push({\n    id: 'explorer',\n    name: 'Explorer',\n    description: 'Visit 10 different countries',\n    icon: 'üß≠',\n    earned_at: new Date().toISOString()\n  });\n}\n\nif (stats.totalContinents >= 3) {\n  achievements.push({\n    id: 'world_traveler',\n    name: 'World Traveler',\n    description: 'Visit 3 different continents',\n    icon: 'üåç',\n    earned_at: new Date().toISOString()\n  });\n}\n\nreturn [{\n  json: {\n    travel: travel,\n    achievements: achievements,\n    stats: stats,\n    status: 'success',\n    message: 'Travel added successfully'\n  }\n}];"
      },
      "id": "calculate-achievements",
      "name": "Calculate Achievements",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 400]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json) }}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "respond",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1450, 400]
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [
        [
          {
            "node": "postgres-insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "manual-trigger": {
      "main": [
        [
          {
            "node": "set-defaults",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set-defaults": {
      "main": [
        [
          {
            "node": "postgres-insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "postgres-insert": {
      "main": [
        [
          {
            "node": "generate-embedding",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generate-embedding": {
      "main": [
        [
          {
            "node": "qdrant-upsert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "qdrant-upsert": {
      "main": [
        [
          {
            "node": "calculate-achievements",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "calculate-achievements": {
      "main": [
        [
          {
            "node": "respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "saveDataSuccessExecution": "all",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "executionTimeout": 900
  },
  "versionId": "travel-tracker-v2",
  "id": "travel-tracker",
  "meta": {
    "instanceId": "travel-tracker"
  },
  "tags": ["travel", "tracking", "embedding"]
}