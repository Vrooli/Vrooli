<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Injection Arena - Defensive Security Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        import { initIframeBridgeChild } from '/node_modules/@vrooli/iframe-bridge/dist/iframeBridgeChild.js';

        if (typeof window !== 'undefined' && window.parent !== window && !window.__promptInjectionBridgeInitialized) {
            let parentOrigin;
            try {
                if (document.referrer) {
                    parentOrigin = new URL(document.referrer).origin;
                }
            } catch (error) {
                console.warn('[PromptInjectionArena] Unable to parse parent origin for iframe bridge', error);
            }

            initIframeBridgeChild({ parentOrigin, appId: 'prompt-injection-arena' });
            window.__promptInjectionBridgeInitialized = true;
        }
    </script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="header-left">
                <div class="logo">
                    <i class="fas fa-shield-alt"></i>
                    <span class="logo-text">Prompt Injection Arena</span>
                </div>
                <div class="status-indicator" id="status-indicator">
                    <span class="status-dot" id="status-dot"></span>
                    <span class="status-text" id="status-text">Connecting...</span>
                </div>
            </div>
            <div class="header-right">
                <div class="header-stats" id="header-stats">
                    <div class="stat-item">
                        <i class="fas fa-database"></i>
                        <span id="total-injections">-</span>
                        <small>Injections</small>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-robot"></i>
                        <span id="total-agents">-</span>
                        <small>Agents</small>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-flask"></i>
                        <span id="total-tests">-</span>
                        <small>Tests</small>
                    </div>
                </div>
                <button class="header-btn" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="dashboard">
            <i class="fas fa-tachometer-alt"></i>
            Dashboard
        </button>
        <button class="nav-tab" data-tab="test-agent">
            <i class="fas fa-user-shield"></i>
            Test Agent
        </button>
        <button class="nav-tab" data-tab="library">
            <i class="fas fa-books"></i>
            Injection Library
        </button>
        <button class="nav-tab" data-tab="leaderboards">
            <i class="fas fa-trophy"></i>
            Leaderboards
        </button>
        <button class="nav-tab" data-tab="research">
            <i class="fas fa-microscope"></i>
            Research
        </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard-tab">
            <div class="dashboard-grid">
                <!-- System Status -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-heartbeat"></i> System Status</h3>
                    </div>
                    <div class="card-content">
                        <div class="status-grid" id="system-status">
                            <div class="status-item">
                                <span class="status-label">API</span>
                                <span class="status-value" id="api-status">Checking...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Database</span>
                                <span class="status-value" id="db-status">Checking...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Security Sandbox</span>
                                <span class="status-value" id="sandbox-status">Checking...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> Recent Activity</h3>
                    </div>
                    <div class="card-content">
                        <div class="activity-list" id="recent-activity">
                            <div class="activity-item">
                                <i class="fas fa-spinner fa-pulse"></i>
                                Loading recent activity...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Threats -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-exclamation-triangle"></i> Most Effective Injections</h3>
                    </div>
                    <div class="card-content">
                        <div class="threat-list" id="top-threats">
                            <div class="loading">Loading threats...</div>
                        </div>
                    </div>
                </div>

                <!-- Security Metrics -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Security Metrics</h3>
                    </div>
                    <div class="card-content">
                        <div class="metrics-grid" id="security-metrics">
                            <div class="metric-item">
                                <div class="metric-value" id="avg-robustness">-</div>
                                <div class="metric-label">Avg Robustness</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value" id="tests-today">-</div>
                                <div class="metric-label">Tests Today</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value" id="success-rate">-</div>
                                <div class="metric-label">Defense Rate</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Agent Tab -->
        <div class="tab-content" id="test-agent-tab">
            <div class="test-container">
                <div class="test-panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-user-shield"></i> Agent Security Testing</h2>
                        <p>Test AI agent configurations against the prompt injection library</p>
                    </div>
                    
                    <div class="test-form">
                        <div class="form-group">
                            <label for="system-prompt">System Prompt *</label>
                            <textarea id="system-prompt" 
                                      placeholder="Enter the system prompt to test (e.g., 'You are a helpful assistant that follows safety guidelines...')"
                                      rows="4"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="model-select">Model</label>
                                <select id="model-select">
                                    <option value="llama3.2">Llama 3.2</option>
                                    <option value="mistral">Mistral</option>
                                    <option value="codellama">Code Llama</option>
                                    <option value="qwen2.5:7b">Qwen 2.5 7B</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="temperature-slider">Temperature</label>
                                <div class="slider-group">
                                    <input type="range" id="temperature-slider" min="0" max="2" step="0.1" value="0.7">
                                    <span id="temperature-value">0.7</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="max-tokens">Max Tokens</label>
                                <input type="number" id="max-tokens" value="1000" min="100" max="4000">
                            </div>
                            
                            <div class="form-group">
                                <label for="timeout">Timeout (seconds)</label>
                                <input type="number" id="timeout" value="30" min="10" max="120">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary" id="test-agent-btn">
                                <i class="fas fa-play"></i>
                                Run Security Test
                            </button>
                            <button class="btn btn-secondary" id="clear-test-btn">
                                <i class="fas fa-trash"></i>
                                Clear
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="results-panel" id="test-results-panel" style="display: none;">
                    <div class="panel-header">
                        <h3><i class="fas fa-chart-bar"></i> Test Results</h3>
                    </div>
                    <div class="results-content" id="test-results-content">
                        <!-- Results will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Injection Library Tab -->
        <div class="tab-content" id="library-tab">
            <div class="library-container">
                <div class="library-header">
                    <h2><i class="fas fa-books"></i> Injection Technique Library</h2>
                    <div class="library-controls">
                        <div class="filter-group">
                            <select id="category-filter">
                                <option value="">All Categories</option>
                            </select>
                            <input type="search" id="search-input" placeholder="Search techniques...">
                        </div>
                        <button class="btn btn-primary" id="add-injection-btn">
                            <i class="fas fa-plus"></i>
                            Add Technique
                        </button>
                    </div>
                </div>
                
                <div class="library-grid" id="injection-library">
                    <div class="loading">Loading injection library...</div>
                </div>
            </div>
        </div>

        <!-- Leaderboards Tab -->
        <div class="tab-content" id="leaderboards-tab">
            <div class="leaderboards-container">
                <div class="leaderboard-section">
                    <div class="section-header">
                        <h2><i class="fas fa-shield-alt"></i> Agent Robustness Leaderboard</h2>
                        <p>Most secure AI agents ranked by resistance to prompt injections</p>
                    </div>
                    <div class="leaderboard-table" id="agent-leaderboard">
                        <div class="loading">Loading agent leaderboard...</div>
                    </div>
                </div>
                
                <div class="leaderboard-section">
                    <div class="section-header">
                        <h2><i class="fas fa-crosshairs"></i> Injection Effectiveness Leaderboard</h2>
                        <p>Most effective prompt injection techniques by success rate</p>
                    </div>
                    <div class="leaderboard-table" id="injection-leaderboard">
                        <div class="loading">Loading injection leaderboard...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Research Tab -->
        <div class="tab-content" id="research-tab">
            <div class="research-container">
                <div class="research-header">
                    <h2><i class="fas fa-microscope"></i> Security Research</h2>
                    <p>Advanced analysis and research tools for prompt injection security</p>
                </div>
                
                <div class="research-grid">
                    <div class="research-card">
                        <h3><i class="fas fa-chart-area"></i> Trend Analysis</h3>
                        <p>Analyze trends in injection effectiveness over time</p>
                        <div class="chart-placeholder">
                            <i class="fas fa-chart-line"></i>
                            <span>Coming Soon</span>
                        </div>
                    </div>
                    
                    <div class="research-card">
                        <h3><i class="fas fa-project-diagram"></i> Technique Clustering</h3>
                        <p>Vector similarity analysis of injection patterns</p>
                        <div class="chart-placeholder">
                            <i class="fas fa-sitemap"></i>
                            <span>Coming Soon</span>
                        </div>
                    </div>
                    
                    <div class="research-card">
                        <h3><i class="fas fa-download"></i> Export Data</h3>
                        <p>Export research data for external analysis</p>
                        <div class="export-options">
                            <button class="btn btn-outline">
                                <i class="fas fa-file-csv"></i>
                                CSV Export
                            </button>
                            <button class="btn btn-outline">
                                <i class="fas fa-file-code"></i>
                                JSON Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Injection Modal -->
    <div class="modal" id="add-injection-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> Add Injection Technique</h3>
                <button class="modal-close" id="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="injection-name">Name *</label>
                    <input type="text" id="injection-name" placeholder="e.g., Authority Override">
                </div>
                
                <div class="form-group">
                    <label for="injection-category">Category *</label>
                    <select id="injection-category">
                        <option value="">Select category</option>
                        <option value="direct_override">Direct Override</option>
                        <option value="context_poisoning">Context Poisoning</option>
                        <option value="role_playing">Role Playing</option>
                        <option value="delimiter_attack">Delimiter Attack</option>
                        <option value="social_engineering">Social Engineering</option>
                        <option value="token_manipulation">Token Manipulation</option>
                        <option value="multi_turn">Multi-turn</option>
                        <option value="jailbreaking">Jailbreaking</option>
                        <option value="prompt_leakage">Prompt Leakage</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="injection-example">Example Prompt *</label>
                    <textarea id="injection-example" 
                              placeholder="Enter the injection prompt that demonstrates the technique"
                              rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="injection-description">Description</label>
                    <textarea id="injection-description" 
                              placeholder="Describe how this technique works"
                              rows="2"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="difficulty-slider">Difficulty Score</label>
                    <div class="slider-group">
                        <input type="range" id="difficulty-slider" min="0" max="1" step="0.1" value="0.5">
                        <span id="difficulty-value">0.5</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-injection">Cancel</button>
                <button class="btn btn-primary" id="save-injection">
                    <i class="fas fa-save"></i>
                    Add Technique
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-shield-alt fa-spin"></i>
            <p>Processing security test...</p>
        </div>
    </div>

    <script src="config.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
