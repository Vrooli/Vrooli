#!/usr/bin/env bash
# Web Console CLI
# Provides command-line interface for managing Web Console

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SCENARIO_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"

# Source common CLI utilities if available
if [ -f "$SCENARIO_DIR/../../scripts/lib/cli-common.sh" ]; then
    source "$SCENARIO_DIR/../../scripts/lib/cli-common.sh"
fi

show_help() {
    cat << EOF
Web Console CLI

Usage: web-console [command] [options]

Commands:
    start           Start the Web Console services
    stop            Stop the Web Console services
    status          Check the status of Web Console services
    logs            View Web Console logs
    help            Show this help message

Examples:
    web-console start
    web-console status
    web-console logs

EOF
}

case "${1:-help}" in
    start)
        echo "Starting Web Console..."
        cd "$SCENARIO_DIR" && make run
        ;;
    stop)
        echo "Stopping Web Console..."
        cd "$SCENARIO_DIR" && make stop
        ;;
    status)
        echo "Checking Web Console status..."
        API_PORT="${API_PORT:-36232}"
        UI_PORT="${UI_PORT:-36233}"

        if curl -sf "http://localhost:$API_PORT/healthz" > /dev/null 2>&1; then
            echo "✓ API is running on port $API_PORT"
        else
            echo "✗ API is not running on port $API_PORT"
        fi

        if curl -sf "http://localhost:$UI_PORT/" > /dev/null 2>&1; then
            echo "✓ UI is running on port $UI_PORT"
        else
            echo "✗ UI is not running on port $UI_PORT"
        fi
        ;;
    logs)
        echo "Viewing Web Console logs..."
        cd "$SCENARIO_DIR" && make logs
        ;;
    help|--help|-h)
        show_help
        ;;
    *)
        echo "Unknown command: $1"
        echo ""
        show_help
        exit 1
        ;;
esac
