{
  "$schema": "../../../../.vrooli/schemas/service.schema.json",
  "version": "1.0.0",
  "service": {
    "name": "calendar",
    "displayName": "Calendar System",
    "description": "Universal scheduling intelligence system that enables time-aware workflows and cross-scenario temporal coordination",
    "version": "1.0.0",
    "tags": [
      "scheduling",
      "calendar",
      "events",
      "time-management",
      "automation",
      "ai-scheduling",
      "notifications",
      "multi-user",
      "postgres-storage",
      "vector-search",
      "microservice",
      "saas-ready"
    ]
  },
  "ports": {
    "api": {
      "env_var": "API_PORT",
      "description": "Calendar REST API for event management and scheduling",
      "range": "15000-19999"
    },
    "ui": {
      "env_var": "UI_PORT",
      "description": "Professional calendar interface with week/month views",
      "range": "35000-39999"
    }
  },
  "resources": {
    "required": {
      "postgres": {
        "instance_name": "calendar-system",
        "database": "calendar_system",
        "purpose": "Event storage, user schedules, recurring patterns",
        "schema_file": "initialization/postgres/schema.sql",
        "estimated_size": "10GB for 100K events",
        "backup_frequency": "daily"
      },
      "qdrant": {
        "collection": "calendar_events",
        "dimensions": 1536,
        "distance": "Cosine",
        "purpose": "AI-powered semantic event search and scheduling intelligence",
        "estimated_vectors": "1M events with embeddings"
      }
    },
    "optional": {
      "scenario-authenticator": {
        "purpose": "Multi-user authentication and user context",
        "api_endpoint": "/api/v1/auth/validate",
        "fallback": "Single-user mode without authentication"
      },
      "notification-hub": {
        "purpose": "Event reminders and schedule change notifications",
        "profile_id": "calendar-system-prod",
        "fallback": "In-memory reminder queue without delivery"
      },
      "ollama": {
        "purpose": "Natural language processing for chat interface",
        "model": "llama2:7b-chat",
        "fallback": "Basic command parsing without AI enhancement"
      }
    }
  },
  "lifecycle": {
    "version": "2.0.0",
    "health": {
      "description": "Calendar system health check configuration",
      "endpoints": {
        "api": "/health"
      },
      "checks": [
        {
          "name": "api_endpoint",
          "type": "http",
          "target": "http://localhost:${API_PORT}/health",
          "critical": true,
          "timeout": 5000,
          "interval": 30000
        },
        {
          "name": "ui_endpoint",
          "type": "http",
          "target": "http://localhost:${UI_PORT}/",
          "critical": false,
          "timeout": 5000,
          "interval": 30000
        }
      ],
      "timeout": 5000,
      "interval": 30000,
      "startup_grace_period": 15000
    },
    "setup": {
      "description": "Initialize Calendar system",
      "condition": {
        "checks": [
           {
             "type": "binaries",
             "targets": [
               "calendar-api"
             ]
           },
           {
             "type": "cli",
             "targets": [
               "calendar"
             ]
           },
          {
            "type": "directory",
            "path": "initialization/postgres"
          }
        ]
      },
      "steps": [
        {
          "name": "install-cli",
          "run": "cd cli && ./install.sh",
          "description": "Install CLI command globally"
        },
        {
          "name": "build-api",
          "run": "cd api && go mod download && go build -o calendar-api .",
          "description": "Build Go API binary"
        },
        {
          "name": "install-ui-deps",
          "run": "cd ui && npm install",
          "description": "Install UI dependencies",
          "condition": {
            "file_exists": "ui/package.json"
          }
        },
        {
          "name": "show-urls",
          "run": "echo 'ðŸš€ Calendar system initialized\\n  Dashboard: http://localhost:${UI_PORT}\\n  API: http://localhost:${API_PORT}\\n  CLI: calendar --help'",
          "description": "Display service access URLs"
        }
      ]
    },
    "develop": {
      "description": "Start calendar system with API and UI servers",
      "steps": [
        {
          "name": "ensure-env",
          "run": "export VROOLI_LIFECYCLE_MANAGED=true",
          "description": "Set lifecycle environment flag"
        },
        {
          "name": "setup-database",
          "run": "resource-postgres content add --database calendar_system --init || echo 'Database may already exist'",
          "description": "Create calendar database if not exists"
        },
        {
          "name": "start-api",
          "run": "cd api && ENVIRONMENT=test VROOLI_LIFECYCLE_MANAGED=true POSTGRES_HOST=localhost POSTGRES_PORT=5433 POSTGRES_USER=vrooli POSTGRES_PASSWORD=vrooli POSTGRES_DB=calendar_system QDRANT_URL=http://localhost:6333 JWT_SECRET=development-secret-for-calendar-system AUTH_SERVICE_URL=http://localhost:15785 NOTIFICATION_SERVICE_URL=http://localhost:15310 NOTIFICATION_PROFILE_ID=calendar-system-prod ./calendar-api",
          "description": "Start Go API server with auth and notification integration",
          "background": true,
          "condition": {
            "file_exists": "api/calendar-api"
          }
        },
        {
          "name": "start-ui",
          "run": "cd ui && VROOLI_LIFECYCLE_MANAGED=true npm run dev",
          "description": "Start Vite development server",
          "background": true,
          "condition": {
            "file_exists": "ui/package.json"
          }
        },
         {
           "name": "show-urls",
           "run": "echo 'ðŸš€ Services running:\\n  Dashboard: http://localhost:${UI_PORT}\\n  API: http://localhost:${API_PORT}\\n  CLI: calendar --help'",
           "description": "Display all running service URLs"
         }
      ]
    },
    "test": {
      "description": "Test calendar API and CLI",
      "steps": [
        {
          "name": "test-go-build",
          "run": "cd api && go build -o test-build . && rm test-build",
          "description": "Test Go compilation",
          "condition": {
            "file_exists": "api/main.go"
          }
        },
        {
          "name": "test-api-health",
          "run": "curl -sf http://localhost:${API_PORT}/health",
          "description": "Test API health endpoint"
        },
        {
          "name": "test-create-event",
          "run": "TS=$(date +%s%N) && YEAR=$((2030 + RANDOM % 20)) && MONTH=$((1 + RANDOM % 12)) && DAY=$((1 + RANDOM % 28)) && HOUR=$((RANDOM % 24)) && MIN=$((RANDOM % 60)) && curl -sf -X POST http://localhost:${API_PORT}/api/v1/events -H 'Content-Type: application/json' -H 'Authorization: Bearer test' -H 'X-User-ID: test-user' -d \"{\\\"title\\\":\\\"Test Event ${TS}\\\",\\\"start_time\\\":\\\"${YEAR}-$(printf %02d $MONTH)-$(printf %02d $DAY)T$(printf %02d $HOUR):$(printf %02d $MIN):00Z\\\",\\\"end_time\\\":\\\"${YEAR}-$(printf %02d $MONTH)-$(printf %02d $DAY)T$(printf %02d $HOUR):$((MIN + 30 > 59 ? 59 : MIN + 30)):00Z\\\",\\\"timezone\\\":\\\"UTC\\\",\\\"location\\\":\\\"Test Room\\\",\\\"event_type\\\":\\\"meeting\\\"}\"",
          "description": "Test event creation endpoint"
        },
        {
          "name": "test-list-events",
          "run": "curl -sf http://localhost:${API_PORT}/api/v1/events -H 'Authorization: Bearer test' -H 'X-User-ID: test-user'",
          "description": "Test event listing endpoint"
        },
        {
          "name": "test-cli-commands",
          "run": "export CALENDAR_API_URL=http://localhost:${API_PORT} && calendar version && calendar help",
          "description": "Test CLI basic commands"
        }
      ]
    },
    "stop": {
      "description": "Stop calendar services",
      "steps": [
        {
          "name": "stop-api",
          "run": "pkill -f \"scenarios/calendar.*calendar-api\" || true; sleep 1; pkill -9 -f \"scenarios/calendar.*calendar-api\" 2>/dev/null || true",
          "description": "Stop API process"
        },
        {
          "name": "stop-ui",
          "run": "pkill -f \"scenarios/calendar.*npm run dev\" || true; pkill -f \"scenarios/calendar.*vite\" || true; sleep 1; pkill -9 -f \"scenarios/calendar.*vite\" 2>/dev/null || true",
          "description": "Stop UI process"
        }
      ]
    }
  },
  "integration": {
    "provides": {
      "api": {
        "base_url": "http://localhost:${API_PORT}/api/v1",
        "key_endpoints": [
          "POST /events - Create calendar events",
          "GET /events - List and search events",
          "POST /schedule/chat - Natural language scheduling",
          "POST /schedule/optimize - AI schedule optimization"
        ]
      },
      "events": {
        "publishes": [
          "calendar.event.created",
          "calendar.event.starting",
          "calendar.schedule.optimized"
        ]
      }
    },
    "consumes": {
      "scenario-authenticator": [
        "user-authentication",
        "jwt-validation"
      ],
      "notification-hub": [
        "multi-channel-notifications",
        "template-system"
      ],
      "ollama": [
        "natural-language-processing"
      ]
    }
  }
}