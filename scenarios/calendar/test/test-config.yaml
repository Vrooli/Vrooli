# Calendar Test Configuration
# Defines test parameters and environment settings

version: 1.0
scenario: calendar

# Test environment configuration
environment:
  api_url: "http://localhost:${API_PORT}"
  ui_url: "http://localhost:${UI_PORT}"
  test_database: "calendar_test"
  test_user_token: "test-user-token-123"
  timeout_seconds: 30
  retry_attempts: 3

# Test data configuration
test_data:
  users:
    - id: "test-user-1"
      email: "test1@example.com"
      display_name: "Test User One"
      timezone: "UTC"
    - id: "test-user-2"
      email: "test2@example.com"
      display_name: "Test User Two"
      timezone: "America/New_York"

  events:
    - title: "Daily Standup"
      description: "Team synchronization meeting"
      duration_minutes: 30
      event_type: "meeting"
      recurring: "daily"
    - title: "Sprint Planning"
      description: "Plan upcoming sprint work"
      duration_minutes: 120
      event_type: "meeting"
      recurring: "weekly"
    - title: "One-on-One"
      description: "Manager check-in"
      duration_minutes: 60
      event_type: "meeting"
      recurring: "monthly"

# Test categories and their configurations
test_categories:
  unit:
    description: "Unit tests for individual components"
    timeout: 10
    parallel: true
    coverage_threshold: 80
    
  integration:
    description: "Integration tests with running services"
    timeout: 60
    parallel: false
    requires_services: ["api", "postgres", "qdrant"]
    
  performance:
    description: "Performance and load tests"
    timeout: 120
    concurrent_users: 10
    request_duration: 60
    response_time_threshold_ms: 500
    
  security:
    description: "Security and authentication tests"
    timeout: 30
    test_invalid_tokens: true
    test_sql_injection: true
    test_xss: true

# API test endpoints and expected responses
api_tests:
  health:
    endpoint: "/health"
    method: "GET"
    expected_status: 200
    expected_fields: ["status", "timestamp", "version"]
    
  events_list:
    endpoint: "/api/v1/events"
    method: "GET"
    auth_required: true
    expected_status: 200
    expected_fields: ["events", "total_count", "has_more"]
    
  events_create:
    endpoint: "/api/v1/events"
    method: "POST"
    auth_required: true
    expected_status: 201
    expected_fields: ["success", "event"]
    payload:
      title: "Test Event"
      start_time: "DYNAMIC:+1d:10:00"  # Tomorrow at 10:00 AM
      end_time: "DYNAMIC:+1d:11:00"    # Tomorrow at 11:00 AM  
      event_type: "meeting"
      
  schedule_chat:
    endpoint: "/api/v1/schedule/chat"
    method: "POST"
    auth_required: true
    expected_status: 200
    expected_fields: ["response", "suggested_actions"]
    payload:
      message: "Schedule a meeting tomorrow at 2pm"

# Database test configuration
database_tests:
  schema_validation:
    - table: "users"
      required_columns: ["id", "email", "display_name", "created_at"]
    - table: "events"
      required_columns: ["id", "user_id", "title", "start_time", "end_time"]
    - table: "event_reminders"
      required_columns: ["id", "event_id", "scheduled_time", "status"]
      
  performance_tests:
    - name: "event_insert_performance"
      operation: "INSERT"
      table: "events"
      target_ops_per_second: 100
    - name: "event_query_performance"
      operation: "SELECT"
      table: "events"
      target_response_time_ms: 50

# UI test configuration
ui_tests:
  accessibility:
    - check: "title_exists"
      description: "Page has proper title"
    - check: "no_console_errors"
      description: "No JavaScript console errors"
    - check: "responsive_design"
      description: "Works on mobile and desktop"
      
  functionality:
    - feature: "calendar_display"
      description: "Calendar renders with current month"
    - feature: "event_creation"
      description: "Users can create new events"
    - feature: "event_editing"
      description: "Users can edit existing events"

# Load testing configuration
load_tests:
  scenarios:
    - name: "normal_usage"
      description: "Typical user behavior"
      duration: 300  # 5 minutes
      users: 10
      ramp_up: 30     # seconds
      actions:
        - weight: 40
          action: "view_calendar"
        - weight: 30
          action: "list_events"
        - weight: 20
          action: "create_event"
        - weight: 10
          action: "search_events"
          
    - name: "peak_usage"
      description: "High load scenario"
      duration: 180   # 3 minutes
      users: 50
      ramp_up: 60     # seconds
      actions:
        - weight: 50
          action: "list_events"
        - weight: 30
          action: "create_event"
        - weight: 20
          action: "schedule_chat"

# Test reporting configuration
reporting:
  formats: ["console", "junit", "html"]
  output_directory: "test/reports"
  include_coverage: true
  include_performance_metrics: true
  
  thresholds:
    test_pass_rate: 95.0      # Minimum pass rate percentage
    code_coverage: 80.0       # Minimum code coverage percentage
    api_response_time: 500    # Maximum API response time (ms)
    ui_load_time: 3000       # Maximum UI load time (ms)

# Cleanup configuration
cleanup:
  after_each_test: true
  after_suite: true
  preserve_on_failure: true
  test_data_retention_hours: 24

# Notification configuration for CI/CD
notifications:
  on_failure:
    enabled: true
    channels: ["email", "slack"]
  on_success:
    enabled: false
  on_performance_degradation:
    enabled: true
    threshold_increase: 20  # Percent increase in response time