# Unified Ecosystem Manager Prompt Configuration
# Supports all 4 operations: resource/scenario generation/improvement

name: ecosystem-manager
type: unified
target: ecosystem
description: Unified system for generating and improving resources and scenarios

# Base sections are unused when dedicated templates are provided
base_sections: []

# Operation-specific section configurations
operations:
  resource-generator:
    name: resource-generator
    type: generator
    target: resources
    description: Creates new resources with v2.0 contract compliance and proper scaffolding
    template: templates/resource-generator
    additional_sections: []
    
    variables:
      scenario_type: "resource"
      focus: "one-time creation of new resources"
      primary_output: "v2.0 compliant resource with PRD"
    
    # Time allocation: See global_config.time_allocations.generators
    
    success_criteria:
      - "Unique resource verified: `grep -r 'resource_name' resources/` returns no matches"
      - "v2.0 contract compliance: `ls lib/` shows setup.sh, develop.sh, test.sh, stop.sh, health.sh"
      - "Health checks working: `timeout 5 curl -sf http://localhost:${PORT}/health` returns 200"
      - "Lifecycle hooks implemented: All `lib/*.sh` scripts execute without errors"
      - "CLI integration functional: `vrooli resource RESOURCE_NAME help` shows available commands"
      - "Port allocation successful: `netstat -tlnp | grep PORT` shows service listening"
      - "PRD complete: All mandatory sections present, 5+ P0 requirements with test commands"
    
    principles:
      - "v2.0 contract is mandatory"
      - "Health checks are critical"
      - "Port allocation must not conflict"
      - "CLI interface must be consistent"
      - "Enable scenario integration"

  resource-improver:
    name: resource-improver
    type: improver
    target: resources
    description: Iteratively improves existing resources for v2.0 compliance and reliability
    template: templates/resource-improver
    additional_sections: []
    
    variables:
      scenario_type: "resource"
      focus: "iterative improvement of existing resources"
      primary_output: "v2.0 compliance and enhanced reliability"
    
    # Time allocation: See global_config.time_allocations.improvers
    
    success_criteria:
      - "v2.0 contract compliance improved: Missing files in `ls lib/` are now present and executable"
      - "Health checks more robust: `timeout 5 curl -sf http://localhost:${PORT}/health` passes with error details"
      - "CLI commands standardized: `vrooli resource NAME help` shows status, health, logs, content commands"
      - "No regressions: All previously passing `lib/test.sh` tests still pass"
      - "Security & standards baseline captured: `resource-auditor audit NAME --timeout 240` recorded before changes"
      - "Documentation updated: README reflects actual implementation, no broken links"
      - "Memory system updated: `vrooli resource qdrant search 'resource_name'` returns updated info"
    
    principles:
      - "v2.0 compliance is priority #1"
      - "Health checks must be reliable"
      - "Preserve working functionality"
      - "Surface inherited security debt before implementing fixes"
      - "Standardize patterns across resources"
      - "Enable better scenario integration"

  scenario-generator:
    name: scenario-generator
    type: generator
    target: scenarios
    description: Creates new scenarios from scratch with comprehensive PRDs
    template: templates/scenario-generator
    additional_sections: []
    
    variables:
      scenario_type: "scenario"
      focus: "one-time creation of new scenarios"
      primary_output: "Comprehensive PRD.md and scaffolded structure"
    
    # Time allocation: See global_config.time_allocations.generators
    
    success_criteria:
      - "Official template scaffold created via `vrooli scenario generate react-vite ...` with api/, ui/, cli/, initialization/, docs/, requirements/, and `.vrooli/` directories intact"
      - "Lifecycle metadata validated: `vrooli scenario status <name>` runs without schema errors and results are summarized in the handoff"
      - "Operational Targets PRD authored with Overview + P0/P1/P2 sections and each target mapped to requirement IDs"
      - "Requirements registry (requirements/index.json + README) seeded with valid IDs, `prd_ref`, `criticality`, and instructions for tagging `[REQ:ID]` in future tests"
      - "Baseline documentation set (README, docs/PROGRESS.md, docs/PROBLEMS.md, docs/RESEARCH.md) populated with uniqueness research, table entries, and next-agent guidance"
      - "Scenario-auditor executed via `scenario-auditor audit <name> --timeout 240`; output path or key failures captured for improvers"
      - "Final handoff includes the Quick Validation commands, deliverables list, and open risks per generator template"
    
    principles:
      - "Stay within the scenario directory and stop at initializationâ€”no P0 implementation"
      - "Research-first: prove uniqueness before scaffolding"
      - "Lifecycle commands (`scenario status`, `scenario-auditor`) are the source of truth"
      - "Documentation quality and PRD clarity outweigh adding placeholder code"
      - "Every artifact must brief the next agent on what to do next"

  scenario-improver:
    name: scenario-improver
    type: improver
    target: scenarios
    description: Iteratively improves existing scenarios to advance PRD completion
    template: templates/scenario-improver
    additional_sections: []
    
    variables:
      scenario_type: "scenario"
      focus: "iterative improvement of existing scenarios"
      primary_output: "PRD progression and working features"
    
    # Time allocation: See global_config.time_allocations.improvers
    
    success_criteria:
      - "Quick Validation Loop completed: `vrooli scenario status <name>`, `scenario-auditor audit <name> --timeout 240`, and the scenario test command all run after changes with results captured"
      - "At least one operational target (P0/P1) advanced end-to-end with linked requirements updated and `[REQ:ID]` tests proving the outcome"
      - "Scenario test suite (or targeted phase script) passes after changes; any inherited failures are documented with evidence"
      - "docs/PROGRESS.md gains a new dated row, docs/PROBLEMS.md lists unresolved issues, and README/test instructions reflect the current state"
      - "Requirements registry/README updated when new requirements or modules are added so coverage tracking stays accurate"
      - "No regressions: previously passing tests remain green or are explicitly documented with cause and next steps"
      - "Final handoff enumerates validation commands, touched files, and remaining risks per improver template"
    
    principles:
      - "Fix lifecycle/security failures before chasing new features"
      - "Advance one operational target at a time and prove it with requirements-linked tests"
      - "Respect the generator scaffold and treat PRD checkboxes as read-only evidence markers"
      - "Document every change in the scenario docs so the next agent has context"
      - "Use repo-wide consumers and dependency searches before changing APIs/CLI outputs"
      - "Leave clear next steps whenever work cannot be finished"

# Global configuration
global_config:
  # Standardized time allocations (percentages)
  time_allocations:
    generators:
      research: 30  # Memory search, web research, duplicate detection
      prd_creation: 50  # PRIMARY DELIVERABLE - comprehensive PRD
      scaffolding: 20  # Basic structure, health checks, minimal implementation
    improvers:
      assessment: 20  # Test current state, verify PRD accuracy
      prioritization: 10  # Identify highest-impact improvements
      implementation: 60  # Fix issues, advance PRD checkboxes
      validation: 10  # Verify improvements, update documentation
    
  # Resource categories (for all resource operations)
  resource_categories:
    ai_ml: "AI/ML resources (models, inference)"
    storage: "Databases and storage systems"
    automation: "Workflow and automation tools"
    monitoring: "Observability and monitoring"
    communication: "Messaging and communication"
    security: "Security and compliance tools"
  
  # Scenario categories (for all scenario operations)
  scenario_categories:
    productivity: "Personal and business productivity"
    ai_tools: "AI-powered utilities and assistants"
    business: "Business operations and management"
    personal: "Personal life management"
    automation: "Workflow and process automation"
    entertainment: "Games and entertainment"
  
  # Port allocation ranges
  port_allocation:
    core_infrastructure: "20000-24999"
    supporting_services: "25000-29999"
    application_scenarios: "30000-34999"
    development_tools: "35000-39999"
    dynamic_pool: "40000-49999"
  
  # Common improvement areas
  common_improvements:
    resource_improvements:
      health_checks: ["Add timeout handling", "Implement retry logic", "Add detailed error messages"]
      lifecycle: ["Graceful shutdown", "Proper cleanup", "State persistence"]
      cli: ["Standardize commands", "Add help documentation", "JSON output support"]
    
    scenario_improvements:
      prd_accuracy: ["Validate checkboxes", "Complete P0 requirements", "Update percentages"]
      user_experience: ["Improve UI/UX", "Optimize workflows", "Better error handling"]
      performance: ["API optimization", "Database queries", "Response times"]
  
  # Priority rubric (for all improver operations)
  priority_rubric:
    critical: ["Contract violations", "Broken health checks", "Security vulnerabilities"]
    high: ["Stability issues", "Missing functionality", "Integration failures"]
    medium: ["Performance improvements", "Error handling", "Documentation"]
    low: ["Code cleanup", "Optimizations", "Nice-to-have features"]
