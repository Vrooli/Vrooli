# BAS Playbooks for landing-manager

This directory contains Browser Automation Studio (BAS) playbook workflows for end-to-end UI validation of the landing-manager factory.

## Structure

```
test/playbooks/
├── capabilities/                    # Feature-specific validation workflows
│   └── 01-template-management/      # Template catalog & generation features
│       └── ui/                      # UI-layer workflows
│           ├── template-list-display.json     # TMPL-AVAILABILITY: Template catalog display
│           └── dry-run-generation.json        # TMPL-DRY-RUN: Dry-run generation flow
├── journeys/                        # End-to-end user journey workflows (future)
│   └── 01-new-user/                 # First-time user happy path (planned)
└── registry.json                    # Auto-generated playbook index
```

## Workflow Metadata

Each playbook JSON file includes:
- `metadata.description`: What the workflow validates
- `metadata.version`: Schema version
- `metadata.reset`: Database reset level (`none`, `full`)
- `settings.executionViewport`: Browser viewport config
- `nodes`: Workflow step definitions (navigate, wait, click, assert, etc.)
- `edges`: Step execution order

## Selectors

UI element selectors are defined in `ui/src/consts/selectors.ts` and referenced via `@selector/<key>` syntax in playbook nodes. Example:

```json
{
  "selector": "@selector/template-catalog",
  "assertMode": "exists"
}
```

## Running Playbooks

Integration phase automatically runs all playbooks during `make test`:
```bash
make test                             # Full test suite including integration
./test/phases/test-integration.sh    # Integration phase only
```

Or via CLI for individual workflows:
```bash
# Requires browser-automation-studio running
browser-automation-studio execute test/playbooks/capabilities/01-template-management/ui/template-list-display.json
```

## Registry

`registry.json` is auto-generated by `scripts/scenarios/testing/playbooks/build-registry.mjs`. **Do not edit manually.** Regenerate via:
```bash
node /home/matthalloran8/Vrooli/scripts/scenarios/testing/playbooks/build-registry.mjs --scenario /home/matthalloran8/Vrooli/scenarios/landing-manager
```

Or trigger automatically by running `make test`.

## Coverage

Current playbooks validate:
- **TMPL-DRY-RUN** (P1): Dry-run generation (plan-only mode)
- **TMPL-LIFECYCLE** (P1): UI-based lifecycle management (start/stop/restart/logs)
- **TMPL-PROMOTION** (P1): UI-based scenario promotion from staging to production

### Future Additions

For additional coverage:
- **TMPL-METADATA**: Template metadata panel display (sections, metrics hooks, schema)
- **TMPL-GENERATION**: Full scenario generation (non-dry-run)
- **TMPL-OUTPUT-VALIDATION**: Generated scenario structure validation
- **TMPL-PROVENANCE**: Template ID/version stamping in generated scenarios
- **AGENT-TRIGGER**: Agent customization form and issue filing

## Notes

- Playbooks complement (not replace) unit tests. They provide browser-level validation of rendered UI flows.
- Each playbook should validate exactly one requirement for clear traceability.
- Use `reset: "full"` sparingly (only when workflow mutates state that affects other tests).
- Prefer `reset: "none"` for read-only validation workflows.
