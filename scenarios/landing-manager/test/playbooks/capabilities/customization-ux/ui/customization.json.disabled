{
  "metadata": {
    "reset": "full"
  },
  "flow_definition": {
    "metadata": {
      "name": "Agent Customization Trigger",
      "description": "Validates agent integration and variant management UI. Tests requirements AGENT-TRIGGER, AGENT-INPUT. Note: BAS/Browserless session persistence limitation prevents testing full customization flow.",
      "reset": "full",
      "requirements": [
        "AGENT-TRIGGER",
        "AGENT-INPUT"
      ],
      "tags": ["customization", "agent", "variant-management"],
      "notes": [
        "NOTE: This playbook validates agent trigger button exists and variant management UI is accessible.",
        "Session persistence across navigations fails in BAS/Browserless, so we navigate directly to customization page.",
        "Once BAS session handling is fixed, expand to test:",
        "1. Click agent customization button",
        "2. Fill agent brief form",
        "3. Submit and validate agent receives structured input"
      ]
    },
    "nodes": [
      {
        "id": "navigate-1",
        "type": "navigate",
        "data": {
          "label": "Navigate to admin login",
          "destinationType": "url",
          "url": "${BASE_URL}/admin/login",
          "waitForMs": 1000,
          "timeoutMs": 10000
        }
      },
      {
        "id": "type-1",
        "type": "type",
        "data": {
          "label": "Login as admin - email",
          "selector": "@selector/admin.login.email",
          "text": "admin@localhost"
        }
      },
      {
        "id": "type-2",
        "type": "type",
        "data": {
          "label": "Enter password",
          "selector": "@selector/admin.login.passwordField",
          "text": "changeme123"
        }
      },
      {
        "id": "click-login",
        "type": "click",
        "data": {
          "label": "Submit login",
          "selector": "@selector/admin.login.submit",
          "waitForMs": 2000,
          "timeoutMs": 10000
        }
      },
      {
        "id": "navigate-customization",
        "type": "navigate",
        "data": {
          "label": "Navigate directly to customization page",
          "destinationType": "url",
          "url": "${BASE_URL}/admin/customization",
          "waitForMs": 1500,
          "timeoutMs": 10000
        }
      },
      {
        "id": "assert-agent-trigger",
        "type": "assert",
        "data": {
          "label": "[REQ:AGENT-TRIGGER] Verify agent trigger button exists",
          "assertMode": "exists",
          "selector": "@selector/admin.customization.triggerAgent",
          "timeoutMs": 5000
        }
      },
      {
        "id": "assert-variant-mgmt",
        "type": "assert",
        "data": {
          "label": "[REQ:AGENT-INPUT] Verify variant management UI (New Variant button)",
          "assertMode": "exists",
          "selector": "@selector/admin.customization.createVariant",
          "timeoutMs": 3000
        }
      }
    ],
    "edges": [
      {"id": "e1", "source": "navigate-1", "target": "type-1", "type": "smoothstep"},
      {"id": "e2", "source": "type-1", "target": "type-2", "type": "smoothstep"},
      {"id": "e3", "source": "type-2", "target": "click-login", "type": "smoothstep"},
      {"id": "e4", "source": "click-login", "target": "navigate-customization", "type": "smoothstep"},
      {"id": "e5", "source": "navigate-customization", "target": "assert-agent-trigger", "type": "smoothstep"},
      {"id": "e6", "source": "assert-agent-trigger", "target": "assert-variant-mgmt", "type": "smoothstep"}
    ]
  }
}
