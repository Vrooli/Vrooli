{
  "metadata": {
    "reset": "full"
  },
  "flow_definition": {
    "metadata": {
      "name": "Admin Portal Authentication and Navigation",
      "description": "Validates admin portal login, session management, breadcrumb navigation, and mode switching. Tests requirements AGENT-TRIGGER, AGENT-INPUT, ADMIN-HIDDEN, ADMIN-AUTH, ADMIN-MODES, ADMIN-NAV, ADMIN-BREADCRUMB.",
      "reset": "full",
      "requirements": [
        "ADMIN-HIDDEN",
        "ADMIN-AUTH",
        "ADMIN-MODES",
        "ADMIN-NAV",
        "ADMIN-BREADCRUMB",
        "AGENT-TRIGGER",
        "AGENT-INPUT"
      ],
      "tags": ["admin", "auth", "navigation", "critical"]
    },
    "nodes": [
      {
        "id": "navigate-1",
        "type": "navigate",
        "data": {
          "label": "Navigate to public home page",
          "destinationType": "url",
          "url": "${BASE_URL}/",
          "waitForMs": 1000,
          "timeoutMs": 10000
        }
      },
      {
        "id": "wait-public",
        "type": "wait",
        "data": {
          "label": "[REQ:ADMIN-HIDDEN] Wait for public page to load",
          "waitType": "duration",
          "durationMs": 1000,
          "timeoutMs": 5000
        }
      },
      {
        "id": "navigate-2",
        "type": "navigate",
        "data": {
          "label": "Navigate directly to admin login",
          "destinationType": "url",
          "url": "${BASE_URL}/admin/login",
          "waitForMs": 1000,
          "timeoutMs": 10000
        }
      },
      {
        "id": "type-1",
        "type": "type",
        "data": {
          "label": "[REQ:ADMIN-AUTH] Enter admin email",
          "selector": "@selector/admin.login.email",
          "text": "admin@localhost"
        }
      },
      {
        "id": "type-2",
        "type": "type",
        "data": {
          "label": "Enter admin password",
          "selector": "@selector/admin.login.passwordField",
          "text": "changeme123"
        }
      },
      {
        "id": "click-1",
        "type": "click",
        "data": {
          "label": "[REQ:ADMIN-AUTH] Submit login form",
          "selector": "@selector/admin.login.submit",
          "waitForMs": 2000,
          "timeoutMs": 10000
        }
      },
      {
        "id": "wait-url",
        "type": "wait",
        "data": {
          "label": "[REQ:ADMIN-AUTH] Wait for redirect to admin home",
          "waitType": "duration",
          "durationMs": 2000,
          "timeoutMs": 5000
        }
      },
      {
        "id": "assert-3",
        "type": "assert",
        "data": {
          "label": "[REQ:ADMIN-BREADCRUMB] Verify breadcrumb shows 'Admin'",
          "assertMode": "text_contains",
          "selector": "@selector/admin.breadcrumb",
          "expectedValue": "Admin",
          "timeoutMs": 3000
        }
      },
      {
        "id": "click-2",
        "type": "click",
        "data": {
          "label": "[REQ:ADMIN-MODES] Click Analytics mode",
          "selector": "@selector/admin.mode.analytics",
          "waitForMs": 500,
          "timeoutMs": 5000
        }
      },
      {
        "id": "assert-4",
        "type": "assert",
        "data": {
          "label": "[REQ:ADMIN-MODES] Verify Analytics section appears",
          "assertMode": "exists",
          "selector": "text=TODO: Implement Analytics Dashboard",
          "timeoutMs": 3000
        }
      },
      {
        "id": "click-3",
        "type": "click",
        "data": {
          "label": "[REQ:ADMIN-MODES] Click Customization mode",
          "selector": "@selector/admin.mode.customization",
          "waitForMs": 500,
          "timeoutMs": 5000
        }
      },
      {
        "id": "assert-5",
        "type": "assert",
        "data": {
          "label": "[REQ:ADMIN-MODES] Verify Customization section appears",
          "assertMode": "exists",
          "selector": "text=TODO: Implement Customization Interface",
          "timeoutMs": 3000
        }
      },
      {
        "id": "assert-6",
        "type": "assert",
        "data": {
          "label": "[REQ:AGENT-TRIGGER] Verify agent trigger mentioned",
          "assertMode": "exists",
          "selector": "text=Agent customization trigger",
          "timeoutMs": 3000
        }
      },
      {
        "id": "assert-7",
        "type": "assert",
        "data": {
          "label": "[REQ:AGENT-INPUT] Verify structured agent input mentioned",
          "assertMode": "exists",
          "selector": "text=Structured agent input form",
          "timeoutMs": 3000
        }
      },
      {
        "id": "navigate-3",
        "type": "navigate",
        "data": {
          "label": "[REQ:ADMIN-AUTH] Test session persistence - reload page",
          "destinationType": "url",
          "url": "${BASE_URL}/admin",
          "waitForMs": 1000,
          "timeoutMs": 10000
        }
      },
      {
        "id": "assert-reload",
        "type": "assert",
        "data": {
          "label": "[REQ:ADMIN-AUTH,ADMIN-NAV] Verify still authenticated after reload",
          "assertMode": "exists",
          "selector": "text=Admin Portal",
          "timeoutMs": 3000
        }
      },
      {
        "id": "navigate-4",
        "type": "navigate",
        "data": {
          "label": "Test protected route - navigate away and back",
          "destinationType": "url",
          "url": "${BASE_URL}/",
          "waitForMs": 500,
          "timeoutMs": 10000
        }
      },
      {
        "id": "navigate-5",
        "type": "navigate",
        "data": {
          "label": "Navigate back to admin without login",
          "destinationType": "url",
          "url": "${BASE_URL}/admin",
          "waitForMs": 1000,
          "timeoutMs": 10000
        }
      },
      {
        "id": "assert-session",
        "type": "assert",
        "data": {
          "label": "[REQ:ADMIN-AUTH] Verify session still valid",
          "assertMode": "exists",
          "selector": "text=TODO: Implement",
          "timeoutMs": 3000
        }
      }
    ],
    "edges": [
      {"id": "e1", "source": "navigate-1", "target": "wait-public", "type": "smoothstep"},
      {"id": "e2", "source": "wait-public", "target": "navigate-2", "type": "smoothstep"},
      {"id": "e3", "source": "navigate-2", "target": "type-1", "type": "smoothstep"},
      {"id": "e4", "source": "type-1", "target": "type-2", "type": "smoothstep"},
      {"id": "e6", "source": "type-2", "target": "click-1", "type": "smoothstep"},
      {"id": "e7", "source": "click-1", "target": "wait-url", "type": "smoothstep"},
      {"id": "e8", "source": "wait-url", "target": "assert-3", "type": "smoothstep"},
      {"id": "e9", "source": "assert-3", "target": "click-2", "type": "smoothstep"},
      {"id": "e10", "source": "click-2", "target": "assert-4", "type": "smoothstep"},
      {"id": "e11", "source": "assert-4", "target": "click-3", "type": "smoothstep"},
      {"id": "e12", "source": "click-3", "target": "assert-5", "type": "smoothstep"},
      {"id": "e13", "source": "assert-5", "target": "assert-6", "type": "smoothstep"},
      {"id": "e14", "source": "assert-6", "target": "assert-7", "type": "smoothstep"},
      {"id": "e15", "source": "assert-7", "target": "navigate-3", "type": "smoothstep"},
      {"id": "e16", "source": "navigate-3", "target": "assert-reload", "type": "smoothstep"},
      {"id": "e17", "source": "assert-reload", "target": "navigate-4", "type": "smoothstep"},
      {"id": "e18", "source": "navigate-4", "target": "navigate-5", "type": "smoothstep"},
      {"id": "e19", "source": "navigate-5", "target": "assert-session", "type": "smoothstep"}
    ]
  }
}
