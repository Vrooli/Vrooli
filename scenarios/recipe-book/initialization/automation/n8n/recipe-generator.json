{
  "name": "Recipe Generator",
  "nodes": [
    {
      "parameters": {},
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300],
      "webhookId": "recipe-generator"
    },
    {
      "parameters": {
        "content": "## Recipe Generation Request",
        "height": 80
      },
      "id": "input-note",
      "name": "Input Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [220, 200]
    },
    {
      "parameters": {
        "functionCode": "const prompt = $input.first().json.prompt || 'Create a delicious dinner recipe';\nconst dietary = $input.first().json.dietary_restrictions || [];\nconst ingredients = $input.first().json.available_ingredients || [];\nconst style = $input.first().json.style || 'home cooking';\n\nlet systemPrompt = `You are a professional chef and recipe creator. Generate a complete, detailed recipe in JSON format with the following structure:\n{\n  \"title\": \"Recipe Name\",\n  \"description\": \"Brief appealing description\",\n  \"ingredients\": [\n    {\"name\": \"ingredient\", \"amount\": number, \"unit\": \"unit\", \"notes\": \"optional notes\"}\n  ],\n  \"instructions\": [\"Step 1\", \"Step 2\", ...],\n  \"prep_time\": minutes,\n  \"cook_time\": minutes,\n  \"servings\": number,\n  \"tags\": [\"tag1\", \"tag2\"],\n  \"cuisine\": \"cuisine type\",\n  \"dietary_info\": [\"vegetarian\", \"gluten-free\", etc],\n  \"nutrition\": {\n    \"calories\": number,\n    \"protein\": grams,\n    \"carbs\": grams,\n    \"fat\": grams,\n    \"fiber\": grams,\n    \"sugar\": grams,\n    \"sodium\": mg\n  }\n}`;\n\nlet userPrompt = `Create a recipe based on: ${prompt}\\n`;\n\nif (dietary.length > 0) {\n  userPrompt += `Dietary restrictions: ${dietary.join(', ')}\\n`;\n}\n\nif (ingredients.length > 0) {\n  userPrompt += `Available ingredients to use: ${ingredients.join(', ')}\\n`;\n}\n\nuserPrompt += `Cooking style: ${style}\\n`;\nuserPrompt += `Make it delicious, practical, and easy to follow.`;\n\nreturn {\n  systemPrompt,\n  userPrompt\n};"
      },
      "id": "prepare-prompt",
      "name": "Prepare Prompt",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "url": "${service.n8n.url}/webhook/ollama",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "llama3.2"
            },
            {
              "name": "prompt",
              "value": "={{ $json.userPrompt }}"
            },
            {
              "name": "system",
              "value": "={{ $json.systemPrompt }}"
            },
            {
              "name": "temperature",
              "value": "0.7"
            },
            {
              "name": "format",
              "value": "json"
            }
          ]
        },
        "options": {}
      },
      "id": "call-ollama",
      "name": "Call Ollama Workflow",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [650, 300]
    },
    {
      "parameters": {
        "functionCode": "const response = $input.first().json;\n\ntry {\n  // Parse the AI response\n  let recipe;\n  if (typeof response === 'string') {\n    recipe = JSON.parse(response);\n  } else if (response.response) {\n    recipe = JSON.parse(response.response);\n  } else {\n    recipe = response;\n  }\n  \n  // Add metadata\n  recipe.source = 'ai_generated';\n  recipe.created_at = new Date().toISOString();\n  recipe.updated_at = new Date().toISOString();\n  recipe.visibility = 'private';\n  \n  // Ensure all required fields exist\n  recipe.ingredients = recipe.ingredients || [];\n  recipe.instructions = recipe.instructions || [];\n  recipe.tags = recipe.tags || [];\n  recipe.dietary_info = recipe.dietary_info || [];\n  recipe.nutrition = recipe.nutrition || {};\n  \n  return {\n    success: true,\n    recipe: recipe,\n    confidence: 0.85\n  };\n} catch (error) {\n  return {\n    success: false,\n    error: error.message,\n    raw_response: response\n  };\n}"
      },
      "id": "parse-response",
      "name": "Parse Recipe",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "status",
              "value": "success"
            }
          ]
        },
        "options": {}
      },
      "id": "success-response",
      "name": "Success Response",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [1050, 280]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "status",
              "value": "error"
            },
            {
              "name": "message",
              "value": "Failed to generate recipe"
            }
          ]
        },
        "options": {}
      },
      "id": "error-response",
      "name": "Error Response",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [1050, 400]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.success }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-success",
      "name": "Check Success",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [950, 300]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "respond",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1250, 300]
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [
        [
          {
            "node": "prepare-prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prepare-prompt": {
      "main": [
        [
          {
            "node": "call-ollama",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "call-ollama": {
      "main": [
        [
          {
            "node": "parse-response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "parse-response": {
      "main": [
        [
          {
            "node": "check-success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-success": {
      "main": [
        [
          {
            "node": "success-response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "error-response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "success-response": {
      "main": [
        [
          {
            "node": "respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "error-response": {
      "main": [
        [
          {
            "node": "respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "saveDataSuccessExecution": "all",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "callerPolicy": "any"
  },
  "versionId": "1.0.0",
  "id": "recipe-generator",
  "meta": {
    "templateId": "recipe-generator"
  },
  "tags": []
}