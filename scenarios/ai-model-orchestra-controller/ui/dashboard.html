<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Model Orchestra Controller - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f1419;
            color: #ffffff;
            line-height: 1.6;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: #1a1f2e;
            padding: 20px;
            border-right: 1px solid #2d3748;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2d3748;
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 600;
            margin-left: 10px;
            color: #64ffda;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: #a0aec0;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            background: #2d3748;
            color: #64ffda;
        }

        .nav-icon {
            margin-right: 10px;
            font-size: 16px;
        }

        .main-content {
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2d3748;
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: #ffffff;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-healthy {
            background: #10b981;
            color: #ffffff;
        }

        .status-warning {
            background: #f59e0b;
            color: #ffffff;
        }

        .status-error {
            background: #ef4444;
            color: #ffffff;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: #1a1f2e;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            border-color: #64ffda;
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-title {
            font-size: 16px;
            font-weight: 500;
            color: #e2e8f0;
        }

        .metric-icon {
            font-size: 20px;
            color: #64ffda;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 14px;
            color: #a0aec0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #2d3748;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #64ffda, #10b981);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #f59e0b, #f97316);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .model-card {
            background: #1a1f2e;
            border: 1px solid #2d3748;
            border-radius: 8px;
            padding: 15px;
        }

        .model-name {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .model-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .model-stat {
            text-align: center;
        }

        .model-stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #64ffda;
        }

        .model-stat-label {
            font-size: 12px;
            color: #a0aec0;
        }

        .chart-container {
            background: #1a1f2e;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 15px;
        }

        .chart {
            height: 300px;
            background: #0f1419;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a0aec0;
        }

        .alerts-panel {
            background: #1a1f2e;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 20px;
        }

        .alert-item {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            background: #2d3748;
        }

        .alert-icon {
            margin-right: 12px;
            margin-top: 2px;
        }

        .alert-content {
            flex: 1;
        }

        .alert-message {
            font-size: 14px;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .alert-time {
            font-size: 12px;
            color: #a0aec0;
        }

        .alert-critical {
            border-left: 4px solid #ef4444;
        }

        .alert-warning {
            border-left: 4px solid #f59e0b;
        }

        .alert-info {
            border-left: 4px solid #3b82f6;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #2d3748;
            border-radius: 50%;
            border-top-color: #64ffda;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .refresh-btn {
            background: #64ffda;
            color: #0f1419;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .refresh-btn:hover {
            background: #4fd1c7;
        }

        .hidden {
            display: none;
        }

        .error-message {
            background: #2d1b1b;
            border: 1px solid #ef4444;
            color: #ef4444;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <nav class="sidebar">
            <div class="logo">
                <span>üéõÔ∏è</span>
                <h1>AI Orchestra</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#overview" class="nav-link active" data-section="overview">
                        <span class="nav-icon">üìä</span>
                        Overview
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#models" class="nav-link" data-section="models">
                        <span class="nav-icon">ü§ñ</span>
                        Models
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#resources" class="nav-link" data-section="resources">
                        <span class="nav-icon">üíæ</span>
                        Resources
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#requests" class="nav-link" data-section="requests">
                        <span class="nav-icon">üîÑ</span>
                        Requests
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#alerts" class="nav-link" data-section="alerts">
                        <span class="nav-icon">‚ö†Ô∏è</span>
                        Alerts
                    </a>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <div id="error-container"></div>

            <!-- Overview Section -->
            <section id="overview-section" class="content-section">
                <div class="header">
                    <h1 class="page-title">Overview</h1>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span id="system-status" class="status-badge status-healthy">System Healthy</span>
                        <button class="refresh-btn" onclick="refreshData()">
                            <span id="refresh-icon">üîÑ</span> Refresh
                        </button>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Total Requests</span>
                            <span class="metric-icon">üìà</span>
                        </div>
                        <div class="metric-value" id="total-requests">-</div>
                        <div class="metric-label">All time</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Success Rate</span>
                            <span class="metric-icon">‚úÖ</span>
                        </div>
                        <div class="metric-value" id="success-rate">-</div>
                        <div class="metric-label">Last 24 hours</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Avg Response Time</span>
                            <span class="metric-icon">‚ö°</span>
                        </div>
                        <div class="metric-value" id="avg-response-time">-</div>
                        <div class="metric-label">Milliseconds</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Active Models</span>
                            <span class="metric-icon">ü§ñ</span>
                        </div>
                        <div class="metric-value" id="active-models">-</div>
                        <div class="metric-label">Available</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Memory Pressure</span>
                            <span class="metric-icon">üíæ</span>
                        </div>
                        <div class="metric-value" id="memory-pressure">-</div>
                        <div class="metric-label">System load</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="memory-progress" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">CPU Usage</span>
                            <span class="metric-icon">‚öôÔ∏è</span>
                        </div>
                        <div class="metric-value" id="cpu-usage">-</div>
                        <div class="metric-label">Percentage</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="cpu-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Request Volume (Last 24 Hours)</div>
                    <div class="chart">
                        üìä Chart visualization would be implemented here<br>
                        (Integration with Chart.js or similar library)
                    </div>
                </div>
            </section>

            <!-- Models Section -->
            <section id="models-section" class="content-section hidden">
                <div class="header">
                    <h1 class="page-title">AI Models</h1>
                    <button class="refresh-btn" onclick="refreshModels()">
                        üîÑ Refresh Models
                    </button>
                </div>

                <div id="models-grid" class="models-grid">
                    <!-- Models will be populated by JavaScript -->
                </div>
            </section>

            <!-- Resources Section -->
            <section id="resources-section" class="content-section hidden">
                <div class="header">
                    <h1 class="page-title">System Resources</h1>
                    <button class="refresh-btn" onclick="refreshResources()">
                        üîÑ Refresh Resources
                    </button>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Memory Available</span>
                            <span class="metric-icon">üíæ</span>
                        </div>
                        <div class="metric-value" id="memory-available">-</div>
                        <div class="metric-label">GB available</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Memory Total</span>
                            <span class="metric-icon">üíΩ</span>
                        </div>
                        <div class="metric-value" id="memory-total">-</div>
                        <div class="metric-label">GB total</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">CPU Load</span>
                            <span class="metric-icon">‚öôÔ∏è</span>
                        </div>
                        <div class="metric-value" id="cpu-load">-</div>
                        <div class="metric-label">1min average</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Swap Usage</span>
                            <span class="metric-icon">üîÑ</span>
                        </div>
                        <div class="metric-value" id="swap-usage">-</div>
                        <div class="metric-label">Percentage</div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Resource Usage Over Time</div>
                    <div class="chart">
                        üìà Resource usage charts would be implemented here
                    </div>
                </div>
            </section>

            <!-- Requests Section -->
            <section id="requests-section" class="content-section hidden">
                <div class="header">
                    <h1 class="page-title">Request Analytics</h1>
                    <button class="refresh-btn" onclick="refreshRequests()">
                        üîÑ Refresh Data
                    </button>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Request Distribution by Model</div>
                    <div class="chart">
                        ü•ß Model usage pie chart would be implemented here
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Response Time Trends</div>
                    <div class="chart">
                        üìä Response time line chart would be implemented here
                    </div>
                </div>
            </section>

            <!-- Alerts Section -->
            <section id="alerts-section" class="content-section hidden">
                <div class="header">
                    <h1 class="page-title">System Alerts</h1>
                    <button class="refresh-btn" onclick="refreshAlerts()">
                        üîÑ Refresh Alerts
                    </button>
                </div>

                <div class="alerts-panel">
                    <div id="alerts-container">
                        <!-- Alerts will be populated by JavaScript -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Global state
        let currentSection = 'overview';
        let refreshInterval;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeNavigation();
            startAutoRefresh();
            loadInitialData();
        });

        // Navigation handling
        function initializeNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });
        }

        function switchSection(section) {
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('active');

            // Show/hide sections
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.add('hidden');
            });
            document.getElementById(`${section}-section`).classList.remove('hidden');

            currentSection = section;
        }

        // Data loading functions
        async function loadInitialData() {
            await Promise.all([
                loadOverviewData(),
                loadModelsData(),
                loadResourcesData(),
                loadAlertsData()
            ]);
        }

        async function loadOverviewData() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                updateSystemStatus(data);
                
                // Load additional metrics
                const metricsResponse = await fetch('/api/ai/resources/metrics');
                const metricsData = await metricsResponse.json();
                
                updateOverviewMetrics(metricsData);
                
            } catch (error) {
                showError('Failed to load overview data: ' + error.message);
            }
        }

        async function loadModelsData() {
            try {
                const response = await fetch('/api/ai/models/status');
                const data = await response.json();
                
                updateModelsDisplay(data);
                
            } catch (error) {
                console.error('Failed to load models data:', error);
            }
        }

        async function loadResourcesData() {
            try {
                const response = await fetch('/api/ai/resources/metrics');
                const data = await response.json();
                
                updateResourcesDisplay(data);
                
            } catch (error) {
                console.error('Failed to load resources data:', error);
            }
        }

        async function loadAlertsData() {
            // Mock alerts data - in real implementation, this would fetch from an alerts API
            const mockAlerts = [
                {
                    type: 'info',
                    message: 'System initialized successfully',
                    time: new Date().toISOString()
                }
            ];
            
            updateAlertsDisplay(mockAlerts);
        }

        // Update functions
        function updateSystemStatus(data) {
            const statusElement = document.getElementById('system-status');
            const isHealthy = data.status === 'healthy';
            
            statusElement.textContent = isHealthy ? 'System Healthy' : 'System Issues';
            statusElement.className = `status-badge ${isHealthy ? 'status-healthy' : 'status-error'}`;
        }

        function updateOverviewMetrics(data) {
            // Update basic metrics
            if (data.requests && data.requests.length > 0) {
                const totalRequests = data.requests.reduce((sum, r) => sum + r.request_count, 0);
                const successCount = data.requests.reduce((sum, r) => sum + r.success_count, 0);
                const avgResponseTime = data.requests.reduce((sum, r) => sum + r.avg_response_time, 0) / data.requests.length;
                
                document.getElementById('total-requests').textContent = totalRequests.toLocaleString();
                document.getElementById('success-rate').textContent = totalRequests > 0 ? Math.round((successCount / totalRequests) * 100) + '%' : '100%';
                document.getElementById('avg-response-time').textContent = Math.round(avgResponseTime) + 'ms';
            }

            // Update system metrics
            if (data.current) {
                const memoryPressure = data.current.memoryPressure || 0;
                const cpuUsage = data.current.cpu?.usage || 0;
                
                document.getElementById('memory-pressure').textContent = Math.round(memoryPressure * 100) + '%';
                document.getElementById('cpu-usage').textContent = Math.round(cpuUsage) + '%';
                
                // Update progress bars
                const memoryProgress = document.getElementById('memory-progress');
                const cpuProgress = document.getElementById('cpu-progress');
                
                memoryProgress.style.width = (memoryPressure * 100) + '%';
                memoryProgress.className = `progress-fill ${memoryPressure > 0.8 ? 'danger' : memoryPressure > 0.6 ? 'warning' : ''}`;
                
                cpuProgress.style.width = cpuUsage + '%';
                cpuProgress.className = `progress-fill ${cpuUsage > 80 ? 'danger' : cpuUsage > 60 ? 'warning' : ''}`;
            }
        }

        function updateModelsDisplay(data) {
            const modelsGrid = document.getElementById('models-grid');
            modelsGrid.innerHTML = '';
            
            document.getElementById('active-models').textContent = data.healthyModels || 0;
            
            if (data.models && data.models.length > 0) {
                data.models.forEach(model => {
                    const modelCard = createModelCard(model);
                    modelsGrid.appendChild(modelCard);
                });
            } else {
                modelsGrid.innerHTML = '<div style="color: #a0aec0; text-align: center; grid-column: 1 / -1;">No models available</div>';
            }
        }

        function createModelCard(model) {
            const card = document.createElement('div');
            card.className = 'model-card';
            
            const successRate = model.request_count > 0 ? Math.round((model.success_count / model.request_count) * 100) : 100;
            
            card.innerHTML = `
                <div class="model-name">${model.model_name}</div>
                <div class="model-stats">
                    <div class="model-stat">
                        <div class="model-stat-value">${model.request_count || 0}</div>
                        <div class="model-stat-label">Requests</div>
                    </div>
                    <div class="model-stat">
                        <div class="model-stat-value">${successRate}%</div>
                        <div class="model-stat-label">Success</div>
                    </div>
                    <div class="model-stat">
                        <div class="model-stat-value">${Math.round(model.avg_response_time_ms || 0)}</div>
                        <div class="model-stat-label">Avg MS</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${Math.min(model.current_load * 100, 100)}%"></div>
                </div>
            `;
            
            return card;
        }

        function updateResourcesDisplay(data) {
            if (data.current && data.current.memory) {
                document.getElementById('memory-available').textContent = data.current.memory.available_gb.toFixed(1) + 'GB';
                document.getElementById('memory-total').textContent = data.current.memory.total_gb.toFixed(1) + 'GB';
            }
            
            if (data.current && data.current.cpu) {
                document.getElementById('cpu-load').textContent = data.current.cpu.load.toFixed(2);
            }
            
            // Mock swap usage
            document.getElementById('swap-usage').textContent = '5%';
        }

        function updateAlertsDisplay(alerts) {
            const alertsContainer = document.getElementById('alerts-container');
            alertsContainer.innerHTML = '';
            
            if (alerts.length === 0) {
                alertsContainer.innerHTML = '<div style="color: #a0aec0; text-align: center;">No alerts</div>';
                return;
            }
            
            alerts.forEach(alert => {
                const alertElement = createAlertElement(alert);
                alertsContainer.appendChild(alertElement);
            });
        }

        function createAlertElement(alert) {
            const element = document.createElement('div');
            element.className = `alert-item alert-${alert.type}`;
            
            const icons = {
                critical: 'üö®',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            element.innerHTML = `
                <div class="alert-icon">${icons[alert.type] || '‚ÑπÔ∏è'}</div>
                <div class="alert-content">
                    <div class="alert-message">${alert.message}</div>
                    <div class="alert-time">${new Date(alert.time).toLocaleString()}</div>
                </div>
            `;
            
            return element;
        }

        // Refresh functions
        async function refreshData() {
            const refreshIcon = document.getElementById('refresh-icon');
            refreshIcon.innerHTML = '<span class="loading"></span>';
            
            try {
                await loadInitialData();
            } finally {
                refreshIcon.innerHTML = 'üîÑ';
            }
        }

        async function refreshModels() {
            await loadModelsData();
        }

        async function refreshResources() {
            await loadResourcesData();
        }

        async function refreshRequests() {
            // Mock implementation
            console.log('Refreshing requests data...');
        }

        async function refreshAlerts() {
            await loadAlertsData();
        }

        // Auto refresh
        function startAutoRefresh() {
            refreshInterval = setInterval(async () => {
                if (currentSection === 'overview') {
                    await loadOverviewData();
                } else if (currentSection === 'models') {
                    await loadModelsData();
                } else if (currentSection === 'resources') {
                    await loadResourcesData();
                }
            }, 30000); // Refresh every 30 seconds
        }

        // Error handling
        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            errorContainer.innerHTML = `<div class="error-message">‚ö†Ô∏è ${message}</div>`;
            
            // Auto-hide error after 5 seconds
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>