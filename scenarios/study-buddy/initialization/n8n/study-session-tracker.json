{
  "name": "Study Session Tracker",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "study-session/start",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [250, 300]
    },
    {
      "parameters": {
        "content": "Manual trigger for testing"
      },
      "id": "manual-trigger",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [250, 500]
    },
    {
      "parameters": {
        "jsCode": "// Provide default values for manual testing\nreturn [{\n  json: {\n    user_id: items[0]?.json?.user_id || 'test-user-123',\n    subject_id: items[0]?.json?.subject_id || 'math-101',\n    session_type: items[0]?.json?.session_type || 'flashcards',\n    start_time: new Date().toISOString()\n  }\n}];"
      },
      "id": "default-values",
      "name": "Default Values",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 500]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO study_sessions (user_id, subject_id, session_type, started_at) VALUES ($1, $2, $3, $4) RETURNING *",
        "options": {
          "queryParams": "={{ $json.user_id }}, {{ $json.subject_id }}, {{ $json.session_type }}, {{ $json.start_time }}"
        }
      },
      "id": "create-session",
      "name": "Create Session",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [650, 400],
      "credentials": {
        "postgres": {
          "id": "postgres-study-buddy",
          "name": "Study Buddy DB"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.OLLAMA_WORKFLOW_URL }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "prompt",
              "value": "Generate 3 motivational study tips for a {{ $json.session_type }} session on {{ $json.subject_id }}. Keep each tip under 50 words. Format as JSON array."
            },
            {
              "name": "model",
              "value": "llama3.2:3b"
            }
          ]
        },
        "options": {}
      },
      "id": "get-study-tips",
      "name": "Get Study Tips",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [850, 400]
    },
    {
      "parameters": {
        "jsCode": "const session = items[0].json[0];\nconst tipsResponse = $input.item.json;\n\nlet tips = [];\ntry {\n  if (typeof tipsResponse.response === 'string') {\n    tips = JSON.parse(tipsResponse.response);\n  } else {\n    tips = ['Focus on understanding concepts', 'Take regular breaks', 'Review regularly'];\n  }\n} catch (e) {\n  tips = ['Focus on understanding concepts', 'Take regular breaks', 'Review regularly'];\n}\n\nreturn [{\n  json: {\n    session_id: session.id,\n    user_id: session.user_id,\n    subject_id: session.subject_id,\n    session_type: session.session_type,\n    started_at: session.started_at,\n    study_tips: tips,\n    status: 'active'\n  }\n}];"
      },
      "id": "format-response",
      "name": "Format Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1050, 400]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "respond",
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1250, 300]
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [
        [
          {
            "node": "create-session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "manual-trigger": {
      "main": [
        [
          {
            "node": "default-values",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "default-values": {
      "main": [
        [
          {
            "node": "create-session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "create-session": {
      "main": [
        [
          {
            "node": "get-study-tips",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-study-tips": {
      "main": [
        [
          {
            "node": "format-response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "format-response": {
      "main": [
        [
          {
            "node": "respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [],
  "id": "study-session-tracker"
}