{
  "workflow_id": "cli-campaign-management",
  "name": "CLI Campaign Management",
  "metadata": {
    "reset": "none"
  },
  "description": "Test campaign management via CLI interface",
  "requirement_refs": ["VT-REQ-004"],
  "priority": "P0",
  "steps": [
    {
      "id": "create_campaign_cli",
      "action": "shell_command",
      "command": "visited-tracker campaigns create --name 'cli-test-campaign' --pattern '**/*.go' --from-agent 'cli-automation' --json",
      "expected_exit_code": 0,
      "save_output": "campaign_json",
      "parse_json": true
    },
    {
      "id": "extract_campaign_id",
      "action": "set_variable",
      "variable": "campaign_id",
      "value": "${campaign_json.id}"
    },
    {
      "id": "list_campaigns",
      "action": "shell_command",
      "command": "visited-tracker campaigns list --json",
      "expected_exit_code": 0,
      "assertions": [
        {"output_contains": "cli-test-campaign"}
      ]
    },
    {
      "id": "get_campaign_status",
      "action": "shell_command",
      "command": "visited-tracker --campaign-id ${campaign_id} status --json",
      "expected_exit_code": 0,
      "save_output": "status_json",
      "parse_json": true
    },
    {
      "id": "record_visit_cli",
      "action": "shell_command",
      "command": "visited-tracker --campaign-id ${campaign_id} visit api/main.go --context 'cli-test'",
      "expected_exit_code": 0
    },
    {
      "id": "query_least_visited_cli",
      "action": "shell_command",
      "command": "visited-tracker --campaign-id ${campaign_id} least-visited --limit 5 --json",
      "expected_exit_code": 0,
      "parse_json": true
    },
    {
      "id": "delete_campaign_cli",
      "action": "shell_command",
      "command": "visited-tracker campaigns delete ${campaign_id}",
      "expected_exit_code": 0
    }
  ]
}
