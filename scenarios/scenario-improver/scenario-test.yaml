version: '1.0'
name: app-debugger
description: Tests for App Debugger scenario

environment:
  API_HOST: "${SCENARIO_IMPROVER_API_HOST:-localhost}"
  API_PORT: "${SCENARIO_IMPROVER_API_PORT:-${API_PORT}}"
  UI_HOST: "${SCENARIO_IMPROVER_UI_HOST:-localhost}"
  UI_PORT: "${SCENARIO_IMPROVER_UI_PORT:-${UI_PORT}}"

tests:
  - name: API Health Check
    type: http
    request:
      method: GET
      url: http://${API_HOST}:${API_PORT}/health
    expected:
      status: 200
      body:
        status: healthy

  - name: List Apps Endpoint
    type: http
    request:
      method: GET
      url: http://${API_HOST}:${API_PORT}/api/apps
    expected:
      status: 200
      
  - name: Debug Session Endpoint
    type: http
    request:
      method: POST
      url: http://${API_HOST}:${API_PORT}/api/debug
      headers:
        Content-Type: application/json
      body:
        app_name: test-app
        debug_type: errors
    expected:
      status: 200
      body:
        status: initiated

  - name: Report Error Endpoint
    type: http
    request:
      method: POST
      url: http://${API_HOST}:${API_PORT}/api/report-error
      headers:
        Content-Type: application/json
      body:
        app_name: test-app
        error_message: Test error
        stack_trace: "at test.js:1"
        context: {}
    expected:
      status: 200
      body:
        status: received

  - name: UI Health Check
    type: http
    request:
      method: GET
      url: http://${UI_HOST}:${UI_PORT}/health
    expected:
      status: 200
      body:
        status: healthy
        service: app-debugger-ui

  - name: UI Loads Successfully
    type: http
    request:
      method: GET
      url: http://${UI_HOST}:${UI_PORT}/
    expected:
      status: 200