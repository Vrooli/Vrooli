{
  "name": "Quiz Generator AI Pipeline",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "quiz-generate",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook_trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "content": "## Manual Test Trigger\nProvides default values for testing",
        "options": {}
      },
      "id": "manual_trigger",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [250, 100]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "content",
              "value": "The solar system consists of the Sun and the celestial objects that orbit it. There are eight planets: Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, and Neptune. The Earth is the third planet from the Sun and takes 365.25 days to complete one orbit."
            },
            {
              "name": "question_count",
              "value": "5"
            },
            {
              "name": "difficulty",
              "value": "medium"
            },
            {
              "name": "question_types",
              "value": "mcq,true_false,short_answer"
            }
          ]
        },
        "options": {}
      },
      "id": "test_defaults",
      "name": "Test Defaults",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [450, 100]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "id": "merge_inputs",
      "name": "Merge Inputs",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [650, 200]
    },
    {
      "parameters": {
        "command": "#!/bin/bash\n\nCONTENT=\"{{ $json.content }}\"\nQUESTION_COUNT=\"{{ $json.question_count }}\"\nDIFFICULTY=\"{{ $json.difficulty }}\"\nQUESTION_TYPES=\"{{ $json.question_types }}\"\n\n# Prepare the prompt for Ollama\nPROMPT=$(cat << 'EOF'\nYou are an expert quiz generator. Generate exactly ${QUESTION_COUNT} questions from the following content.\n\nContent: ${CONTENT}\n\nRequirements:\n1. Difficulty level: ${DIFFICULTY}\n2. Question types to include: ${QUESTION_TYPES}\n3. Each question must be directly based on the provided content\n4. Provide clear, unambiguous questions\n5. For multiple choice questions, provide 4 options with only 1 correct answer\n6. Include explanations for correct answers\n\nReturn the response as a valid JSON array with this structure:\n[\n  {\n    \"type\": \"mcq\",\n    \"question\": \"question text\",\n    \"options\": [\"A) option1\", \"B) option2\", \"C) option3\", \"D) option4\"],\n    \"correct_answer\": \"A\",\n    \"explanation\": \"explanation text\",\n    \"difficulty\": \"medium\"\n  },\n  {\n    \"type\": \"true_false\",\n    \"question\": \"question text\",\n    \"correct_answer\": \"true\",\n    \"explanation\": \"explanation text\",\n    \"difficulty\": \"medium\"\n  },\n  {\n    \"type\": \"short_answer\",\n    \"question\": \"question text\",\n    \"correct_answer\": \"expected answer\",\n    \"explanation\": \"explanation text\",\n    \"difficulty\": \"medium\"\n  }\n]\nEOF\n)\n\n# Call the Ollama service\nresource-ollama generate \"${PROMPT}\" --format json",
        "options": {}
      },
      "id": "generate_questions",
      "name": "Generate Questions via Ollama",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [850, 200]
    },
    {
      "parameters": {
        "jsCode": "// Parse the Ollama response and structure the quiz\ntry {\n  const rawResponse = $input.first().json.stdout;\n  const questions = JSON.parse(rawResponse);\n  \n  // Generate a quiz ID\n  const quizId = Math.random().toString(36).substring(2, 15);\n  \n  // Calculate estimated time (2 minutes per question average)\n  const estimatedTime = questions.length * 120;\n  \n  // Structure the quiz object\n  const quiz = {\n    quiz_id: quizId,\n    title: \"Generated Quiz\",\n    description: \"AI-generated quiz from provided content\",\n    questions: questions.map((q, index) => ({\n      ...q,\n      id: Math.random().toString(36).substring(2, 15),\n      order_index: index + 1,\n      points: q.difficulty === 'hard' ? 3 : q.difficulty === 'medium' ? 2 : 1\n    })),\n    total_points: questions.reduce((sum, q) => {\n      return sum + (q.difficulty === 'hard' ? 3 : q.difficulty === 'medium' ? 2 : 1);\n    }, 0),\n    passing_score: 70,\n    estimated_time: estimatedTime,\n    created_at: new Date().toISOString()\n  };\n  \n  return quiz;\n} catch (error) {\n  throw new Error(`Failed to parse quiz questions: ${error.message}`);\n}"
      },
      "id": "structure_quiz",
      "name": "Structure Quiz",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1050, 200]
    },
    {
      "parameters": {
        "url": "http://localhost:3250/api/v1/quiz",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "quiz_id",
              "value": "={{ $json.quiz_id }}"
            },
            {
              "name": "title",
              "value": "={{ $json.title }}"
            },
            {
              "name": "description",
              "value": "={{ $json.description }}"
            },
            {
              "name": "questions",
              "value": "={{ $json.questions }}"
            },
            {
              "name": "total_points",
              "value": "={{ $json.total_points }}"
            },
            {
              "name": "passing_score",
              "value": "={{ $json.passing_score }}"
            },
            {
              "name": "estimated_time",
              "value": "={{ $json.estimated_time }}"
            }
          ]
        },
        "options": {
          "timeout": 10000
        }
      },
      "id": "save_to_database",
      "name": "Save Quiz to Database",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1250, 200]
    },
    {
      "parameters": {
        "respondWith": "allIncomingItems",
        "options": {}
      },
      "id": "webhook_response",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1450, 200]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "error",
              "value": "={{ $json.error }}"
            },
            {
              "name": "message",
              "value": "Failed to generate quiz"
            }
          ]
        },
        "options": {}
      },
      "id": "error_handler",
      "name": "Error Handler",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [1050, 400]
    }
  ],
  "connections": {
    "webhook_trigger": {
      "main": [
        [
          {
            "node": "merge_inputs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "manual_trigger": {
      "main": [
        [
          {
            "node": "test_defaults",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "test_defaults": {
      "main": [
        [
          {
            "node": "merge_inputs",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "merge_inputs": {
      "main": [
        [
          {
            "node": "generate_questions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generate_questions": {
      "main": [
        [
          {
            "node": "structure_quiz",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "structure_quiz": {
      "main": [
        [
          {
            "node": "save_to_database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "save_to_database": {
      "main": [
        [
          {
            "node": "webhook_response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": ""
  },
  "staticData": null,
  "pinData": {},
  "versionId": "1.0.0",
  "triggerCount": 2,
  "tags": [
    {
      "name": "quiz-generator",
      "createdAt": "2024-09-05T00:00:00.000Z"
    }
  ]
}