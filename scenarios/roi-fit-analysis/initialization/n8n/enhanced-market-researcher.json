{
  "name": "Enhanced Market Researcher",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "enhanced-market-researcher",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [250, 400]
    },
    {
      "parameters": {
        "jsCode": "// Extract and validate input data\nconst input = $input.item.json;\n\nconst industry = input.industry || input.body?.industry || 'technology';\nconst targetMarket = input.target_market || input.body?.target_market || 'small businesses';\nconst researchDepth = input.research_depth || input.body?.research_depth || 'comprehensive';\nconst budget = input.budget || input.body?.budget || 50000;\n\nreturn {\n  industry: industry,\n  target_market: targetMarket,\n  research_depth: researchDepth,\n  budget: budget,\n  research_id: 'research_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),\n  timestamp: new Date().toISOString()\n};"
      },
      "id": "prepare-research-data",
      "name": "Prepare Research Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [450, 400]
    },
    {
      "parameters": {
        "url": "${service.browserless.url}/content",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "url",
              "value": "=https://www.google.com/search?q={{ encodeURIComponent($json.industry + ' market size trends ' + $json.target_market) }}"
            },
            {
              "name": "gotoOptions",
              "value": "{\"waitUntil\": \"networkidle2\"}"
            },
            {
              "name": "waitFor",
              "value": "2000"
            }
          ]
        },
        "options": {}
      },
      "id": "google-search",
      "name": "Google Market Search",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "url": "${service.browserless.url}/content",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "url",
              "value": "=https://www.crunchbase.com/discover/organization.companies/field/categories/{{ encodeURIComponent($json.industry) }}"
            },
            {
              "name": "gotoOptions",
              "value": "{\"waitUntil\": \"networkidle2\"}"
            },
            {
              "name": "waitFor",
              "value": "3000"
            }
          ]
        },
        "options": {}
      },
      "id": "crunchbase-search", 
      "name": "Crunchbase Research",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [650, 400]
    },
    {
      "parameters": {
        "url": "${service.browserless.url}/content",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "url",
              "value": "=https://trends.google.com/trends/explore?q={{ encodeURIComponent($json.industry) }}"
            },
            {
              "name": "gotoOptions",
              "value": "{\"waitUntil\": \"networkidle2\"}"
            },
            {
              "name": "waitFor",
              "value": "5000"
            }
          ]
        },
        "options": {}
      },
      "id": "trends-search",
      "name": "Google Trends Research", 
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [650, 500]
    },
    {
      "parameters": {},
      "id": "merge-research",
      "name": "Merge Research Data",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [850, 400]
    },
    {
      "parameters": {
        "jsCode": "// Process and combine all research data\nconst originalData = $('Prepare Research Data').item.json;\nconst googleData = $('Google Market Search').item.json;\nconst crunchbaseData = $('Crunchbase Research').item.json;\nconst trendsData = $('Google Trends Research').item.json;\n\n// Extract text content and clean it\nfunction extractText(response) {\n  if (!response) return '';\n  const content = response.content || response.text || response.body || '';\n  if (typeof content === 'string') {\n    return content.replace(/<[^>]*>/g, '').replace(/\\s+/g, ' ').trim();\n  }\n  return '';\n}\n\nconst googleText = extractText(googleData).substring(0, 2000);\nconst crunchbaseText = extractText(crunchbaseData).substring(0, 2000);\nconst trendsText = extractText(trendsData).substring(0, 1000);\n\n// Combine research data\nconst combinedResearch = {\n  research_id: originalData.research_id,\n  timestamp: originalData.timestamp,\n  input: {\n    industry: originalData.industry,\n    target_market: originalData.target_market,\n    research_depth: originalData.research_depth,\n    budget: originalData.budget\n  },\n  market_data: {\n    google_results: googleText,\n    crunchbase_data: crunchbaseText,\n    trends_data: trendsText,\n    data_quality: 'raw'\n  },\n  success: true\n};\n\nreturn combinedResearch;"
      },
      "id": "process-research",
      "name": "Process Research Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1050, 400]
    },
    {
      "parameters": {
        "url": "${service.n8n.url}/webhook/ollama",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "prompt",
              "value": "=You are a market research analyst. Analyze this scraped market data and provide insights:\n\nIndustry: {{ $json.input.industry }}\nTarget Market: {{ $json.input.target_market }}\nBudget: ${{ $json.input.budget }}\n\nGoogle Search Results:\n{{ $json.market_data.google_results }}\n\nCrunchbase Data:\n{{ $json.market_data.crunchbase_data }}\n\nTrends Data:\n{{ $json.market_data.trends_data }}\n\nProvide a structured analysis with:\n1. Market size estimate\n2. Growth rate and trends\n3. Key competitors (top 5)\n4. Market opportunities\n5. Entry barriers\n6. Risk factors\n7. Recommended strategy\n\nFormat as valid JSON with clear sections."
            },
            {
              "name": "model",
              "value": "phi3.5:3.8b"
            },
            {
              "name": "type",
              "value": "analysis"
            },
            {
              "name": "timeout_seconds",
              "value": "120"
            }
          ]
        },
        "options": {}
      },
      "id": "analyze-market-data",
      "name": "Analyze Market Data",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1250, 400]
    },
    {
      "parameters": {
        "jsCode": "// Combine research data with AI analysis\nconst researchData = $('Process Research Data').item.json;\nconst aiAnalysis = $('Analyze Market Data').item.json;\n\n// Parse AI response\nlet marketAnalysis = {};\ntry {\n  if (aiAnalysis.success && aiAnalysis.response) {\n    const responseText = aiAnalysis.response;\n    if (responseText.includes('{') && responseText.includes('}')) {\n      const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\n      if (jsonMatch) {\n        marketAnalysis = JSON.parse(jsonMatch[0]);\n      } else {\n        marketAnalysis = { raw_analysis: responseText };\n      }\n    } else {\n      marketAnalysis = { raw_analysis: responseText };\n    }\n  }\n} catch (e) {\n  console.error('Failed to parse market analysis:', e);\n  marketAnalysis = { raw_analysis: aiAnalysis.response || 'Analysis failed' };\n}\n\n// Build final response\nreturn {\n  research_id: researchData.research_id,\n  timestamp: researchData.timestamp,\n  input: researchData.input,\n  raw_data: researchData.market_data,\n  market_analysis: marketAnalysis,\n  ai_execution: aiAnalysis.execution || {},\n  recommendations: {\n    market_entry_score: calculateMarketEntryScore(marketAnalysis),\n    investment_recommendation: getInvestmentRecommendation(researchData.input.budget, marketAnalysis),\n    next_steps: generateNextSteps(marketAnalysis)\n  },\n  success: true\n};\n\nfunction calculateMarketEntryScore(analysis) {\n  // Simple scoring based on analysis keywords\n  let score = 50; // Base score\n  const text = JSON.stringify(analysis).toLowerCase();\n  \n  if (text.includes('growing') || text.includes('growth')) score += 10;\n  if (text.includes('competitive') || text.includes('saturated')) score -= 15;\n  if (text.includes('opportunity') || text.includes('gap')) score += 15;\n  if (text.includes('barrier') || text.includes('difficult')) score -= 10;\n  \n  return Math.max(0, Math.min(100, score));\n}\n\nfunction getInvestmentRecommendation(budget, analysis) {\n  const text = JSON.stringify(analysis).toLowerCase();\n  if (budget < 25000) return 'Start with MVP and validate market';\n  if (budget < 100000) return 'Focus on niche market entry';\n  return 'Consider full market entry with competitive positioning';\n}\n\nfunction generateNextSteps(analysis) {\n  return [\n    'Validate market assumptions with target customers',\n    'Analyze top 3 competitors in detail',\n    'Develop minimum viable product strategy',\n    'Create go-to-market timeline'\n  ];\n}"
      },
      "id": "finalize-research",
      "name": "Finalize Research Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1450, 400]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json, null, 2) }}"
      },
      "id": "respond-success",
      "name": "Respond Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1650, 400]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [[{ "node": "Prepare Research Data", "type": "main", "index": 0 }]]
    },
    "Prepare Research Data": {
      "main": [
        [
          { "node": "Google Market Search", "type": "main", "index": 0 },
          { "node": "Crunchbase Research", "type": "main", "index": 0 },
          { "node": "Google Trends Research", "type": "main", "index": 0 }
        ]
      ]
    },
    "Google Market Search": {
      "main": [[{ "node": "Merge Research Data", "type": "main", "index": 0 }]]
    },
    "Crunchbase Research": {
      "main": [[{ "node": "Merge Research Data", "type": "main", "index": 1 }]]
    },
    "Google Trends Research": {
      "main": [[{ "node": "Merge Research Data", "type": "main", "index": 2 }]]
    },
    "Merge Research Data": {
      "main": [[{ "node": "Process Research Data", "type": "main", "index": 0 }]]
    },
    "Process Research Data": {
      "main": [[{ "node": "Analyze Market Data", "type": "main", "index": 0 }]]
    },
    "Analyze Market Data": {
      "main": [[{ "node": "Finalize Research Report", "type": "main", "index": 0 }]]
    },
    "Finalize Research Report": {
      "main": [[{ "node": "Respond Success", "type": "main", "index": 0 }]]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1.0.0",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "enhanced-market-researcher"
  },
  "tags": []
}