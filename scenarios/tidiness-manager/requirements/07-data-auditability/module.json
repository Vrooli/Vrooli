{
  "_metadata": {
    "prd_section": "P1 - Data, Consistency & Auditability",
    "description": "Scan history, configuration management, and audit trails",
    "last_synced_at": "2025-11-21T18:00:24.821Z"
  },
  "requirements": [
    {
      "id": "TM-DA-001",
      "title": "Scan history tracking - resource used",
      "prd_ref": "OT-P1-007",
      "criticality": "P1",
      "description": "Record which AI resource was used for each issue (resource-claude-code vs resource-codes)",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "not_implemented",
          "ref": "test/phases/test-integration.sh",
          "_sync_metadata": {
            "last_test_run": "",
            "test_duration_ms": 0,
            "auto_updated": true,
            "test_names": [],
            "phase_result": "",
            "source_phase": "integration",
            "tests_run": [
              "test/run-tests.sh"
            ]
          }
        }
      ],
      "notes": "Store in issues table as resource_id",
      "status": "pending",
      "_sync_metadata": {
        "last_updated": "2025-11-21T18:00:24.821Z",
        "updated_by": "auto-sync",
        "test_coverage_count": 0,
        "all_tests_passing": true,
        "phase_results": [],
        "tests_run": [
          "test/run-tests.sh"
        ]
      }
    },
    {
      "id": "TM-DA-002",
      "title": "Scan history tracking - creation timestamp",
      "prd_ref": "OT-P1-007",
      "criticality": "P1",
      "description": "Record when each issue was created",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "not_implemented",
          "ref": "test/phases/test-integration.sh",
          "_sync_metadata": {
            "last_test_run": "",
            "test_duration_ms": 0,
            "auto_updated": true,
            "test_names": [],
            "phase_result": "",
            "source_phase": "integration",
            "tests_run": [
              "test/run-tests.sh"
            ]
          }
        }
      ],
      "notes": "created_at timestamp for trend analysis",
      "status": "pending",
      "_sync_metadata": {
        "last_updated": "2025-11-21T18:00:24.821Z",
        "updated_by": "auto-sync",
        "test_coverage_count": 0,
        "all_tests_passing": true,
        "phase_results": [],
        "tests_run": [
          "test/run-tests.sh"
        ]
      }
    },
    {
      "id": "TM-DA-003",
      "title": "Scan history tracking - campaign linkage",
      "prd_ref": "OT-P1-007",
      "criticality": "P1",
      "description": "Record which campaign and session produced each issue",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "not_implemented",
          "ref": "test/phases/test-integration.sh",
          "_sync_metadata": {
            "last_test_run": "",
            "test_duration_ms": 0,
            "auto_updated": true,
            "test_names": [],
            "phase_result": "",
            "source_phase": "integration",
            "tests_run": [
              "test/run-tests.sh"
            ]
          }
        }
      ],
      "notes": "campaign_id and session_id foreign keys",
      "status": "pending",
      "_sync_metadata": {
        "last_updated": "2025-11-21T18:00:24.821Z",
        "updated_by": "auto-sync",
        "test_coverage_count": 0,
        "all_tests_passing": true,
        "phase_results": [],
        "tests_run": [
          "test/run-tests.sh"
        ]
      }
    },
    {
      "id": "TM-DA-004",
      "title": "Configurable thresholds - central storage",
      "prd_ref": "OT-P1-008",
      "criticality": "P0",
      "description": "Store all thresholds in postgres config table (no hard-coding)",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "not_implemented",
          "ref": "test/phases/test-integration.sh",
          "_sync_metadata": {
            "last_test_run": "",
            "test_duration_ms": 0,
            "auto_updated": true,
            "test_names": [],
            "phase_result": "",
            "source_phase": "integration",
            "tests_run": [
              "test/run-tests.sh"
            ]
          }
        }
      ],
      "notes": "Long file lines, max scans per file, max concurrent campaigns",
      "status": "pending",
      "_sync_metadata": {
        "last_updated": "2025-11-21T18:00:24.821Z",
        "updated_by": "auto-sync",
        "test_coverage_count": 0,
        "all_tests_passing": true,
        "phase_results": [],
        "tests_run": [
          "test/run-tests.sh"
        ]
      }
    },
    {
      "id": "TM-DA-005",
      "title": "Configurable thresholds - per-scenario override",
      "prd_ref": "OT-P1-008",
      "criticality": "P1",
      "description": "Support per-scenario threshold overrides for special cases",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "not_implemented",
          "ref": "test/phases/test-integration.sh",
          "_sync_metadata": {
            "last_test_run": "",
            "test_duration_ms": 0,
            "auto_updated": true,
            "test_names": [],
            "phase_result": "",
            "source_phase": "integration",
            "tests_run": [
              "test/run-tests.sh"
            ]
          }
        }
      ],
      "notes": "E.g., allow longer files in generated code scenarios",
      "status": "pending",
      "_sync_metadata": {
        "last_updated": "2025-11-21T18:00:24.821Z",
        "updated_by": "auto-sync",
        "test_coverage_count": 0,
        "all_tests_passing": true,
        "phase_results": [],
        "tests_run": [
          "test/run-tests.sh"
        ]
      }
    },
    {
      "id": "TM-DA-006",
      "title": "Read-only agent queries",
      "prd_ref": "OT-P1-009",
      "criticality": "P0",
      "description": "Agent read calls return existing data without triggering new scans by default",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "not_implemented",
          "ref": "test/phases/test-integration.sh",
          "_sync_metadata": {
            "last_test_run": "",
            "test_duration_ms": 0,
            "auto_updated": true,
            "test_names": [],
            "phase_result": "",
            "source_phase": "integration",
            "tests_run": [
              "test/run-tests.sh"
            ]
          }
        }
      ],
      "notes": "Prevent accidental scan storms from agent loops",
      "status": "pending",
      "_sync_metadata": {
        "last_updated": "2025-11-21T18:00:24.821Z",
        "updated_by": "auto-sync",
        "test_coverage_count": 0,
        "all_tests_passing": true,
        "phase_results": [],
        "tests_run": [
          "test/run-tests.sh"
        ]
      }
    },
    {
      "id": "TM-DA-007",
      "title": "Force scan flag",
      "prd_ref": "OT-P1-009",
      "criticality": "P1",
      "description": "Support explicit force flag to trigger new scan from agent API",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "not_implemented",
          "ref": "test/phases/test-integration.sh",
          "_sync_metadata": {
            "last_test_run": "",
            "test_duration_ms": 0,
            "auto_updated": true,
            "test_names": [],
            "phase_result": "",
            "source_phase": "integration",
            "tests_run": [
              "test/run-tests.sh"
            ]
          }
        }
      ],
      "notes": "GET /api/v1/scenarios/{name}/issues?force_scan=true",
      "status": "pending",
      "_sync_metadata": {
        "last_updated": "2025-11-21T18:00:24.821Z",
        "updated_by": "auto-sync",
        "test_coverage_count": 0,
        "all_tests_passing": true,
        "phase_results": [],
        "tests_run": [
          "test/run-tests.sh"
        ]
      }
    },
    {
      "id": "TM-DA-008",
      "title": "Force scan queueing",
      "prd_ref": "OT-P1-010",
      "criticality": "P0",
      "description": "Enqueue force-scan requests in controlled queue with global concurrency limit",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "not_implemented",
          "ref": "test/phases/test-integration.sh",
          "_sync_metadata": {
            "last_test_run": "",
            "test_duration_ms": 0,
            "auto_updated": true,
            "test_names": [],
            "phase_result": "",
            "source_phase": "integration",
            "tests_run": [
              "test/run-tests.sh"
            ]
          }
        }
      ],
      "notes": "Prevent overwhelming AI resources with concurrent scans",
      "status": "pending",
      "_sync_metadata": {
        "last_updated": "2025-11-21T18:00:24.821Z",
        "updated_by": "auto-sync",
        "test_coverage_count": 0,
        "all_tests_passing": true,
        "phase_results": [],
        "tests_run": [
          "test/run-tests.sh"
        ]
      }
    }
  ]
}
