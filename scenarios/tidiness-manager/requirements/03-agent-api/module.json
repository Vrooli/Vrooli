{
  "_metadata": {
    "prd_section": "P0 - Agent-Callable Interface",
    "description": "HTTP/CLI API for other agents to request tidiness recommendations"
  },
  "requirements": [
    {
      "id": "TM-API-001",
      "title": "Scenario summary endpoint",
      "prd_ref": "OT-P0-007",
      "criticality": "P0",
      "description": "Expose API endpoint to request top N tidiness issues for a given scenario",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "failing",
          "ref": "test/phases/test-integration.sh"
        }
      ],
      "notes": "GET /api/v1/scenarios/{name}/issues?limit=N&severity=high",
      "status": "in_progress"
    },
    {
      "id": "TM-API-002",
      "title": "File-scoped issue query",
      "prd_ref": "OT-P0-007",
      "criticality": "P1",
      "description": "Support querying issues scoped to specific file or folder",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "failing",
          "ref": "test/phases/test-integration.sh"
        }
      ],
      "notes": "GET /api/v1/scenarios/{name}/issues?file=path/to/file.ts",
      "status": "in_progress"
    },
    {
      "id": "TM-API-003",
      "title": "Category-scoped issue query",
      "prd_ref": "OT-P0-007",
      "criticality": "P1",
      "description": "Support querying issues filtered by category (e.g., 'long files', 'dead code')",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "failing",
          "ref": "test/phases/test-integration.sh"
        }
      ],
      "notes": "GET /api/v1/scenarios/{name}/issues?category=dead_code",
      "status": "in_progress"
    },
    {
      "id": "TM-API-004",
      "title": "Issue ranking heuristic",
      "prd_ref": "OT-P0-007",
      "criticality": "P0",
      "description": "Rank returned issues by severity, occurrence count, and file criticality",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "not_implemented",
          "ref": "api/issue_ranker_test.go"
        }
      ],
      "notes": "Define clear ranking formula in API docs",
      "status": "pending"
    },
    {
      "id": "TM-API-005",
      "title": "CLI wrapper for agent integration",
      "prd_ref": "OT-P0-007",
      "criticality": "P0",
      "description": "Provide CLI commands that wrap HTTP API for agent consumption",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "not_implemented",
          "ref": "test/cli/agent-api.bats"
        }
      ],
      "notes": "tidiness-manager issues <scenario> --limit 10 --category dead_code",
      "status": "pending"
    },
    {
      "id": "TM-API-006",
      "title": "Issue storage in postgres",
      "prd_ref": "OT-P0-008",
      "criticality": "P0",
      "description": "Store issues in postgres with all required fields (scenario, file, category, severity, notes, remediation, campaign metadata)",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "failing",
          "ref": "test/phases/test-integration.sh"
        }
      ],
      "notes": "Schema must support querying by all filterable dimensions",
      "status": "in_progress"
    },
    {
      "id": "TM-API-007",
      "title": "Campaign metadata linkage",
      "prd_ref": "OT-P0-008",
      "criticality": "P1",
      "description": "Link issues to campaign ID, session ID, and visit timestamp",
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "status": "failing",
          "ref": "test/phases/test-integration.sh"
        }
      ],
      "notes": "Enables audit trail and trend analysis",
      "status": "in_progress"
    }
  ]
}
