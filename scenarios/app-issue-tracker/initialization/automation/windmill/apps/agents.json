{
  "name": "Agent Management",
  "path": "issue_tracker_agents",
  "summary": "Manage Claude-Code agents and prompt templates",
  "description": "Create, edit, and monitor AI agents for issue investigation and fixing",
  "value": {
    "type": "app",
    "grid": [
      {
        "id": "header",
        "type": "text",
        "configuration": {
          "text": "# ðŸ¤– Claude-Code Agent Management",
          "style": {
            "fontSize": "24px",
            "fontWeight": "bold",
            "marginBottom": "20px"
          }
        },
        "position": { "x": 0, "y": 0, "w": 12, "h": 1 }
      },
      {
        "id": "agent_stats",
        "type": "container",
        "configuration": {
          "layout": "horizontal",
          "components": [
            {
              "type": "statCard",
              "title": "Total Agents",
              "data": "{{getTotalAgents}}",
              "color": "blue",
              "icon": "users"
            },
            {
              "type": "statCard",
              "title": "Active Agents",
              "data": "{{getActiveAgents}}",
              "color": "green",
              "icon": "activity"
            },
            {
              "type": "statCard",
              "title": "Avg Success Rate",
              "data": "{{getAvgSuccessRate}}",
              "unit": "%",
              "color": "purple",
              "icon": "trending-up"
            },
            {
              "type": "statCard",
              "title": "Total Runs (24h)",
              "data": "{{getTotalRuns24h}}",
              "color": "orange",
              "icon": "play-circle"
            }
          ]
        },
        "position": { "x": 0, "y": 1, "w": 12, "h": 2 }
      },
      {
        "id": "agent_actions",
        "type": "container",
        "configuration": {
          "layout": "horizontal",
          "components": [
            {
              "id": "create_agent_btn",
              "type": "button",
              "text": "âž• Create New Agent",
              "color": "primary",
              "size": "large",
              "onClick": "{{openCreateAgentModal}}"
            },
            {
              "id": "import_agent_btn",
              "type": "button",
              "text": "ðŸ“¥ Import Agent",
              "color": "secondary",
              "onClick": "{{openImportModal}}"
            },
            {
              "id": "export_agents_btn",
              "type": "button",
              "text": "ðŸ“¤ Export All",
              "color": "default",
              "onClick": "{{exportAgents}}"
            },
            {
              "id": "test_agent_btn",
              "type": "button",
              "text": "ðŸ§ª Test Agent",
              "color": "warning",
              "disabled": "{{!selectedAgent}}",
              "onClick": "{{openTestModal}}"
            }
          ]
        },
        "position": { "x": 0, "y": 3, "w": 12, "h": 1 }
      },
      {
        "id": "agents_grid",
        "type": "aggridcomponent",
        "configuration": {
          "resource": "postgres://issue_tracker",
          "query": "SELECT a.*, CASE WHEN a.total_runs > 0 THEN (a.successful_runs::DECIMAL / a.total_runs * 100)::DECIMAL(5,2) ELSE 0 END as success_percent FROM agents a ORDER BY a.is_active DESC, success_percent DESC",
          "columnDefs": [
            {
              "field": "id",
              "headerName": "ID",
              "hide": true
            },
            {
              "field": "name",
              "headerName": "Agent Name",
              "width": 150,
              "pinned": "left"
            },
            {
              "field": "display_name",
              "headerName": "Display Name",
              "width": 200
            },
            {
              "field": "description",
              "headerName": "Description",
              "flex": 2,
              "wrapText": true
            },
            {
              "field": "capabilities",
              "headerName": "Capabilities",
              "width": 200,
              "cellRenderer": "tagRenderer"
            },
            {
              "field": "model",
              "headerName": "Model",
              "width": 150
            },
            {
              "field": "success_percent",
              "headerName": "Success %",
              "width": 100,
              "cellRenderer": "progressBar"
            },
            {
              "field": "total_runs",
              "headerName": "Total Runs",
              "width": 100
            },
            {
              "field": "avg_completion_time_seconds",
              "headerName": "Avg Time (s)",
              "width": 120
            },
            {
              "field": "total_cost_usd",
              "headerName": "Total Cost",
              "width": 100,
              "valueFormatter": "currencyFormatter"
            },
            {
              "field": "is_active",
              "headerName": "Active",
              "width": 80,
              "cellRenderer": "booleanToggle",
              "onCellValueChanged": "{{toggleAgentActive}}"
            }
          ],
          "rowSelection": "single",
          "onRowClicked": "{{selectAgent}}",
          "pagination": true,
          "paginationPageSize": 15
        },
        "position": { "x": 0, "y": 4, "w": 12, "h": 6 }
      },
      {
        "id": "agent_details",
        "type": "container",
        "configuration": {
          "title": "Agent Details",
          "show": "{{selectedAgent}}",
          "components": [
            {
              "type": "tabs",
              "tabs": [
                {
                  "label": "Prompt Configuration",
                  "content": {
                    "type": "container",
                    "components": [
                      {
                        "type": "codeEditor",
                        "id": "system_prompt_editor",
                        "label": "System Prompt",
                        "value": "{{selectedAgent.system_prompt}}",
                        "language": "markdown",
                        "height": 200
                      },
                      {
                        "type": "codeEditor",
                        "id": "user_prompt_editor",
                        "label": "User Prompt Template",
                        "value": "{{selectedAgent.user_prompt_template}}",
                        "language": "markdown",
                        "height": 200,
                        "helperText": "Use {{variable}} for placeholders"
                      },
                      {
                        "type": "container",
                        "layout": "horizontal",
                        "components": [
                          {
                            "type": "numberInput",
                            "id": "max_tokens",
                            "label": "Max Tokens",
                            "value": "{{selectedAgent.max_tokens}}",
                            "min": 1000,
                            "max": 16000
                          },
                          {
                            "type": "slider",
                            "id": "temperature",
                            "label": "Temperature",
                            "value": "{{selectedAgent.temperature}}",
                            "min": 0,
                            "max": 1,
                            "step": 0.1
                          }
                        ]
                      },
                      {
                        "type": "button",
                        "text": "ðŸ’¾ Save Changes",
                        "color": "primary",
                        "onClick": "{{saveAgentChanges}}"
                      }
                    ]
                  }
                },
                {
                  "label": "Performance History",
                  "content": {
                    "type": "container",
                    "components": [
                      {
                        "type": "chart",
                        "chartType": "line",
                        "title": "Success Rate Over Time",
                        "data": "{{getAgentPerformanceHistory}}",
                        "xAxis": "date",
                        "yAxis": "success_rate",
                        "height": 250
                      },
                      {
                        "type": "chart",
                        "chartType": "bar",
                        "title": "Issues Handled by Type",
                        "data": "{{getAgentIssueTypes}}",
                        "xAxis": "issue_type",
                        "yAxis": "count",
                        "height": 200
                      }
                    ]
                  }
                },
                {
                  "label": "Recent Runs",
                  "content": {
                    "type": "table",
                    "data": "{{getAgentRecentRuns}}",
                    "columns": [
                      { "field": "issue_title", "header": "Issue" },
                      { "field": "started_at", "header": "Started" },
                      { "field": "duration_seconds", "header": "Duration (s)" },
                      { "field": "status", "header": "Status", "cellRenderer": "statusBadge" },
                      { "field": "tokens_used", "header": "Tokens" },
                      { "field": "cost_estimate", "header": "Cost ($)" }
                    ],
                    "pagination": true,
                    "pageSize": 10
                  }
                }
              ]
            }
          ]
        },
        "position": { "x": 0, "y": 10, "w": 12, "h": 6 }
      },
      {
        "id": "create_agent_modal",
        "type": "modal",
        "configuration": {
          "title": "Create New Agent",
          "size": "large",
          "open": "{{showCreateModal}}",
          "components": [
            {
              "type": "form",
              "fields": [
                {
                  "id": "new_agent_name",
                  "type": "textInput",
                  "label": "Agent Name (lowercase, no spaces)",
                  "required": true,
                  "pattern": "^[a-z0-9-]+$"
                },
                {
                  "id": "new_agent_display_name",
                  "type": "textInput",
                  "label": "Display Name",
                  "required": true
                },
                {
                  "id": "new_agent_description",
                  "type": "textarea",
                  "label": "Description",
                  "rows": 3
                },
                {
                  "id": "new_agent_capabilities",
                  "type": "multiSelect",
                  "label": "Capabilities",
                  "options": ["investigate", "fix", "test", "document", "refactor"],
                  "required": true
                },
                {
                  "id": "new_agent_model",
                  "type": "select",
                  "label": "Model",
                  "options": [
                    { "value": "claude-3-opus-20240229", "label": "Claude 3 Opus" },
                    { "value": "claude-3-sonnet-20240229", "label": "Claude 3 Sonnet" },
                    { "value": "claude-3-haiku-20240307", "label": "Claude 3 Haiku" }
                  ],
                  "defaultValue": "claude-3-opus-20240229"
                },
                {
                  "id": "new_agent_system_prompt",
                  "type": "codeEditor",
                  "label": "System Prompt",
                  "language": "markdown",
                  "height": 150,
                  "required": true
                },
                {
                  "id": "new_agent_user_prompt",
                  "type": "codeEditor",
                  "label": "User Prompt Template",
                  "language": "markdown",
                  "height": 150,
                  "required": true,
                  "helperText": "Use {{variable}} for placeholders"
                }
              ],
              "submitButton": {
                "text": "Create Agent",
                "color": "primary"
              },
              "onSubmit": "{{createNewAgent}}"
            }
          ]
        }
      },
      {
        "id": "test_agent_modal",
        "type": "modal",
        "configuration": {
          "title": "Test Agent",
          "size": "large",
          "open": "{{showTestModal}}",
          "components": [
            {
              "type": "form",
              "fields": [
                {
                  "id": "test_issue_id",
                  "type": "select",
                  "label": "Select Test Issue",
                  "options": "{{getTestIssues}}",
                  "required": true
                },
                {
                  "id": "test_dry_run",
                  "type": "checkbox",
                  "label": "Dry Run (don't save results)",
                  "defaultValue": true
                }
              ],
              "submitButton": {
                "text": "Run Test",
                "color": "warning"
              },
              "onSubmit": "{{runAgentTest}}"
            },
            {
              "type": "container",
              "show": "{{testResults}}",
              "components": [
                {
                  "type": "text",
                  "text": "### Test Results"
                },
                {
                  "type": "codeEditor",
                  "value": "{{testResults}}",
                  "language": "json",
                  "readOnly": true,
                  "height": 300
                }
              ]
            }
          ]
        }
      }
    ],
    "scripts": {
      "getTotalAgents": "SELECT COUNT(*) as value FROM agents",
      "getActiveAgents": "SELECT COUNT(*) as value FROM agents WHERE is_active = true",
      "getAvgSuccessRate": "SELECT AVG(CASE WHEN total_runs > 0 THEN (successful_runs::DECIMAL / total_runs * 100) ELSE 0 END)::DECIMAL(5,2) as value FROM agents WHERE is_active = true",
      "getTotalRuns24h": "SELECT COUNT(*) as value FROM agent_runs WHERE started_at >= NOW() - INTERVAL '24 hours'",
      "selectAgent": "scripts/actions/select-agent",
      "toggleAgentActive": "scripts/actions/toggle-agent-active",
      "saveAgentChanges": "scripts/actions/save-agent-changes",
      "openCreateAgentModal": "scripts/actions/open-create-agent-modal",
      "createNewAgent": "scripts/actions/create-new-agent",
      "openTestModal": "scripts/actions/open-test-modal",
      "runAgentTest": "scripts/actions/run-agent-test",
      "getAgentPerformanceHistory": "scripts/analytics/get-agent-performance-history",
      "getAgentIssueTypes": "scripts/analytics/get-agent-issue-types",
      "getAgentRecentRuns": "scripts/api/get-agent-recent-runs",
      "getTestIssues": "SELECT id as value, title as label FROM issues WHERE status = 'open' ORDER BY created_at DESC LIMIT 20",
      "exportAgents": "scripts/actions/export-agents",
      "openImportModal": "scripts/actions/open-import-modal"
    }
  }
}