{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://vrooli.com/schemas/lighthouse.schema.json",
  "title": "Vrooli Lighthouse Configuration",
  "description": "Lighthouse performance and accessibility audit configuration for a scenario",
  "type": "object",
  "required": ["version"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version (semver format)"
    },
    "service": {
      "type": "string",
      "description": "Service/scenario name"
    },
    "scenario": {
      "type": "string",
      "description": "Scenario name (alternate field)"
    },
    "description": {
      "type": "string",
      "description": "Description of this Lighthouse configuration"
    },
    "lighthouse": {
      "type": "object",
      "description": "Main Lighthouse configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Whether Lighthouse audits are enabled"
        },
        "url": {
          "type": "string",
          "description": "Base URL to audit (supports ${ENV_VAR} substitution)"
        },
        "thresholds": {
          "$ref": "#/definitions/thresholds",
          "description": "Global score thresholds"
        },
        "budgets": {
          "type": "array",
          "description": "Performance budgets by resource type",
          "items": {
            "$ref": "#/definitions/budget"
          }
        },
        "scenarios": {
          "type": "array",
          "description": "Page-specific audit scenarios",
          "items": {
            "$ref": "#/definitions/scenario"
          }
        },
        "checks": {
          "type": "array",
          "description": "Individual page checks (alternate format)",
          "items": {
            "$ref": "#/definitions/check"
          }
        },
        "config": {
          "$ref": "#/definitions/lighthouse_config",
          "description": "Lighthouse runner configuration"
        }
      }
    },
    "pages": {
      "type": "array",
      "description": "Page definitions (alternate top-level format)",
      "items": {
        "$ref": "#/definitions/page"
      }
    },
    "global_options": {
      "type": "object",
      "description": "Global Chrome/Lighthouse options",
      "properties": {
        "chrome_flags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "performance_notes": {
      "type": "object",
      "description": "Documentation about performance characteristics",
      "properties": {
        "known_issues": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "optimizations_applied": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "future_improvements": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    }
  },
  "definitions": {
    "thresholds": {
      "type": "object",
      "description": "Score thresholds (0-100 or 0-1 scale)",
      "properties": {
        "performance": {
          "type": "number",
          "minimum": 0,
          "description": "Performance score threshold"
        },
        "accessibility": {
          "type": "number",
          "minimum": 0,
          "description": "Accessibility score threshold"
        },
        "best-practices": {
          "type": "number",
          "minimum": 0,
          "description": "Best practices score threshold"
        },
        "seo": {
          "type": "number",
          "minimum": 0,
          "description": "SEO score threshold"
        },
        "first-contentful-paint": {
          "type": "number",
          "description": "FCP threshold in milliseconds"
        },
        "largest-contentful-paint": {
          "type": "number",
          "description": "LCP threshold in milliseconds"
        },
        "time-to-interactive": {
          "type": "number",
          "description": "TTI threshold in milliseconds"
        },
        "cumulative-layout-shift": {
          "type": "number",
          "description": "CLS threshold (0-1 scale)"
        },
        "total-blocking-time": {
          "type": "number",
          "description": "TBT threshold in milliseconds"
        }
      }
    },
    "budget": {
      "type": "object",
      "required": ["resourceType", "budget"],
      "properties": {
        "resourceType": {
          "type": "string",
          "enum": ["script", "stylesheet", "image", "font", "document", "media", "other", "total"],
          "description": "Type of resource to budget"
        },
        "budget": {
          "type": "integer",
          "minimum": 0,
          "description": "Budget in kilobytes"
        }
      }
    },
    "scenario": {
      "type": "object",
      "required": ["name", "url"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Scenario identifier"
        },
        "description": {
          "type": "string"
        },
        "url": {
          "type": "string",
          "description": "URL path to audit"
        },
        "thresholds": {
          "$ref": "#/definitions/thresholds"
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "check": {
      "type": "object",
      "required": ["name", "url"],
      "properties": {
        "name": {
          "type": "string"
        },
        "url": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "config": {
          "$ref": "#/definitions/lighthouse_config"
        }
      }
    },
    "page": {
      "type": "object",
      "required": ["id", "path"],
      "properties": {
        "id": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "path": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "thresholds": {
          "$ref": "#/definitions/thresholds"
        }
      }
    },
    "lighthouse_config": {
      "type": "object",
      "description": "Lighthouse runner settings",
      "properties": {
        "extends": {
          "type": "string",
          "description": "Base config to extend (e.g., 'lighthouse:default')"
        },
        "settings": {
          "type": "object",
          "properties": {
            "onlyCategories": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "skipAudits": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "emulatedFormFactor": {
              "type": "string",
              "enum": ["mobile", "desktop"]
            },
            "formFactor": {
              "type": "string",
              "enum": ["mobile", "desktop"]
            },
            "throttling": {
              "type": "object",
              "properties": {
                "rttMs": {
                  "type": "number"
                },
                "throughputKbps": {
                  "type": "number"
                },
                "cpuSlowdownMultiplier": {
                  "type": "number"
                }
              }
            },
            "screenEmulation": {
              "type": "object",
              "properties": {
                "mobile": {
                  "type": "boolean"
                },
                "width": {
                  "type": "integer"
                },
                "height": {
                  "type": "integer"
                },
                "deviceScaleFactor": {
                  "type": "number"
                }
              }
            }
          }
        }
      }
    }
  }
}
