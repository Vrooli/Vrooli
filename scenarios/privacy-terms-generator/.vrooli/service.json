{
  "$schema": "../../../../.vrooli/schemas/service.schema.json",
  "version": "1.0.0",
  "service": {
    "name": "privacy-terms-generator",
    "displayName": "Privacy & Terms Generator",
    "description": "Generate legally compliant privacy policies, terms of service, and other legal documents for businesses",
    "version": "1.0.0",
    "tags": [
      "legal",
      "compliance",
      "privacy",
      "terms",
      "GDPR",
      "CCPA",
      "document-generation",
      "business-tools",
      "postgres-storage",
      "ollama-ai"
    ]
  },
   "ports": {
     "api": {
       "env_var": "API_PORT",
       "range": "15000-19999"
     },
     "ui": {
       "env_var": "UI_PORT",
       "description": "Web UI for document generation",
       "range": "35000-39999"
     }
   },
  "resources": {
    "postgres": {
      "type": "postgres",
      "enabled": true,
      "required": true,
      "purpose": "Store templates, generated documents, and business profiles",
      "initialization": [
        {
          "file": "initialization/postgres/schema.sql",
          "type": "schema"
        },
        {
          "file": "initialization/postgres/seed-templates.sql",
          "type": "seed"
        }
      ]
    },
    "ollama": {
      "type": "ollama",
      "enabled": true,
      "required": true,
      "purpose": "Generate custom clauses and adapt templates to business needs",
      "models": [
        "llama3.2",
        "mistral"
      ]
    },
    "qdrant": {
      "type": "qdrant",
      "enabled": false,
      "required": false,
      "purpose": "Semantic search for relevant legal clauses and similar documents"
    },
    "browserless": {
      "type": "browserless",
      "enabled": false,
      "required": false,
      "purpose": "Generate PDF versions of legal documents"
    }
  },
  "lifecycle": {
    "version": "2.0.0",
    "health": {
      "description": "Privacy & Terms Generator health check",
      "endpoints": {
        "ui": "/health"
      },
      "checks": [
        {
          "name": "ui_endpoint",
          "type": "http",
          "target": "http://localhost:${UI_PORT}/health",
          "critical": true,
          "timeout": 5000,
          "interval": 30000
        },
        {
          "name": "postgres_connection",
          "type": "exec",
          "command": "resource-postgres query \"SELECT 1\"",
          "critical": true,
          "timeout": 3000,
          "interval": 60000
        }
      ],
      "timeout": 5000,
      "interval": 30000,
      "startup_grace_period": 10000
    },
    "setup": {
      "description": "Initialize Privacy & Terms Generator",
       "condition": {
         "checks": [
           {
             "type": "binaries",
             "targets": [
               "privacy-terms-generator-api"
             ]
           },
           {
             "type": "cli",
             "targets": [
               "privacy-terms-generator"
             ]
           },
           {
             "type": "resources",
             "populated": true
           }
         ]
       },
      "steps": [
        {
          "name": "initialize-database",
          "run": "resource-postgres query < initialization/postgres/schema.sql",
          "description": "Create database schema"
        },
        {
          "name": "seed-templates",
          "run": "lib/fetch-templates.sh && resource-postgres query < initialization/postgres/seed-templates.sql",
          "description": "Fetch and seed legal templates"
        },
        {
          "name": "install-cli",
          "run": "cd cli && ./install.sh",
          "description": "Install CLI command globally"
        },
        {
          "name": "show-urls",
          "run": "echo 'ðŸš€ Privacy & Terms Generator initialized\\n  UI: http://localhost:${UI_PORT}\\n  CLI: privacy-terms-generator --help'",
          "description": "Display service access URLs"
        }
      ]
    },
     "develop": {
       "description": "Start privacy & terms generator UI",
       "steps": [
         {
           "name": "start-api",
           "run": "cd api && ./privacy-terms-generator-api",
           "description": "Start Go API server in background",
           "background": true,
           "condition": {
             "file_exists": "api/privacy-terms-generator-api"
           }
         },
         {
           "name": "start-ui",
           "run": "cd ui && python3 -m http.server ${UI_PORT} 2>/dev/null",
           "description": "Start web UI server",
           "background": true
         },
         {
           "name": "show-urls",
           "run": "echo 'ðŸš€ Services running:\\n  UI: http://localhost:${UI_PORT}\\n  CLI: privacy-terms-generator --help'",
           "description": "Display running service URLs"
         }
       ]
     },
    "test": {
      "description": "Test privacy & terms generator",
      "steps": [
        {
          "name": "test-cli-generation",
          "run": "cli/privacy-terms-generator generate privacy --business-name 'TestCo' --jurisdiction US --format markdown",
          "description": "Test CLI document generation"
        },
        {
          "name": "test-template-freshness",
          "run": "cli/privacy-terms-generator list-templates --json | jq -e '.[0].fetched_at'",
          "description": "Test template freshness tracking"
        },
        {
          "name": "test-ui-health",
          "run": "curl -sf http://localhost:${UI_PORT}/health",
          "description": "Test UI health endpoint"
        }
      ]
    },
    "stop": {
      "description": "Stop services",
      "steps": [
        {
          "name": "stop-api",
          "run": "pkill -f \"privacy-terms-generator-api\" || true; sleep 1; pkill -9 -f \"privacy-terms-generator-api\" 2>/dev/null || true",
          "description": "Stop API process"
        },
        {
          "name": "stop-ui",
          "run": "true",
          "description": "Stop UI process"
        }
      ]
    }
  }
}
