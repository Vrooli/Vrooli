{
  "module": "chat-persistence",
  "description": "PostgreSQL storage for chats and messages",
  "requirements": [
    {
      "id": "PERSIST-001",
      "title": "Store chat metadata",
      "description": "Save chat ID, name, model, view mode, labels, timestamps to PostgreSQL",
      "prd_ref": "OT-P0-009",
      "criticality": "P0",
      "status": "complete",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "ref": "api/persistence_test.go"
        },
        {
          "type": "test",
          "phase": "integration",
          "status": "implemented",
          "ref": "bas/flows/basic-chat-flow.json"
        }
      ]
    },
    {
      "id": "PERSIST-002",
      "title": "Store messages",
      "description": "Save all messages with role, content, timestamp, token count to PostgreSQL",
      "prd_ref": "OT-P0-009",
      "criticality": "P0",
      "status": "complete",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "ref": "api/persistence_test.go"
        },
        {
          "type": "test",
          "phase": "integration",
          "status": "implemented",
          "ref": "bas/flows/basic-chat-flow.json"
        }
      ]
    },
    {
      "id": "PERSIST-003",
      "title": "Load chat history",
      "description": "Retrieve full conversation history when opening a chat",
      "prd_ref": "OT-P0-009",
      "criticality": "P0",
      "status": "complete",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "ref": "api/persistence_test.go"
        },
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "ref": "ui/src/App.tsx"
        }
      ]
    },
    {
      "id": "PERSIST-004",
      "title": "Delete chat",
      "description": "Permanently delete chat and all associated messages",
      "prd_ref": "OT-P0-009",
      "criticality": "P0",
      "status": "complete",
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "ref": "api/persistence_test.go"
        },
        {
          "type": "test",
          "phase": "unit",
          "status": "implemented",
          "ref": "ui/src/App.tsx"
        }
      ]
    },
    {
      "id": "PERSIST-005",
      "title": "Export chat",
      "description": "Export chat history to markdown, JSON, or plain text",
      "prd_ref": "OT-P1-005",
      "criticality": "P1",
      "status": "complete",
      "validation": [
        {
          "type": "unit_test",
          "file": "api/chat_test.go",
          "description": "Tests export endpoint for markdown, JSON, txt formats and validation",
          "status": "implemented"
        },
        {
          "type": "code_review",
          "file": "api/handlers/chat.go",
          "description": "ExportChat handler with format support and file download",
          "status": "implemented"
        },
        {
          "type": "code_review",
          "file": "ui/src/components/chat/ChatHeader.tsx",
          "description": "Export dialog UI with format selection",
          "status": "implemented"
        }
      ]
    }
  ]
}
