name: notes
description: Test SmartNotes scenario functionality
version: 1.0.0

tests:
  - name: API Health Check
    type: http
    config:
      url: http://localhost:${SERVICE_PORT}/health
      method: GET
      expected_status: 200
      expected_body:
        status: healthy
        service: smartnotes-api

  - name: Create Note
    type: http
    config:
      url: http://localhost:${SERVICE_PORT}/api/notes
      method: POST
      headers:
        Content-Type: application/json
      body:
        title: Test Note
        content: This is a test note
        user_id: default-user
        content_type: markdown
      expected_status: 201
      expected_fields:
        - id
        - created_at

  - name: List Notes
    type: http
    config:
      url: http://localhost:${SERVICE_PORT}/api/notes?user_id=default-user
      method: GET
      expected_status: 200
      validate_response: |
        Array.isArray(response) && response.length >= 0

  - name: UI Health Check
    type: http
    config:
      url: http://localhost:${UI_PORT}/
      method: GET
      expected_status: 200
      validate_response: |
        response.includes('SmartNotes')

  - name: PostgreSQL Connection
    type: database
    config:
      type: postgres
      query: SELECT COUNT(*) FROM notes
      expected_result: success

  - name: Qdrant Collection Check
    type: http
    config:
      url: http://localhost:${RESOURCE_PORTS[qdrant]}/collections/notes
      method: GET
      expected_status: 200

dependencies:
  - postgres
  - qdrant
  - n8n
  - ollama

timeout: 60