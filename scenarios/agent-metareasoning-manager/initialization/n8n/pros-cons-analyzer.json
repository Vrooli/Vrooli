{
  "name": "Pros and Cons Analyzer",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "analyze-pros-cons",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook_trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Prepare ollama CLI command\nconst input = $input.item.json;\n\nconst prompt = `Analyze the following decision or proposal and create a comprehensive pros and cons list:\n\n${input.input || 'No input provided'}\n\nProvide:\n1. At least 5 pros (advantages, benefits, positive outcomes)\n2. At least 5 cons (disadvantages, risks, negative outcomes)\n3. Weight each item on importance (1-10)\n4. Overall recommendation\n\nFormat as JSON with structure: {pros: [{item, weight, explanation}], cons: [{item, weight, explanation}], recommendation: string, confidence: number}`;\n\n// Build command using CLI\nconst model = input.model || 'llama3.2';\nconst timestamp = Date.now();\nconst randomId = Math.random().toString(36).substring(2, 8);\nconst tempFile = '/tmp/pros_cons_' + timestamp + '_' + randomId + '.txt';\n\n// Escape single quotes in prompt for shell\nconst escapedPrompt = prompt.replace(/'/g, \"'\\\"'\\\"'\");\n\n// Build command string using vrooli CLI\nconst command = 'prompt_file=\"' + tempFile + '\"; ' +\n  'echo \\'' + escapedPrompt + '\\' > \"$prompt_file\"; ' +\n  'vrooli resource ollama generate \"$(cat \"$prompt_file\")\" --model \\'' + model + '\\' --type reasoning --quiet; ' +\n  'rm -f \"$prompt_file\"';\n\nreturn {\n  command: command,\n  model: model,\n  temp_file: tempFile\n};"
      },
      "id": "prepare_ollama_input",
      "name": "Prepare Ollama Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "command": "={{ $json.command }}",
        "options": {
          "timeout": 120000
        }
      },
      "id": "generate_analysis",
      "name": "Generate Pros and Cons",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Get input data and command result\nconst items = $input.all();\nconst preparedInput = $node['Prepare Ollama Input']?.json || {};\nconst commandResult = $node['Generate Pros and Cons']?.json || {};\n\n// Extract the response from command stdout\nconst responseText = commandResult.stdout || '{}';\n\n// Parse response with error handling\nlet response = { pros: [], cons: [], recommendation: '', confidence: 0 };\ntry {\n  response = JSON.parse(responseText);\n} catch (error) {\n  // Return error if parsing fails\n  return [{\n    json: {\n      error: true,\n      message: 'Failed to parse analysis response',\n      original_response: responseText,\n      exit_code: commandResult.exitCode,\n      stderr: commandResult.stderr,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}\n\n// Ensure arrays exist with fallbacks\nconst pros = response.pros || [];\nconst cons = response.cons || [];\n\n// Calculate weighted scores safely\nconst prosScore = pros.reduce((sum, p) => sum + (p?.weight || 0), 0);\nconst consScore = cons.reduce((sum, c) => sum + (c?.weight || 0), 0);\nconst netScore = prosScore - consScore;\nconst totalScore = prosScore + consScore;\nconst recommendationStrength = totalScore > 0 ? Math.abs(netScore) / totalScore : 0;\n\nreturn [{\n  json: {\n    analysis: response,\n    scores: {\n      pros_total: prosScore,\n      cons_total: consScore,\n      net_score: netScore,\n      recommendation_strength: recommendationStrength\n    },\n    timestamp: new Date().toISOString(),\n    model_used: preparedInput.model || 'llama3.2',\n    execution_success: commandResult.exitCode === 0\n  }\n}];"
      },
      "id": "process_results",
      "name": "Process and Score",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300]
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "execution_history",
        "columns": "resource_type,resource_id,input_data,output_data,execution_time_ms,status,model_used",
        "returnFields": "id"
      },
      "id": "save_history",
      "name": "Save to History",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "status",
              "value": "success"
            }
          ]
        },
        "options": {}
      },
      "id": "response",
      "name": "Send Response",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [1250, 300]
    }
  ],
  "connections": {
    "webhook_trigger": {
      "main": [[{"node": "prepare_ollama_input", "type": "main", "index": 0}]]
    },
    "prepare_ollama_input": {
      "main": [[{"node": "generate_analysis", "type": "main", "index": 0}]]
    },
    "generate_analysis": {
      "main": [[{"node": "process_results", "type": "main", "index": 0}]]
    },
    "process_results": {
      "main": [[{"node": "save_history", "type": "main", "index": 0}]]
    },
    "save_history": {
      "main": [[{"node": "response", "type": "main", "index": 0}]]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "id": "pros-cons-analyzer"
}