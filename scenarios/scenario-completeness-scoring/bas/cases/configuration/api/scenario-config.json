{
  "metadata": {
    "name": "Configuration Update E2E Test",
    "description": "Tests updating global configuration (weights and toggles)",
    "tags": ["e2e", "api", "configuration"],
    "requirements": ["SCS-CFG-004"],
    "reset": "none"
  },
  "settings": {},
  "nodes": [
    {
      "id": "1",
      "type": "http_request",
      "data": {
        "label": "Reset configuration to defaults",
        "method": "POST",
        "url": "{{API_URL}}/api/v1/config/reset",
        "headers": {
          "Content-Type": "application/json"
        },
        "assertions": [
          {"type": "status_code", "expected": 200},
          {"type": "json_path", "path": "$.success", "expected": true},
          {"type": "json_path_exists", "path": "$.config"}
        ]
      }
    },
    {
      "id": "2",
      "type": "http_request",
      "data": {
        "label": "Update configuration weights",
        "method": "PUT",
        "url": "{{API_URL}}/api/v1/config",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "version": "1.0.0",
          "components": {
            "quality": {"enabled": true, "requirement_pass_rate": true, "target_pass_rate": true, "test_pass_rate": true},
            "coverage": {"enabled": true, "test_coverage_ratio": true, "requirement_depth": true},
            "quantity": {"enabled": true, "requirements": true, "targets": true, "tests": true},
            "ui": {"enabled": true, "template_detection": true, "component_complexity": true, "api_integration": true, "routing": true, "code_volume": true}
          },
          "penalties": {
            "enabled": true,
            "insufficient_test_coverage": true,
            "invalid_test_location": true,
            "monolithic_test_files": true,
            "single_layer_validation": true,
            "target_mapping_ratio": true,
            "superficial_test_implementation": true,
            "manual_validations": true
          },
          "circuit_breaker": {"enabled": true, "fail_threshold": 3, "retry_interval_seconds": 300, "auto_disable": true},
          "weights": {"quality": 40, "coverage": 20, "quantity": 20, "ui": 20}
        },
        "assertions": [
          {"type": "status_code", "expected": 200},
          {"type": "json_path", "path": "$.success", "expected": true}
        ]
      }
    },
    {
      "id": "3",
      "type": "http_request",
      "data": {
        "label": "Verify configuration saved",
        "method": "GET",
        "url": "{{API_URL}}/api/v1/config",
        "assertions": [
          {"type": "status_code", "expected": 200},
          {"type": "json_path", "path": "$.config.weights.quality", "expected": 40},
          {"type": "json_path", "path": "$.config.weights.ui", "expected": 20}
        ]
      }
    }
  ],
  "edges": [
    {"id": "e1", "source": "1", "target": "2", "type": "smoothstep"},
    {"id": "e2", "source": "2", "target": "3", "type": "smoothstep"}
  ]
}
