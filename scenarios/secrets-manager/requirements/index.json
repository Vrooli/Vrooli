{
  "_metadata": {
    "description": "Secrets Manager operational requirements aligned with the minimal PRD (v2.0)",
    "schema_version": "1.0.0",
    "auto_sync_enabled": true,
    "last_validated_at": "",
    "last_synced_at": "2025-11-18T20:49:02.389Z"
  },
  "meta": {
    "scenario": "secrets-manager",
    "version": "2024.11",
    "generated": "2024-11-19",
    "owners": [
      {
        "team": "Vrooli Security",
        "contact": "security@vrooli.dev"
      }
    ]
  },
  "imports": [],
  "requirements": [
    {
      "id": "SEC-VLT-001",
      "category": "vault-intelligence",
      "title": "Repository secret manifest discovery",
      "description": "Enumerate every config/secrets manifest across scenarios/resources and normalize keys + metadata for downstream validation.",
      "prd_ref": "Operational Targets > P0 > OT-P0-001",
      "status": "complete",
      "tags": [
        "vault",
        "discovery",
        "cli"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "command": "go test ./api -run TestParseVaultConfig",
          "ref": "api/scanner_test.go",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-VLT-002",
      "category": "vault-intelligence",
      "title": "Persist secret requirements in Postgres",
      "description": "Create and maintain the resource_secrets / secret_validations tables plus seeding scripts that describe each required secret.",
      "prd_ref": "Operational Targets > P0 > OT-P0-001",
      "status": "complete",
      "tags": [
        "postgres",
        "schema"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "structure",
          "command": "test -f initialization/storage/postgres/schema.sql && test -f initialization/storage/postgres/seed.sql",
          "ref": "test/phases/test-structure.sh",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-VLT-003",
      "category": "vault-intelligence",
      "title": "Vault CLI integration with graceful fallback",
      "description": "Drive `resource-vault secrets validate/check` for canonical status and fall back to local parsing when CLI output is unavailable.",
      "prd_ref": "Operational Targets > P0 > OT-P0-001",
      "status": "complete",
      "tags": [
        "vault",
        "cli",
        "fallback"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "command": "go test ./api -run TestVaultValidation",
          "ref": "api/validator_test.go",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-VLT-004",
      "category": "vault-intelligence",
      "title": "Vault health endpoint",
      "description": "Expose `/api/v1/vault/secrets/status` with totals, missing secrets, timestamps, and per-resource health that other surfaces can consume.",
      "prd_ref": "Operational Targets > P0 > OT-P0-001",
      "status": "not_implemented",
      "tags": [
        "api",
        "vault"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "command": "go test ./api -run TestVaultSecretsStatusHandler",
          "ref": "api/main_test.go:62",
          "status": "not_implemented"
        },
        {
          "type": "test",
          "phase": "business",
          "command": "curl -s http://localhost:16738/api/v1/vault/secrets/status | jq .total_resources",
          "ref": ".vrooli/endpoints.json:23",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-VLT-006",
      "category": "vault-intelligence",
      "title": "Resource secrets workspace",
      "description": "Provide per-resource views with secret lists, owners, rotation notes, and inline actions to sync or open provisioning flows.",
      "prd_ref": "Operational Targets > P0 > OT-P0-001",
      "status": "complete",
      "tags": [
        "ui",
        "vault",
        "inventory"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Open UI and navigate to resource secrets view",
          "ref": "ui/src/components/VaultCoverage.tsx",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-SCAN-001",
      "category": "security-scanning",
      "title": "Cross-scenario code scanning",
      "description": "Scan Go/TypeScript files for hardcoded secrets, SQL injection, and http misuse with component metadata for each finding.",
      "prd_ref": "Operational Targets > P0 > OT-P0-002",
      "status": "not_implemented",
      "tags": [
        "scanner",
        "code",
        "security"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "business",
          "command": "curl -s http://localhost:16738/api/v1/security/vulnerabilities | jq .total_count",
          "ref": ".vrooli/endpoints.json:46",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-SCAN-002",
      "category": "security-scanning",
      "title": "Risk scoring and severity weighting",
      "description": "Calculate overall risk and per-vulnerability severity counts so compliance consumers see the weighted exposure.",
      "prd_ref": "Operational Targets > P0 > OT-P0-002",
      "status": "not_implemented",
      "tags": [
        "scoring",
        "analytics"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "business",
          "command": "curl -s http://localhost:16738/api/v1/security/vulnerabilities | jq .scan_metadata.risk_score",
          "ref": "api/main.go:1757",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-SCAN-004",
      "category": "security-scanning",
      "title": "Remediation intelligence",
      "description": "Attach remediation steps, ownership hints, and jump-to-code links for every vulnerability so operators know the next best action.",
      "prd_ref": "Operational Targets > P0 > OT-P0-002",
      "status": "complete",
      "tags": [
        "security",
        "remediation",
        "ux"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Check vulnerability response includes remediation field",
          "ref": "api/main.go",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-COMP-001",
      "category": "compliance",
      "title": "Unified compliance aggregator",
      "description": "Blend vault coverage, vulnerability stats, and risk scores into `/security/compliance` for dashboard + CLI consumption.",
      "prd_ref": "Operational Targets > P0 > OT-P0-003",
      "status": "not_implemented",
      "tags": [
        "compliance",
        "api"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "command": "go test ./api -run TestComplianceHandler",
          "ref": "api/main_test.go:294",
          "status": "not_implemented"
        },
        {
          "type": "test",
          "phase": "business",
          "command": "curl -s http://localhost:16738/api/v1/security/compliance | jq .risk_score",
          "ref": ".vrooli/endpoints.json:79",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-OPS-001",
      "category": "operations",
      "title": "Lifecycle health instrumentation",
      "description": "Expose `/health` plus lifecycle metadata so the orchestrator can monitor API/UI availability and restart as needed.",
      "prd_ref": "Operational Targets > P0 > OT-P0-003",
      "status": "not_implemented",
      "tags": [
        "lifecycle",
        "health"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "unit",
          "command": "go test ./api -run TestHealthHandler",
          "ref": "api/main_test.go:47",
          "status": "not_implemented"
        },
        {
          "type": "test",
          "phase": "business",
          "command": "curl -s http://localhost:16738/health | jq .status",
          "ref": ".vrooli/endpoints.json:7",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-DEP-001",
      "category": "deployment",
      "title": "Tier strategy metadata",
      "description": "Store per-tier handling strategies (strip/generate/prompt/delegate) for every secret and surface them via API + CLI.",
      "prd_ref": "Operational Targets > P0 > OT-P0-003",
      "status": "complete",
      "tags": [
        "deployment",
        "metadata"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Verify tier strategy fields exist in schema.sql",
          "ref": "initialization/storage/postgres/schema.sql",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-DEP-002",
      "category": "deployment",
      "title": "Bundle manifest export",
      "description": "Generate machine-readable bundles describing selected secrets, tiers, prompts, and generators for deployment-manager and scenario-to-*.",
      "prd_ref": "Operational Targets > P0 > OT-P0-003",
      "status": "complete",
      "tags": [
        "deployment",
        "manifest",
        "api"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "business",
          "command": "curl -s -X POST http://localhost:16739/api/v1/deployment/secrets -H 'Content-Type: application/json' -d '{\"scenario\":\"test\",\"tier\":\"desktop\"}' | jq .secrets",
          "ref": ".vrooli/endpoints.json:134",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-DEP-003",
      "category": "deployment",
      "title": "Deployment-manager handshake",
      "description": "Expose `/deployment/secrets` + webhook push so deployment-manager can visualize plans, request updates, and confirm readiness.",
      "prd_ref": "Operational Targets > P0 > OT-P0-003",
      "status": "complete",
      "tags": [
        "deployment",
        "api",
        "integration"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "business",
          "command": "curl -s -X POST http://localhost:16739/api/v1/deployment/secrets -H 'Content-Type: application/json' -d '{\"scenario\":\"test\",\"tier\":\"desktop\"}' | jq .scenario",
          "ref": ".vrooli/endpoints.json:134",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-DEP-004",
      "category": "deployment",
      "title": "Scenario-to-* integration",
      "description": "Provide SDK/CLI helpers so scenario-to-desktop/mobile/cloud can request tier manifests and receive scoped secrets during packaging.",
      "prd_ref": "Operational Targets > P0 > OT-P0-003",
      "status": "complete",
      "tags": [
        "deployment",
        "sdk"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Check CLI help includes deployment commands",
          "ref": "cli/secrets-manager",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-VLT-005",
      "category": "vault-intelligence",
      "title": "Guided provisioning API",
      "description": "Enable `/vault/secrets/provision` (and CLI helper) to accept secret payloads, write to Vault, and trigger validation refreshes.",
      "prd_ref": "Operational Targets > P1 > OT-P1-001",
      "status": "complete",
      "tags": [
        "vault",
        "provisioning"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "business",
          "command": "curl -s -X POST http://localhost:16739/api/v1/secrets/provision -H 'Content-Type: application/json' -d '{\"resource\":\"test\",\"secrets\":{}}' | jq .status",
          "ref": ".vrooli/endpoints.json:117",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-CLI-001",
      "category": "cli",
      "title": "CLI status proxy",
      "description": "`secrets-manager status` should call `/health`, respect env/config overrides, and emit JSON for automation.",
      "prd_ref": "Operational Targets > P1 > OT-P1-004",
      "status": "not_implemented",
      "tags": [
        "cli",
        "health"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "command": "./cli/secrets-manager status --json",
          "ref": "cli/secrets-manager",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-CLI-002",
      "category": "cli",
      "title": "CLI wrappers for vault/compliance/vulnerabilities",
      "description": "Expose thin commands that forward filters to the API instead of re-implementing parsing or data munging locally.",
      "prd_ref": "Operational Targets > P1 > OT-P1-004",
      "status": "not_implemented",
      "tags": [
        "cli",
        "api"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "integration",
          "command": "./cli/secrets-manager vault list && ./cli/secrets-manager vulnerabilities list",
          "ref": "cli/secrets-manager",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-UI-001",
      "category": "ui",
      "title": "Dashboard hero metrics",
      "description": "Show top-line counts (configured resources, risk score, missing secrets) sourced directly from compliance + vault endpoints.",
      "prd_ref": "Operational Targets > P1 > OT-P1-002",
      "status": "not_implemented",
      "tags": [
        "ui",
        "dashboard"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Open UI dashboard and verify hero metrics display",
          "ref": "ui/src/App.tsx",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-UI-002",
      "category": "ui",
      "title": "Vault coverage module",
      "description": "Display per-resource coverage bars, severity badges, and missing secret callouts with automatic refresh via React Query.",
      "prd_ref": "Operational Targets > P1 > OT-P1-002",
      "status": "not_implemented",
      "tags": [
        "ui",
        "vault"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Open UI and verify VaultCoverage component renders",
          "ref": "ui/src/components/VaultCoverage.tsx",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-UI-003",
      "category": "ui",
      "title": "Vulnerability filter panel",
      "description": "Allow filtering by severity, component, or type with responsive tables that mirror the `/vulnerabilities` API params.",
      "prd_ref": "Operational Targets > P1 > OT-P1-002",
      "status": "not_implemented",
      "tags": [
        "ui",
        "filters"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Open UI and verify vulnerability filters work",
          "ref": "ui/src/components/VulnerabilityList.tsx",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-UI-004",
      "category": "ui",
      "title": "Compliance callout",
      "description": "Highlight the blended risk score with textual guidance plus iconography that reflects severity thresholds.",
      "prd_ref": "Operational Targets > P1 > OT-P1-002",
      "status": "not_implemented",
      "tags": [
        "ui",
        "compliance"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Open UI and verify compliance callout displays risk score",
          "ref": "ui/src/components/ComplianceOverview.tsx",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-UX-001",
      "category": "ui",
      "title": "Accessible dark-chrome theme",
      "description": "Apply consistent typography, contrast, and motion guidelines so the cyberpunk aesthetic still passes WCAG AA.",
      "prd_ref": "Operational Targets > P1 > OT-P1-002",
      "status": "complete",
      "tags": [
        "ux",
        "branding"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "performance",
          "command": "Lighthouse accessibility score >= 90%",
          "ref": "test/phases/test-performance.sh",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-UX-002",
      "category": "ui",
      "title": "Orientation landing hub",
      "description": "Design the home view with hero stats, deployment readiness tiles, and journey cards (configure secrets, fix vulns, prep deployments).",
      "prd_ref": "Operational Targets > P0 > OT-P0-004",
      "status": "complete",
      "tags": [
        "ux",
        "dashboard"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Verify Dashboard component displays hero metrics",
          "ref": "ui/src/App.tsx",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-UX-003",
      "category": "ui",
      "title": "Guided remedial flows",
      "description": "Provide multi-step wizards for each journey so operators move from detection to resolution with progress indicators and contextual help.",
      "prd_ref": "Operational Targets > P0 > OT-P0-004",
      "status": "complete",
      "tags": [
        "ux",
        "flows"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Check UI includes wizard components",
          "ref": "ui/src/App.tsx",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-UX-004",
      "category": "ui",
      "title": "Contextual action rail",
      "description": "Every table/detail panel should surface the next action (open provisioning, file issue, run scan) with inline status + blockers.",
      "prd_ref": "Operational Targets > P0 > OT-P0-004",
      "status": "complete",
      "tags": [
        "ux",
        "actions"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Verify action buttons present in table components",
          "ref": "ui/src/App.tsx",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-DATA-001",
      "category": "data",
      "title": "Historical validation telemetry",
      "description": "Track secret validation runs + scan events over time to power compliance deltas and future analytics.",
      "prd_ref": "Operational Targets > P1 > OT-P1-003",
      "status": "not_implemented",
      "tags": [
        "postgres",
        "telemetry"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Verify telemetry tables exist in schema.sql",
          "ref": "initialization/storage/postgres/schema.sql",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-SCAN-003",
      "category": "security-scanning",
      "title": "File content gateway",
      "description": "Provide a secure `/files/content` endpoint for reviewing snippets referenced by vulnerabilities with path safeguards.",
      "prd_ref": "Operational Targets > P1 > OT-P1-003",
      "status": "planned",
      "tags": [
        "security",
        "files"
      ],
      "validation": [
        {
          "type": "manual",
          "phase": "integration",
          "command": "Test /files/content endpoint with valid path",
          "ref": "api/main.go",
          "status": "not_implemented"
        }
      ]
    },
    {
      "id": "SEC-OPS-002",
      "category": "operations",
      "title": "Schema + seed automation",
      "description": "Lifecycle `setup` must run schema + seed SQL files and remain idempotent so agents can reset environments quickly.",
      "prd_ref": "Operational Targets > P1 > OT-P1-005",
      "status": "complete",
      "tags": [
        "lifecycle",
        "database"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "structure",
          "command": "test -f initialization/storage/postgres/schema.sql && test -f .vrooli/service.json",
          "ref": ".vrooli/service.json",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-TEST-001",
      "category": "operations",
      "title": "Phased testing alignment",
      "description": "`test/run-tests.sh` must execute structure/unit/integration/performance phases and emit artifacts referencing `[REQ:ID]` tags.",
      "prd_ref": "Operational Targets > P1 > OT-P1-005",
      "status": "complete",
      "tags": [
        "testing",
        "phased"
      ],
      "validation": [
        {
          "type": "test",
          "phase": "structure",
          "command": "test -x test/run-tests.sh && test -d test/phases",
          "ref": "test/run-tests.sh",
          "status": "implemented"
        }
      ]
    },
    {
      "id": "SEC-AUTO-001",
      "category": "future",
      "title": "Auto-remediation suggestions",
      "description": "Surface remediation text or trigger claude-code agents that can automatically patch common vulnerability classes.",
      "prd_ref": "Operational Targets > P2 > OT-P2-001",
      "status": "planned",
      "tags": [
        "ai",
        "remediation"
      ],
      "validation": []
    },
    {
      "id": "SEC-AUTO-002",
      "category": "future",
      "title": "Trend analytics",
      "description": "Compute and display rolling averages plus anomaly detection for risk scores and vault coverage deltas.",
      "prd_ref": "Operational Targets > P2 > OT-P2-002",
      "status": "planned",
      "tags": [
        "analytics",
        "trend"
      ],
      "validation": []
    },
    {
      "id": "SEC-POL-001",
      "category": "future",
      "title": "Policy gating hooks",
      "description": "Expose an API/CLI to block deployments or scenario actions until secrets + security thresholds are satisfied.",
      "prd_ref": "Operational Targets > P2 > OT-P2-003",
      "status": "planned",
      "tags": [
        "policy",
        "integration"
      ],
      "validation": []
    },
    {
      "id": "SEC-CLI-003",
      "category": "future",
      "title": "CI-friendly export",
      "description": "Provide a CLI/API command that exports validated secrets and vulnerability summaries for CI pipelines without manual parsing.",
      "prd_ref": "Operational Targets > P2 > OT-P2-003",
      "status": "planned",
      "tags": [
        "cli",
        "ci"
      ],
      "validation": []
    }
  ],
  "reporting": {
    "phases": [
      {
        "name": "structure",
        "runner": "test/phases/test-structure.sh"
      },
      {
        "name": "unit",
        "runner": "api"
      },
      {
        "name": "integration",
        "runner": "test/run-tests.sh"
      }
    ]
  }
}
