name: resource-improver
description: Continuous improvement system for existing Vrooli resources
version: 1.0.0

resources:
  required:
    - postgres
    - claude-code

tests:
  - name: Database Connection
    type: connectivity
    target: postgres
    config:
      database: postgres
      timeout: 30
    
  - name: Database Schema Check
    type: postgres
    operation: SELECT
    query: SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name IN ('resource_reports', 'improvement_suggestions', 'resource_metrics')
    expected:
      rows: 3
      
  - name: API Health Check
    type: http
    method: GET
    url: http://localhost:${API_PORT}/health
    expected:
      status: 200
      body:
        status: healthy
        
  - name: Resources List API
    type: http
    method: GET
    url: http://localhost:${API_PORT}/api/resources/list
    expected:
      status: 200
      
  - name: Queue Status API
    type: http
    method: GET
    url: http://localhost:${API_PORT}/api/queue/status
    expected:
      status: 200
      
  - name: Submit Improvement API
    type: http
    method: POST
    url: http://localhost:${API_PORT}/api/improvement/submit
    body:
      title: Test Improvement
      description: Test resource improvement submission
      type: health-check
      target: postgres
      priority: medium
    expected:
      status: 201
      body:
        status: created
        
  - name: Start Improvement API
    type: http
    method: POST
    url: http://localhost:${API_PORT}/api/improvement/start
    body: {}
    expected:
      status: 200
      
  - name: Claude Code Health Check
    type: command
    command: resource-claude-code status
    expected:
      exit_code: 0
      
validation:
  startup:
    timeout: 60
    health_checks:
      - service: postgres
        port: ${RESOURCE_PORTS[postgres]}
      - service: api
        port: ${API_PORT}
        
  runtime:
    monitoring:
      - metric: active_improvements
        threshold: 50
      - metric: database_connections
        threshold: 10
        
  cleanup:
    commands:
      - echo "Cleaning up test data..."