version: 1.0
scenario: financial-calculators-hub

# Structure validation
structure:
  required_files:
    - .vrooli/service.json
    - PRD.md
    - api/main.go
    - api/go.mod
    - lib/calculators.go
    - cli/financial-calculators-hub
    - cli/install.sh
    - ui/package.json
    - ui/src/App.jsx
    - scenario-test.yaml
    - README.md
    
  required_dirs:
    - api
    - cli
    - lib
    - ui
    - ui/src
    - ui/src/components

# Resource validation
resources:
  required: []
  optional: [postgres, redis, ollama]
  health_timeout: 60

# Declarative tests
tests:
  # API health check
  - name: "API health check"
    type: http
    service: api
    endpoint: /health
    method: GET
    expect:
      status: 200
      body:
        status: healthy
        service: financial-calculators-hub
      
  # FIRE calculation test
  - name: "FIRE calculation accuracy test"
    type: http
    service: api
    endpoint: /api/v1/calculate/fire
    method: POST
    body:
      current_age: 30
      current_savings: 100000
      annual_income: 100000
      annual_expenses: 50000
      savings_rate: 50
      expected_return: 7
      target_withdrawal_rate: 4
    expect:
      status: 200
      body_contains:
        - retirement_age
        - years_to_retirement
        - target_nest_egg
        - monthly_savings_required
        
  # Compound interest calculation test
  - name: "Compound interest calculation test"
    type: http
    service: api
    endpoint: /api/v1/calculate/compound-interest
    method: POST
    body:
      principal: 10000
      annual_rate: 7
      years: 10
      monthly_contribution: 500
      compound_frequency: monthly
    expect:
      status: 200
      body_contains:
        - final_amount
        - total_contributions
        - total_interest
        - year_by_year
        
  # Mortgage calculation test
  - name: "Mortgage calculation test"
    type: http
    service: api
    endpoint: /api/v1/calculate/mortgage
    method: POST
    body:
      loan_amount: 300000
      annual_rate: 4.5
      years: 30
      down_payment: 60000
      extra_monthly_payment: 0
    expect:
      status: 200
      body_contains:
        - monthly_payment
        - total_interest
        - total_paid
        - payoff_date
        - amortization_schedule
        
  # Inflation calculation test
  - name: "Inflation calculation test"
    type: http
    service: api
    endpoint: /api/v1/calculate/inflation
    method: POST
    body:
      amount: 100000
      years: 20
      inflation_rate: 3
    expect:
      status: 200
      body_contains:
        - future_value
        - purchasing_power
        - total_inflation
        
  # CLI command tests
  - name: "CLI status command"
    type: exec
    command: ./cli/financial-calculators-hub status
    expect:
      exit_code: 0
      output_contains: ["status", "healthy"]
      
  - name: "CLI help command"
    type: exec
    command: ./cli/financial-calculators-hub help
    expect:
      exit_code: 0
      output_contains: ["Financial Calculators Hub CLI", "Commands:", "fire", "compound", "mortgage", "inflation"]
      
  - name: "CLI version command"
    type: exec
    command: ./cli/financial-calculators-hub version
    expect:
      exit_code: 0
      output_contains: ["Financial Calculators Hub v1.0.0"]
      
  - name: "CLI FIRE calculation"
    type: exec
    command: ./cli/financial-calculators-hub fire --age 30 --savings 100000 --income 100000 --expenses 50000 --json
    expect:
      exit_code: 0
      output_contains: ["retirement_age", "years_to_retirement"]
      
  # UI health check
  - name: "UI server responds"
    type: http
    service: ui
    endpoint: /
    method: GET
    expect:
      status: 200
      
  # Validation of calculator accuracy
  - name: "Validate compound interest calculation accuracy"
    type: http
    service: api
    endpoint: /api/v1/calculate/compound-interest
    method: POST
    body:
      principal: 1000
      annual_rate: 10
      years: 1
      monthly_contribution: 0
      compound_frequency: annually
    expect:
      status: 200
      body:
        final_amount: 1100  # Should be exactly 1100 for 10% annual on 1000
        
  - name: "Validate mortgage PMT formula"
    type: http
    service: api
    endpoint: /api/v1/calculate/mortgage
    method: POST
    body:
      loan_amount: 100000
      annual_rate: 6
      years: 30
      down_payment: 0
      extra_monthly_payment: 0
    expect:
      status: 200
      body_contains:
        - monthly_payment
      # Standard mortgage payment should be around $599.55

# Performance tests
performance:
  - name: "API response time"
    type: http
    service: api
    endpoint: /api/v1/calculate/fire
    method: POST
    body:
      current_age: 30
      current_savings: 100000
      annual_income: 100000
      annual_expenses: 50000
      savings_rate: 50
      expected_return: 7
      target_withdrawal_rate: 4
    expect:
      max_response_time_ms: 50
      
  - name: "Bulk calculation performance"
    type: http
    service: api
    endpoint: /api/v1/calculate/compound-interest
    method: POST
    body:
      principal: 10000
      annual_rate: 7
      years: 50
      monthly_contribution: 1000
      compound_frequency: monthly
    repeat: 100
    expect:
      avg_response_time_ms: 50
      max_response_time_ms: 100