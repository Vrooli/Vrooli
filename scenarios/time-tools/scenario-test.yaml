version: 1.0
scenario: time-tools

structure:
  required_files:
    - service.json
    - PRD.md
    - README.md
    - api/main.go
    - api/handlers.go
    - api/models.go
    - api/database.go
    - api/go.mod
    - cli/time-tools
    - ui/index.html
    - initialization/storage/postgres/schema.sql
    - test/test-basic-functionality.sh
    - scenario-test.yaml

resources:
  required: [postgres, redis]
  optional: [minio]
  health_timeout: 60

tests:
  - name: "API health check"
    type: http
    service: api
    endpoint: /api/v1/health
    method: GET
    expect:
      status: 200
      body:
        status: healthy
        service: time-tools

  - name: "Timezone conversion functionality"
    type: http
    service: api
    endpoint: /api/v1/time/convert
    method: POST
    body:
      time: "2024-01-15T10:00:00Z"
      from_timezone: "UTC"
      to_timezone: "America/New_York"
    expect:
      status: 200
      body:
        from_timezone: "UTC"
        to_timezone: "America/New_York"

  - name: "Duration calculation works"
    type: http
    service: api
    endpoint: /api/v1/time/duration
    method: POST
    body:
      start_time: "2024-01-15T09:00:00Z"
      end_time: "2024-01-15T17:00:00Z"
      exclude_weekends: false
    expect:
      status: 200
      body:
        total_hours: 8.0

  - name: "Schedule optimization endpoint"
    type: http
    service: api
    endpoint: /api/v1/schedule/optimal
    method: POST
    body:
      participants: ["alice", "bob"]
      duration_minutes: 60
      timezone: "UTC"
      earliest_date: "2024-01-15"
      latest_date: "2024-01-22"
    expect:
      status: 200
      body:
        optimal_slots: [type: array]

  - name: "Conflict detection functionality"
    type: http
    service: api
    endpoint: /api/v1/schedule/conflicts
    method: POST
    body:
      organizer_id: "test_user"
      start_time: "2024-01-15T14:00:00Z"
      end_time: "2024-01-15T15:00:00Z"
    expect:
      status: 200
      body:
        has_conflicts: [type: boolean]
        conflict_count: [type: number]

  - name: "Time formatting endpoint"
    type: http
    service: api
    endpoint: /api/v1/time/format
    method: POST
    body:
      time: "2024-01-15T10:00:00Z"
      format: "human"
      timezone: "America/New_York"
    expect:
      status: 200
      body:
        formatted: [type: string]

  - name: "CLI help command"
    type: cli
    command: time-tools help
    expect:
      exit_code: 0
      stdout_contains: "Time Tools CLI"

  - name: "CLI version command"
    type: cli
    command: time-tools version
    expect:
      exit_code: 0
      stdout_contains: "time-tools CLI"

  - name: "CLI status command"
    type: cli
    command: time-tools status
    expect:
      exit_code: 0

  - name: "CLI timezone conversion"
    type: cli
    command: time-tools convert '2024-01-15T10:00:00Z' UTC 'America/New_York'
    expect:
      exit_code: 0
      stdout_contains: "Timezone Conversion"

  - name: "CLI duration calculation"
    type: cli
    command: time-tools duration '2024-01-15T09:00:00Z' '2024-01-15T17:00:00Z'
    expect:
      exit_code: 0
      stdout_contains: "Duration Calculation"

  - name: "Go build succeeds"
    type: build
    language: go
    working_dir: api
    command: go build -o time-tools-api
    expect:
      exit_code: 0
      artifacts: [time-tools-api]

  - name: "Integration test suite"
    type: script
    script: test/test-basic-functionality.sh
    expect:
      exit_code: 0
      stdout_contains: "All tests passed"

quality_gates:
  - name: "All core endpoints functional"
    criteria: "All HTTP API tests pass"
  - name: "CLI commands work"
    criteria: "All CLI tests pass"
  - name: "Build system works"
    criteria: "Go build succeeds"
  - name: "Integration tests pass"
    criteria: "test-basic-functionality.sh passes"

performance:
  response_time:
    timezone_conversion: 100ms
    duration_calculation: 50ms
    schedule_optimization: 500ms
  throughput:
    min_rps: 10
    target_rps: 50