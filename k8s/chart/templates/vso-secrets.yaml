{{- if and .Values.vso.enabled .Values.vso.secrets -}}
{{- range $secretKeyName, $secretConfig := .Values.vso.secrets -}}
{{- if $secretConfig.enabled -}}
---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: {{ include "vrooli.fullname" $ }}-{{ $secretConfig.k8sSecretName | default $secretKeyName }}
  namespace: {{ $.Release.Namespace }}
  labels:
    {{- include "vrooli.labels" $ | nindent 4 }}
spec:
  vaultAuthRef: {{ $secretConfig.vaultAuthRef | default (printf "%s-vault-auth" (include "vrooli.fullname" $)) }}
  mount: secret # KV secrets engine mount path
  type: kv-v2 # Secret type
  # path is the secret path in Vault (without the mount and /data/ prefix for KV v2)
  path: {{ $secretConfig.vaultPath | replace "secret/data/" "" | quote }}

  # Optional: Specify how often VSO should resync the secret from Vault
  # refreshAfter: "1h"

  # Configuration for the destination Kubernetes Secret
  destination:
    name: {{ $secretConfig.k8sSecretName | default $secretKeyName | quote }}
    create: true
    # Type of the Kubernetes Secret (e.g., Opaque, kubernetes.io/tls, kubernetes.io/dockerconfigjson)
    type: {{ $secretConfig.type | default "Opaque" | quote }}

  # If specific templating is needed (e.g., for .dockerconfigjson)
  {{- if $secretConfig.templates }}
  templates:
    {{- toYaml $secretConfig.templates | nindent 4 }}
  {{- end }}
{{- end -}}
{{- end -}}
{{- end }}

{{- /* Add other VaultSecret definitions here as needed */ -}} 