# Quick production values
nameOverride: ""
fullnameOverride: "vrooli"

image:
  registry: "docker.io/${DOCKER_HUB_USERNAME:-matthalloran8}"
  tag: "2.0.0"
  pullPolicy: Always

imagePullSecrets:
  - name: "dockerhub-secret"

replicaCount:
  ui: 2
  server: 2
  jobs: 1

services:
  ui:
    repository: vrooli-ui
    tag: "2.0.0"
    type: ClusterIP
    port: 3000
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
    
  server:
    repository: vrooli-server
    tag: "2.0.0"
    type: ClusterIP
    port: 5329
    env:
      NODE_ENV: "production"
      PORT_API: "5329"
      API_URL: "https://vrooli.com/api"
      UI_URL: "https://vrooli.com"
      CREATE_MOCK_DATA: "false"
    resources:
      requests:
        cpu: "200m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
    
  jobs:
    repository: vrooli-jobs
    tag: "2.0.0"
    type: ClusterIP
    port: 4001
    env:
      NODE_ENV: "production"
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

# Disable features we don't need
adminer:
  enabled: false

postgresql:
  enabled: false

redis:
  enabled: false

pgoPostgresql:
  enabled: false

spotahomeRedis:
  enabled: false

vso:
  enabled: false

# External database configuration
externalDatabase:
  enabled: true
  existingSecret: "postgres-credentials"

externalRedis:
  enabled: true
  existingSecret: "redis-credentials"

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
  hosts:
    - host: vrooli.com
      paths:
        - path: /api
          pathType: Prefix
          service: server
          port: 5329
        - path: /
          pathType: Prefix
          service: ui
          port: 3000
  tls:
    - secretName: vrooli-tls
      hosts:
        - vrooli.com

# Security
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Health checks
healthChecks:
  enabled: true
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
  readinessProbe:
    initialDelaySeconds: 15
    periodSeconds: 5