# Payments With Stripe
We use Stripe to process payments. This includes:  
- Premium plans
- Donations
- API credits

In this guide, we'll walk through how to set up Stripe for use in this application.

**NOTE:** Stripe has a [test environment and a production environment](https://stripe.com/docs/keys#test-live-modes). You'll need to set up both environments if you want to test and deploy the application. You can switch between these in the Stripe dashboard by toggling the *Test mode* switch in the top right corner.

## Create a Stripe Account
1. Go to [Stripe's website](https://stripe.com/) and click "Start Now" to create an account.
2. Enter your email, full name, password, and click "Create Account."
3. Complete the onboarding process by providing the required business information.

## Create Products
In both your test and production environment, you need to create Products and Prices. Currently, we offer a premium plan, which is a product with multiple prices (monthly and yearly). We also offer API credits, which is a product with a single price, and donations, which is also product with a single price.

Here is how to create a product:  
1. In the Stripe dashboard, navigate to "Products" in the sidebar.
2. Click "Add product," fill out the details for your product (including prices), and save.
3. After creating the product, you can add new prices by clicking the product, clicking "Add another price," entering the desired price, and saving. 
4. Repeat these steps for all necessary products and prices.

**NOTE:** You cannot change the price of a Price object after it has been created. If you need to change the price, you'll need to create a new Price object, migrate any subscriptions to the new price, and archive the old one.

## Enable Customer Portal
The Stripe Customer Portal allows customers to manage their own subscriptions and payment methods. To access the portal, we must send the customer a link to the portal through their email. This link is generated by Stripe and is unique to each customer.

To enable the Customer Portal (do this for both test and production environments):
1. In the Stripe dashboard, navigate to "Settings."
2. Scroll down and click on "Customer portal."
3. Make sure that the following options are enabled: 
    - Invoice history
    - Customer information, minus shipping address and tax ID
    - Payment methods
    - Cancellations, with "end of billing period" mode and all cancellation reasons enabled
    - Subscriptions, with the product you created for the premium plan selected
4. Copy the portal link and click "Save."
5. Save the portal link in TODO

## Set Up the Server
TODO explain and link to relevant code for stripe endpoints and webhooks

Refer to the [Stripe API documentation](https://stripe.com/docs/api) and [webhook documentation](https://stripe.com/docs/webhooks) when updating the server.