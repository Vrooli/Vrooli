syntax = "proto3";

package browser_automation_studio.v1;

import "google/protobuf/struct.proto";
import "browser-automation-studio/v1/shared.proto";

option go_package = "github.com/vrooli/vrooli/packages/proto/gen/go/browser-automation-studio/v1;browser_automation_studio_v1";

// WorkflowDefinition mirrors the JSON workflow definitions used by BAS.
message WorkflowDefinition {
  // Workflow nodes representing graph steps.
  repeated WorkflowNode nodes = 1;
  // Edges connecting workflow nodes.
  repeated WorkflowEdge edges = 2;
  // Arbitrary metadata associated with the workflow.
  map<string, google.protobuf.Value> metadata = 3 [deprecated = true];
  // Execution settings for the workflow (e.g., viewport).
  map<string, google.protobuf.Value> settings = 4 [deprecated = true];
  // Strongly typed metadata; prefer over the deprecated Struct-backed map.
  WorkflowMetadata metadata_typed = 5;
  // Strongly typed execution settings; prefer over the deprecated Struct-backed map.
  WorkflowSettings settings_typed = 6;
}

// WorkflowNode captures a single node in a workflow graph.
message WorkflowNode {
  // Unique node identifier.
  string id = 1;
  // Node type (navigate, click, assert, subflow, etc.).
  StepType type = 2;
  // Node-specific configuration payload.
  google.protobuf.Struct data = 3;
  // Strongly typed node configuration; prefer over Struct when possible.
  JsonObject data_typed = 4;
}

// WorkflowEdge connects nodes within a workflow graph.
message WorkflowEdge {
  // Unique edge identifier.
  string id = 1;
  // Source node ID.
  string source = 2;
  // Target node ID.
  string target = 3;
  // Edge type (e.g., smoothstep) when provided.
  string type = 4;
  // Provider-specific edge metadata.
  google.protobuf.Struct data = 5;
  // Typed edge metadata; prefer over Struct when available.
  JsonObject data_typed = 6;
}

// WorkflowMetadata captures the most common workflow descriptors.
message WorkflowMetadata {
  // Human-readable workflow name.
  string name = 1;
  // Optional longer description of what the workflow does.
  string description = 2;
  // Arbitrary labels for grouping/ownership (e.g., env=prod, team=apps).
  map<string, string> labels = 3;
  // Version tag for this definition (e.g., semver or git sha).
  string version = 4;
}

// WorkflowSettings captures common browser/execution knobs.
message WorkflowSettings {
  // Viewport width in pixels.
  int32 viewport_width = 1;
  // Viewport height in pixels.
  int32 viewport_height = 2;
  // User agent string to present during execution.
  string user_agent = 3;
  // Preferred locale (e.g., en-US).
  string locale = 4;
  // Overall timeout in seconds for the run.
  int32 timeout_seconds = 5;
  // Whether to run headless.
  bool headless = 6;
  // Additional provider-specific settings not yet typed.
  map<string, google.protobuf.Value> extras = 7;
}
