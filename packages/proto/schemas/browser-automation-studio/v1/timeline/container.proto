syntax = "proto3";

package browser_automation_studio.v1;

import "google/protobuf/timestamp.proto";
import "browser-automation-studio/v1/base/shared.proto";
import "browser-automation-studio/v1/timeline/entry.proto";

option go_package = "github.com/vrooli/vrooli/packages/proto/gen/go/browser-automation-studio/v1/timeline;timeline";

// =============================================================================
// EXECUTION TIMELINE (BATCH API FORMAT)
// =============================================================================
//
// This file defines the container for batch timeline data, returned by
// REST API endpoints like GET /api/v1/executions/{id}/timeline.
//
// The individual entries use TimelineEntry from timeline_entry.proto, which is
// the unified format for both streaming and batch access.
//
// See "UNIFIED RECORDING/EXECUTION MODEL" in shared.proto for design rationale.
// =============================================================================

// ExecutionTimeline is returned by GET /api/v1/executions/{id}/timeline.
// Contains all timeline entries from a completed or in-progress execution.
message ExecutionTimeline {
  // Unique identifier for this execution (UUID format).
  string execution_id = 1;
  // Workflow ID associated with the execution (UUID format).
  string workflow_id = 2;
  // Current execution status (pending, running, completed, failed, cancelled).
  ExecutionStatus status = 3;
  // Overall execution progress percentage (0-100).
  int32 progress = 4;
  // When the execution started.
  google.protobuf.Timestamp started_at = 5;
  // When the execution completed (null if still running).
  optional google.protobuf.Timestamp completed_at = 6;
  // Ordered list of timeline entries (one per action/step).
  // Uses the unified TimelineEntry format.
  repeated TimelineEntry entries = 7;
  // Console and execution logs captured during the run.
  repeated TimelineLog logs = 8;
}

// =============================================================================
// DEPRECATED TYPES - FOR BACKWARDS COMPATIBILITY
// =============================================================================
//
// TimelineFrame has been replaced by TimelineEntry from timeline_entry.proto.
// This alias is provided for backwards compatibility during migration.
//
// MIGRATION GUIDE:
//   - TimelineFrame → TimelineEntry
//   - frame.step_index → entry.step_index
//   - frame.node_id → entry.node_id
//   - frame.action → entry.action
//   - frame.telemetry → entry.telemetry
//   - frame.success → entry.context.success
//   - frame.error → entry.context.error
//   - frame.retry_status → entry.context.retry_status
//   - frame.assertion → entry.context.assertion
//   - (other fields) → entry.aggregates.*
// =============================================================================

// DEPRECATED: Use TimelineEntry from timeline_entry.proto instead.
// TimelineFrame is an alias for backwards compatibility.
message TimelineFrame {
  option deprecated = true;

  // Delegate to TimelineEntry for all data.
  TimelineEntry entry = 1;
}
