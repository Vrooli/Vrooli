syntax = "proto3";

package browser_automation_studio.v1;

import "browser-automation-studio/v1/shared.proto";
import "browser-automation-studio/v1/geometry.proto";

option go_package = "github.com/vrooli/vrooli/packages/proto/gen/go/browser-automation-studio/v1;browser_automation_studio_v1";

// =============================================================================
// SELECTOR TYPES
// =============================================================================

// SelectorCandidate is a single selector with metadata.
message SelectorCandidate {
  // Selector strategy type (css, xpath, id, data-testid, aria, text, etc.).
  SelectorType type = 1;
  // The actual selector string.
  string value = 2;
  // Confidence score (0.0-1.0) indicating selector reliability.
  double confidence = 3;
  // Specificity score for ranking selector candidates.
  int32 specificity = 4;
}

// SelectorSet contains multiple selector strategies for resilience.
// This enables fallback behavior when the primary selector fails:
// 1. Try primary selector first
// 2. If primary fails, iterate through candidates by confidence score
// 3. Store successful selector for future runs
//
// Used internally by the playwright-driver for resilient element targeting.
// May be added to ActionDefinition params in future for explicit fallback control.
message SelectorSet {
  // Primary selector to use first.
  string primary = 1;
  // Alternative selector candidates ranked by preference.
  repeated SelectorCandidate candidates = 2;
}

// =============================================================================
// ELEMENT METADATA
// =============================================================================

// ElementMeta captures information about a DOM element.
message ElementMeta {
  // HTML tag name (e.g., "button", "input", "div").
  string tag_name = 1;
  // Element id attribute.
  string id = 2;
  // Element class attribute.
  string class_name = 3;
  // Truncated inner text content.
  string inner_text = 4;
  // Key-value pairs of element attributes.
  map<string, string> attributes = 5;
  // Whether the element is currently visible.
  bool is_visible = 6;
  // Whether the element is enabled (not disabled).
  bool is_enabled = 7;
  // ARIA role attribute.
  string role = 8;
  // ARIA label attribute.
  string aria_label = 9;
}

// =============================================================================
// VISUAL OVERLAYS
// =============================================================================

// HighlightRegion describes an overlay applied to screenshots for emphasis.
message HighlightRegion {
  // CSS selector for the region.
  string selector = 1;
  // Bounding box for the highlighted area.
  BoundingBox bounding_box = 2;
  // Padding in pixels around the region.
  int32 padding = 3;
  // Highlight color (CSS string, e.g., "#ff0000" or "rgba(255,0,0,0.5)").
  string color = 4;
}

// MaskRegion describes areas that were dimmed or masked during capture.
message MaskRegion {
  // CSS selector for the region to mask.
  string selector = 1;
  // Bounding box for the masked area.
  BoundingBox bounding_box = 2;
  // Mask opacity value (0.0-1.0, where 1.0 is fully opaque).
  double opacity = 3;
}

// NOTE: TimelineScreenshot has been moved to telemetry.proto where it
// logically belongs alongside ActionTelemetry.
