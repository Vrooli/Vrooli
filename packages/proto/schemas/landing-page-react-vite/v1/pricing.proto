syntax = "proto3";

package landing_page_react_vite.v1;

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/vrooli/vrooli/packages/proto/gen/go/landing-page-react-vite/v1;landing_page_react_vite_v1";

// PlanKind mirrors supported purchase flows for plans.
enum PlanKind {
  PLAN_KIND_UNSPECIFIED = 0;
  PLAN_KIND_SUBSCRIPTION = 1;
  PLAN_KIND_CREDITS_TOPUP = 2;
  PLAN_KIND_SUPPORTER_CONTRIBUTION = 3;
}

// BillingInterval restricts billing cadence to supported Stripe intervals.
enum BillingInterval {
  BILLING_INTERVAL_UNSPECIFIED = 0;
  BILLING_INTERVAL_MONTH = 1;
  BILLING_INTERVAL_YEAR = 2;
  BILLING_INTERVAL_ONE_TIME = 3;
}

// IntroPricingType captures the known introductory pricing strategies.
enum IntroPricingType {
  INTRO_PRICING_TYPE_UNSPECIFIED = 0;
  INTRO_PRICING_TYPE_FLAT_AMOUNT = 1;
  INTRO_PRICING_TYPE_PERCENTAGE = 2;
}

// Bundle captures Stripe product metadata and credit conversion rules.
message Bundle {
  // Stable key used by clients and downstream scenarios.
  string bundle_key = 1;
  // Human-readable bundle name.
  string name = 2;
  // Stripe product identifier.
  string stripe_product_id = 3;
  // Conversion rate from USD cents to credits.
  int64 credits_per_usd = 4;
  // Multiplier applied when rendering credit amounts for display.
  double display_credits_multiplier = 5;
  // Display label for credits (e.g., "credits", "tokens").
  string display_credits_label = 6;
  // Environment label (e.g., "production", "staging").
  string environment = 7;
  // Additional metadata passed through to clients.
  map<string, google.protobuf.Value> metadata = 8;
}

// PlanOption represents a purchasable Stripe price for a bundle.
message PlanOption {
  // User-facing plan name (e.g., "Pro", "Team").
  string plan_name = 1;
  // Tier key used for entitlement checks.
  string plan_tier = 2;
  // Billing cadence ("month" or "year").
  BillingInterval billing_interval = 3;
  // Price in cents for the billing interval.
  int64 amount_cents = 4;
  // Currency code (ISO 4217).
  string currency = 5;
  // Whether an introductory price is enabled.
  bool intro_enabled = 6;
  // Type of intro pricing ("flat_amount", etc.).
  IntroPricingType intro_type = 7;
  // Introductory amount in cents (nullable when not enabled).
  optional int64 intro_amount_cents = 8;
  // Number of billing periods for the intro price.
  int32 intro_periods = 9;
  // Lookup key for intro pricing in Stripe.
  string intro_price_lookup_key = 10;
  // Stripe price identifier.
  string stripe_price_id = 11;
  // Included credits per billing interval.
  int64 monthly_included_credits = 12;
  // One-time bonus credits granted at purchase.
  int64 one_time_bonus_credits = 13;
  // Display ordering rank (higher first).
  int32 plan_rank = 14;
  // Bonus type label.
  string bonus_type = 15;
  // Purchase flow kind (subscription, credits, supporter contribution).
  PlanKind kind = 16;
  // Indicates variable-amount purchases (e.g., donations).
  bool is_variable_amount = 17;
  // Whether to show this plan on the landing page.
  bool display_enabled = 18;
  // Bundle key this plan belongs to.
  string bundle_key = 19;
  // Weight for ordering within its interval group.
  int32 display_weight = 20;
  // Arbitrary structured metadata.
  map<string, google.protobuf.Value> metadata = 21;
}

// PricingOverview groups bundle metadata with available plans.
message PricingOverview {
  // Bundle/product metadata.
  Bundle bundle = 1;
  // Monthly billing options (filtered for display).
  repeated PlanOption monthly = 2;
  // Yearly billing options (filtered for display).
  repeated PlanOption yearly = 3;
  // Last update timestamp for pricing metadata.
  google.protobuf.Timestamp updated_at = 4;
}

// GetPricingRequest allows selecting a bundle and visibility mode.
message GetPricingRequest {
  // Bundle key to fetch; defaults to server-configured bundle.
  string bundle_key = 1;
  // Include plans that are not display_enabled.
  bool include_hidden = 2;
}

// GetPricingResponse returns pricing metadata for the requested bundle.
message GetPricingResponse {
  // Pricing overview for the bundle.
  PricingOverview pricing = 1;
}
