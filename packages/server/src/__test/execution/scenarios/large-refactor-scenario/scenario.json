{
  "identity": {
    "name": "large-refactor-scenario",
    "description": "Resource-constrained refactoring of 50,000+ line legacy Node.js codebase from callbacks to async/await",
    "category": "multi-agent",
    "complexity": "advanced"
  },

  "agents": [
    {
      "name": "refactor-orchestrator",
      "role": "coordinator",
      "botConfig": {
        "__version": "1.0",
        "model": "claude-3-5-sonnet-20241022",
        "maxTokens": 2000,
        "agentSpec": {
          "goal": "Orchestrate systematic modernization of legacy Node.js codebase while managing resource constraints",
          "subscriptions": [
            "swarm/started",
            "refactor/analysis_complete",
            "refactor/chunk_complete",
            "refactor/resources_low",
            "refactor/checkpoint_saved"
          ],
          "behaviors": [
            {
              "trigger": {
                "topic": "swarm/started"
              },
              "action": {
                "type": "emit",
                "eventType": "refactor/analysis_requested",
                "dataMapping": {
                  "codebase_path": "blackboard.target_codebase",
                  "refactor_type": "'callbacks_to_async_await'",
                  "scope": "'full_codebase'"
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/analysis_complete"
              },
              "action": {
                "type": "routine",
                "label": "refactor-planning-routine",
                "inputMap": {
                  "analysisResults": "event.data.analysis_results",
                  "resourceBudget": "blackboard.resource_budget"
                },
                "outputOperations": {
                  "set": [
                    {"routineOutput": "refactor_plan", "blackboardId": "execution_plan"},
                    {"routineOutput": "priority_chunks", "blackboardId": "refactor_chunks"}
                  ]
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/analysis_complete"
              },
              "action": {
                "type": "emit",
                "eventType": "refactor/chunk_processing_requested",
                "dataMapping": {
                  "chunk": "blackboard.refactor_chunks[0]",
                  "chunk_index": "0",
                  "mode": "'thorough'"
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/chunk_complete",
                "when": "event.data.success == true && blackboard.current_chunk_index < blackboard.refactor_chunks.length - 1"
              },
              "action": {
                "type": "emit",
                "eventType": "refactor/chunk_processing_requested",
                "dataMapping": {
                  "chunk": "blackboard.refactor_chunks[blackboard.current_chunk_index + 1]",
                  "chunk_index": "blackboard.current_chunk_index + 1",
                  "mode": "blackboard.refactor_mode"
                },
                "outputOperations": {
                  "increment": [
                    {"constantValue": 1, "blackboardId": "current_chunk_index"}
                  ]
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/resources_low"
              },
              "action": {
                "type": "routine",
                "label": "resource-conservation-routine",
                "inputMap": {
                  "remainingResources": "event.data.remaining_resources",
                  "progressSoFar": "blackboard.completed_chunks",
                  "remainingWork": "blackboard.remaining_chunks"
                },
                "outputOperations": {
                  "set": [
                    {"routineOutput": "conservation_strategy", "blackboardId": "conservation_plan"},
                    {"routineOutput": "refactor_mode", "blackboardId": "refactor_mode"}
                  ]
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/resources_low"
              },
              "action": {
                "type": "emit",
                "eventType": "refactor/checkpoint_requested",
                "dataMapping": {
                  "progress": "blackboard.completed_chunks",
                  "reason": "'resource_conservation'",
                  "mode": "blackboard.refactor_mode"
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/checkpoint_saved"
              },
              "action": {
                "type": "routine",
                "label": "refactor-completion-routine",
                "inputMap": {
                  "completedWork": "blackboard.completed_chunks",
                  "remainingWork": "blackboard.remaining_chunks",
                  "resourcesUsed": "blackboard.total_resources_used"
                },
                "outputOperations": {
                  "set": [
                    {"routineOutput": "completion_status", "blackboardId": "refactor_completion"},
                    {"routineOutput": "continuation_plan", "blackboardId": "remaining_work_plan"}
                  ]
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/checkpoint_saved"
              },
              "action": {
                "type": "emit",
                "eventType": "refactor/work_complete",
                "dataMapping": {
                  "completion_percentage": "blackboard.refactor_completion.percentage",
                  "chunks_completed": "blackboard.completed_chunks.length",
                  "tests_passing": "blackboard.refactor_completion.tests_passing"
                },
                "outputOperations": {
                  "set": [
                    {"constantValue": true, "blackboardId": "refactor_session_complete"}
                  ]
                }
              },
              "qos": 1
            }
          ],
          "prompt": {
            "mode": "supplement",
            "source": "direct",
            "content": "You orchestrate large-scale refactoring projects while managing resource constraints. Monitor progress, adapt strategies when resources run low, and ensure work is properly saved and documented for continuation."
          }
        }
      }
    },
    {
      "name": "code-analyzer",
      "role": "specialist",
      "botConfig": {
        "__version": "1.0",
        "model": "gpt-4",
        "maxTokens": 4000,
        "agentSpec": {
          "goal": "Analyze legacy codebase and identify refactoring opportunities and dependencies",
          "subscriptions": [
            "refactor/analysis_requested"
          ],
          "behaviors": [
            {
              "trigger": {
                "topic": "refactor/analysis_requested"
              },
              "action": {
                "type": "routine",
                "label": "codebase-analysis-routine",
                "inputMap": {
                  "codebasePath": "event.data.codebase_path",
                  "refactorType": "event.data.refactor_type",
                  "scope": "event.data.scope"
                },
                "outputOperations": {
                  "set": [
                    {"routineOutput": "analysis_results", "blackboardId": "codebase_analysis"},
                    {"routineOutput": "complexity_map", "blackboardId": "refactor_complexity"}
                  ],
                  "append": [
                    {"routineOutput": "analysis_log", "blackboardId": "analysis_history"}
                  ]
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/analysis_requested"
              },
              "action": {
                "type": "emit",
                "eventType": "refactor/analysis_complete",
                "dataMapping": {
                  "analysis_results": "blackboard.codebase_analysis",
                  "total_files": "blackboard.codebase_analysis.total_files",
                  "estimated_effort": "blackboard.codebase_analysis.estimated_effort"
                }
              },
              "qos": 1
            }
          ],
          "prompt": {
            "mode": "supplement",
            "source": "direct",
            "content": "You analyze large legacy codebases to identify refactoring opportunities. Focus on callback patterns, promise chains, and async/await conversion potential. Prioritize by complexity and impact."
          }
        }
      }
    },
    {
      "name": "resource-monitor",
      "role": "monitor",
      "botConfig": {
        "__version": "1.0",
        "model": "gpt-3.5-turbo",
        "maxTokens": 1500,
        "agentSpec": {
          "goal": "Monitor resource consumption and trigger conservation measures when resources run low",
          "subscriptions": [
            "refactor/chunk_complete",
            "refactor/resource_check_requested"
          ],
          "behaviors": [
            {
              "trigger": {
                "topic": "refactor/chunk_complete"
              },
              "action": {
                "type": "routine",
                "label": "resource-monitoring-routine",
                "inputMap": {
                  "chunkResourceUsage": "event.data.resource_usage",
                  "totalBudget": "blackboard.resource_budget",
                  "usedSoFar": "blackboard.total_resources_used"
                },
                "outputOperations": {
                  "set": [
                    {"routineOutput": "resource_status", "blackboardId": "current_resource_status"},
                    {"routineOutput": "burn_rate", "blackboardId": "resource_burn_rate"}
                  ],
                  "increment": [
                    {"routineOutput": "resources_consumed", "blackboardId": "total_resources_used"}
                  ]
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/chunk_complete",
                "when": "blackboard.current_resource_status.remaining_percentage < 25"
              },
              "action": {
                "type": "emit",
                "eventType": "refactor/resources_low",
                "dataMapping": {
                  "remaining_resources": "blackboard.current_resource_status.remaining",
                  "burn_rate": "blackboard.resource_burn_rate",
                  "estimated_remaining_work": "blackboard.current_resource_status.estimated_remaining_chunks"
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/resource_check_requested"
              },
              "action": {
                "type": "routine",
                "label": "resource-projection-routine",
                "inputMap": {
                  "currentUsage": "blackboard.total_resources_used",
                  "remainingWork": "blackboard.remaining_chunks"
                },
                "outputOperations": {
                  "set": [
                    {"routineOutput": "projection", "blackboardId": "resource_projection"}
                  ]
                }
              },
              "qos": 1
            }
          ],
          "prompt": {
            "mode": "supplement",
            "source": "direct",
            "content": "You monitor resource consumption during refactoring. Track credit burn rates, project remaining work, and trigger conservation measures when resources are running low."
          }
        }
      }
    },
    {
      "name": "chunk-processor",
      "role": "specialist",
      "botConfig": {
        "__version": "1.0",
        "model": "gpt-4",
        "maxTokens": 3000,
        "agentSpec": {
          "goal": "Process refactoring chunks with adaptive thoroughness based on resource constraints",
          "subscriptions": [
            "refactor/chunk_processing_requested"
          ],
          "behaviors": [
            {
              "trigger": {
                "topic": "refactor/chunk_processing_requested"
              },
              "action": {
                "type": "routine",
                "label": "chunk-refactoring-routine",
                "inputMap": {
                  "chunk": "event.data.chunk",
                  "mode": "event.data.mode",
                  "chunkIndex": "event.data.chunk_index"
                },
                "outputOperations": {
                  "set": [
                    {"routineOutput": "refactored_chunk", "blackboardId": "current_chunk_result"},
                    {"routineOutput": "resource_usage", "blackboardId": "chunk_resource_usage"}
                  ],
                  "append": [
                    {"routineOutput": "completed_files", "blackboardId": "completed_chunks"},
                    {"routineOutput": "refactor_log", "blackboardId": "refactor_history"}
                  ]
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/chunk_processing_requested"
              },
              "action": {
                "type": "emit",
                "eventType": "refactor/chunk_complete",
                "dataMapping": {
                  "success": "blackboard.current_chunk_result.success",
                  "files_processed": "blackboard.current_chunk_result.files_processed",
                  "resource_usage": "blackboard.chunk_resource_usage",
                  "chunk_index": "event.data.chunk_index"
                }
              },
              "qos": 1
            }
          ],
          "prompt": {
            "mode": "supplement",
            "source": "direct",
            "content": "You process refactoring chunks with adaptive thoroughness. In 'thorough' mode, perform comprehensive refactoring. In 'essential' mode, focus on critical-path changes only to conserve resources."
          }
        }
      }
    },
    {
      "name": "progress-recorder",
      "role": "specialist",
      "botConfig": {
        "__version": "1.0",
        "model": "gpt-3.5-turbo",
        "maxTokens": 2000,
        "agentSpec": {
          "goal": "Save progress checkpoints and document work for continuation",
          "subscriptions": [
            "refactor/checkpoint_requested"
          ],
          "behaviors": [
            {
              "trigger": {
                "topic": "refactor/checkpoint_requested"
              },
              "action": {
                "type": "routine",
                "label": "checkpoint-creation-routine",
                "inputMap": {
                  "progress": "event.data.progress",
                  "reason": "event.data.reason",
                  "mode": "event.data.mode"
                },
                "outputOperations": {
                  "set": [
                    {"routineOutput": "checkpoint_data", "blackboardId": "latest_checkpoint"},
                    {"routineOutput": "continuation_guide", "blackboardId": "work_continuation_plan"}
                  ],
                  "append": [
                    {"routineOutput": "checkpoint_log", "blackboardId": "checkpoint_history"}
                  ]
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/checkpoint_requested"
              },
              "action": {
                "type": "routine",
                "label": "stability-verification-routine",
                "inputMap": {
                  "completedWork": "blackboard.completed_chunks",
                  "refactoredFiles": "blackboard.latest_checkpoint.files"
                },
                "outputOperations": {
                  "set": [
                    {"routineOutput": "stability_report", "blackboardId": "refactor_stability"}
                  ]
                }
              },
              "qos": 1
            },
            {
              "trigger": {
                "topic": "refactor/checkpoint_requested"
              },
              "action": {
                "type": "emit",
                "eventType": "refactor/checkpoint_saved",
                "dataMapping": {
                  "checkpoint_id": "blackboard.latest_checkpoint.id",
                  "files_saved": "blackboard.latest_checkpoint.files.length",
                  "tests_passing": "blackboard.refactor_stability.tests_passing"
                }
              },
              "qos": 1
            }
          ],
          "prompt": {
            "mode": "supplement",
            "source": "direct",
            "content": "You create checkpoints and document refactoring progress. Ensure all completed work is saved, tests are verified, and detailed continuation plans are created for resuming work later."
          }
        }
      }
    }
  ],

  "routines": [
    {
      "name": "codebase-analysis-routine",
      "type": "generate",
      "config": {
        "resourceSubType": "RoutineGenerate",
        "instructions": [
          {
            "type": "text",
            "text": "Analyze legacy Node.js codebase for callback-to-async/await refactoring opportunities. Identify files with callback patterns, assess complexity, estimate effort, and prioritize by impact and risk."
          }
        ],
        "callDataGenerate": {
          "schema": {
            "inputTemplate": {
              "path": "{{input.codebasePath}}",
              "type": "{{input.refactorType}}",
              "scope": "{{input.scope}}"
            },
            "outputMapping": {
              "analysis_results": "analysis.results",
              "complexity_map": "analysis.complexity",
              "analysis_log": "analysis.log"
            }
          }
        }
      }
    },
    {
      "name": "refactor-planning-routine",
      "type": "generate",
      "config": {
        "resourceSubType": "RoutineGenerate",
        "instructions": [
          {
            "type": "text",
            "text": "Create refactoring execution plan based on analysis results and resource budget. Divide work into chunks, prioritize by risk and impact, estimate resource requirements per chunk."
          }
        ],
        "callDataGenerate": {
          "schema": {
            "inputTemplate": {
              "analysis": "{{input.analysisResults}}",
              "budget": "{{input.resourceBudget}}"
            },
            "outputMapping": {
              "refactor_plan": "planning.plan",
              "priority_chunks": "planning.chunks"
            }
          }
        }
      }
    },
    {
      "name": "chunk-refactoring-routine",
      "type": "generate",
      "config": {
        "resourceSubType": "RoutineGenerate",
        "instructions": [
          {
            "type": "text",
            "text": "Refactor a chunk of files from callbacks to async/await. Adapt thoroughness based on mode: 'thorough' for comprehensive refactoring, 'essential' for critical-path changes only."
          }
        ],
        "callDataGenerate": {
          "schema": {
            "inputTemplate": {
              "chunk": "{{input.chunk}}",
              "mode": "{{input.mode}}",
              "index": "{{input.chunkIndex}}"
            },
            "outputMapping": {
              "refactored_chunk": "refactor.result",
              "resource_usage": "refactor.resources",
              "completed_files": "refactor.files",
              "refactor_log": "refactor.log"
            }
          }
        }
      }
    },
    {
      "name": "resource-monitoring-routine",
      "type": "generate",
      "config": {
        "resourceSubType": "RoutineGenerate",
        "instructions": [
          {
            "type": "text",
            "text": "Monitor resource consumption and calculate burn rates. Determine remaining resources, project completion feasibility, and identify when conservation measures are needed."
          }
        ],
        "callDataGenerate": {
          "schema": {
            "inputTemplate": {
              "usage": "{{input.chunkResourceUsage}}",
              "budget": "{{input.totalBudget}}",
              "used": "{{input.usedSoFar}}"
            },
            "outputMapping": {
              "resource_status": "monitoring.status",
              "burn_rate": "monitoring.burn_rate",
              "resources_consumed": "monitoring.consumed"
            }
          }
        }
      }
    },
    {
      "name": "resource-conservation-routine",
      "type": "generate",
      "config": {
        "resourceSubType": "RoutineGenerate",
        "instructions": [
          {
            "type": "text",
            "text": "Create resource conservation strategy when resources are running low. Determine which work to prioritize, what mode to switch to, and how to maximize value from remaining resources."
          }
        ],
        "callDataGenerate": {
          "schema": {
            "inputTemplate": {
              "remaining": "{{input.remainingResources}}",
              "progress": "{{input.progressSoFar}}",
              "remaining_work": "{{input.remainingWork}}"
            },
            "outputMapping": {
              "conservation_strategy": "conservation.strategy",
              "refactor_mode": "conservation.mode"
            }
          }
        }
      }
    },
    {
      "name": "checkpoint-creation-routine",
      "type": "generate",
      "config": {
        "resourceSubType": "RoutineGenerate",
        "instructions": [
          {
            "type": "text",
            "text": "Create comprehensive checkpoint of refactoring progress. Document completed work, save state, and create detailed continuation plan for resuming work later."
          }
        ],
        "callDataGenerate": {
          "schema": {
            "inputTemplate": {
              "progress": "{{input.progress}}",
              "reason": "{{input.reason}}",
              "mode": "{{input.mode}}"
            },
            "outputMapping": {
              "checkpoint_data": "checkpoint.data",
              "continuation_guide": "checkpoint.guide",
              "checkpoint_log": "checkpoint.log"
            }
          }
        }
      }
    },
    {
      "name": "stability-verification-routine",
      "type": "generate",
      "config": {
        "resourceSubType": "RoutineGenerate",
        "instructions": [
          {
            "type": "text",
            "text": "Verify stability of refactored code. Run tests, check for regressions, ensure application still functions correctly with partial refactoring completed."
          }
        ],
        "callDataGenerate": {
          "schema": {
            "inputTemplate": {
              "completed": "{{input.completedWork}}",
              "files": "{{input.refactoredFiles}}"
            },
            "outputMapping": {
              "stability_report": "stability.report"
            }
          }
        }
      }
    },
    {
      "name": "refactor-completion-routine",
      "type": "generate",
      "config": {
        "resourceSubType": "RoutineGenerate",
        "instructions": [
          {
            "type": "text",
            "text": "Evaluate refactoring session completion. Calculate completion percentage, assess work quality, and create comprehensive plan for continuing remaining work."
          }
        ],
        "callDataGenerate": {
          "schema": {
            "inputTemplate": {
              "completed": "{{input.completedWork}}",
              "remaining": "{{input.remainingWork}}",
              "resources": "{{input.resourcesUsed}}"
            },
            "outputMapping": {
              "completion_status": "completion.status",
              "continuation_plan": "completion.plan"
            }
          }
        }
      }
    },
    {
      "name": "resource-projection-routine",
      "type": "generate",
      "config": {
        "resourceSubType": "RoutineGenerate",
        "instructions": [
          {
            "type": "text",
            "text": "Project resource requirements for remaining work. Estimate completion feasibility, identify critical-path items, and recommend resource allocation strategies."
          }
        ],
        "callDataGenerate": {
          "schema": {
            "inputTemplate": {
              "current": "{{input.currentUsage}}",
              "remaining": "{{input.remainingWork}}"
            },
            "outputMapping": {
              "projection": "projection.analysis"
            }
          }
        }
      }
    }
  ],

  "expectedFlow": [
    {
      "step": 1,
      "agent": "refactor-orchestrator",
      "trigger": "swarm/started",
      "action": "emit",
      "emittedEvents": ["refactor/analysis_requested"]
    },
    {
      "step": 2,
      "agent": "code-analyzer",
      "trigger": "refactor/analysis_requested",
      "action": "codebase-analysis-routine",
      "blackboardUpdates": {
        "codebase_analysis": "Analysis of 50K+ lines, 247 files with callback patterns",
        "refactor_complexity": "Complexity mapping by file and risk level"
      }
    },
    {
      "step": 3,
      "agent": "code-analyzer",
      "trigger": "refactor/analysis_requested",
      "action": "emit",
      "emittedEvents": ["refactor/analysis_complete"]
    },
    {
      "step": 4,
      "agent": "refactor-orchestrator",
      "trigger": "refactor/analysis_complete",
      "action": "refactor-planning-routine",
      "blackboardUpdates": {
        "execution_plan": "Phased refactoring plan with resource estimates",
        "refactor_chunks": "20 chunks prioritized by risk and impact"
      }
    },
    {
      "step": 5,
      "agent": "refactor-orchestrator",
      "trigger": "refactor/analysis_complete",
      "action": "emit",
      "emittedEvents": ["refactor/chunk_processing_requested"]
    },
    {
      "step": 6,
      "agent": "chunk-processor",
      "trigger": "refactor/chunk_processing_requested",
      "action": "chunk-refactoring-routine",
      "blackboardUpdates": {
        "current_chunk_result": "Refactored 12 files successfully",
        "completed_chunks": "First chunk completed",
        "chunk_resource_usage": "45,000 credits consumed"
      }
    },
    {
      "step": 7,
      "agent": "chunk-processor",
      "trigger": "refactor/chunk_processing_requested",
      "action": "emit",
      "emittedEvents": ["refactor/chunk_complete"]
    },
    {
      "step": 8,
      "agent": "resource-monitor",
      "trigger": "refactor/chunk_complete",
      "action": "resource-monitoring-routine",
      "blackboardUpdates": {
        "current_resource_status": "75% resources remaining",
        "total_resources_used": "45,000 credits",
        "resource_burn_rate": "2,250 credits per chunk"
      }
    },
    {
      "step": 9,
      "description": "Continue processing chunks until resources run low"
    },
    {
      "step": 10,
      "agent": "resource-monitor",
      "trigger": "refactor/chunk_complete",
      "action": "emit",
      "emittedEvents": ["refactor/resources_low"],
      "description": "Triggered when remaining resources < 25%"
    },
    {
      "step": 11,
      "agent": "refactor-orchestrator",
      "trigger": "refactor/resources_low",
      "action": "resource-conservation-routine",
      "blackboardUpdates": {
        "conservation_plan": "Switch to essential mode, prioritize critical paths",
        "refactor_mode": "essential"
      }
    },
    {
      "step": 12,
      "agent": "refactor-orchestrator",
      "trigger": "refactor/resources_low",
      "action": "emit",
      "emittedEvents": ["refactor/checkpoint_requested"]
    },
    {
      "step": 13,
      "agent": "progress-recorder",
      "trigger": "refactor/checkpoint_requested",
      "action": "checkpoint-creation-routine",
      "blackboardUpdates": {
        "latest_checkpoint": "Checkpoint with 60% completion",
        "work_continuation_plan": "Plan for resuming remaining 40%"
      }
    },
    {
      "step": 14,
      "agent": "progress-recorder",
      "trigger": "refactor/checkpoint_requested",
      "action": "stability-verification-routine",
      "blackboardUpdates": {
        "refactor_stability": "All tests passing, no regressions"
      }
    },
    {
      "step": 15,
      "agent": "progress-recorder",
      "trigger": "refactor/checkpoint_requested",
      "action": "emit",
      "emittedEvents": ["refactor/checkpoint_saved"]
    },
    {
      "step": 16,
      "agent": "refactor-orchestrator",
      "trigger": "refactor/checkpoint_saved",
      "action": "refactor-completion-routine",
      "blackboardUpdates": {
        "refactor_completion": "60% complete, stable state",
        "remaining_work_plan": "Detailed plan for remaining 40%"
      }
    },
    {
      "step": 17,
      "agent": "refactor-orchestrator",
      "trigger": "refactor/checkpoint_saved",
      "action": "emit",
      "emittedEvents": ["refactor/work_complete"],
      "blackboardUpdates": {
        "refactor_session_complete": true
      }
    }
  ],

  "resources": {
    "maxCredits": "180000000",
    "maxDurationMs": 600000,
    "quotas": {
      "gpuPercentage": 25,
      "ramGB": 16,
      "cpuCores": 4,
      "storageGB": 100
    }
  },

  "success": {
    "requiredEvents": [
      "refactor/analysis_requested",
      "refactor/analysis_complete",
      "refactor/chunk_processing_requested",
      "refactor/chunk_complete",
      "refactor/resources_low",
      "refactor/checkpoint_requested",
      "refactor/checkpoint_saved",
      "refactor/work_complete"
    ],
    "blackboardState": {
      "refactor_session_complete": "true",
      "completed_chunks": "length>0",
      "refactor_completion": "exists",
      "refactor_stability": "exists",
      "conservation_plan": "exists",
      "work_continuation_plan": "exists"
    },
    "resourceManagement": {
      "resourcesMonitored": true,
      "conservationTriggered": true,
      "checkpointCreated": true,
      "stabilityVerified": true
    },
    "routineCallsMin": 8,
    "agentCoordination": true
  },

  "initialConditions": {
    "triggerEvent": {
      "topic": "swarm/started",
      "data": {
        "task": "refactor-legacy-nodejs-codebase",
        "timestamp": "2024-01-17T08:00:00Z"
      }
    },
    "blackboardState": {
      "target_codebase": "/src/legacy-ecommerce-platform",
      "resource_budget": {
        "total_credits": 180000000,
        "warning_threshold": 0.25,
        "critical_threshold": 0.10
      },
      "refactor_mode": "thorough",
      "current_chunk_index": 0,
      "completed_chunks": [],
      "remaining_chunks": [],
      "total_resources_used": 0
    }
  },

  "mocks": {
    "routineResponses": [
      {
        "routineName": "codebase-analysis-routine",
        "response": {
          "analysis": {
            "results": {
              "total_files": 247,
              "total_lines": 52347,
              "callback_patterns": 1834,
              "promise_chains": 567,
              "async_await_candidates": 1201,
              "estimated_effort": "high",
              "high_risk_files": 23,
              "medium_risk_files": 89,
              "low_risk_files": 135
            },
            "complexity": {
              "critical_path": ["user-auth.js", "payment-processor.js", "order-manager.js"],
              "high_complexity": ["database-migrations.js", "email-service.js", "cache-manager.js"],
              "dependencies": {
                "user-auth.js": ["session-manager.js", "crypto-utils.js"],
                "payment-processor.js": ["stripe-client.js", "audit-logger.js"]
              }
            },
            "log": "Analyzed 52K+ lines across 247 files. Found 1834 callback patterns suitable for async/await conversion."
          }
        }
      },
      {
        "routineName": "refactor-planning-routine",
        "response": {
          "planning": {
            "plan": {
              "total_chunks": 20,
              "estimated_total_effort": "180M credits",
              "estimated_duration": "10 hours",
              "strategy": "critical_path_first",
              "degradation_strategy": "essential_only_mode"
            },
            "chunks": [
              {
                "id": 1,
                "priority": "critical",
                "files": ["user-auth.js", "session-manager.js", "crypto-utils.js"],
                "estimated_effort": "12M credits",
                "risk_level": "high"
              },
              {
                "id": 2,
                "priority": "critical",
                "files": ["payment-processor.js", "stripe-client.js", "audit-logger.js"],
                "estimated_effort": "15M credits",
                "risk_level": "high"
              },
              {
                "id": 3,
                "priority": "high",
                "files": ["order-manager.js", "inventory-service.js", "notification-service.js"],
                "estimated_effort": "10M credits",
                "risk_level": "medium"
              }
            ]
          }
        }
      },
      {
        "routineName": "chunk-refactoring-routine",
        "attempt": 1,
        "response": {
          "refactor": {
            "result": {
              "success": true,
              "files_processed": 3,
              "callbacks_converted": 47,
              "tests_updated": 12,
              "tests_passing": true
            },
            "resources": {
              "credits_consumed": 12000000,
              "time_elapsed": "28 minutes",
              "complexity_handled": "high"
            },
            "files": [
              {
                "name": "user-auth.js",
                "status": "completed",
                "callbacks_converted": 23,
                "async_functions_created": 8
              },
              {
                "name": "session-manager.js",
                "status": "completed",
                "callbacks_converted": 15,
                "async_functions_created": 5
              },
              {
                "name": "crypto-utils.js",
                "status": "completed",
                "callbacks_converted": 9,
                "async_functions_created": 3
              }
            ],
            "log": "Successfully refactored chunk 1: converted 47 callbacks to async/await in 3 critical files"
          }
        }
      },
      {
        "routineName": "resource-monitoring-routine",
        "response": {
          "monitoring": {
            "status": {
              "remaining": 168000000,
              "remaining_percentage": 93.3,
              "estimated_remaining_chunks": 14,
              "completion_feasible": true
            },
            "burn_rate": {
              "credits_per_chunk": 12000000,
              "credits_per_hour": 25714286,
              "efficiency": "above_average"
            },
            "consumed": 12000000
          }
        }
      },
      {
        "routineName": "chunk-refactoring-routine",
        "attempt": 10,
        "response": {
          "refactor": {
            "result": {
              "success": true,
              "files_processed": 5,
              "callbacks_converted": 34,
              "tests_updated": 8,
              "tests_passing": true
            },
            "resources": {
              "credits_consumed": 8500000,
              "time_elapsed": "18 minutes",
              "complexity_handled": "medium"
            },
            "files": [
              {
                "name": "email-templates.js",
                "status": "completed",
                "callbacks_converted": 12,
                "async_functions_created": 4
              },
              {
                "name": "report-generator.js",
                "status": "completed",
                "callbacks_converted": 22,
                "async_functions_created": 7
              }
            ],
            "log": "Refactored chunk 10 with reduced thoroughness due to resource constraints"
          }
        }
      },
      {
        "routineName": "resource-monitoring-routine",
        "response": {
          "monitoring": {
            "status": {
              "remaining": 42000000,
              "remaining_percentage": 23.3,
              "estimated_remaining_chunks": 10,
              "completion_feasible": false
            },
            "burn_rate": {
              "credits_per_chunk": 9200000,
              "credits_per_hour": 23000000,
              "efficiency": "declining"
            },
            "consumed": 138000000
          }
        }
      },
      {
        "routineName": "resource-conservation-routine",
        "response": {
          "conservation": {
            "strategy": {
              "mode_switch": "essential_only",
              "priority_focus": "critical_path_completion",
              "skip_non_essential": true,
              "reduce_testing": false,
              "estimated_savings": "40%"
            },
            "mode": "essential"
          }
        }
      },
      {
        "routineName": "checkpoint-creation-routine",
        "response": {
          "checkpoint": {
            "data": {
              "id": "checkpoint_20240117_143022",
              "timestamp": "2024-01-17T14:30:22Z",
              "completion_percentage": 60,
              "files": 148,
              "callbacks_converted": 1102,
              "tests_passing": true,
              "resource_usage": 138000000
            },
            "guide": {
              "remaining_work": "40% of refactoring remaining",
              "priority_files": ["database-migrations.js", "analytics-engine.js", "background-jobs.js"],
              "estimated_effort": "72M credits",
              "recommended_approach": "Resume with 'essential' mode, focus on critical paths",
              "continuation_strategy": "Allocate 100M credits for completion"
            },
            "log": "Created comprehensive checkpoint at 60% completion with full continuation plan"
          }
        }
      },
      {
        "routineName": "stability-verification-routine",
        "response": {
          "stability": {
            "report": {
              "tests_passing": true,
              "test_coverage": "87%",
              "no_regressions": true,
              "performance_impact": "5% improvement",
              "memory_usage": "stable",
              "error_rates": "unchanged"
            }
          }
        }
      },
      {
        "routineName": "refactor-completion-routine",
        "response": {
          "completion": {
            "status": {
              "percentage": 60,
              "files_completed": 148,
              "files_remaining": 99,
              "callbacks_converted": 1102,
              "callbacks_remaining": 732,
              "tests_passing": true,
              "production_ready": true
            },
            "plan": {
              "remaining_effort": "72M credits",
              "estimated_duration": "4 hours",
              "critical_files": ["database-migrations.js", "analytics-engine.js", "background-jobs.js"],
              "optional_files": ["admin-utilities.js", "debug-helpers.js", "test-fixtures.js"],
              "recommended_resources": "100M credits",
              "continuation_steps": [
                "Resume with 'essential' mode",
                "Focus on critical path files first",
                "Defer non-essential utilities",
                "Validate tests after each chunk"
              ]
            }
          }
        }
      }
    ]
  }
}