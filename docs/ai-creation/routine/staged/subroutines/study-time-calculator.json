{
  "id": "7829564732190850181",
  "publicId": "study-time-calc-v1",
  "resourceType": "Routine",
  "isPrivate": false,
  "permissions": "{}",
  "isInternal": false,
  "tags": [],
  "versions": [
    {
      "id": "7829564732190850182",
      "publicId": "study-time-calc-v1-0",
      "versionLabel": "1.0.0",
      "versionNotes": "Initial version - Calculates available study time and constraints",
      "isComplete": true,
      "isPrivate": false,
      "versionIndex": 0,
      "isAutomatable": true,
      "resourceSubType": "RoutineCode",
      "config": {
        "__version": "1.0",
        "callDataCode": {
          "__version": "1.0",
          "schema": {
            "language": "javascript",
            "logic": "function calculateStudyTime({ examSchedule, dailySchedule, commitments }) {\n  // Parse exam dates to calculate time until each exam\n  const exams = Array.isArray(examSchedule) ? examSchedule : [examSchedule];\n  const today = new Date();\n  \n  const examTimelines = exams.map(exam => {\n    const examDate = new Date(exam.date || exam.examDate);\n    const daysUntilExam = Math.ceil((examDate - today) / (1000 * 60 * 60 * 24));\n    return {\n      subject: exam.subject || exam.name,\n      examDate: examDate,\n      daysUntilExam: Math.max(0, daysUntilExam),\n      importance: exam.importance || exam.weight || 'medium',\n      type: exam.type || 'written'\n    };\n  }).sort((a, b) => a.daysUntilExam - b.daysUntilExam);\n  \n  // Parse daily schedule to find available study time\n  const schedule = dailySchedule || {\n    weekdays: { freeHours: 3, preferredTimes: ['evening'] },\n    weekends: { freeHours: 6, preferredTimes: ['morning', 'afternoon'] }\n  };\n  \n  // Calculate base available hours per week\n  const weekdayHours = schedule.weekdays?.freeHours || 2;\n  const weekendHours = schedule.weekends?.freeHours || 4;\n  const baseWeeklyHours = (weekdayHours * 5) + (weekendHours * 2);\n  \n  // Account for commitments and reduce available time\n  const commitmentReduction = commitments ? calculateCommitmentImpact(commitments) : 0.1;\n  const adjustedWeeklyHours = baseWeeklyHours * (1 - commitmentReduction);\n  \n  function calculateCommitmentImpact(commitments) {\n    let impact = 0;\n    if (commitments.work && commitments.work > 40) impact += 0.2;\n    if (commitments.family === 'high') impact += 0.15;\n    if (commitments.social === 'high') impact += 0.1;\n    if (commitments.other && commitments.other.length > 0) impact += 0.05;\n    return Math.min(impact, 0.4); // Cap at 40% reduction\n  }\n  \n  // Calculate study capacity for each exam period\n  const studyCapacity = examTimelines.map(exam => {\n    const weeksUntilExam = Math.ceil(exam.daysUntilExam / 7);\n    const totalAvailableHours = weeksUntilExam * adjustedWeeklyHours;\n    \n    // Reserve some time for final review (20% of total time)\n    const studyHours = totalAvailableHours * 0.8;\n    const reviewHours = totalAvailableHours * 0.2;\n    \n    return {\n      subject: exam.subject,\n      totalHours: totalAvailableHours,\n      studyHours: Math.floor(studyHours),\n      reviewHours: Math.floor(reviewHours),\n      weeksAvailable: weeksUntilExam,\n      hoursPerWeek: Math.floor(adjustedWeeklyHours),\n      intensity: calculateIntensity(totalAvailableHours, exam.importance)\n    };\n  });\n  \n  function calculateIntensity(hours, importance) {\n    const importanceMultiplier = {\n      'low': 0.7,\n      'medium': 1.0,\n      'high': 1.3,\n      'critical': 1.5\n    };\n    \n    const baseIntensity = hours < 20 ? 'intensive' :\n                         hours < 50 ? 'moderate' :\n                         hours < 100 ? 'standard' : 'relaxed';\n    \n    const multiplier = importanceMultiplier[importance] || 1.0;\n    \n    if (multiplier > 1.2 && baseIntensity === 'relaxed') return 'standard';\n    if (multiplier > 1.2 && baseIntensity === 'standard') return 'moderate';\n    if (multiplier < 0.8 && baseIntensity === 'intensive') return 'moderate';\n    \n    return baseIntensity;\n  }\n  \n  // Identify optimal study windows\n  const studyWindows = {\n    weekdays: {\n      morning: schedule.weekdays?.preferredTimes?.includes('morning') || false,\n      afternoon: schedule.weekdays?.preferredTimes?.includes('afternoon') || false,\n      evening: schedule.weekdays?.preferredTimes?.includes('evening') || true,\n      availableHours: weekdayHours\n    },\n    weekends: {\n      morning: schedule.weekends?.preferredTimes?.includes('morning') || true,\n      afternoon: schedule.weekends?.preferredTimes?.includes('afternoon') || true,\n      evening: schedule.weekends?.preferredTimes?.includes('evening') || false,\n      availableHours: weekendHours\n    },\n    optimal: identifyOptimalWindows(schedule)\n  };\n  \n  function identifyOptimalWindows(schedule) {\n    const windows = [];\n    \n    // Weekday windows\n    if (schedule.weekdays?.preferredTimes) {\n      schedule.weekdays.preferredTimes.forEach(time => {\n        windows.push({\n          day: 'weekdays',\n          time: time,\n          duration: Math.floor(weekdayHours / schedule.weekdays.preferredTimes.length),\n          frequency: 5 // 5 days per week\n        });\n      });\n    }\n    \n    // Weekend windows\n    if (schedule.weekends?.preferredTimes) {\n      schedule.weekends.preferredTimes.forEach(time => {\n        windows.push({\n          day: 'weekends',\n          time: time,\n          duration: Math.floor(weekendHours / schedule.weekends.preferredTimes.length),\n          frequency: 2 // 2 days per week\n        });\n      });\n    }\n    \n    return windows;\n  }\n  \n  // Calculate scheduling constraints\n  const timeConstraints = {\n    totalWeeklyHours: adjustedWeeklyHours,\n    commitmentImpact: commitmentReduction,\n    urgentExams: examTimelines.filter(e => e.daysUntilExam < 14).length,\n    overlappingPeriods: identifyOverlaps(examTimelines),\n    peakStudyPeriods: identifyPeakPeriods(examTimelines),\n    minimumDailyStudy: Math.max(1, Math.floor(adjustedWeeklyHours / 7)),\n    maximumDailyStudy: Math.min(8, Math.floor(adjustedWeeklyHours / 3))\n  };\n  \n  function identifyOverlaps(timelines) {\n    const overlaps = [];\n    for (let i = 0; i < timelines.length - 1; i++) {\n      for (let j = i + 1; j < timelines.length; j++) {\n        const daysDiff = Math.abs(timelines[i].daysUntilExam - timelines[j].daysUntilExam);\n        if (daysDiff < 7) {\n          overlaps.push({\n            exams: [timelines[i].subject, timelines[j].subject],\n            daysSeparation: daysDiff,\n            challenge: 'concurrent-preparation'\n          });\n        }\n      }\n    }\n    return overlaps;\n  }\n  \n  function identifyPeakPeriods(timelines) {\n    return timelines.map(exam => {\n      const startIntensive = Math.max(0, exam.daysUntilExam - 14);\n      const startFinal = Math.max(0, exam.daysUntilExam - 3);\n      \n      return {\n        subject: exam.subject,\n        intensiveStart: startIntensive,\n        finalReviewStart: startFinal,\n        examDay: exam.daysUntilExam\n      };\n    });\n  }\n  \n  return {\n    availableHours: studyCapacity,\n    studyWindows: studyWindows,\n    timeConstraints: timeConstraints\n  };\n}"
          }
        },
        "formInput": {
          "__version": "1.0",
          "schema": {
            "containers": [],
            "elements": [
              {
                "fieldName": "examSchedule",
                "id": "exam_schedule_input",
                "label": "Exam Schedule",
                "type": "JSON",
                "isRequired": true,
                "props": {
                  "placeholder": "Exam dates and subjects"
                }
              },
              {
                "fieldName": "dailySchedule",
                "id": "daily_schedule_input",
                "label": "Time Availability",
                "type": "JSON",
                "isRequired": true,
                "props": {
                  "placeholder": "Available study time per day"
                }
              },
              {
                "fieldName": "commitments",
                "id": "commitments_input",
                "label": "Existing Obligations",
                "type": "JSON",
                "isRequired": false,
                "props": {
                  "placeholder": "Work, family, and other commitments"
                }
              }
            ]
          }
        },
        "formOutput": {
          "__version": "1.0",
          "schema": {
            "containers": [],
            "elements": [
              {
                "fieldName": "availableHours",
                "id": "available_hours_output",
                "label": "Study Capacity",
                "type": "JSON"
              },
              {
                "fieldName": "studyWindows",
                "id": "study_windows_output",
                "label": "Learning Slots",
                "type": "JSON"
              },
              {
                "fieldName": "timeConstraints",
                "id": "time_constraints_output",
                "label": "Scheduling Limits",
                "type": "JSON"
              }
            ]
          }
        },
        "executionStrategy": "deterministic"
      },
      "translations": [
        {
          "id": "7829564732190850183",
          "language": "en",
          "name": "Study Time Calculator",
          "description": "Determines study capacity and scheduling constraints based on exam dates and available time.",
          "instructions": "Provide exam schedule, daily availability, and existing commitments. The routine will calculate study capacity and optimal time windows."
        }
      ]
    }
  ]
}