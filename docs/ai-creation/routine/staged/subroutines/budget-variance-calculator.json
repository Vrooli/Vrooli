{
  "id": "7829564732190850007",
  "publicId": "budget-var-v1",
  "resourceType": "Routine",
  "isPrivate": false,
  "permissions": "{}",
  "isInternal": false,
  "tags": [],
  "versions": [
    {
      "id": "7829564732190850008",
      "publicId": "budget-var-v1-0",
      "versionLabel": "1.0.0",
      "versionNotes": "Initial version - Calculates budget variance and identifies over/under spending",
      "isComplete": true,
      "isPrivate": false,
      "versionIndex": 0,
      "isAutomatable": true,
      "resourceSubType": "RoutineCode",
      "config": {
        "__version": "1.0",
        "callDataCode": {
          "__version": "1.0",
          "schema": {
            "code": "function calculateBudgetVariance(input) {\n  const { categoryTotals, budgetLimits, budgetPeriod } = input;\n  \n  const result = {\n    budgetVariance: {},\n    overBudgetCategories: [],\n    underBudgetCategories: [],\n    totalBudget: 0,\n    totalSpent: 0,\n    remainingBudget: 0\n  };\n  \n  // Calculate variance for each category\n  for (const category in budgetLimits) {\n    const budgeted = budgetLimits[category] || 0;\n    const spent = categoryTotals[category] || 0;\n    const variance = budgeted - spent;\n    const percentageUsed = budgeted > 0 ? (spent / budgeted) * 100 : 0;\n    \n    result.budgetVariance[category] = {\n      budgeted,\n      spent,\n      variance,\n      percentageUsed: Math.round(percentageUsed * 10) / 10,\n      status: variance < 0 ? 'over' : variance > budgeted * 0.1 ? 'under' : 'on-track'\n    };\n    \n    if (variance < 0) {\n      result.overBudgetCategories.push({\n        category,\n        overspent: Math.abs(variance),\n        percentageOver: Math.round((Math.abs(variance) / budgeted) * 1000) / 10\n      });\n    } else if (percentageUsed < 80) {\n      result.underBudgetCategories.push({\n        category,\n        remaining: variance,\n        percentageRemaining: Math.round((variance / budgeted) * 1000) / 10\n      });\n    }\n    \n    result.totalBudget += budgeted;\n    result.totalSpent += spent;\n  }\n  \n  // Check for spending in non-budgeted categories\n  for (const category in categoryTotals) {\n    if (!budgetLimits[category]) {\n      result.overBudgetCategories.push({\n        category,\n        overspent: categoryTotals[category],\n        percentageOver: 100,\n        note: 'No budget allocated for this category'\n      });\n    }\n  }\n  \n  result.remainingBudget = result.totalBudget - result.totalSpent;\n  result.overallStatus = result.remainingBudget >= 0 ? 'within-budget' : 'over-budget';\n  result.budgetUtilization = Math.round((result.totalSpent / result.totalBudget) * 1000) / 10;\n  \n  // Sort over-budget categories by amount overspent\n  result.overBudgetCategories.sort((a, b) => b.overspent - a.overspent);\n  \n  return result;\n}\n\n// Execute the calculation\nconst output = calculateBudgetVariance(input);\nreturn output;",
            "language": "javascript"
          }
        },
        "formInput": {
          "__version": "1.0",
          "schema": {
            "containers": [],
            "elements": [
              {
                "fieldName": "categoryTotals",
                "id": "category_totals_input",
                "label": "Spending by Category",
                "type": "JSON",
                "isRequired": true,
                "props": {
                  "placeholder": "Object with category names as keys and spent amounts as values"
                }
              },
              {
                "fieldName": "budgetLimits",
                "id": "budget_limits_input",
                "label": "Budget Allocations",
                "type": "JSON",
                "isRequired": true,
                "props": {
                  "placeholder": "Object with category names as keys and budget amounts as values"
                }
              },
              {
                "fieldName": "budgetPeriod",
                "id": "budget_period_input",
                "label": "Budget Period",
                "type": "Text",
                "isRequired": false,
                "props": {
                  "placeholder": "Time period for the budget (e.g., 'Monthly', 'Quarterly')"
                }
              }
            ]
          }
        },
        "formOutput": {
          "__version": "1.0",
          "schema": {
            "containers": [],
            "elements": [
              {
                "fieldName": "budgetVariance",
                "id": "budget_variance_output",
                "label": "Budget Variance Details",
                "type": "JSON"
              },
              {
                "fieldName": "overBudgetCategories",
                "id": "over_budget_output",
                "label": "Over Budget Categories",
                "type": "JSON"
              },
              {
                "fieldName": "underBudgetCategories",
                "id": "under_budget_output",
                "label": "Under Budget Categories",
                "type": "JSON"
              }
            ]
          }
        },
        "executionStrategy": "deterministic"
      },
      "translations": [
        {
          "id": "7829564732190850009",
          "language": "en",
          "name": "Budget Variance Calculator",
          "description": "Calculates budget variance by comparing actual spending against planned budget allocations for each category.",
          "instructions": "Provide category spending totals and budget limits as JSON objects. The routine will calculate variance, identify over/under budget categories, and provide detailed budget utilization metrics."
        }
      ]
    }
  ]
}