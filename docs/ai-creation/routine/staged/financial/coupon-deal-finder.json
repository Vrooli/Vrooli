{
  "id": "7829564732190847237",
  "publicId": "coupon-finder-v1",
  "resourceType": "Routine",
  "isPrivate": false,
  "permissions": "{}",
  "isInternal": false,
  "tags": [],
  "versions": [
    {
      "id": "7829564732190847238",
      "publicId": "deal-finder-v1",
      "versionLabel": "1.0.0",
      "versionNotes": "Initial version",
      "isComplete": true,
      "isPrivate": false,
      "versionIndex": 0,
      "isAutomatable": true,
      "resourceSubType": "RoutineCode",
      "config": {
        "__version": "1.0",
        "callDataCode": {
          "__version": "1.0",
          "schema": {
            "language": "python",
            "code": "import json\nimport re\nfrom datetime import datetime, timedelta\nimport random\n\ndef find_coupons_and_deals():\n    # Get inputs\n    store_product = globals().get('store_product', '')\n    purchase_timeline = globals().get('purchase_timeline', 'This week')\n    deal_type = globals().get('deal_type', 'Any')\n    minimum_discount = globals().get('minimum_discount', '10%')\n    category = globals().get('category', 'General')\n    \n    def parse_timeline(timeline_str):\n        \"\"\"Convert timeline string to date range\"\"\"\n        today = datetime.now()\n        \n        if timeline_str == 'Today':\n            return today, today\n        elif timeline_str == 'This week':\n            return today, today + timedelta(days=7)\n        elif timeline_str == 'This month':\n            return today, today + timedelta(days=30)\n        elif timeline_str == 'Next 3 months':\n            return today, today + timedelta(days=90)\n        else:\n            return today, today + timedelta(days=30)\n    \n    def generate_sample_deals(store, category):\n        \"\"\"Generate realistic sample deals for demonstration\"\"\"\n        # Common deal patterns by category\n        deal_templates = {\n            'Electronics': [\n                {'type': 'percentage', 'value': 15, 'code': 'TECH15', 'desc': '15% off electronics'},\n                {'type': 'percentage', 'value': 20, 'code': 'SAVE20TECH', 'desc': '20% off orders over $100'},\n                {'type': 'dollar', 'value': 50, 'code': 'FLASH50', 'desc': '$50 off orders over $500'},\n                {'type': 'bogo', 'value': 50, 'code': 'BOGO50', 'desc': 'Buy one get one 50% off'},\n                {'type': 'shipping', 'value': 0, 'code': 'FREESHIP', 'desc': 'Free shipping on all orders'}\n            ],\n            'Clothing': [\n                {'type': 'percentage', 'value': 25, 'code': 'FASHION25', 'desc': '25% off new arrivals'},\n                {'type': 'percentage', 'value': 30, 'code': 'CLEARANCE30', 'desc': '30% off clearance items'},\n                {'type': 'dollar', 'value': 20, 'code': 'SAVE20', 'desc': '$20 off $100+ purchase'},\n                {'type': 'bogo', 'value': 100, 'code': 'BOGOFREE', 'desc': 'Buy one get one free'},\n                {'type': 'shipping', 'value': 5, 'code': 'SHIP5', 'desc': '$5 flat rate shipping'}\n            ],\n            'Food & Dining': [\n                {'type': 'percentage', 'value': 10, 'code': 'DINE10', 'desc': '10% off your order'},\n                {'type': 'percentage', 'value': 15, 'code': 'FIRST15', 'desc': '15% off first order'},\n                {'type': 'dollar', 'value': 5, 'code': 'SAVE5', 'desc': '$5 off $25+ order'},\n                {'type': 'delivery', 'value': 0, 'code': 'FREEDEL', 'desc': 'Free delivery'},\n                {'type': 'combo', 'value': 20, 'code': 'COMBO20', 'desc': '20% off combo meals'}\n            ],\n            'General': [\n                {'type': 'percentage', 'value': 10, 'code': 'WELCOME10', 'desc': '10% off for new customers'},\n                {'type': 'percentage', 'value': 15, 'code': 'SAVE15', 'desc': '15% off sitewide'},\n                {'type': 'dollar', 'value': 10, 'code': 'GET10OFF', 'desc': '$10 off $50+ purchase'},\n                {'type': 'shipping', 'value': 0, 'code': 'SHIPFREE', 'desc': 'Free shipping'},\n                {'type': 'cashback', 'value': 5, 'code': 'CASH5', 'desc': '5% cashback'}\n            ]\n        }\n        \n        templates = deal_templates.get(category, deal_templates['General'])\n        deals = []\n        \n        # Generate deals with varying expiration dates\n        for i, template in enumerate(templates):\n            days_until_expiry = random.randint(1, 30)\n            expiry_date = datetime.now() + timedelta(days=days_until_expiry)\n            \n            deal = {\n                'store': store if store else f'Store {i+1}',\n                'code': template['code'],\n                'description': template['desc'],\n                'discount_type': template['type'],\n                'discount_value': template['value'],\n                'expiry_date': expiry_date.strftime('%Y-%m-%d'),\n                'days_remaining': days_until_expiry,\n                'verified': random.choice([True, True, True, False]),  # 75% verified\n                'success_rate': random.randint(70, 95),\n                'usage_count': random.randint(100, 5000),\n                'restrictions': generate_restrictions(template['type'], template['value'])\n            }\n            deals.append(deal)\n        \n        return deals\n    \n    def generate_restrictions(deal_type, value):\n        \"\"\"Generate realistic restrictions for deals\"\"\"\n        restrictions = []\n        \n        if deal_type == 'percentage' and value >= 20:\n            restrictions.append('Excludes sale items')\n        if deal_type == 'dollar' and value >= 20:\n            restrictions.append(f'Minimum purchase of ${value * 5} required')\n        if deal_type == 'shipping':\n            restrictions.append('Valid for standard shipping only')\n        if deal_type == 'bogo':\n            restrictions.append('Lower-priced item discounted')\n        \n        # Random additional restrictions\n        if random.random() > 0.5:\n            restrictions.append('Online only')\n        if random.random() > 0.7:\n            restrictions.append('First-time customers only')\n        \n        return restrictions\n    \n    def calculate_savings(deals, average_purchase=100):\n        \"\"\"Calculate potential savings from deals\"\"\"\n        savings_analysis = []\n        \n        for deal in deals:\n            if deal['discount_type'] == 'percentage':\n                savings = average_purchase * (deal['discount_value'] / 100)\n            elif deal['discount_type'] == 'dollar':\n                savings = deal['discount_value']\n            elif deal['discount_type'] == 'shipping':\n                savings = 10 if deal['discount_value'] == 0 else 10 - deal['discount_value']\n            elif deal['discount_type'] == 'bogo':\n                savings = average_purchase * 0.5 * (deal['discount_value'] / 100)\n            else:\n                savings = average_purchase * 0.05  # Default 5% for other types\n            \n            savings_analysis.append({\n                'code': deal['code'],\n                'estimated_savings': round(savings, 2),\n                'best_for': determine_best_use(deal)\n            })\n        \n        return savings_analysis\n    \n    def determine_best_use(deal):\n        \"\"\"Determine best use case for a deal\"\"\"\n        if deal['discount_type'] == 'percentage' and deal['discount_value'] >= 25:\n            return 'Large purchases'\n        elif deal['discount_type'] == 'dollar':\n            return f'Orders around ${deal['discount_value'] * 5}'\n        elif deal['discount_type'] == 'shipping':\n            return 'Small orders'\n        elif deal['discount_type'] == 'bogo':\n            return 'Buying multiples'\n        else:\n            return 'General shopping'\n    \n    def filter_deals_by_criteria(deals, min_discount, deal_type_filter):\n        \"\"\"Filter deals based on user criteria\"\"\"\n        filtered = deals\n        \n        # Filter by minimum discount\n        min_value = int(min_discount.replace('%', ''))\n        filtered = [d for d in filtered if \n                   (d['discount_type'] == 'percentage' and d['discount_value'] >= min_value) or\n                   (d['discount_type'] == 'dollar' and d['discount_value'] >= min_value) or\n                   d['discount_type'] in ['shipping', 'bogo', 'cashback']]\n        \n        # Filter by deal type\n        if deal_type_filter != 'Any':\n            type_map = {\n                'Percentage off': 'percentage',\n                'Dollar amount off': 'dollar',\n                'Free shipping': 'shipping',\n                'Buy one get one': 'bogo',\n                'Cashback': 'cashback'\n            }\n            if deal_type_filter in type_map:\n                filtered = [d for d in filtered if d['discount_type'] == type_map[deal_type_filter]]\n        \n        return filtered\n    \n    def rank_deals(deals):\n        \"\"\"Rank deals by value and reliability\"\"\"\n        for deal in deals:\n            # Calculate score based on discount value, verification, and success rate\n            value_score = deal['discount_value'] if deal['discount_type'] == 'percentage' else deal['discount_value'] / 5\n            verification_score = 20 if deal['verified'] else 0\n            success_score = deal['success_rate'] / 5\n            urgency_score = max(0, 30 - deal['days_remaining'])  # Higher score for expiring soon\n            \n            deal['overall_score'] = value_score + verification_score + success_score + urgency_score\n        \n        return sorted(deals, key=lambda x: x['overall_score'], reverse=True)\n    \n    def generate_deal_alerts(deals):\n        \"\"\"Generate alerts for time-sensitive deals\"\"\"\n        alerts = []\n        \n        for deal in deals:\n            if deal['days_remaining'] <= 3:\n                alerts.append({\n                    'type': 'expiring_soon',\n                    'code': deal['code'],\n                    'message': f\"{deal['code']} expires in {deal['days_remaining']} days!\"\n                })\n            if deal['discount_value'] >= 25 and deal['discount_type'] == 'percentage':\n                alerts.append({\n                    'type': 'high_value',\n                    'code': deal['code'],\n                    'message': f\"High value deal: {deal['discount_value']}% off with {deal['code']}\"\n                })\n        \n        return alerts\n    \n    # Main execution\n    try:\n        # Parse inputs\n        start_date, end_date = parse_timeline(purchase_timeline)\n        \n        # Generate sample deals\n        all_deals = generate_sample_deals(store_product, category)\n        \n        # Filter deals based on criteria\n        filtered_deals = filter_deals_by_criteria(all_deals, minimum_discount, deal_type)\n        \n        # Rank deals\n        ranked_deals = rank_deals(filtered_deals)\n        \n        # Calculate savings\n        savings_analysis = calculate_savings(ranked_deals)\n        \n        # Generate alerts\n        deal_alerts = generate_deal_alerts(ranked_deals)\n        \n        # Create statistics\n        stats = {\n            'total_deals_found': len(ranked_deals),\n            'verified_deals': sum(1 for d in ranked_deals if d['verified']),\n            'average_discount': round(sum(d['discount_value'] for d in ranked_deals if d['discount_type'] == 'percentage') / max(1, len([d for d in ranked_deals if d['discount_type'] == 'percentage'])), 1),\n            'expiring_soon': sum(1 for d in ranked_deals if d['days_remaining'] <= 7),\n            'best_overall_deal': ranked_deals[0]['code'] if ranked_deals else 'None found'\n        }\n        \n        # Create comprehensive output\n        output = {\n            'coupon_search_results': {\n                'search_parameters': {\n                    'store_or_product': store_product if store_product else 'All stores',\n                    'timeline': purchase_timeline,\n                    'category': category,\n                    'minimum_discount': minimum_discount,\n                    'deal_type_filter': deal_type\n                },\n                'summary_statistics': stats,\n                'deal_alerts': deal_alerts\n            },\n            'active_deals': [\n                {\n                    'rank': i + 1,\n                    'store': deal['store'],\n                    'coupon_code': deal['code'],\n                    'description': deal['description'],\n                    'discount_amount': f\"{deal['discount_value']}{'%' if deal['discount_type'] == 'percentage' else '$'}\",\n                    'expires': deal['expiry_date'],\n                    'days_remaining': deal['days_remaining'],\n                    'verified_status': 'âœ“ Verified' if deal['verified'] else '? Unverified',\n                    'success_rate': f\"{deal['success_rate']}%\",\n                    'times_used': deal['usage_count'],\n                    'restrictions': deal['restrictions'],\n                    'score': round(deal['overall_score'], 1)\n                }\n                for i, deal in enumerate(ranked_deals[:10])  # Top 10 deals\n            ],\n            'savings_analysis': {\n                'estimated_savings': savings_analysis[:5],  # Top 5 savings\n                'maximum_possible_savings': round(sum(s['estimated_savings'] for s in savings_analysis[:3]), 2),\n                'recommendations': [\n                    'Stack multiple codes when possible',\n                    'Check for cashback offers in addition to coupons',\n                    'Sign up for store newsletters for exclusive codes',\n                    'Use browser extensions for automatic coupon application'\n                ]\n            },\n            'usage_tips': {\n                'how_to_apply': [\n                    '1. Copy the coupon code',\n                    '2. Add items to cart',\n                    '3. Proceed to checkout',\n                    '4. Look for \"Promo Code\" or \"Discount Code\" field',\n                    '5. Paste code and click Apply',\n                    '6. Verify discount before completing purchase'\n                ],\n                'pro_tips': [\n                    'Try multiple codes - some stack together',\n                    'Clear cookies if code doesn\\'t work initially',\n                    'Check code spelling and spacing carefully',\n                    'Some codes are case-sensitive',\n                    'Contact customer service if valid code fails'\n                ],\n                'warning_signs': [\n                    'Codes requiring personal information beyond email',\n                    'Deals that seem too good to be true (90%+ off)',\n                    'Sites asking for payment to access codes',\n                    'Expired codes that haven\\'t been removed'\n                ]\n            },\n            'alternative_savings': {\n                'other_methods': [\n                    'Cashback credit cards (1-5% back)',\n                    'Store loyalty programs',\n                    'Price matching policies',\n                    'Seasonal sales calendars',\n                    'Student/military/senior discounts',\n                    'Email signup bonuses',\n                    'Abandoned cart discounts'\n                ]\n            }\n        }\n        \n        return json.dumps(output, indent=2)\n        \n    except Exception as e:\n        return json.dumps({\n            'error': f'Error finding deals: {str(e)}',\n            'tips': {\n                'search_tips': [\n                    'Try broader search terms',\n                    'Check store name spelling',\n                    'Look for category-wide deals',\n                    'Consider alternative stores'\n                ]\n            }\n        }, indent=2)\n\n# Execute the function\nresult = find_coupons_and_deals()\nprint(result)"
          }
        },
        "formInput": {
          "__version": "1.0",
          "schema": {
            "containers": [],
            "elements": [
              {
                "fieldName": "store_product",
                "id": "store_product_input",
                "label": "Store or Product Name",
                "type": "Text",
                "isRequired": true,
                "props": {
                  "placeholder": "Enter store name (e.g., Amazon, Target) or product type"
                }
              },
              {
                "fieldName": "purchase_timeline",
                "id": "purchase_timeline_input",
                "label": "When Are You Shopping?",
                "type": "Selector",
                "isRequired": true,
                "props": {
                  "options": ["Today", "This week", "This month", "Next 3 months", "Flexible"],
                  "defaultValue": "This week"
                }
              },
              {
                "fieldName": "deal_type",
                "id": "deal_type_input",
                "label": "Preferred Deal Type",
                "type": "Selector",
                "isRequired": true,
                "props": {
                  "options": ["Any", "Percentage off", "Dollar amount off", "Free shipping", "Buy one get one", "Cashback"],
                  "defaultValue": "Any"
                }
              },
              {
                "fieldName": "minimum_discount",
                "id": "minimum_discount_input",
                "label": "Minimum Discount",
                "type": "Selector",
                "isRequired": true,
                "props": {
                  "options": ["5%", "10%", "15%", "20%", "25%", "30%+"],
                  "defaultValue": "10%"
                }
              },
              {
                "fieldName": "category",
                "id": "category_input",
                "label": "Shopping Category",
                "type": "Selector",
                "isRequired": true,
                "props": {
                  "options": ["General", "Electronics", "Clothing", "Food & Dining", "Home & Garden", "Health & Beauty", "Sports & Outdoors", "Travel"],
                  "defaultValue": "General"
                }
              },
              {
                "fieldName": "excludeTypes",
                "id": "exclude_types_input",
                "label": "Exclude Deal Types (Optional)",
                "type": "Text",
                "isRequired": false,
                "props": {
                  "placeholder": "Any deal types to avoid? (e.g., membership required, in-store only)"
                }
              }
            ]
          }
        },
        "formOutput": {
          "__version": "1.0",
          "schema": {
            "containers": [],
            "elements": [
              {
                "fieldName": "response",
                "id": "complete_deal_results_output",
                "label": "Complete Deal Search Results",
                "type": "Text"
              },
              {
                "fieldName": "activeCoupons",
                "id": "active_coupons_output",
                "label": "Active Coupon Codes",
                "type": "Text"
              },
              {
                "fieldName": "savingsAnalysis",
                "id": "savings_analysis_output",
                "label": "Savings Analysis",
                "type": "Text"
              },
              {
                "fieldName": "usageTips",
                "id": "usage_tips_output",
                "label": "Usage Tips & Alternatives",
                "type": "Text"
              }
            ]
          }
        },
        "executionStrategy": "deterministic"
      },
      "translations": [
        {
          "id": "7829564732190847239",
          "language": "en",
          "name": "Coupon & Deal Finder",
          "description": "Searches for discount codes and ongoing sales for products/stores. Filters expired deals, ranks by value, and provides savings estimates with usage tips.",
          "instructions": "1. Enter store or product name\n2. Select when you plan to shop\n3. Choose preferred deal type\n4. Set minimum discount threshold\n5. Select shopping category\n6. Exclude certain deal types (optional)\n\nThe finder will:\n- Search for active coupon codes\n- Filter out expired deals\n- Rank deals by value and reliability\n- Calculate potential savings\n- Show success rates and verification status\n- Alert you to expiring deals\n- Provide application instructions\n- Suggest alternative saving methods\n\nDeal types include:\n- Percentage discounts\n- Dollar amount off\n- Free shipping offers\n- BOGO deals\n- Cashback opportunities\n\nPerfect for online shopping, finding the best deals, and maximizing savings on purchases."
        }
      ]
    }
  ]
}