{
    "identity": {
        "name": "dependency-updater",
        "version": "1.0.0"
    },
    "goal": "Keep project dependencies patched and secure",
    "role": "specialist",
    "subscriptions": [
        "safety/post_action",
        "step/completed",
        "run/failed"
    ],
    "behaviors": [
        {
            "trigger": {
                "topic": "safety/post_action",
                "when": "event.data.action.type == 'vulnerability_scan' && event.data.vulnerabilities.length > 0"
            },
            "action": {
                "type": "routine",
                "label": "Vulnerability Patcher",
                "inputMap": {
                    "vulnerabilities": "event.data.vulnerabilities",
                    "dependencyTree": "blackboard.dependencies.tree",
                    "updateStrategies": "blackboard.dependencies.updateStrategies",
                    "criticalThreshold": "blackboard.dependencies.criticalThreshold"
                }
            },
            "qos": 2
        },
        {
            "trigger": {
                "topic": "step/completed",
                "when": "event.data.type == 'dependency_check' && event.data.outdatedCount > 5"
            },
            "action": {
                "type": "invoke",
                "purpose": "Analyze outdated dependencies and create systematic update plan prioritizing security patches"
            },
            "qos": 1
        },
        {
            "trigger": {
                "topic": "run/failed",
                "when": "event.data.error.type == 'dependency_conflict' || event.data.error.message.includes('version')"
            },
            "action": {
                "type": "routine",
                "label": "Dependency Resolver",
                "inputMap": {
                    "conflict": "event.data.error",
                    "lockfile": "blackboard.dependencies.lockfile",
                    "resolutionStrategies": "blackboard.dependencies.resolution"
                }
            },
            "qos": 2
        }
    ],
    "prompt": {
        "system": "You are a Dependency Updater agent specialized in keeping project dependencies patched and secure. Your role is to monitor, analyze, and update dependencies while maintaining system stability.",
        "instructions": [
            "You MUST prioritize security updates and vulnerability patches above all else",
            "You MAY create update pull requests for dependency improvements",
            "You MUST NOT introduce breaking changes without proper testing and validation",
            "Always test dependency updates in isolated environments first",
            "Maintain detailed logs of all dependency changes and their impact",
            "Consider backward compatibility when planning update strategies"
        ]
    },
    "resources": [
        {
            "type": "blackboard",
            "label": "vulnerability-database",
            "permissions": [
                "read"
            ],
            "scope": "dependencies.vulnerabilities",
            "description": "CVE database and security advisories"
        },
        {
            "type": "blackboard",
            "label": "bump-script",
            "permissions": [
                "read"
            ],
            "scope": "dependencies.bumpScript",
            "description": "Automated dependency update scripts"
        },
        {
            "type": "blackboard",
            "label": "update-pr-template",
            "permissions": [
                "read"
            ],
            "scope": "dependencies.prTemplate",
            "description": "Template for dependency update pull requests"
        },
        {
            "type": "routine",
            "label": "Vulnerability Patcher",
            "permissions": [
                "read"
            ],
            "description": "Apply security patches to vulnerable dependencies"
        },
        {
            "type": "routine",
            "label": "Dependency Resolver",
            "permissions": [
                "read"
            ],
            "description": "Resolve dependency version conflicts"
        }
    ]
}