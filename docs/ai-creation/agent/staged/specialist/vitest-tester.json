{
    "identity": {
        "name": "vitest-tester",
        "version": "1.0.0"
    },
    "goal": "Keep the repository's Vitest suite green and comprehensive",
    "role": "specialist",
    "subscriptions": [
        "step/completed",
        "run/completed",
        "safety/post_action"
    ],
    "behaviors": [
        {
            "trigger": {
                "topic": "step/completed",
                "when": "event.data.tags.includes('code_change')"
            },
            "action": {
                "type": "routine",
                "label": "Test Runner",
                "inputMap": {
                    "changedFiles": "event.data.files",
                    "testSuite": "blackboard.testing.vitest",
                    "coverageThreshold": "blackboard.quality.coverage.threshold"
                }
            },
            "qos": 1
        },
        {
            "trigger": {
                "topic": "run/completed",
                "when": "event.data.metrics.coverage < 85"
            },
            "action": {
                "type": "invoke",
                "purpose": "Analyze test coverage gaps and generate comprehensive test cases to meet coverage requirements"
            },
            "qos": 1
        },
        {
            "trigger": {
                "topic": "safety/post_action",
                "when": "event.data.action.type == 'deploy' && blackboard.testing.status != 'green'"
            },
            "action": {
                "type": "routine",
                "label": "Test Quality Enforcer",
                "inputMap": {
                    "deploymentTarget": "event.data.target",
                    "testStatus": "blackboard.testing.status",
                    "failedTests": "blackboard.testing.failures"
                }
            },
            "qos": 2
        }
    ],
    "prompt": {
        "mode": "supplement",
        "source": "direct",
        "content": "You must maintain comprehensive test coverage and ensure all tests pass consistently. You are authorized to create new test cases and improve existing test suites. You must never allow failing tests to remain in the codebase or permit deployments with broken tests."
    },
    "resources": [
        {
            "type": "blackboard",
            "label": "test-quality",
            "permissions": [
                "read",
                "write"
            ],
            "scope": "testing.quality",
            "description": "Track and update test quality metrics"
        },
        {
            "type": "blackboard",
            "label": "test-coverage",
            "permissions": [
                "read",
                "write"
            ],
            "scope": "testing.coverage",
            "description": "Monitor and update test coverage data"
        },
        {
            "type": "blackboard",
            "label": "coverage-dashboard",
            "permissions": [
                "write"
            ],
            "scope": "dashboards.coverage",
            "description": "Update coverage visualization dashboard"
        },
        {
            "type": "routine",
            "label": "Test Runner",
            "permissions": [
                "read"
            ],
            "description": "Execute Vitest suite and analyze results"
        },
        {
            "type": "routine",
            "label": "Test Quality Enforcer",
            "permissions": [
                "read"
            ],
            "description": "Enforce test quality standards before deployment"
        }
    ]
}