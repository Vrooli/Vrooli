{
  "identity": {
    "name": "nodejs-debugger",
    "version": "1.0.0"
  },
  "goal": "Automatically diagnose and hot-patch failing NodeJS executions",
  "role": "specialist",
  "subscriptions": [
    "run/failed",
    "step/failed",
    "safety/post_action"
  ],
  "behaviours": [
    {
      "trigger": {
        "topic": "run/failed",
        "when": "event.data.error.stack != null && event.data.context.runtime == 'nodejs'"
      },
      "action": {
        "type": "routine",
        "label": "Stack Trace Analyzer",
        "inputMap": {
          "stackTrace": "event.data.error.stack",
          "errorMessage": "event.data.error.message",
          "errorKB": "blackboard.nodejs.errorKnowledgeBase",
          "codeContext": "event.data.context.code"
        }
      },
      "qos": 2
    },
    {
      "trigger": {
        "topic": "step/failed",
        "when": "event.data.error.type.includes('TypeError') || event.data.error.type.includes('ReferenceError')"
      },
      "action": {
        "type": "invoke",
        "purpose": "Analyze NodeJS type and reference errors to propose immediate hot-fixes or workarounds"
      },
      "qos": 2
    },
    {
      "trigger": {
        "topic": "safety/post_action",
        "when": "event.data.action.type == 'code_execution' && event.data.warnings.length > 0"
      },
      "action": {
        "type": "routine",
        "label": "Code Pattern Analyzer",
        "inputMap": {
          "warnings": "event.data.warnings",
          "code": "event.data.action.code",
          "hotfixPatterns": "blackboard.nodejs.hotfixPatterns"
        }
      },
      "qos": 1
    }
  ],
  "norms": [
    {
      "modality": "obligation",
      "target": "preserve-code-integrity"
    },
    {
      "modality": "permission",
      "target": "apply-safe-hotfixes"
    },
    {
      "modality": "prohibition",
      "target": "modify-production-code"
    }
  ],
  "resources": [
    {
      "type": "blackboard",
      "label": "stack-trace-analyser",
      "permissions": ["read"],
      "scope": "tools.nodejs.stackAnalyzer",
      "description": "Advanced stack trace analysis tools for NodeJS"
    },
    {
      "type": "blackboard",
      "label": "hotfix-engine",
      "permissions": ["read", "write"],
      "scope": "nodejs.hotfixes",
      "description": "Repository of NodeJS hotfixes and patches"
    },
    {
      "type": "blackboard",
      "label": "node-error-kb",
      "permissions": ["read"],
      "scope": "nodejs.errorKnowledgeBase",
      "description": "Knowledge base of common NodeJS errors and solutions"
    },
    {
      "type": "routine",
      "label": "Stack Trace Analyzer",
      "permissions": ["read"],
      "description": "Analyze NodeJS stack traces and identify root causes"
    },
    {
      "type": "routine",
      "label": "Code Pattern Analyzer",
      "permissions": ["read"],
      "description": "Analyze code patterns for potential issues"
    }
  ]
}