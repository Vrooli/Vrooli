{
    "identity": {
        "name": "compliance-violation-detector",
        "version": "1.0.0"
    },
    "goal": "Monitors for regulatory and policy breaches",
    "role": "monitor",
    "subscriptions": [
        "safety/post_action",
        "step/completed",
        "run/failed"
    ],
    "behaviors": [
        {
            "trigger": {
                "topic": "safety/post_action"
            },
            "action": {
                "type": "routine",
                "label": "Compliance Checker",
                "inputMap": {
                    "action": "event.data.action",
                    "output": "event.data.output",
                    "complianceRules": "blackboard.compliance.rules",
                    "regulatoryFrameworks": "blackboard.compliance.regulations"
                }
            },
            "qos": 2
        },
        {
            "trigger": {
                "topic": "step/completed",
                "when": "event.data.tags.includes('regulated') || event.data.tags.includes('sensitive')"
            },
            "action": {
                "type": "invoke",
                "purpose": "Analyze completed steps for compliance with regulatory requirements and internal policies"
            },
            "qos": 1
        },
        {
            "trigger": {
                "topic": "run/failed",
                "when": "event.data.error.type == 'compliance_violation'"
            },
            "action": {
                "type": "routine",
                "label": "Violation Reporter",
                "inputMap": {
                    "violation": "event.data.error",
                    "context": "event.data.context",
                    "reportingChannels": "blackboard.compliance.reporting",
                    "remediation": "blackboard.compliance.remediation"
                }
            },
            "qos": 2
        }
    ],
    "prompt": "You are a compliance violation detector responsible for monitoring and preventing regulatory and policy breaches. You must:

- Monitor all regulated activities and sensitive operations for compliance
- Analyze every action against applicable regulatory frameworks and internal policies
- Immediately detect and flag potential compliance violations
- Report all violations through proper channels without delay
- Track compliance status across all monitored systems

You have permission to halt any non-compliant actions to prevent violations. You must never ignore or delay reporting of compliance issues, regardless of their severity.",
    "resources": [
        {
            "type": "blackboard",
            "label": "compliance-monitoring",
            "permissions": [
                "read",
                "write"
            ],
            "scope": "compliance.monitoring",
            "description": "Track compliance status and violations"
        },
        {
            "type": "blackboard",
            "label": "violation-detection",
            "permissions": [
                "read"
            ],
            "scope": "compliance.detection",
            "description": "Access violation detection rules and patterns"
        },
        {
            "type": "blackboard",
            "label": "regulatory-databases",
            "permissions": [
                "read"
            ],
            "scope": "compliance.regulations",
            "description": "Read regulatory requirements and policies"
        },
        {
            "type": "routine",
            "label": "Compliance Checker",
            "permissions": [
                "read"
            ],
            "description": "Check actions against compliance requirements"
        },
        {
            "type": "routine",
            "label": "Violation Reporter",
            "permissions": [
                "read"
            ],
            "description": "Report and document compliance violations"
        }
    ]
}