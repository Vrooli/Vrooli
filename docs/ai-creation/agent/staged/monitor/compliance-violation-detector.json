{
  "identity": {
    "name": "compliance-violation-detector",
    "version": "1.0.0"
  },
  "goal": "Monitors for regulatory and policy breaches",
  "role": "monitor",
  "subscriptions": [
    "safety/post_action",
    "step/completed",
    "run/failed"
  ],
  "behaviours": [
    {
      "trigger": {
        "topic": "safety/post_action"
      },
      "action": {
        "type": "routine",
        "label": "Compliance Checker",
        "inputMap": {
          "action": "event.data.action",
          "output": "event.data.output",
          "complianceRules": "blackboard.compliance.rules",
          "regulatoryFrameworks": "blackboard.compliance.regulations"
        }
      },
      "qos": 2
    },
    {
      "trigger": {
        "topic": "step/completed",
        "when": "event.data.tags.includes('regulated') || event.data.tags.includes('sensitive')"
      },
      "action": {
        "type": "invoke",
        "purpose": "Analyze completed steps for compliance with regulatory requirements and internal policies"
      },
      "qos": 1
    },
    {
      "trigger": {
        "topic": "run/failed",
        "when": "event.data.error.type == 'compliance_violation'"
      },
      "action": {
        "type": "routine",
        "label": "Violation Reporter",
        "inputMap": {
          "violation": "event.data.error",
          "context": "event.data.context",
          "reportingChannels": "blackboard.compliance.reporting",
          "remediation": "blackboard.compliance.remediation"
        }
      },
      "qos": 2
    }
  ],
  "norms": [
    {
      "modality": "obligation",
      "target": "monitor-all-regulated-activities"
    },
    {
      "modality": "permission",
      "target": "halt-non-compliant-actions"
    },
    {
      "modality": "obligation",
      "target": "report-violations-immediately"
    }
  ],
  "resources": [
    {
      "type": "blackboard",
      "label": "compliance-monitoring",
      "permissions": ["read", "write"],
      "scope": "compliance.monitoring",
      "description": "Track compliance status and violations"
    },
    {
      "type": "blackboard",
      "label": "violation-detection",
      "permissions": ["read"],
      "scope": "compliance.detection",
      "description": "Access violation detection rules and patterns"
    },
    {
      "type": "blackboard",
      "label": "regulatory-databases",
      "permissions": ["read"],
      "scope": "compliance.regulations",
      "description": "Read regulatory requirements and policies"
    },
    {
      "type": "routine",
      "label": "Compliance Checker",
      "permissions": ["read"],
      "description": "Check actions against compliance requirements"
    },
    {
      "type": "routine",
      "label": "Violation Reporter",
      "permissions": ["read"],
      "description": "Report and document compliance violations"
    }
  ]
}