# Twilio Resource Secrets Declaration
version: "1.0"
resource: "twilio"
description: "API credentials and configuration for Twilio cloud communications platform"

secrets:
  # Primary API credentials
  api_keys:
    - name: "account_sid"
      path: "secret/resources/twilio/api/account_sid"
      description: "Twilio Account SID for API authentication"
      required: true
      format: "string"
      validation:
        pattern: "^AC[a-f0-9]{32}$"
      default_env: "TWILIO_ACCOUNT_SID"
      example: "ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
      
    - name: "auth_token"
      path: "secret/resources/twilio/api/auth_token"
      description: "Twilio Auth Token for API authentication"
      required: true
      format: "string"
      validation:
        pattern: "^[a-f0-9]{32}$"
      default_env: "TWILIO_AUTH_TOKEN"
      example: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
      sensitive: true
      
  # Phone numbers configuration
  phone_numbers:
    - name: "default_from_number"
      path: "secret/resources/twilio/config/default_from_number"
      description: "Default phone number to send messages from"
      required: false
      format: "string"
      validation:
        pattern: "^\\+[1-9]\\d{1,14}$"
      default_env: "TWILIO_FROM_NUMBER"
      example: "+1234567890"
      
  # Optional API keys for sub-accounts
  subaccounts:
    - name: "test_account_sid"
      path: "secret/resources/twilio/test/account_sid"
      description: "Test account SID for development/testing"
      required: false
      format: "string"
      validation:
        pattern: "^AC[a-f0-9]{32}$"
      default_env: "TWILIO_TEST_ACCOUNT_SID"
      example: "ACtest_xxxxxxxxxxxxxxxxxxxxxxxxxx"
      
    - name: "test_auth_token"
      path: "secret/resources/twilio/test/auth_token"
      description: "Test account auth token for development/testing"
      required: false
      format: "string"
      validation:
        pattern: "^[a-f0-9]{32}$"
      default_env: "TWILIO_TEST_AUTH_TOKEN"
      example: "test_xxxxxxxxxxxxxxxxxxxxxxxxxxxx"
      sensitive: true

# No dependencies on other resource secrets
dependencies: []

# Initialization hints for vault
initialization:
  prompt_user:
    - name: "account_sid"
      prompt: "Enter your Twilio Account SID from https://console.twilio.com"
      validation: "Verify format matches ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
      
    - name: "auth_token"
      prompt: "Enter your Twilio Auth Token from https://console.twilio.com"
      validation: "Test API connection with credentials"
      
    - name: "default_from_number"
      prompt: "Enter your Twilio phone number (optional, format: +1234567890)"
      validation: "Verify phone number format"
      optional: true

# Health check validates credentials work
health_check:
  endpoint: "/health/secrets"
  required_secrets: ["account_sid", "auth_token"]
  test_command: "timeout 5 twilio api:core:accounts:list --limit 1"