workflow:
  name: "ecommerce-checkout"
  description: "Complete e-commerce checkout flow with cart, shipping, and payment"
  version: "1.0.0"
  debug_level: "steps"
  
  parameters:
    base_url:
      type: string
      required: true
      description: "E-commerce site base URL"
    product_url:
      type: string
      required: true
      description: "URL of product to purchase"
    quantity:
      type: number
      required: false
      description: "Quantity to purchase"
      default: 1
    shipping_info:
      type: object
      required: true
      description: "Shipping information"
      properties:
        first_name:
          type: string
        last_name:
          type: string
        address:
          type: string
        city:
          type: string
        state:
          type: string
        zip:
          type: string
        email:
          type: string
        phone:
          type: string
    payment_info:
      type: object
      required: true
      description: "Payment information"
      sensitive: true
      properties:
        card_number:
          type: string
        expiry:
          type: string
        cvv:
          type: string
        name_on_card:
          type: string
  
  steps:
    - name: "navigate-to-product"
      action: "navigate"
      url: "${params.product_url}"
      wait_for: "networkidle2"
      timeout: 30000
      debug:
        screenshot: true
        network: true
    
    - name: "wait-for-product-page"
      action: "wait_for_element"
      selector: ".add-to-cart, button[data-action='add-to-cart'], #add-to-cart-button"
      timeout: 10000
      visible: true
      debug:
        screenshot: false
    
    - name: "select-quantity"
      action: "select"
      selector: "select[name='quantity'], #quantity, .quantity-selector"
      value: "${params.quantity}"
      on_error: "continue"
      debug:
        screenshot: true
    
    - name: "add-to-cart"
      action: "click"
      selector: ".add-to-cart, button[data-action='add-to-cart'], #add-to-cart-button"
      wait_for_navigation: false
      debug:
        screenshot: true
        console: true
    
    - name: "wait-for-cart-update"
      action: "wait"
      duration: 2000
      debug:
        screenshot: false
    
    - name: "go-to-cart"
      action: "click"
      selector: ".cart-link, .view-cart, a[href*='/cart'], button:contains('View Cart')"
      wait_for_navigation: true
      debug:
        screenshot: true
    
    - name: "verify-cart-contents"
      action: "assert_element"
      selector: ".cart-item, .product-row, tr[data-product]"
      timeout: 5000
      debug:
        screenshot: true
    
    - name: "proceed-to-checkout"
      action: "click"
      selector: ".checkout-button, button:contains('Checkout'), a[href*='/checkout']"
      wait_for_navigation: true
      debug:
        screenshot: true
        network: true
    
    - name: "fill-shipping-info"
      action: "fill_form"
      selectors:
        first_name: "input[name='firstName'], #firstName, input[name='shipping_first_name']"
        last_name: "input[name='lastName'], #lastName, input[name='shipping_last_name']"
        email: "input[name='email'], #email, input[type='email']"
        phone: "input[name='phone'], #phone, input[type='tel']"
        address: "input[name='address'], #address, input[name='shipping_address']"
        city: "input[name='city'], #city, input[name='shipping_city']"
        state: "select[name='state'], #state, input[name='shipping_state']"
        zip: "input[name='zip'], #zip, input[name='shipping_zip']"
      values:
        first_name: "${params.shipping_info.first_name}"
        last_name: "${params.shipping_info.last_name}"
        email: "${params.shipping_info.email}"
        phone: "${params.shipping_info.phone}"
        address: "${params.shipping_info.address}"
        city: "${params.shipping_info.city}"
        state: "${params.shipping_info.state}"
        zip: "${params.shipping_info.zip}"
      debug:
        screenshot: true
    
    - name: "continue-to-payment"
      action: "click"
      selector: "button:contains('Continue'), button[type='submit'], .continue-button"
      wait_for_navigation: false
      debug:
        screenshot: true
    
    - name: "wait-for-payment-form"
      action: "wait_for_element"
      selector: "input[name='cardNumber'], #cardNumber, iframe[title*='card']"
      timeout: 10000
      debug:
        screenshot: false
    
    - name: "fill-payment-info"
      action: "fill_form"
      selectors:
        card_number: "input[name='cardNumber'], #cardNumber"
        expiry: "input[name='expiry'], #expiry, input[name='exp']"
        cvv: "input[name='cvv'], #cvv, input[name='cvc']"
        name_on_card: "input[name='nameOnCard'], #nameOnCard, input[name='cardholder']"
      values:
        card_number: "${params.payment_info.card_number}"
        expiry: "${params.payment_info.expiry}"
        cvv: "${params.payment_info.cvv}"
        name_on_card: "${params.payment_info.name_on_card}"
      debug:
        screenshot: false
    
    - name: "review-order"
      action: "screenshot"
      output: "${context.outputDir}/order-review.png"
      full_page: true
      debug:
        screenshot: true
    
    - name: "place-order"
      action: "click"
      selector: "button:contains('Place Order'), button:contains('Complete'), .place-order-button"
      wait_for_navigation: true
      on_error: "retry"
      debug:
        screenshot: true
        network: true
        console: true
    
    - name: "wait-for-confirmation"
      action: "wait_for_element"
      selector: ".order-confirmation, .order-number, h1:contains('Thank'), .success-message"
      timeout: 30000
      debug:
        screenshot: true
    
    - name: "extract-order-details"
      action: "extract_data"
      selectors:
        order_number: ".order-number, .confirmation-number, [data-order-id]"
        total: ".order-total, .total-price, .grand-total"
        estimated_delivery: ".delivery-date, .estimated-delivery, .shipping-estimate"
      output: "${context.outputDir}/order-details.json"
      debug:
        screenshot: true
    
    - name: "capture-confirmation"
      action: "screenshot"
      output: "${context.outputDir}/order-confirmation.png"
      full_page: true
      debug:
        screenshot: true